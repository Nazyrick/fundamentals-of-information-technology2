!function(e){function t(t){for(var i,s,a=t[0],c=t[1],l=t[2],d=0,h=[];d<a.length;d++)s=a[d],n[s]&&h.push(n[s][0]),n[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(p&&p(t);h.length;)h.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],i=!0,a=1;a<r.length;a++){var c=r[a];0!==n[c]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=r[0]))}return e}var i={},n={"web/apps":0},o=[];function s(t){if(i[t])return i[t].exports;var r=i[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=i,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/js/cmodules/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var p=c;o.push([97,"bundles/common","bundles/vendors","bundles/454fe4e6032ef0103496e107a1aed550"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t);var i=r("q1tI"),n=r.n(i),o=r("17x9"),s=r.n(o),a=n.a.createContext(null);var c=function(e){e()},l=function(){return c},p=null,d={notify:function(){}};var h=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=d,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){var e,t,r;this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=(e=l(),t=[],r=[],{clear:function(){r=p,t=p},notify:function(){var i=t=r;e(function(){for(var e=0;e<i.length;e++)i[e]()})},get:function(){return r},subscribe:function(e){var i=!0;return r===t&&(r=t.slice()),r.push(e),function(){i&&t!==p&&(i=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}))},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=d)},e}(),u=function(e){var t,r;function i(t){var r;r=e.call(this,t)||this;var i=t.store;r.notifySubscribers=r.notifySubscribers.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r));var n=new h(i);return n.onStateChange=r.notifySubscribers,r.state={store:i,subscription:n},r.previousState=i.getState(),r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var o=i.prototype;return o.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},o.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},o.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new h(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},o.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},o.render=function(){var e=this.props.context||a;return n.a.createElement(e.Provider,{value:this.state},this.props.children)},i}(i.Component);u.propTypes={store:s.a.shape({subscribe:s.a.func.isRequired,dispatch:s.a.func.isRequired,getState:s.a.func.isRequired}),context:s.a.object,children:s.a.any};var _=u;function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function m(e,t){if(null==e)return{};var r,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}var b=r("2mql"),g=r.n(b),v=r("QLaP"),w=r.n(v),E=r("TOwV"),y=[],O=[null,null];function C(e,t){var r=e[1];return[t.payload,r+1]}var S=function(){return[null,0]},A="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect;function P(e,t){void 0===t&&(t={});var r=t,o=r.getDisplayName,s=void 0===o?function(e){return"ConnectAdvanced("+e+")"}:o,c=r.methodName,l=void 0===c?"connectAdvanced":c,p=r.renderCountProp,d=void 0===p?void 0:p,u=r.shouldHandleStateChanges,_=void 0===u||u,b=r.storeKey,v=void 0===b?"store":b,P=r.withRef,k=void 0!==P&&P,T=r.forwardRef,M=void 0!==T&&T,D=r.context,R=void 0===D?a:D,I=m(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);w()(void 0===d,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),w()(!k,"withRef is removed. To access the wrapped instance, use a ref on the connected component");w()("store"===v,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var L=R;return function(t){var r=t.displayName||t.name||"Component",o=s(r),a=f({},I,{getDisplayName:s,methodName:l,renderCountProp:d,shouldHandleStateChanges:_,storeKey:v,displayName:o,wrappedComponentName:r,WrappedComponent:t}),c=I.pure;var p=c?i.useMemo:function(e){return e()};function u(r){var s=Object(i.useMemo)(function(){var e=r.forwardedRef,t=m(r,["forwardedRef"]);return[r.context,e,t]},[r]),c=s[0],l=s[1],d=s[2],u=Object(i.useMemo)(function(){return c&&c.Consumer&&Object(E.isContextConsumer)(n.a.createElement(c.Consumer,null))?c:L},[c,L]),b=Object(i.useContext)(u),g=Boolean(r.store),v=Boolean(b)&&Boolean(b.store);w()(g||v,'Could not find "store" in the context of "'+o+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+o+" in connect options.");var P=r.store||b.store,k=Object(i.useMemo)(function(){return function(t){return e(t.dispatch,a)}(P)},[P]),T=Object(i.useMemo)(function(){if(!_)return O;var e=new h(P,g?null:b.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]},[P,g,b]),M=T[0],D=T[1],R=Object(i.useMemo)(function(){return g?b:f({},b,{subscription:M})},[g,b,M]),I=Object(i.useReducer)(C,y,S),x=I[0][0],B=I[1];if(x&&x.error)throw x.error;var N=Object(i.useRef)(),j=Object(i.useRef)(d),W=Object(i.useRef)(),H=Object(i.useRef)(!1),U=p(function(){return W.current&&d===j.current?W.current:k(P.getState(),d)},[P,x,d]);A(function(){j.current=d,N.current=U,H.current=!1,W.current&&(W.current=null,D())}),A(function(){if(_){var e=!1,t=null,r=function(){if(!e){var r,i,n=P.getState();try{r=k(n,j.current)}catch(e){i=e,t=e}i||(t=null),r===N.current?H.current||D():(N.current=r,W.current=r,H.current=!0,B({type:"STORE_UPDATED",payload:{latestStoreState:n,error:i}}))}};M.onStateChange=r,M.trySubscribe(),r();return function(){if(e=!0,M.tryUnsubscribe(),t)throw t}}},[P,M,k]);var K=Object(i.useMemo)(function(){return n.a.createElement(t,f({},U,{ref:l}))},[l,t,U]);return Object(i.useMemo)(function(){return _?n.a.createElement(u.Provider,{value:R},K):K},[u,K,R])}var b=c?n.a.memo(u):u;if(b.WrappedComponent=t,b.displayName=o,M){var P=n.a.forwardRef(function(e,t){return n.a.createElement(b,f({},e,{forwardedRef:t}))});return P.displayName=o,P.WrappedComponent=t,g()(P,t)}return g()(b,t)}}var k=Object.prototype.hasOwnProperty;function T(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function M(e,t){if(T(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(var n=0;n<r.length;n++)if(!k.call(t,r[n])||!T(e[r[n]],t[r[n]]))return!1;return!0}var D=r("ANjH");function R(e){return function(t,r){var i=e(t,r);function n(){return i}return n.dependsOnOwnProps=!1,n}}function I(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function L(e,t){return function(t,r){r.displayName;var i=function(e,t){return i.dependsOnOwnProps?i.mapToProps(e,t):i.mapToProps(e)};return i.dependsOnOwnProps=!0,i.mapToProps=function(t,r){i.mapToProps=e,i.dependsOnOwnProps=I(e);var n=i(t,r);return"function"==typeof n&&(i.mapToProps=n,i.dependsOnOwnProps=I(n),n=i(t,r)),n},i}}var x=[function(e){return"function"==typeof e?L(e):void 0},function(e){return e?void 0:R(function(e){return{dispatch:e}})},function(e){return e&&"object"==typeof e?R(function(t){return Object(D.bindActionCreators)(e,t)}):void 0}];var B=[function(e){return"function"==typeof e?L(e):void 0},function(e){return e?void 0:R(function(){return{}})}];function N(e,t,r){return f({},r,e,t)}var j=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var i,n=r.pure,o=r.areMergedPropsEqual,s=!1;return function(t,r,a){var c=e(t,r,a);return s?n&&o(c,i)||(i=c):(s=!0,i=c),i}}}(e):void 0},function(e){return e?void 0:function(){return N}}];function W(e,t,r,i){return function(n,o){return r(e(n,o),t(i,o),o)}}function H(e,t,r,i,n){var o,s,a,c,l,p=n.areStatesEqual,d=n.areOwnPropsEqual,h=n.areStatePropsEqual,u=!1;function _(n,u){var _,f,m=!d(u,s),b=!p(n,o);return o=n,s=u,m&&b?(a=e(o,s),t.dependsOnOwnProps&&(c=t(i,s)),l=r(a,c,s)):m?(e.dependsOnOwnProps&&(a=e(o,s)),t.dependsOnOwnProps&&(c=t(i,s)),l=r(a,c,s)):b?(_=e(o,s),f=!h(_,a),a=_,f&&(l=r(a,c,s)),l):l}return function(n,p){return u?_(n,p):(a=e(o=n,s=p),c=t(i,s),l=r(a,c,s),u=!0,l)}}function U(e,t){var r=t.initMapStateToProps,i=t.initMapDispatchToProps,n=t.initMergeProps,o=m(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),s=r(e,o),a=i(e,o),c=n(e,o);return(o.pure?H:W)(s,a,c,e,o)}function K(e,t,r){for(var i=t.length-1;i>=0;i--){var n=t[i](e);if(n)return n}return function(t,i){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+i.wrappedComponentName+".")}}function F(e,t){return e===t}var V,G,q,z,Y,$,X,J,Z,Q,ee,te,re=(q=(G=void 0===V?{}:V).connectHOC,z=void 0===q?P:q,Y=G.mapStateToPropsFactories,$=void 0===Y?B:Y,X=G.mapDispatchToPropsFactories,J=void 0===X?x:X,Z=G.mergePropsFactories,Q=void 0===Z?j:Z,ee=G.selectorFactory,te=void 0===ee?U:ee,function(e,t,r,i){void 0===i&&(i={});var n=i,o=n.pure,s=void 0===o||o,a=n.areStatesEqual,c=void 0===a?F:a,l=n.areOwnPropsEqual,p=void 0===l?M:l,d=n.areStatePropsEqual,h=void 0===d?M:d,u=n.areMergedPropsEqual,_=void 0===u?M:u,b=m(n,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),g=K(e,$,"mapStateToProps"),v=K(t,J,"mapDispatchToProps"),w=K(r,Q,"mergeProps");return z(te,f({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:g,initMapDispatchToProps:v,initMergeProps:w,pure:s,areStatesEqual:c,areOwnPropsEqual:p,areStatePropsEqual:h,areMergedPropsEqual:_},b))});function ie(){var e=Object(i.useContext)(a);return w()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function ne(){return ie().store}function oe(){return ne().dispatch}var se="undefined"!=typeof window?i.useLayoutEffect:i.useEffect,ae=function(e,t){return e===t};function ce(e,t){void 0===t&&(t=ae),w()(e,"You must pass a selector to useSelectors");var r,n=ie(),o=n.store,s=n.subscription,a=Object(i.useReducer)(function(e){return e+1},0)[1],c=Object(i.useMemo)(function(){return new h(o,s)},[o,s]),l=Object(i.useRef)(),p=Object(i.useRef)(),d=Object(i.useRef)();try{r=e!==p.current||l.current?e(o.getState()):d.current}catch(e){var u="An error occured while selecting the store state: "+e.message+".";throw l.current&&(u+="\nThe error may be correlated with this previous error:\n"+l.current.stack+"\n\nOriginal stack trace:"),new Error(u)}return se(function(){p.current=e,d.current=r,l.current=void 0}),se(function(){function e(){try{var e=p.current(o.getState());if(t(e,d.current))return;d.current=e}catch(e){l.current=e}a({})}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}},[o,c]),r}var le,pe=r("i8i4");r.d(t,"Provider",function(){return _}),r.d(t,"connectAdvanced",function(){return P}),r.d(t,"ReactReduxContext",function(){return a}),r.d(t,"connect",function(){return re}),r.d(t,"batch",function(){return pe.unstable_batchedUpdates}),r.d(t,"useDispatch",function(){return oe}),r.d(t,"useSelector",function(){return ce}),r.d(t,"useStore",function(){return ne}),r.d(t,"shallowEqual",function(){return M}),le=pe.unstable_batchedUpdates,c=le},"/TnQ":function(e,t,r){"use strict";var i=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?i:i.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var i=r("q1tI"),n=r("/MKj"),o=r("ANjH"),s=r("/TnQ"),a=r("sINF"),c=r("xYVc"),l=function(){return(l=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},p={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:c.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},d=function(e,t){switch(void 0===e&&(e=p),t.type){case"SET_DATA_LOADED":return l(l({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return l(l({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return l(l({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return l(l({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return l(l({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return l(l({},e),{stickerHeaderScrollPosition:t.value});default:return e}},h=function(){return(h=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},u={color:c.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:c.default.FONTS[0]},_=function(e,t){switch(void 0===e&&(e=u),t.type){case"SET_SETTING_COLOR":return h(h({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return h(h({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return h(h({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return h(h({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return h(h({},e),{fontStyle:t.fontStyle});default:return e}},f=function(){return(f=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},m=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i},b={currentIndex:null,items:[]},g=function(e,t){switch(void 0===e&&(e=b),t.type){case"SET_CURRENT_LAYER":return f(f({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return f(f({},e),{items:m(e.items,[t.payload])});case"UPDATE_LAYER":return f(f({},e),{items:e.items.map(function(r,i){return e.currentIndex===i?f(f({},r),t.payload):r})});case"DELETE_LAYER":return{currentIndex:null,items:e.items.filter(function(e,r){return r!==t.index})};default:return e}},v=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i},w=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return v(e,[t.payload]);case"UNDO_DRAWING":return e.filter(function(t,r){return r!==e.length-1});default:return e}},E=function(){return(E=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},y={currentBackgroundType:c.default.BACKGROUND_MODES.PHOTO,currentPhotoUrl:null,currentBackgroundId:1},O=function(e,t){switch(void 0===e&&(e=y),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return E(E({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return E(E({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return E(E({},e),{currentBackgroundId:t.value});default:return e}},C=function(){return(C=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},S=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return C(C({},e),t.payload);default:return e}},A=Object(o.combineReducers)({ui:d,settings:_,layers:g,drawings:w,background:O,data:S}),P=r("mYgU"),k=r.n(P),T=r("ufMw"),M=r("nAFc"),D=r("jE6c"),R=function(e){return{type:"SET_CURRENT_LAYER",index:e}},I=function(e,t,r){return void 0===r&&(r=!0),function(i,n){var o=n().layers.items;i({type:e,payload:t}),r&&i(R(o.length))}},L=function(e,t){return function(r,i){var n,o,s=i(),a=s.data,l=s.settings,p=a.artboardWidth/2,d=a.artboardHeight/2-(parseInt(null===(n=a.addons)||void 0===n?void 0:n.photoOffsetTop)||0),h=Object(M.decodeHTMLEntities)(a.placeholders[Object(D.irand)(0,a.placeholders.length-1)]),u=0,_=!1,f=l.fontStyle,m=l.color,b=l.fontSize;t&&(p=void 0!==t.x?t.x:p,d=void 0!==t.y?t.y:d,h=void 0!==t.text?t.text:h,u=void 0!==t.rotate?t.rotate:u,_=void 0!==t.isEdit?t.isEdit:_,f=void 0!==t.style?t.style:f,m=void 0!==t.color?t.color:m,b=void 0!==t.fontSize?t.fontSize:b,o=t.initialFontSize),Object(T.sendStat)(T.EVENTS.ADD_TEXT),e&&r(W(c.default.TABS.TEXT)),r(I("ADD_LAYER_TEXT",{type:c.default.LAYER_TYPES.TEXT,text:h,x:p,y:d,rotate:u,isFixed:!1,isEdit:_,fontSize:b,initialFontSize:o,fontStyle:f,color:m,scale:1},e))}},x=function(e){return function(t,r){var i=r().layers,n=i.currentIndex,o=i.items;null!==n&&o[n]&&t({type:"UPDATE_LAYER",payload:e})}},B=function(){return function(e,t){var r=t().layers,i=r.currentIndex,n=r.items;if(null!==i){var o=n[i];o&&(o.type===c.default.LAYER_TYPES.STICKER?Object(T.sendStat)(T.EVENTS.DELETE_STICKER):o.type===c.default.LAYER_TYPES.TEXT&&Object(T.sendStat)(T.EVENTS.DELETE_TEXT),e(j(!1)),e({type:"DELETE_LAYER",index:i}))}}},N=function(){return function(e,t){var r=t().layers,i=r.currentIndex,n=r.items;if(null!==i){var o=n[i];o&&o.type===c.default.LAYER_TYPES.TEXT&&(n[i].text.trim()?e(x({isEdit:!1})):e(B()))}}},j=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},W=function(e){return function(t,r){var i=r().layers,n=i.items,o=i.currentIndex;null!==o&&(n[o].type===c.default.LAYER_TYPES.TEXT&&t(N()),e===c.default.TABS.PAINT&&t(R(null))),t({type:"SET_CURRENT_TAB",value:e})}},H=function(e){return function(t,r){var i=r().layers,n=i.currentIndex,o=i.items;n&&!o[n]||t(x({color:e})),t({type:"SET_SETTING_COLOR",color:e})}},U=function(){return Object(T.sendStat)(T.EVENTS.CANCEL_GRAFFITI),{type:"UNDO_DRAWING"}},K=r("i8i4");function F(e){return new Promise(function(t,r){var i=new Image;i.crossOrigin="Anonymous",i.onerror=function(){r(new Error("Failed to load image's URL: "+e))},i.onload=function(){t(i)},i.src=e})}function V(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0};var r=t.getBoundingClientRect(),i=r.left,n=r.top;return{x:e.clientX-i,y:e.clientY-n,xOrigin:i,yOrigin:n}}function G(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function q(){return new Promise(function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var i=r.target;if(!i)return t();if(!i.files)return t();var n=i.files[0],o=URL.createObjectURL(n);F(o).then(function(){(function(e){return new Promise(function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,i=new DataView(r.result);if(65496!=i.getUint16(0,!1))return t(-2);for(var n=i.byteLength,o=2;o<n;){if(i.getUint16(o+2,!1)<=8)return t(-1);var s=i.getUint16(o,!1);if(o+=2,65505==s){if(1165519206!=i.getUint32(o+=2,!1))return t(-1);var a=18761==i.getUint16(o+=6,!1);o+=i.getUint32(o+4,a);var c=i.getUint16(o,a);o+=2;for(var l=0;l<c;l++)if(274==i.getUint16(o+12*l,a))return t(i.getUint16(o+12*l+8,a))}else{if(65280!=(65280&s))break;o+=i.getUint16(o,!1)}}return t(-1)}},r.readAsArrayBuffer(e)})})(n).then(function(r){-1===r||-2===r||1===r?e(o):function(e,t){return new Promise(function(r,i){var n=new Image;n.onload=function(){var e=n.width,o=n.height,s=document.createElement("canvas"),a=s.getContext("2d");if(!a)return i();switch(4<t&&t<9?(s.width=o,s.height=e):(s.width=e,s.height=o),t){case 2:a.transform(-1,0,0,1,e,0);break;case 3:a.transform(-1,0,0,-1,e,o);break;case 4:a.transform(1,0,0,-1,0,o);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,o,0);break;case 7:a.transform(0,-1,-1,0,o,e);break;case 8:a.transform(0,-1,1,0,0,e)}a.drawImage(n,0,0),r(s.toDataURL())},n.src=e})}(o,r).then(function(t){e(t)}).catch(function(){t()})}).catch(function(){t()})}).catch(function(){t()})},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()})}function z(e,t,r,i,n,o,s){var a=0,c=0;switch(e){case"left_top":a=i+o,c=n+s;break;case"left_center":a=i+o,c=r/2+s;break;case"left_bottom":a=i+o,c=r-n+s;break;case"center_top":a=t/2+o,c=n+s;break;case"center":a=t/2+o,c=r/2+s;break;case"center_bottom":a=t/2+o,c=r-n+s;break;case"right_top":a=t-i+o,c=n+s;break;case"right_center":a=t-i+o,c=r/2+s;break;case"right_bottom":a=t-i+o,c=r-n+s}return{x:a,y:c}}var Y,$=(Y=function(e,t){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),X=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){return r.props.drawings.length!==e.drawings.length&&r.renderDrawings(e.drawings),!1},r.renderDrawings=function(e){var t=r.canvas.current;if(t){var i=t.getContext("2d");if(i){var n=r.props.data.originalHeight/r.props.height;i.clearRect(0,0,t.width,t.height),i.lineCap="round",i.lineJoin="round",e.forEach(function(e){i.lineWidth=e.width*c.default.BRUSH_WIDTH_COEFFICIENT*n,i.strokeStyle=G(e.color,e.opacity),i.beginPath(),i.moveTo(e.path[0][0]*n,e.path[0][1]*n),e.path.forEach(function(e){i.lineTo(e[0]*n,e[1]*n)}),i.stroke()})}}},r.drawStart=function(e){if(r.props.ui.currentMode===c.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=V(e.nativeEvent,r.canvas.current),i=t.x,n=t.y;r.currentDrawing=[[i,n]];var o=r.props.settings;r.props.addDrawing({color:o.color,width:o.brushWidth,opacity:o.brushOpacity,path:r.currentDrawing}),r.renderDrawings(r.props.drawings)}},r.drawProcess=function(e){var t=V(e,r.canvas.current),i=t.x,n=t.y;r.currentDrawing.push([i,n]),r.renderDrawings(r.props.drawings)},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvasDoubleClick=function(){r.props.ui.currentMode!==c.default.TABS.PAINT&&r.props.addLayerText(!0,{isEdit:!0})},r.canvas=i.createRef(),r.currentDrawing=[],r}return $(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,n=e.height;return i.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--draw",onDoubleClick:this.canvasDoubleClick,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:n}})},t}(i.Component),J=Object(n.connect)(function(e){return{ui:e.ui,settings:e.settings,drawings:e.drawings,data:e.data}},function(e){return{addDrawing:function(t){return e(function(e){return Object(T.sendStat)(T.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}}(t))},addLayerText:function(t,r){return e(L(t,r))}}})(X),Z=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Q=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i},ee=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props.background;return t.currentBackgroundId===e.background.currentBackgroundId&&t.currentBackgroundType===e.background.currentBackgroundType&&t.currentPhotoUrl===e.background.currentPhotoUrl||r.renderImage(e.background),!1},r.getBackgroundById=function(e){var t=r.props.data.backgrounds,i=t.gradients,n=t.emojies;return Q(i,n).filter(function(t){return t.id===e})[0]},r.getCurrentImageUrl=function(e){var t,i=e||r.props.background,n=i.currentBackgroundType,o=i.currentPhotoUrl,s=i.currentBackgroundId;n===c.default.BACKGROUND_MODES.PHOTO?t=o:t=r.getBackgroundById(s).url;return t},r.renderImage=function(e){var t=r.canvas.current;if(t){var i=r.getCurrentImageUrl(e);i&&F(i).then(function(e){var r=t.getContext("2d");if(r){var i=+(e.height/e.width).toFixed(2),n=t.width,o=t.width*i;if(r.save(),r.clearRect(0,0,t.width,t.height),r.filter="blur(135px)",r.drawImage(e,0,0,t.width,t.height),r.restore(),"none"!==r.filter){var s=function(e){var t,r={r:0,g:0,b:0};if(!e)return r;try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var i=-4,n=0;(i+=20)<t.data.length;)++n,r.r+=t.data[i],r.g+=t.data[i+1],r.b+=t.data[i+2];return r.r=~~(r.r/n),r.g=~~(r.g/n),r.b=~~(r.b/n),r}(r);r.fillStyle="rgb("+s.r+", "+s.g+", "+s.b+")",r.fillRect(0,0,t.width,t.height)}r.drawImage(e,t.width/2-n/2,t.height/2-o/2,n,o)}}).catch(function(e){console.error(e)})}},r.canvas=i.createRef(),r}return Z(t,e),t.prototype.componentDidMount=function(){this.renderImage()},t.prototype.render=function(){var e=this.props.data;return i.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:e.originalWidth,height:e.originalHeight,style:{width:this.props.width,height:this.props.height}})},t}(i.Component),te=Object(n.connect)(function(e){return{data:e.data,background:e.background}})(ee),re=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.layer=t.props.layer,t.layer.type===c.default.LAYER_TYPES.TEXT){var i=e.target.closest(".EditorLayer__inner");if(!i)return;t.width=i.offsetWidth,t.height=i.offsetHeight}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=V(e,document.querySelector(".EditorCanvas__canvas--draw")),i=r.x,n=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var o={x:i-t.layer.x,y:n-t.layer.y},s=180*(Math.atan2(o.y,o.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,a=Math.max(c.default.LAYER_MIN_SIZE,Math.sqrt(o.x*o.x+o.y*o.y))/t.distanceToZero,l=Math.floor(t.width*a),p=Math.floor(t.height*a);t.layer.type===c.default.LAYER_TYPES.TEXT?t.props.updateLayer({fontSize:t.layer.fontSize*a,rotate:s}):t.props.updateLayer({width:l,height:p,scale:a,rotate:s})}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return re(t,e),t.prototype.render=function(){var e=this;return i.createElement("div",{className:"EditorLayerSelection"},i.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),i.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),i.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),i.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(i.Component),ne=r("Xrg9"),oe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return oe(t,e),t.prototype.render=function(){return ne.default.get("story_show_clickable_zones")?this.props.clickableZones.map(function(e,t){var r=e.clickable_area,n=100*Math.abs(r[1].x-r[0].x),o=100*Math.abs(r[2].y-r[1].y);return i.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:n+"%",height:o+"%"}})}):null},t}(i.Component),ae=r("pemR"),ce=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderLayerSticker=function(e,r,n){var o=t.props.getStickerUrlById(e.id,c.default.STICKER_LARGE);return i.createElement("div",{key:r,className:n,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},i.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+o+"')"}},t.props.currentIndex===r&&i.createElement(ie,{layer:e,updateLayer:t.props.updateLayer})))},t.renderLayerImage=function(e,r,n){return i.createElement("div",{key:r,className:n,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},i.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+e.url+"')"}},t.props.currentIndex===r&&i.createElement(ie,{layer:e,updateLayer:t.props.updateLayer}),e.clickableZones&&i.createElement(se,{clickableZones:e.clickableZones})))},t.renderLayerText=function(e,r,n){var o=Math.max(2,e.fontSize*e.scale*c.default.FONT_SIZE_COEFFICIENT);n+=" PhotoEditorFontStyle--"+e.fontStyle;var s={fontSize:o,color:e.color};return t.props.currentIndex===r&&e.isEdit?null:i.createElement("div",{key:r,className:n,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},i.createElement("div",{className:"EditorLayer__inner",style:s,onDoubleClick:t.handleDoubleClick},i.createElement("div",null,Object(M.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),t.props.currentIndex===r&&i.createElement(ie,{layer:e,updateLayer:t.props.updateLayer})))},t.handleDoubleClick=function(){t.props.updateLayer({isEdit:!0})},t}return ce(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,i=e.index,n=null,o=Object(ae.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===i,"EditorLayer--drag":t.isFixed,"EditorLayer--hide":t.isHide});switch(t.type){case c.default.LAYER_TYPES.STICKER:n=this.renderLayerSticker(t,i,o);break;case c.default.LAYER_TYPES.TEXT:n=this.renderLayerText(t,i,o);break;case c.default.LAYER_TYPES.IMAGE:n=this.renderLayerImage(t,i,o)}return t.isFixed?K.createPortal(n,document.body):n},t}(i.Component),pe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pe(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,n=t.currentIndex,o=Object(ae.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":this.props.currentMode===c.default.TABS.PAINT});return i.createElement("div",{className:o,id:"EditorCanvas__layers"},r.map(function(t,r){return i.createElement(le,{key:r,index:r,currentIndex:n,layer:t,updateLayer:e.props.updateLayer,getStickerUrlById:e.props.getStickerUrlById})}))},t}(i.Component),he=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ue=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=.5*c.default.FONT_SIZE_COEFFICIENT;return e.initialFontSize&&(t=e.initialFontSize*c.default.FONT_SIZE_COEFFICIENT),i.createElement("div",{className:"EditorText"},i.createElement("div",{className:"EditorText__inner"},i.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(M.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},function(){r.setState({height:e.scrollHeight})}),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var i=r.scrollWidth,n=0,o=-1;n<t.length;n++){var s=t.charAt(n);if(" "!=s&&"-"!=s&&"+"!=s||(o=n),r.value+=s,r.scrollWidth>i){var a="";if(o>=0){for(var c=o+1;c<n;c++)a+=t.charAt(c);o=-1}a+=s,r.value=r.value.substr(0,r.value.length-a.length),r.value+="\n\v"+a}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=i.createRef(),Object(T.sendStat)(T.EVENTS.EDIT_TEXT),r}return he(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontStyle!==this.props.layer.fontStyle&&this.onChange()},t}(i.Component),_e=r("4+be"),fe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),me=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i},be=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,n=t.currentIndex,o=t.items,s=null!==n&&o[n],a=s&&s.type===c.default.LAYER_TYPES.TEXT&&s.isEdit,l=s&&s.type===c.default.LAYER_TYPES.STICKER&&s.isHide,p="";return s&&(s.type===c.default.LAYER_TYPES.STICKER?p=Object(_e.getLang)("photos_pe_delete_sticker"):s.type===c.default.LAYER_TYPES.TEXT&&(p=Object(_e.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==c.default.BACKGROUND_MODES.BACKGROUND||s||(e=!0),i.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():i.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),i.createElement("div",null,s&&!a&&!l&&i.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},p),s&&a&&i.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(_e.getLang)("photos_pe_save_action")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?i.createElement("div",null,e&&e.edited&&e.canEdit&&i.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(_e.getLang)("photos_filtered_restore")),e&&!e.canEdit&&i.createElement("span",{className:"StatusPanel__info"},Object(_e.getLang)("photos_will_be_saved_to_pe_album"))):i.createElement("div",null,r.props.currentBackgroundType===c.default.BACKGROUND_MODES.PHOTO&&i.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(_e.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds||{},n=t.gradients,o=void 0===n?{}:n,s=t.emojies,a=void 0===s?{}:s,c=r.scrollElement.current,l=c?e+c.offsetWidth:0,p=!!e,d=!c||!!(c.scrollWidth-l);return i.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},i.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},me(o,a).map(function(e){var t=e.id,n=e.preview;return i.createElement("a",{className:Object(ae.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+n+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})})),p&&i.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},i.createElement("span",{className:"StatusPanel__arrowIcon"})),d&&i.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},i.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var i=r.scrollElement.current;if(i){var n=r.state.scrollBlockPosition,o=i.offsetWidth,s=Math.max(0,Math.min(n+e,i.scrollWidth-o));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:s})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var i=t.offsetWidth/2;e&&(i=-i),r.setPosition(i,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=i.createRef(),r.scrollWithAnimation=!1,r}return fe(t,e),t}(i.Component),ge=Object(n.connect)(function(e){return{context:e.data.context,layers:e.layers,addons:e.data.addons}},function(e){return{deleteLayer:function(){return e(B())},closeTextEditor:function(){return e(N())}}})(be),ve=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),we=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===c.default.BACKGROUND_MODES.PHOTO?Object(T.sendStat)(T.EVENTS.CLICK_TO_CAMERA_ICON):e===c.default.BACKGROUND_MODES.BACKGROUND&&Object(T.sendStat)(T.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return ve(t,e),t.prototype.render=function(){var e=this;return i.createElement("div",{className:"SwitchMode"},Object.values(c.default.BACKGROUND_MODES).map(function(t){var r=Object(ae.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return i.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})}))},t}(i.Component),Ee=r("6krn"),ye=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Oe=r("XpgC").default,Ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?K.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,n=e.background,o=e.data,s=o.addons,a=o.artboardWidth,l=o.artboardHeight,p=o.attachment,d=t.props.layers,h=d.currentIndex,u=d.items,_=null!==h&&u[h],f=_&&_.type===c.default.LAYER_TYPES.TEXT&&_.isEdit,m=t.props.ui.isDataLoaded&&t.props.data.context===c.default.CONTEXT_TYPES.STORY,b=l;s&&s.photoHeight&&(b=s.photoHeight);var g=0;return s&&s.photoOffsetTop&&(g=s.photoOffsetTop),i.createElement(i.Fragment,null,i.createElement("div",{style:{width:a,height:b,marginTop:g},className:"EditorCanvas"},i.createElement(de,{updateLayer:t.props.updateLayer,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),f&&_?i.createElement(ue,{layer:_,onChange:t.onChangeText}):m&&i.createElement(i.Fragment,null,!!p&&i.createElement(Oe,{text:Object(Ee.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},i.createElement("span",{className:"EditorCanvas__postIcon"})),i.createElement(we,{current:n.currentBackgroundType,setMode:t.setMode})),t.props.ui.isDataLoaded&&i.createElement(J,{width:a,height:b}),t.props.ui.isDataLoaded&&i.createElement(te,{width:a,height:b})),t.props.ui.isDataLoaded&&i.createElement(ge,{currentBackgroundId:n.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:n.currentBackgroundType,uploadPhoto:t.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onChangeText=function(e){t.props.updateLayer({text:e})},t.setMode=function(e){var r=t.props.background,i=r.currentBackgroundType,n=r.currentPhotoUrl;t.props.setCurrentLayer(null),e===c.default.BACKGROUND_MODES.PHOTO&&!n||i===c.default.BACKGROUND_MODES.PHOTO&&i===e?t.uploadPhoto(function(){t.props.setBackgroundType(e)}):t.props.setBackgroundType(e)},t.uploadPhoto=function(e){q().then(function(r){e&&e(),t.props.setCurrentPhotoUrl(r)}).catch(function(){window.showFastBox({title:Object(Ee.getLang)("global_error")},Object(Ee.getLang)("stories_create_image_incorrect"))})},t}return ye(t,e),t}(i.Component),Se=Object(n.connect)(function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}},function(e){return{setCurrentBackgroundId:function(t){return e(function(e){return Object(T.sendStat)(T.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}}(t))},updateLayer:function(t){return e(x(t))},setCurrentLayer:function(t){return e(R(t))},setBackgroundType:function(t){return e({type:"SET_CURRENT_BACKGROUND_TYPE",value:t})},setCurrentPhotoUrl:function(t){return e(function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}}(t))}}})(Ce),Ae=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ae(t,e),t.prototype.render=function(){var e=this.props,t=e.current,r=e.change;return i.createElement("div",{className:"EditorTabs"},i.createElement("div",{className:"EditorTabs__header"},i.Children.map(this.props.children,function(e){var n=Object(ae.classNames)("EditorTabs__item","EditorTabs__item--"+e.props["data-mode"],{"EditorTabs__item--current":t===e.props["data-mode"]});return i.createElement("div",{className:n,key:e.props["data-mode"],onClick:function(){return r(e.props["data-mode"])}})})),i.createElement("div",{className:"EditorTabs__content"},i.Children.map(this.props.children,function(e){var r={className:Object(ae.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return i.cloneElement(e,r)})))},t}(i.Component),ke=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Te=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return ke(t,e),t.prototype.render=function(){var e=this,t=Object(ae.classNames)("DropBox__inner",{"DropBox__inner--hover":this.state.onHover});return i.createElement("div",{className:"DropBox"},i.createElement("div",{className:t,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},i.createElement("div",{className:"DropBox__icon"},this.renderIcon()),i.createElement("span",{dangerouslySetInnerHTML:{__html:Object(Ee.getLang)("photos_pe_drag_to_remove")}})))},t.prototype.renderIcon=function(){return i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50px",height:"50px",viewBox:"0 0 50 50"},i.createElement("path",{d:"M15 19H35V37C35 38.1 34.1 39 33 39H17C15.9 39 15 38.1 15 37V19Z",fill:"white"}),i.createElement("path",{d:"M37 15C37 13.9 36.1 13 35 13H28.4C28.4 11.9 27.5 11 26.4 11H23.6C22.5 11 21.6 11.9 21.6 13H15C13.9 13 13 13.9 13 15C13 15 13 13.5 13 15V17H37V15C37 15 37 13.4 37 15Z",fill:"white",className:"cap"}))},t}(i.Component),Me=r("t7n3"),De=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Re=r("vRp6").default,Ie=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.setState({})},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,n=e.stickerMouseDown,o=r.props.ui,s=o.stickerHeaderScrollPosition,a=o.currentStickerPackIndex,l=r.scrollElement.current,p=!!s,d=!1,h=0;l&&(h=s+l.offsetWidth,d=!!(l.scrollWidth-h));var u=t[a]?t[a].items:[];r.needReset&&(r.needReset=!1,u=[],r.setState({}));for(var _=[],f=0,m=u.length;f<m;f+=3)_.push(u.slice(f,f+3));return i.createElement("div",{className:"StickersPanel"},r.props.ui.isShowDropBox&&i.createElement(Te,{onDelete:r.props.deleteLayer}),i.createElement("div",{className:"StickersPanel__header"},i.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+s+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},t.map(function(e,t){var n=e.id,o=r.getTabPreviewUrl(t);if(!o)return null;var s=!Object(Me.inArray)(n,["recent","editor"]),c=Object(ae.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===a,"StickersPanel__tab--recent":"recent"===n,"StickersPanel__tab--editor":"editor"===n});return i.createElement("div",{key:n,className:c,style:s?{backgroundImage:"url('"+o+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})})),p&&i.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},i.createElement("span",{className:"StickersPanel__arrowIcon"})),d&&i.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},i.createElement("span",{className:"StickersPanel__arrowIcon"}))),i.createElement(Re,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},_.map(function(e,t){return i.createElement("div",{key:t,className:"StickersPanel__row"},e.map(function(e){var t=e.id,r=e.sizes;return i.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return n(e,t)}},i.createElement("img",{src:r[c.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))}))})))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,i=(t||[])[0],n=void 0===i?null:i;return!(!t||!n)&&n.sizes[c.default.STICKER_SMALL]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var i=t.offsetWidth;e&&(i=-i),r.setPosition(i,!0)}},r.setPosition=function(e,t){var i=r.scrollElement.current,n=r.props.ui.stickerHeaderScrollPosition;if(i){var o=i.offsetWidth,s=Math.max(0,Math.min(n+e,i.scrollWidth-o));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(s)}},r.loadingLimit=25,r.scrollElement=i.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return De(t,e),t}(i.Component),Le=Object(n.connect)(function(e){return{ui:e.ui,stickers:e.data.stickers}},function(e){return{deleteLayer:function(){return e(B())},setCurrentStickerPackIndex:function(t){return e(function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}}(t))},setHeaderScrollPosition:function(t){return e(function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}}(t))}}})(Ie),xe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xe(t,e),t.prototype.render=function(){var e=this;return i.createElement("div",{className:"ColorPicker"},c.default.COLORS.map(function(t){var r=Object(ae.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return i.createElement("div",{key:t,className:r,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})}))},t}(i.Component),Ne=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),je=r("Cb16").default,We=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,n=e.setColor,o=e.setBrushWidth,s=e.setBrushOpacity;return r.updateDrawingPreview(),i.createElement("div",{className:"DrawPanel"},i.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:"270",height:"80"}),i.createElement("div",{className:"DrawPanel__sliders"},i.createElement("div",{className:"DrawPanel__slider"},i.createElement("div",{className:"DrawPanel__sliderTitle"},Object(Ee.getLang)("photos_pe_intensity")),i.createElement(je,{color:"#5181b8",defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return s(e)}})),i.createElement("div",{className:"DrawPanel__slider"},i.createElement("div",{className:"DrawPanel__sliderTitle"},Object(Ee.getLang)("photos_pe_line_width")),i.createElement(je,{color:"#5181b8",defaultValue:t.brushWidth,onChange:function(e){return o(e)}}))),i.createElement(Be,{color:t.color,setColor:n}),!!r.props.drawings.length&&i.createElement("div",{className:"DrawPanel__undo",onClick:r.undoDrawing},Object(Ee.getLang)("photos_pe_undo_last_action")))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var i=e.getContext("2d");if(i){var n=i.canvas,o=n.width,s=n.height,a=.2*o,l=.25*s,p=.8*o,d=l,h=o/2,u=1.2*s;i.clearRect(0,0,o,s),i.beginPath(),i.moveTo(a,l),i.quadraticCurveTo(h,u,p,d);var _="#FFFFFF"===t.color?"#F1F1F1":t.color;i.lineWidth=t.brushWidth*c.default.BRUSH_WIDTH_COEFFICIENT,i.strokeStyle=G(_,t.brushOpacity),i.lineJoin=i.lineCap="round",i.stroke()}}},r.undoDrawing=function(){r.props.undoDrawing()},r.previewCanvas=i.createRef(),r}return Ne(t,e),t}(i.Component),He=Object(n.connect)(function(e){return{settings:e.settings,drawings:e.drawings}},function(e){return{setColor:function(t){return e(H(t))},setBrushWidth:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}}(t))},setBrushOpacity:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}(t))},undoDrawing:function(){return e(U())}}})(We),Ue=r("Ht+d"),Ke=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Fe=r("TBLV").default,Ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,n=e.setColor,o=e.layer,s=e.fontsPlaceholders,a=o&&o.isEdit,l=o&&o.fontStyle,p=o&&o.color;return i.createElement("div",{className:"TextPanel"},t.props.ui.isShowDropBox&&i.createElement(Te,{onDelete:t.props.deleteLayer}),a?i.createElement(Ue.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(_e.getLang)("photos_pe_save_action")):i.createElement(Ue.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},i.createElement("div",{className:"TextPanelButton__icon"}),Object(_e.getLang)("photos_pe_add_text")),i.createElement("div",{className:"TextPanelButton__fonts"},i.createElement("div",{className:"TextPanelButton__title"},Object(_e.getLang)("photos_pe_font")),c.default.FONTS.map(function(e,n){return i.createElement(Fe,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:l?l===e:r.fontStyle===e},i.createElement("span",{className:"TextPanelButton__font PhotoEditorFontStyle--"+e},s[n]))})),i.createElement("div",{className:"TextPanelButton__colors"},i.createElement("div",{className:"TextPanelButton__title"},Object(_e.getLang)("photos_pe_color")),i.createElement(Be,{color:p||r.color,setColor:n})))},t}return Ke(t,e),t}(i.Component),Ge=Object(n.connect)(function(e){var t=e.layers,r=t.items,i=t.currentIndex,n=null;return null!==i&&(n=r[i]),{ui:e.ui,settings:e.settings,layer:n,fontsPlaceholders:e.data.fontsPlaceholders}},function(e){return{addLayerText:function(t,r){return e(L(t,r))},setColor:function(t){return e(H(t))},setFontSize:function(t){return e(function(e){return function(t,r){var i=r().layers,n=i.currentIndex,o=i.items;n&&!o[n]||t(x({fontSize:e})),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}}(t))},setFontStyle:function(t){return e(function(e){return function(t,r){var i=r().layers,n=i.currentIndex,o=i.items;n&&!o[n]||t(x({fontStyle:e})),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}}(t))},deleteLayer:function(){return e(B())},closeTextEditor:function(){return e(N())}}})(Ve),qe=r("3oLO"),ze=r("Egk5"),Ye=r("zxIV"),$e=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Xe=function(){return(Xe=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Je=r("6raB").default,Ze=r("PjZB").default,Qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then(function(e){var r=e.stickers,i=e.backgrounds,n=e.hash,o={};r.forEach(function(e){e.items.forEach(function(e){o[e.id]=e})}),t.props.setData({stickers:r,stickersMap:o,backgrounds:i,placeholders:Object(Ee.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object(Ee.getLang)("photos_pe_fonts").split("<br>"),hash:n}),t.props.setDataLoaded(),t.props.background.currentBackgroundType===c.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)}).catch(function(){window.showFastBox({title:Object(Ee.getLang)("global_error")},Object(Ee.getLang)("global_error"),Object(Ee.getLang)("global_close"),function(){window.curBox().hide(),t.props.data.close(!1,!0)})})},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise(function(e,t){qe.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})})},t.render=function(){var e,r=t.props,n=r.ui,o=r.data,s=r.drawings,a=r.layers;return o.artboardContainer||(e={width:o.artboardWidth,height:parseInt(o.artboardHeight)+c.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,o.context===c.default.CONTEXT_TYPES.STORY?t.isSaveDisabled=!1:t.isSaveDisabled=!a.items.length&&!s.length,i.createElement("div",{className:"PhotoEditor",style:{height:parseInt(o.artboardHeight)+c.default.BOTTOM_PANEL_HEIGHT}},i.createElement("div",{className:"PhotoEditor__canvas",style:e},i.createElement(Se,{getStickerUrlById:t.getStickerUrlById})),i.createElement("div",{className:"PhotoEditor__tabs"},n.isDataLoaded?t.renderTabs():i.createElement(Ze,null)),!n.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e=Object(Ee.getLang)("photos_pe_save_action");return t.props.data.context===c.default.CONTEXT_TYPES.STORY&&(e=Object(Ee.getLang)("photos_pe_publish_action")),i.createElement("div",{className:"PhotoEditor__inner"},i.createElement(Pe,{current:t.props.ui.currentMode,change:t.props.setMode},i.createElement("div",{"data-mode":c.default.TABS.STICKERS},i.createElement(Le,{stickerMouseDown:t.stickerDragStart})),i.createElement("div",{"data-mode":c.default.TABS.TEXT},i.createElement(Ge,null)),i.createElement("div",{"data-mode":c.default.TABS.PAINT},i.createElement(He,null))),i.createElement("div",{className:"PhotoEditor__actions"},i.createElement(Ue.default,{appearance:"secondary",onClick:t.props.data.close},Object(Ee.getLang)("photos_pe_cancel_action")),i.createElement(Je,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},e)))},t.renderFontsPreloading=function(){return i.createElement("div",{className:"PhotoEditor__fontPreload"},c.default.FONTS.map(function(e){return i.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})}))},t.save=function(){t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),t.renderFinalImage().then(function(e){var r=e.blob,i=e.width,n=e.height,o=t.props,s=o.layers,a=o.drawings,c=o.background,l=Object(T.prepareStat)(s.items,a,c.currentBackgroundType,c.currentBackgroundId),p=[];t.props.layers.items.forEach(function(e){e.clickableZones&&e.clickableZones.forEach(function(r){p.push(t.getPreparedClickableZone(e,r))})});var d={original_width:i,original_height:n,clickable_stickers:p};t.props.data.save(r,function(){t.props.setSaveLoading(!1)},{attachment:t.props.data.attachment,hash:t.props.data.hash,analytics:JSON.stringify(l),clickable_stickers:JSON.stringify(d)})}).catch(function(e){console.error(e)})},t.getPreparedClickableZone=function(e,r){var i,n=t.props.data.originalWidth/t.props.data.artboardWidth,o=e.rotate*(Math.PI/180),s=e.x-e.width/2,a=e.y-e.height/2,c=parseFloat(e.x)+(s-e.x)*Math.cos(o)-(a-e.y)*Math.sin(o),l=parseFloat(e.y)+(a-e.y)*Math.cos(o)+(s-e.x)*Math.sin(o),p=null===(i=r.clickable_area)||void 0===i?void 0:i.map(function(t){var r=t.x*e.width,i=t.y*e.height,s=r*Math.cos(o)-i*Math.sin(o),a=r*Math.sin(o)+i*Math.cos(o);return{x:(c+s)*n,y:(l+a)*n}}),d={type:r.action_type,clickable_area:p};return"link"===r.action_type?(d.link=r.action.link,r.action.tooltip_text_key&&(d.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(d.app_id=r.action.app_id,r.action.app_context&&(d.app_id=r.action.app_id)),d},t.renderFinalImage=function(){return new Promise(function(e){var r=document.createElement("canvas"),i=r.getContext("2d"),n=document.querySelector(".EditorCanvas__canvas--bg"),o=document.querySelector(".EditorCanvas__canvas--draw"),s=document.getElementById("EditorCanvas__layers");if(i&&n&&o&&s){r.width=n.width,r.height=n.height,i.drawImage(n,0,0),i.drawImage(o,0,0);var a=t.props.data,c=a.artboardWidth,l=a.artboardHeight,p=a.addons,d=l;p&&p.photoHeight&&(d=p.photoHeight),k.a.toCanvas(s,{width:c,height:d,filter:function(e){return e.nodeType===Node.TEXT_NODE||!e.classList.contains("EditorLayer--sticker")&&!e.classList.contains("EditorClickableZone")}}).then(function(n){i.drawImage(n,0,0,r.width,r.height),t.renderCanvasLayers(i).then(function(){r.toBlob(function(t){e({blob:t,width:r.width,height:r.height})},"image/jpeg",1)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}})},t.renderCanvasLayers=function(e){return new Promise(function(r,i){var n=t.props.data.originalWidth/t.props.data.artboardWidth,o=[];t.props.layers.items.forEach(function(r){r.type===c.default.LAYER_TYPES.STICKER&&o.push(t.renderCanvasSticker(e,r,n))}),Promise.all(o).then(r).catch(function(e){i(e)})})},t.renderCanvasSticker=function(e,r,i){return F(t.getStickerUrlById(r.id,c.default.STICKER_LARGE)).then(function(t){var n=r.width*i,o=r.height*i,s=(r.x-r.width/2)*i,a=(r.y-r.height/2)*i;e.save(),e.translate(s,a),e.translate(n/2,o/2),e.rotate(r.rotate*Math.PI/180),e.translate(-n/2,-o/2),e.drawImage(t,0,0,n,o),e.restore()})},t.handleKeyDown=function(e){if((e.ctrlKey||e.metaKey)&&90===e.keyCode&&t.props.ui.currentMode===c.default.TABS.PAINT&&t.props.undoDrawing(),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(e.keyCode===ze.KEY.DEL)e.preventDefault(),t.props.deleteLayer();else if([ze.KEY.UP,ze.KEY.DOWN,ze.KEY.LEFT,ze.KEY.RIGHT].includes(e.keyCode)){var r=t.getCurrentLayer();if(!r)return;var i={x:r.x,y:r.y},n=e.shiftKey?10:1;switch(e.keyCode){case ze.KEY.UP:i.y-=n;break;case ze.KEY.DOWN:i.y+=n;break;case ze.KEY.LEFT:i.x-=n;break;case ze.KEY.RIGHT:i.x+=n}t.props.updateLayer({x:i.x,y:i.y})}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),i=e.target;if(r&&r.isFixed)t.layerDragFinish(e);else if("TEXTAREA"!==i.tagName)return!!i.closest(".EditorCanvas")&&(!i.closest(".SwitchMode")&&void(t.props.ui.currentMode!==c.default.TABS.PAINT&&(r&&r.type===c.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():i.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null))))},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,i=e.currentIndex;return null===i?i:r[i]},t.layerDragStart=function(e,r){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var i,n=e.target.closest("[data-index]");i=n?+Object(Ye.domData)(n,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==i&&t.props.setCurrentLayer(i);var o=V(e,document.querySelector(".EditorCanvas__canvas--draw")),s=o.x,a=o.y,c=o.xOrigin,l=o.yOrigin;t.currentLayer=t.getCurrentLayer(),t.currentLayer&&(t.fromPanel=r,t.clientX=e.clientX,t.clientY=e.clientY,t.fromPanel?(t.shiftX=0,t.shiftY=0,t.shiftBodyX=0,t.shiftBodyY=0):(t.shiftX=s-t.currentLayer.x,t.shiftY=a-t.currentLayer.y,t.shiftBodyX=t.clientX-(t.currentLayer.x+c),t.shiftBodyY=t.clientY-(t.currentLayer.y+l)))},t.layerDragProcess=function(e){void 0!==t.shiftBodyX&&void 0!==t.shiftBodyY&&(t.props.updateLayer({x:Math.round(e.clientX-t.shiftBodyX),y:Math.round(e.clientY-t.shiftBodyY),isFixed:!0,isHide:!1}),t.fromPanel||t.props.ui.isShowDropBox||t.props.setShowDropBox(!0))},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var i=V(e,r),n=i.x,o=i.y,s=r.getBoundingClientRect(),a=s.width,c=s.height,l=n-t.shiftX,p=o-t.shiftY,d=!1;if(t.fromPanel){var h=t.currentLayer.width/2,u=t.currentLayer.height/2;t.clientX===e.clientX&&t.clientY===e.clientY?(l=r.offsetWidth/2,p=r.offsetHeight/2):(l+h<0||l-h>a||p+u<0||p-u>c)&&(d=!0)}t.props.updateLayer({x:Math.round(l),y:Math.round(p),isFixed:!1,isHide:!1}),d&&t.props.deleteLayer(),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.shiftBodyX,delete t.shiftBodyY,delete t.fromPanel,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var i=t.props.data.stickersMap[e];return i?i.sizes[r]:""},t.stickerDragStart=function(e,r){e.persist();var i=t.getCurrentLayer();if(!i||!i.isFixed){var n=document.querySelector(".EditorCanvas__canvas--draw");if(n){var o=c.default.LAYER_DEFAULT_SIZE/2,s=Math.floor(n.width/c.default.CANVAS_SCALE/2-o),a=Math.floor(n.height/c.default.CANVAS_SCALE/2-o);t.props.addLayerSticker({id:r,x:s,y:a,width:c.default.LAYER_DEFAULT_SIZE,height:c.default.LAYER_DEFAULT_SIZE,rotate:0,isHide:!0,isFixed:!1}),setTimeout(function(){t.layerDragStart(e.nativeEvent,!0)},0)}}},t.prepareStickers=function(e){var r=t.props.data,i=r.artboardWidth,n=r.artboardHeight;e.forEach(function(e){var r=e.sticker.transform||{},o=r.gravity,s=void 0===o?"center":o,a=r.rotation,l=void 0===a?0:a,p=r.translation_x,d=void 0===p?0:p,h=r.translation_y,u=void 0===h?0:h,_=r.relation_width;if(d=Math.min(Math.max(d,-1),1),u=Math.min(Math.max(u,-1),1),_&&(_=Math.min(Math.max(_,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,s,d,u,_).then(function(e){var r=e.url,i=e.x,n=e.y,o=e.stickerWidth,s=e.stickerHeight,a=e.clickableZones;t.props.addLayerImage({url:r,x:i,y:n,width:Math.round(o),height:Math.round(s),rotate:-l,isFixed:!1,clickableZones:a})}).catch(function(e){console.error(e)});else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var f=_?i*_:c.default.LAYER_DEFAULT_SIZE,m=_?i*_:c.default.LAYER_DEFAULT_SIZE,b=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[b]){var g=z(s,i,n,f/2,m/2,d*i,u*n),v=g.x,w=g.y;t.props.addLayerSticker({id:b,x:v,y:w,width:f,height:m,rotate:-l,isHide:!1,isFixed:!1})}break;case"text":var E=.5;_&&(E=t.getFontSize(e.sticker.action.text,i*_,e.sticker.action.style));var y=t.getTextRect(e.sticker.action.text,E*c.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),O=(f=y.width,m=y.height,z(s,i,n,f/2,m/2,d*i,u*n));v=O.x,w=O.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:E,initialFontSize:E,rotate:-l,x:v,y:w})}})},t.prepareRenderableSticker=function(e,r,i,n,o){var s=t.props.data,a=s.artboardWidth,c=s.artboardHeight,l=s.originalWidth/a;return new Promise(function(t,s){"string"!=typeof e.url&&"string"!=typeof e.blob&&s();var p=e.url||e.blob||"";F(p).then(function(s){var d=s.height/s.width,h=0,u=0;o?u=(h=a*o)*d:(h=s.width/l,u=s.height/l,h>a&&(u=(h=a)*d));var _,f=z(r,a,c,h/2,u/2,i*a,n*c),m=f.x,b=f.y;e.clickable_zones&&(_=e.clickable_zones.map(function(e){var t;return t=e.clickable_area?e.clickable_area.map(function(e){return{x:e.x/s.width,y:e.y/s.height}}):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],Xe(Xe({},e),{clickable_area:t})})),t({url:p,x:m,y:b,stickerWidth:h,stickerHeight:u,clickableZones:_})}).catch(function(){s()})})},t.getTextRect=function(e,t,r){var i=document.createElement("span");i.innerHTML=e,i.style.display="inline-block",i.style.fontSize=t+"px",i.style.lineHeight="1em",i.style.whiteSpace="pre",r&&i.classList.add("PhotoEditorFontStyle--"+r),document.body.append(i);var n=i.getBoundingClientRect();return i.remove(),n},t.getFontSize=function(e,t,r){var i=2*t,n=document.createElement("span");for(n.innerHTML=e,n.style.display="inline-block",n.style.width=t+"px",n.style.fontSize=i+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);i&&n.scrollWidth>Math.round(t);)i--,n.style.fontSize=i+"px";return n.remove(),i/100},t}return $e(t,e),t}(i.Component),et=Object(n.connect)(function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}},function(e){return{setMode:function(t){return e(W(t))},addLayerSticker:function(t){return e(function(e){return Object(T.sendStat)(T.EVENTS.ADD_STICKER),I("ADD_LAYER_STICKER",{type:c.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isHide:e.isHide,isFixed:e.isFixed})}(t))},addLayerText:function(t,r){return e(L(t,r))},addLayerImage:function(t){return e(function(e){return I("ADD_LAYER_IMAGE",{type:c.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isFixed:e.isFixed,clickableZones:e.clickableZones})}(t))},updateLayer:function(t){return e(x(t))},undoDrawing:function(){return e(U())},deleteLayer:function(){return e(B())},setCurrentLayer:function(t){return e(R(t))},setDataLoaded:function(){return e({type:"SET_DATA_LOADED"})},setShowDropBox:function(t){return e(j(t))},setSaveLoading:function(t){return e(function(e){return{type:"SET_SAVE_LOADING",value:e}}(t))},closeTextEditor:function(){return e(N())},setData:function(t){return e(function(e){return{type:"SET_DATA",payload:e}}(t))}}})(Qe),tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),rt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=c.default.CONTEXT_TYPES,r=c.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return tt(t,e),t.prototype.render=function(){var e,t=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},Object(o.createStore)(A,e,s.composeWithDevTools(Object(o.applyMiddleware)(a.default))));return i.createElement(n.Provider,{store:t},i.createElement(et,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:c.default.STORY_BASE_WIDTH,originalHeight:c.default.STORY_BASE_HEIGHT},t}(i.Component);t.default=rt},"1y80":function(e,t,r){"use strict";function i(e,t,r,i,n){return window.statlogsValueEvent(e,t,r,i,n)}function n(e){return Math.random()<e}function o(e,t,r,o,s,a){n(e)&&i(t,r,o,s,a)}r.r(t),r.d(t,"statlogsValueEvent",function(){return i}),r.d(t,"randEnabled",function(){return n}),r.d(t,"statlogsProbValueEvent",function(){return o})},"2mql":function(e,t,r){"use strict";var i=r("TOwV"),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function c(e){return i.isMemo(e)?s:a[e.$$typeof]||n}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0};var l=Object.defineProperty,p=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,_=Object.prototype;e.exports=function e(t,r,i){if("string"!=typeof r){if(_){var n=u(r);n&&n!==_&&e(t,n,i)}var s=p(r);d&&(s=s.concat(d(r)));for(var a=c(t),f=c(r),m=0;m<s.length;++m){var b=s[m];if(!(o[b]||i&&i[b]||f&&f[b]||a&&a[b])){var g=h(r,b);try{l(t,b,g)}catch(e){}}}return t}return t}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"3f+a":function(e,t,r){"use strict";r.r(t);r("tUrg");var i=class{constructor(e){this.link=e,this.onClick=this.onClick.bind(this)}onClick(){this.copyToClipboard(this.link),this.copy.classList.add("vk_app_copy_link__copy--hidden"),this.copied.classList.add("vk_app_copy_link__copied--visible"),setTimeout(()=>{this.copy.classList.remove("vk_app_copy_link__copy--hidden"),this.copied.classList.remove("vk_app_copy_link__copied--visible")},2400)}copyToClipboard(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var r=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),r&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(r))}renderCopied(){this.copied=document.createElement("span"),this.copied.classList.add("vk_app_copy_link__copied"),this.copied.innerHTML=getLang("vkapps_link_copied")}renderCopy(){this.copy=document.createElement("span"),this.copy.classList.add("vk_app_copy_link__copy"),this.copy.innerHTML=getLang("vkapps_link_copy"),this.copy.addEventListener("click",this.onClick)}render(){return this.linkEl=document.createElement("span"),this.linkEl.classList.add("vk_app_copy_link__container"),this.renderCopy(),this.renderCopied(),this.linkEl.appendChild(this.copy),this.linkEl.appendChild(this.copied),this.linkEl}},n=r("wZQE");t.default=class{constructor(){this.onHide=this.onHide.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),this.isVisible=!1}init(){var e;this.render(),(e=cur.app?cur.app.cont:ge("apps_test_id"))&&e.appendChild(this.container)}toggle(){this.isVisible?this.hide():this.show()}show(){setTimeout(()=>this.container.classList.add("show"),300),this.container.addEventListener("click",this.onHide),this.isVisible=!0,this.container.setAttribute("aria-hidden",this.isVisible)}hide(){setTimeout(()=>this.container.classList.remove("show"),300),this.container.removeEventListener("click",this.onHide),this.closeBtn.removeEventListener("click",this.onHide),this.isVisible=!1,this.container.setAttribute("aria-hidden",this.isVisible)}onHide(e){(e.target===this.container||e.target===this.closeBtn||this.closeBtn.contains(e.target))&&(this.hide(),this.destroy())}destroy(){this.container.parentNode.removeChild(this.container),this.callback&&this.callback()}_renderCloseBtn(){this.closeBtn=document.createElement("button"),this.closeBtn.setAttribute("type","button"),this.closeBtn.classList.add("vk_app_modal_close_btn"),this.closeBtn.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',this.closeBtn.addEventListener("click",this.onHide),this.container.childNodes[0].appendChild(this.closeBtn)}_renderOuter(){this.container=document.createElement("div"),this.container.classList.add("vk_app_modal_outer")}renderModal(){var e=new i(window.location.href);this.modal=document.createElement("div"),this.modal.classList.add("vk_app_modal_container","vk_app_modal_container--qr","vk_app_modal_container--flex","MiniAppModalContainer__qr");var t=window.location.href,r=n.createQR(t,120,"",{isShowLogo:!0});this.modal.innerHTML=`${r}\n<h2>${cur.backLang}</h2>\n<p>${getLang("vkapps_focus_camera_on_qr_code")}</p>`,this.modal.appendChild(e.render())}render(){this.container||this._renderOuter(),this.renderModal(),this.container.innerHTML="",this.container.appendChild(this.modal),this._renderCloseBtn(this.container)}}},"4zn2":function(e,t,r){"use strict";r.r(t),r.d(t,"API_VERSION",function(){return i}),r.d(t,"VKPAY_TRANSACTION_EVENT",function(){return n}),r.d(t,"PLATFORM",function(){return o}),r.d(t,"CLIENT_SCHEME",function(){return s}),r.d(t,"ERROR_CODES",function(){return a}),r.d(t,"ERROR_REASONS",function(){return c}),r.d(t,"ERROR_TYPES",function(){return l}),r.d(t,"CLOSE_STATUS",function(){return p}),r.d(t,"VKPAY_APPS",function(){return d}),r.d(t,"VK_CONNECT_EVENTS",function(){return h});var i="5.95",n="VKWebAppActionDone",o={WEB:"web",MOBILE_WEB:"mobile-web"},s={LIGHT:"client_light",DARK:"client_dark",BRIGHT_LIGHT:"bright_light",SPACE_GRAY:"space_gray"},a={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,CUSTOM:6},c={UNSUPPORTED_PLATFORM:"Unsupported platform",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device"},l={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},p=["success","failed"],d=[6217559,7131443],h={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppGetCommunityAuthToken:"get_community_token",VKWebAppGetCommunityAuthTokenPreload:"get_community_scope",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_scope",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppJoinGroup:"join_group",VKWebAppOpenApp:"open_app",VKWebAppGetUserInfo:"get_user_info",VKWebAppSendPayload:"send_payload",VKWebAppShowOrderBox:"order",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppStorageGetKeys:"storage_get_keys",VKWebAppStorageSet:"storage_set",VKWebAppStorageGet:"storage_get",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close"}},"59zB":function(e,t,r){"use strict";r.r(t);r("pIFo"),r("KKXr");var i,n=r("gdug"),o=r("t7n3"),s=r("zxIV"),a=r("Egk5"),c=r("7jxN"),l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),p=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function d(e){i&&p(i),i=l(e)}function h(e){return Object(o.isString)(e)&&"_"===e[0]?geByClass1(e):ge(e)}function u(e,t){if((e=h(e))&&Object(o.isFunction)(t)){if(n.browser.msie9||n.browser.opera&&n.browser.version<13){var r=!1,i=!1,s=function e(){if(!a.contentDocument)return setTimeout(e,100);a.contentDocument.defaultView.removeEventListener("resize",t),a.contentDocument.defaultView.addEventListener("resize",t),t()},a=ce("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){i=!0,r&&s()}});return e.appendChild(a),e.__resizeSensor__=[a,function(){r=!0,i&&s()}]}var c=ce("div",{className:"ui_scroll_resize_sensor"}),l=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),p=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),d=ce("div"),u=ce("div"),_=null;return l.appendChild(d),p.appendChild(u),c.appendChild(l),c.appendChild(p),e.appendChild(c),e.__resizeSensor__=[c,l.onscroll=p.onscroll=function(){var r=(e.offsetWidth||1e4)+10,i=(e.offsetHeight||1e4)+10;d.style.width=r+"px",d.style.height=i+"px",l.scrollLeft=r,l.scrollTop=i,p.scrollLeft=r,p.scrollTop=i,_!==(_=r+" "+i)&&t()}]}}class _{constructor(e,t){if(!(e=h(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=extend({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1,noLazyLoadWatch:!1},t),this.options.native&&(this.options.shadows=!1),n.browser.mobile&&(this.options.stopScrollPropagation=!1),isArray(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,Object(o.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),Object(o.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),Object(o.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),Object(o.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),Object(o.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),Object(o.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),Object(o.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),Object(o.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),Object(o.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:ce("div",{className:"ui_scroll_overflow"}),outer:ce("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:ce("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:ce("div",{className:"ui_scroll_shadow_top"}),shadowBottom:ce("div",{className:"ui_scroll_shadow_bottom"}),content:ce("div",{className:"ui_scroll_content clear_fix"}),barContainer:ce("div",{className:"ui_scroll_bar_container"}),barOuter:ce("div",{className:"ui_scroll_bar_outer"}),barInner:ce("div",{className:"ui_scroll_bar_inner"})},Object(s.data)(this.el.container,"ui-scroll",this);var r=Object(s.cf)(),i=["ui_scroll_container"];for(each(isArray(this.options.theme)?this.options.theme:trim(this.options.theme+"").split(/\s+/),function(e,t){t&&i.push("ui_scroll_"+t+"_theme")}),addClass(this.el.container,i.join(" ")),this.options.hidden&&addClass(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=ce("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),r.appendChild(this.el.overflow),this.options.native?addClass(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),r.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),n.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){var c=u(this.el.inner,this.resize.bind(this,!0)),l=u(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(c[0]),this.removeElements.push(l[0]),this.startResizeListening=function(){c[1](),l[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(r),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init(),this.options.noLazyLoadWatch||(window.LazyLoad&&LazyLoad.watch(this.el.outer),window.LazyLoad&&LazyLoad.scanDelayed());var p="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":n.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,p,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&Object(a.cancelEvent)(e):this.isScrollEventUnused(e)?Object(a.cancelEvent)(e):Object(a.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),each(this.options.scrollElements,function(e,t){this.addEvent(t,p,function(e){this.disabled||this.unnecessary||(this.scrollBy(_.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||Object(a.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;var t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){removeEvent(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,addClass(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||removeClass(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,r,i){return this.removeEvents.push([e,t,r]),addEvent(e,t,r,void 0,void 0,i?{passive:!0}:void 0),r}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),each(this.removeEvents,function(e,t){removeEvent.apply(null,t)}),this.el.overflow.parentNode==this.el.container){for(var e=Object(s.cf)();this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return Object(s.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),each(this.removeElements,function(e,t){Object(s.re)(t)}),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if(Object(o.isFunction)(e)){this.animation&&this.animation.stop();var t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if(Object(o.isFunction)(e)){this.animation&&this.animation.stop();var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){n.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),setStyle(this.el.container,"width",e?Object(s.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){var t=0,r=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=.025*-e.wheelDeltaY,n.browser.mac&&n.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=.025*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==r?15:2==r?450:1)}isScrollEventUnused(e){return _.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),Object(s.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),addEvent(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),addEvent(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,Object(a.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),setStyle(bodyNode,"cursor",""),removeClass(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);var t=(e.pageY-Object(s.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&Object(a.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(!this.disabled&&this.dragging&&!this.options.native){e||(e=window.event);var t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,setStyle(bodyNode,"cursor","pointer"),addClass(this.el.container,"ui_scroll_dragging")),Object(a.cancelEvent)(e),this.emitEvent("drag"),this.api}}scroll(e,t,r){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new c.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:c.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:Object(o.isFunction)(r)?r.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,Object(o.isFunction)(r)&&r(this.api)),this.api}scrollTop(e,t,r,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(Object(o.intval)(t),r,i)}scrollBottom(e,t,r,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-Object(o.intval)(t),r,i)}scrollBy(e,t,r){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+Object(o.intval)(e),t,r)}scrollIntoView(e,t,r,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=h(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){var n=Object(s.getXY)(t)[1],a=Object(s.getXY)(this.el.overflow)[1],c=Object(s.getSize)(t)[1];if(n<=a&&n+c>=a+this.api.data.viewportHeight||n>=a&&n+c<=a+this.api.data.viewportHeight)Object(o.isFunction)(i)&&(r?setTimeout(i.bind(this.api),0):i(this.api));else if(c>this.api.data.viewportHeight||n<a)this.scrollTop(!1,n-a+this.api.data.scrollTop-(this.options.shadows?Object(s.getSize)(this.el.shadowTop)[1]:0),r,i);else{var l=this.options.shadows?Object(s.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,n-a+this.api.data.scrollTop+c-this.api.data.viewportHeight+l,r,i)}}return this.api}update(e){var t,r;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));var i=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==i)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,i))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(!(r=(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight))<=this.api.data.viewportHeight)){var n=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==n)&&(this.barOuterHeight=n,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),d(()=>{var e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`})}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!r)&&Object(s.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!r),this.shadowBottom!=(this.api.data.scrollBottom&&!r)&&Object(s.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!r)),this.unnecessary!==r&&(Object(s.toggleClass)(this.el.container,"ui_scroll_unnecessary",r),this.unnecessary=r,this.options.stopScrollPropagation&&this.fixBlocker(),r&&this.barInnerHeight&&this.barOuterHeight&&d(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";var r=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${r}%)`}.bind(this)))}return this.emitEvent("update"),this.options.noLazyLoadWatch||window.LazyLoad&&LazyLoad.scanDelayed(this.el.outer),(!this.options.reversed||i>=0)&&this.more(),!0}return!1}more(){var e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}}_.addResizeSensor=u;t.default=_},"6krn":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",function(){return s});var i=r("nAFc"),n=r("4+be"),o={};function s(e,t,r){void 0===t&&(t=!1);var s="number"==typeof t,a=t||s,c=e+(a?".raw":"");if(void 0===o[c]){var l=a?Object(n.getLang)(e,"raw"):Object(n.getLang)(e);"string"==typeof l?o[c]=Object(i.decodeHTMLEntities)(l):Array.isArray(l)&&(o[c]=l.map(i.decodeHTMLEntities))}if(s){var p=t;return Object(n.langNumeric)(p,o[c],r)}return o[c]||""}t.default={getLang:s}},"6tUA":function(e,t,r){"use strict";r.r(t);r("pIFo");var i=r("EasH"),n=r("4+be"),o=r("RbYe"),s=r("kcIO"),a=r("jE6c"),c=r("RJZa"),l=r("v+DW"),p="/apps",d="get_share_to_story_upload_data";class h{static share(e,t,r){Object(c.confirm)(getLang("apps_share_to_story_title"),getLang("apps_share_to_story_message")).then(()=>{var i=Object(s.curBox)();if(i){var n=i.btns.ok[0];Object(l.lockButton)(n)}h.start(e,t,r)}).catch(()=>{Object(s.curBox)().hide()})}static start(e,t,r){ajax.post(p,{act:d,hash:r,promo:e,gift_type:t,ref:cur.module},{onDone:h.publishStory,onFail:e=>{Object(i.showFastBox)(getLang("global_error"),e)}})}static publishStory(e){var t=e.upload_image_src,r=e.upload_url;t&&r&&fetch(t).then(e=>e.blob()).then(e=>{var t=new FormData,i=encodeURIComponent(`story_share_${Object(a.irand)(0,99999)}.jpg`);return t.append("file0",e,i),fetch(r,{method:"POST",body:t})}).then(()=>{Object(s.showDoneBox)(getLang("apps_share_to_story_success"));var e=Object(s.curBox)();e&&e.hide()}).catch(()=>{Object(i.showFastBox)(getLang("global_error"),getLang("apps_share_to_story_error"))})}}var u=r("W9Tc");r.d(t,"default",function(){return P});var _="game",f="votes_3",m="votes_10",b="votes_100",g="spin",v=10600,w="fortune_spin",E="fortune_notification",y="/apps",O="fortune_wheel",C="apps_black_friday_rest_spins",S="apps_black_friday_rest_spin_by_order",A="apps_black_friday_no_rest_spin";class P{static isEnabled(){return Object(u.partConfigEnabled)("apps_fortune_wheel")}constructor(){this.wheelImageEl=null,this.restTextEl=null,this.spinButtonEl=null,this.lastGiftSector=-1,this.restCount=0,this.possibleSpinByOrder=!1,this.lastGiftData=null,this.wheelTimeout=0,this.resetTimeout=0,this.weheelInProgress=!1}init(){this.wheelImageEl=document.querySelector(".FortuneWheelBanner__wheelImage"),this.restTextEl=document.querySelector(".FortuneWheelBanner__spinRestCount"),this.spinButtonEl=document.querySelector(".FortuneWheelBanner__spinButton"),this.wheelImageEl&&this.restTextEl&&this.spinButtonEl&&(this.restCount=+this.restTextEl.dataset.restSpins,this.possibleSpinByOrder=Boolean(+this.restTextEl.dataset.possibleOrder),window.cur=window.cur||{},window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.destroy()}))}destroy(){this.wheelTimeout&&clearTimeout(this.wheelTimeout),this.resetTimeout&&clearTimeout(this.resetTimeout),this.weheelInProgress&&(this.sendNotify(this.lastGiftData),this.updateRestSpinsByGift(this.lastGiftData),this.updateButtonState(),this.wheelImageEl.classList.remove(`FortuneWheelBanner__wheelImage--start${this.lastGiftSector}`),this.wheelImageEl.classList.remove(`FortuneWheelBanner__wheelImage--gift${this.lastGiftSector}`),this.weheelInProgress=!1)}spin(e,t){this.lastGiftData=null,ajax.post(y,{act:w,hash:t},{onDone:t=>{this.onSpinWheelSuccess(e,t)},onFail:e=>{Object(i.showFastBox)(Object(n.getLang)("global_error"),e)},showProgress:()=>{this.disableButton()}})}disableButton(){this.spinButtonEl.disabled="disabled",this.spinButtonEl.classList.add("FortuneWheelBanner__spinButton--disabled")}enableButton(){this.spinButtonEl.disabled=!1,this.spinButtonEl.classList.remove("FortuneWheelBanner__spinButton--disabled")}onSpinWheelSuccess(e,t){if(this.wheelImageEl){this.wheelImageEl.classList.add(`FortuneWheelBanner__wheelImage--gift${t.wheel_sector}`),this.lastGiftSector=t.wheel_sector,this.lastGiftData=t,this.weheelInProgress=!0;var r=t.wheel_sector>=0?v:0;this.updateRestSpins(),this.wheelTimeout=setTimeout(()=>{this.updateRestSpinsByGift(t),this.showGiftBox(t),this.updateButtonState(),this.sendNotify(t),this.weheelInProgress=!1},r)}}sendNotify(e){e&&ajax.post(y,{act:E,gift_id:e.gift_id,hash:e.data_hash})}updateRestSpinsByGift(e){e.gift_type===g&&(this.restCount+=2,this.updateRestSpins())}updateRestSpins(){this.restCount--,this.restCount?this.restTextEl.textContent=Object(n.langNumeric)(this.restCount,cur.lang[C]).replace("{count}",this.restCount):this.possibleSpinByOrder?this.restTextEl.textContent=Object(n.getLang)(S):this.restTextEl.textContent=Object(n.getLang)(A),this.restTextEl.dataset.restSpins=this.restCount}updateButtonState(){this.restCount?this.enableButton():this.disableButton()}showGiftBox(e){switch(e.gift_type){case _:this.showGameGiftBox(e);break;case f:case m:case b:this.showVotesGiftBox(e);break;case g:this.showSpinGiftBox();break;default:Object(i.showFastBox)(Object(n.getLang)("global_error"),Object(n.getLang)("global_error"))}}reInitWheelPosition(){this.wheelImageEl.classList.remove(`FortuneWheelBanner__wheelImage--gift${this.lastGiftSector}`),this.wheelImageEl.classList.add(`FortuneWheelBanner__wheelImage--start${this.lastGiftSector}`),this.resetTimeout=setTimeout(()=>{this.wheelImageEl.classList.remove(`FortuneWheelBanner__wheelImage--start${this.lastGiftSector}`)},1100)}showGameGiftBox(e){var t=Object(n.getLang)("apps_black_friday_gift_popup_game_desc").replace("{app_name}",e.app_name),r=Object(u.partConfigEnabled)("apps_promo_share_story")?`<a class="FortuneWheelGiftPopup__shareLink" onclick="cur.FortuneWheel.share()">${Object(n.getLang)("apps_black_friday_gift_popup_share")}</a>`:"",i=`\n    <div class="FortuneWheelGiftPopup__content">\n      <a class="FortuneWheelGiftPopup__close" onclick="curBox().hide(true)">close</a>\n      <div class="FortuneWheelGiftPopup__header"></div>\n      <div class="FortuneWheelGiftPopup__paddedContent">\n        <div class="FortuneWheelGiftPopup__title">${Object(n.getLang)("apps_black_friday_gift_popup_title")}</div>\n        <div class="FortuneWheelGiftPopup__description">${t}</div>\n        <div class="FortuneWheelGiftPopup__appIcon">\n          <img src="${Object(a.escapeAttr)(e.app_icon)}" class="FortuneWheelGiftPopup__appIconImg">\n        </div>\n        <div class="FortuneWheelGiftPopup__appName">${e.app_name}</div>\n        <a class="flat_button FortuneWheelGiftPopup__appHref" href="${Object(a.escapeAttr)(e.app_href)}">\n          ${Object(n.getLang)("apps_black_friday_gift_popup_game_run")}\n        </a>\n        ${r}\n      </div>\n    </div>\n    `;this.showBox(i,"FortuneWheelGiftPopup FortuneWheelGiftPopup--game")}showSpinGiftBox(){var e=Object(n.getLang)("apps_black_friday_gift_popup_spin_desc"),t=`\n    <div class="FortuneWheelGiftPopup__content">\n      <a class="FortuneWheelGiftPopup__close" onclick="curBox().hide(true)">close</a>\n      <div class="FortuneWheelGiftPopup__header"></div>\n      <div class="FortuneWheelGiftPopup__paddedContent">\n        <div class="FortuneWheelGiftPopup__title">${Object(n.getLang)("apps_black_friday_gift_popup_title")}</div>\n        <div class="FortuneWheelGiftPopup__description">${e}</div>\n         <a class="flat_button FortuneWheelGiftPopup__spinHref" onclick="curBox().hide(true)">\n           ${Object(n.getLang)("apps_black_friday_gift_popup_spin_button")}\n        </a>\n      </div>\n    </div>\n    `;this.showBox(t,"FortuneWheelGiftPopup FortuneWheelGiftPopup--spin")}showVotesGiftBox(e){var t={};t[b]=100,t[m]=10,t[f]=3;var r=t[e.gift_type],i=Object(n.langNumeric)(r,cur.lang.apps_black_friday_gift_popup_votes_desc).replace("{count}",r),o=Object(u.partConfigEnabled)("apps_promo_share_story")?`<a class="FortuneWheelGiftPopup__shareLink" onclick="cur.FortuneWheel.share()">${Object(n.getLang)("apps_black_friday_gift_popup_share")}</a>`:"",s=`\n    <div class="FortuneWheelGiftPopup__content">\n      <a class="FortuneWheelGiftPopup__close" onclick="curBox().hide(true)">close</a>\n      <div class="FortuneWheelGiftPopup__header"></div>\n      <div class="FortuneWheelGiftPopup__paddedContent">\n        <div class="FortuneWheelGiftPopup__title">${Object(n.getLang)("apps_black_friday_gift_popup_title")}</div>\n        <div class="FortuneWheelGiftPopup__description">${i}</div>\n        <div class="FortuneWheelGiftPopup__codeControls">\n          <div class="FortuneWheelGiftPopup__code">\n            <span class="FortuneWheelGiftPopup__codeText">${e.promo_code}</span>\n            <a class="FortuneWheelGiftPopup__copy" onclick="cur.FortuneWheel.copyCode()"></a>\n          </div>\n          <a class="flat_button FortuneWheelGiftPopup__activateCodeHref" href="/settings?act=payments&w=promocode${Object(a.escapeAttr)(this.lastGiftData.promo_code)}">\n            ${Object(n.getLang)("apps_black_friday_gift_activate_code")}\n          </a>\n        </div>\n        ${o}\n        <div class="FortuneWheelGiftPopup__footer">\n          ${Object(n.getLang)("apps_black_friday_gift_activate_code_help")}\n        </div>\n       </div>\n    </div>\n    `;this.showBox(s,"FortuneWheelGiftPopup FortuneWheelGiftPopup--votes")}showBox(e,t){new i.MessageBox({title:!1,width:400,containerClass:t,noControls:!0,hideOnBGClick:!1,onDestroy:()=>{this.reInitWheelPosition()},onHideAttempt:e=>e}).content(e).show()}copyCode(){this.lastGiftData&&(Object(o.copyToClipboard)(this.lastGiftData.promo_code),Object(s.showDoneBox)(Object(n.getLang)("apps_black_friday_gift_code_copy_success"),{timeout:1e3}))}share(){this.lastGiftData&&h.share(O,this.lastGiftData.gift_type,this.lastGiftData.share_hash)}}},97:function(e,t,r){e.exports=r("G9Ol")},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",function(){return a}),r.d(t,"combineReducers",function(){return l}),r.d(t,"bindActionCreators",function(){return d}),r.d(t,"applyMiddleware",function(){return f}),r.d(t,"compose",function(){return _}),r.d(t,"__DO_NOT_USE__ActionTypes",function(){return o});var i=r("bCCX"),n=function(){return Math.random().toString(36).substring(7).split("").join(".")},o={INIT:"@@redux/INIT"+n(),REPLACE:"@@redux/REPLACE"+n(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+n()}};function s(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function a(e,t,r){var n;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(a)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var c=e,l=t,p=[],d=p,h=!1;function u(){d===p&&(d=p.slice())}function _(){if(h)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return l}function f(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(h)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return u(),d.push(e),function(){if(t){if(h)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,u();var r=d.indexOf(e);d.splice(r,1)}}}function m(e){if(!s(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw new Error("Reducers may not dispatch actions.");try{h=!0,l=c(l,e)}finally{h=!1}for(var t=p=d,r=0;r<t.length;r++){(0,t[r])()}return e}return m({type:o.INIT}),(n={dispatch:m,subscribe:f,getState:_,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");c=e,m({type:o.REPLACE})}})[i.default]=function(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(_())}return r(),{unsubscribe:t(r)}}})[i.default]=function(){return this},e},n}function c(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function l(e){for(var t=Object.keys(e),r={},i=0;i<t.length;i++){var n=t[i];0,"function"==typeof e[n]&&(r[n]=e[n])}var s,a=Object.keys(r);try{!function(e){Object.keys(e).forEach(function(t){var r=e[t];if(void 0===r(void 0,{type:o.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:o.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+o.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(r)}catch(e){s=e}return function(e,t){if(void 0===e&&(e={}),s)throw s;for(var i=!1,n={},o=0;o<a.length;o++){var l=a[o],p=r[l],d=e[l],h=p(d,t);if(void 0===h){var u=c(l,t);throw new Error(u)}n[l]=h,i=i||h!==d}return i?n:e}}function p(e,t){return function(){return t(e.apply(this,arguments))}}function d(e,t){if("function"==typeof e)return p(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),i={},n=0;n<r.length;n++){var o=r[n],s=e[o];"function"==typeof s&&(i[o]=p(s,t))}return i}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){h(e,t,r[t])})}return e}function _(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),i=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},n={getState:r.getState,dispatch:function(){return i.apply(void 0,arguments)}},o=t.map(function(e){return e(n)});return u({},r,{dispatch:i=_.apply(void 0,o)(r.dispatch)})}}}},Cb16:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return o});r("91GP");var i=r("q1tI");r("17x9");function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}class o extends i.Component{constructor(e){if(super(e),this.props.defaultValue<0||this.props.defaultValue>1)throw new Error("Bad defaultValue specified to Slider");this.containerRef=i.createRef()}componentDidUpdate(e){this.props.value!==e.value&&this.sliderElement.setValue(this.props.value,!0)}componentDidMount(){this.sliderElement=new window.Slider(this.containerRef.current,n({size:1,value:this.props.defaultValue,formatHint:this.props.formatHint,onChange:this.props.onChange},this.props))}render(){return i.createElement("div",{className:`Slider Slider--${this.props.color} ${this.props.className}`,ref:this.containerRef})}}o.defaultProps={color:"blue",defaultValue:.5,formatHint:e=>Math.round(100*e)}},D1OX:function(e,t,r){"use strict";r.r(t);var i,n=r("jE6c");i=window.hasOwnProperty("__SHARED_STATE_KEY")?window.__SHARED_STATE_KEY:Object.create(null),Object.defineProperty(window,"__SHARED_STATE_KEY",{configurable:!0,value:i});var o=()=>window.__SHARED_STATE_KEY,s=e=>o()[e],a={persistIfInitialized:!0};r.d(t,"uiGetGallery",function(){return p}),r.d(t,"UIGallery",function(){return d});var c=1e3,l=((e,t,r)=>{var i=Object(n.defaults)({},r,a),c=e in o(),l=s(e),p=c&&i.persistIfInitialized?l:t(l);((e,t)=>{o()[e]=t})(e,p);return()=>s(e)})("ui-gallery",()=>({galleries:{},incIndex:0}));function p(e){var t=domData(ge(e),"gallery-id");return t&&l().galleries[t]}class d{constructor(e,t){if(!e)throw new Error("No element was provided for UIGallery");if(e=ge(e),!hasClass(e,"ui_gallery"))throw new Error("Provided incorrect element for UIGallery");var r=p(e);if(r)return r;this._opts=extend({markOutside:!1,scrollY:!0,scrollX:!0,noArrows:!1},t),this._id=l().incIndex,l().incIndex+=1,this._el=e,this._width=getSize(this._el)[0],this._items=geByClass("ui_gallery_item",this._el),this._itemWidth=getSize(this._items[0])[0],this._itemOffset=intval(getStyle(this._items[0],vk.rtl?"marginLeft":"marginRight")),this._scrollOffset=intval(getStyle(this._items[0],"marginLeft")),this._itemFullWidth=this._itemWidth+this._itemOffset,this._innerCont=geByClass1("ui_gallery__inner_cont",this._el),this._inner=geByClass1("ui_gallery__inner",this._el),this._scroll=function(){var e={rtl:!1,backward:!1,delta:1,negative:!1,rtlSame:!1};if(!vk.rtl)return e;if(!cur._scrollInfo){var t=se('<div style="position: fixed; left: -1000; width: 0; overflow: scroll">x</div>');ge("content").appendChild(t);var r=t.scrollLeft;e.rtl=vk.rtl,e.backward=r>0,t.scrollLeft=1e3,e.delta=t.scrollLeft===r?-1:1,e.negative=!e.backward&&e.delta<0,e.rtlSame=e.rtl&&!e.backward&&!e.negative,re(t),cur._scrollInfo=e}return cur._scrollInfo}(),this._loadingMore=!1,this._finised=!1,this._visible={left:-1,right:-1,items:[]},this._outside={left:-1,right:-1,timer:null},this._initScroll(),this._initArrows(),domData(this._el,"gallery-id",this._id),l().galleries[this._id]=this,this._checkItemsAfterScroll(this._innerCont.scrollLeft,!0)}_initScroll(){(this._opts.scrollX||this._opts.scrollY)&&addEvent(this._innerCont,"DOMMouseScroll wheel",this._onWheelScroll.bind(this))}_initArrows(){this._opts.noArrows?addClass(this._el,"ui_gallery_no_arrows"):(this._leftArrow=geByClass1("ui_gallery__arrow_left",this._el),this._rightArrow=geByClass1("ui_gallery__arrow_right",this._el),this._arrowWidth=getSize(this._leftArrow)[0],addEvent(this._leftArrow,"click",this._onArrowScroll.bind(this,-1)),addEvent(this._leftArrow,"mouseover",this._onArrowMouseOver.bind(this,"left")),addEvent(this._leftArrow,"mouseout",this._onArrowMouseOut.bind(this)),addEvent(this._rightArrow,"click",this._onArrowScroll.bind(this,1)),addEvent(this._rightArrow,"mouseover",this._onArrowMouseOver.bind(this,"right")),addEvent(this._rightArrow,"mouseout",this._onArrowMouseOut.bind(this)))}_onWheelScroll(e){if(this._opts.scrollX||this._opts.scrollY){var t;if("wheel"==e.type)if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){if(!this._opts.scrollY)return;t=-e.deltaY}else{if(!this._opts.scrollX)return;t=-e.deltaX}else if(void 0!==e.wheelDeltaY){if(!this._opts.scrollY)return;t=e.wheelDeltaY}else if(void 0!==e.wheelDelta)t=e.wheelDelta;else{if(!e.detail||1!==e.axis)return;t=-e.detail}t=this._scroll.rtlSame?-t:t,Math.abs(t)>=120&&(t=74*Math.max(-1,Math.min(1,t))),this._innerCont.scrollLeft-=t,this._checkItemsAfterScroll(this._innerCont.scrollLeft),cancelEvent(e)}}_onArrowScroll(e,t){if(!this._opts.noArrows){var r=this._innerCont.scrollLeft+(this._scroll.rtlSame?-e:e)*(this._width-2*this._arrowWidth),i=this._innerCont.scrollWidth-this._width;this._scroll.negative?(r=Math.min(r,0),r=Math.abs(r)):r=Math.max(0,r),r=Math.min(i,r);var n=this._scroll.negative||this._scroll.rtlSame?-e:e;if(n>0&&r<i)r=Math.floor(r/this._itemFullWidth)*this._itemFullWidth;else if(n<0&&r>0){r=Math.floor(r/this._itemFullWidth)*this._itemFullWidth}if(0===r||r===i){var o=this._innerCont.scrollWidth;addClass(this._inner,"ui_gallery__inner_shift_instant"),this._onArrowMouseOut(),r&&(r+=e*(this._innerCont.scrollWidth-o))}this._scroll.negative&&(r=-r),animate(this._innerCont,{scrollLeft:r},{duration:Math.abs(this._innerCont.scrollLeft-r)+50,transition:Fx.Transitions.easeOutCubic}),this._checkItemsAfterScroll(r),setTimeout(()=>removeClass(this._inner,"ui_gallery__inner_shift_instant"),0),cancelEvent(t)}}_checkItemsAfterScroll(e,t){if(this._scroll.negative&&(e=Math.abs(e)),this._opts.markOutside||this._opts.onViewItem){var r,i=this._itemWidth/3,n=(this._scroll.backward?this._inner.scrollWidth-this._width-e:e)-this._scrollOffset,o=e&&Math.floor(n/this._itemFullWidth),s=o*this._itemFullWidth+2*i;r=this._scroll.backward?e+this._width<this._inner.scrollWidth-s:e>s;var a,l=Math.min(this._items.length-1,Math.floor((n+this._width)/this._itemFullWidth)),p=l*this._itemFullWidth+2*i;if(a=this._scroll.backward?e>this._inner.scrollWidth-p:e+this._width<p,this._opts.onViewItem){var d=r?Math.min(this._items.length-1,o+1):o,h=a?Math.max(0,l-1):l;if(t||d!==this._visible.left||h!==this._visible.right){for(var u=d;u<=h;u++)(this._visible.left<0||t&&!inArray(this._items[u],this._visible.items)||u<this._visible.left||u>this._visible.right)&&this._opts.onViewItem(this._items[u],u);this._visible.left=d,this._visible.right=h,this._visible.items=this._items.slice(d,h+1)}}this._opts.markOutside&&(t?(geByClass("ui_gallery_item_outside",this._inner).forEach(e=>{removeClass(e,"ui_gallery_item_outside")}),this._outside.left=-1,this._outside.right=-1):((o!==this._outside.left||!r)&&this._outside.left>=0&&(removeClass(this._items[this._outside.left],"ui_gallery_item_outside"),this._outside.left=-1),(l!==this._outside.right||!a)&&this._outside.right>=0&&(removeClass(this._items[this._outside.right],"ui_gallery_item_outside"),this._outside.right=-1)),r&&o!==this._outside.left&&(addClass(this._items[o],"ui_gallery_item_outside"),this._outside.left=o),a&&l!==this._outside.right&&(addClass(this._items[l],"ui_gallery_item_outside"),this._outside.right=l))}if(!this._opts.noArrows){var _=e>0,f=e+this._width<this._inner.scrollWidth;toggleClass(this._leftArrow,"ui_gallery__arrow_visible",this._scroll.rtl&&!this._scroll.backward?f:_),toggleClass(this._rightArrow,"ui_gallery__arrow_visible",this._scroll.rtl&&!this._scroll.backward?_:f)}(!this._scroll.backward&&this._inner.scrollWidth-e-this._width<c||this._scroll.backward&&e<c)&&this._onLoadMore()}_onArrowMouseOver(e){this._opts.noArrows||addClass(this._inner,"ui_gallery__inner_shift_"+e)}_onArrowMouseOut(){this._opts.noArrows||(removeClass(this._inner,"ui_gallery__inner_shift_left"),removeClass(this._inner,"ui_gallery__inner_shift_right"))}_onLoadMore(){!this._opts.onLoadMore||this._loadingMore||this._finised||(this._loadingMore=!0,this._opts.onLoadMore(this._items.length))}addMore(e,t){e=e||[],this.addItems(e),this._finised=!!t||!e.length,this._loadingMore=!1}addItems(e,t){if((e=e||[]).length){var r=t>=0&&t<this._items.length?this._items[t]:null;e.forEach(e=>{r?domInsertBefore(e,r):this._inner.appendChild(e)}),this.refresh()}}destroy(){removeEvent(this._innerCont),removeEvent(this._leftArrow),removeEvent(this._rightArrow),domData(this._el,"gallery-id",null),delete l().galleries[this._id],this._opts.onDestroy&&this._opts.onDestroy(),re(this._el)}removeItem(e){return isNumeric(e)&&(e=this._items[e]),!(!e||!inArray(e,this._items))&&(re(e),this.refresh(),this._items.length||this.destroy(),!0)}refresh(){this._width=getSize(this._el)[0],this._items=geByClass("ui_gallery_item",this._el),this._checkItemsAfterScroll(this._innerCont.scrollLeft,!0)}getItems(){return this._items}getVisibleItems(){return this._visible.items.map((e,t)=>[e,this._visible.left+t])}}},D2Nl:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r("JHWP")),o=r("Iwry"),s=/url\((['"]?)([^'"]+?)\1\)/g;function a(e){var t=[];return e.replace(s,function(e,r,i){return t.push(i),e}),t.filter(function(e){return!o.isDataUrl(e)})}function c(e,t,r,i){var s=r?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;var r=document.implementation.createHTMLDocument(),i=r.createElement("base"),n=r.createElement("a");return r.head.appendChild(i),r.body.appendChild(n),t&&(i.href=t),n.href=e,n.href}(t,r):t;return Promise.resolve(s).then(function(e){return n.default(e,i)}).then(function(e){return o.toDataURL(e,o.getMimeType(t))}).then(function(r){return e.replace(new RegExp("(url\\(['\"]?)("+function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}(t)+")(['\"]?\\))","g"),"$1"+r+"$3")}).then(function(e){return e},function(){return s})}function l(e){return-1!==e.search(s)}t.shouldEmbed=l,t.default=function(e,t,r){return l(e)?Promise.resolve(e).then(a).then(function(i){return i.reduce(function(e,i){return e.then(function(e){return c(e,i,t,r)})},Promise.resolve(e))}):Promise.resolve(e)}},G9Ol:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ioFf"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("rGqo"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("HEwt"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Oyvg"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("OG14"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("Vd3H"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("Btvt"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("zxIV"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("FWc3"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("4+be"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("t7n3"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("Egk5"),_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("XzvV"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("gdug"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("7jxN"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("jE6c"),_shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("3f+a"),_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("lMzL"),_shared_apps_SessionTimeLogger__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("xo6n"),_vkontakte_vk_qr__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("wZQE"),_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("WPHA"),_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("eiY0"),_web_apps_games_gifts_GiftsFriendsWishListLoader__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("nNgf"),_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("4zn2"),blueimp_md5__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("jYEY"),_web_apps_promo_wheel_FortuneWheel__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("6tUA"),_shared_constants_platforms__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("z9Td");function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],i=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var ID_APP_CHECKBACK=6739175;!function(e){if(!e.fastXDM){var t={},r=[],i={};e.fastXDM={_id:0,helperUrl:"https://vk.com/js/api/xdmHelper.js",Server:function(r,i,n){this.methods=r||{},this.filter=i,this.options=n||{},this.id=e.fastXDM._id++,this.key=function(){for(var e="",t=0;t<5;t++)e+=Math.ceil(15*Math.random()).toString(16);return e}(),this.frameName="fXD"+this.key,this.frameId="fXD",this.server=!0,this.methods["%init%"]=this.methods.__fxdm_i=function(){e.fastXDM.run(this.id),this.methods.onInit&&this.methods.onInit()},t[this.key]=[l,this]},Client:function(r,i){if(this.methods=r||{},this.options=i||{},this.id=e.fastXDM._id++,this.client=!0,e.fastXDM.run(this.id),0!==window.name.indexOf("fXD"))throw Error("Wrong window.name property.");this.key=window.name.substr(3),this.caller=window.parent,t[this.key]=[l,this],e.fastXDM.on("helper",function(){e.fastXDM.onClientStart(this)},this),a(function(e){e.send(this,e.json.stringify(["%init%"]));var t=this.methods;setTimeout(function(){t.onInit&&t.onInit()},0)},this)},onMessage:function(r){if(r.origin!==e.location.origin){var i=cur.app&&cur.app.options&&cur.app.options.src?cur.app.options.src:"";if(!i)return!1;r.origin!==i&&r.origin+"/"!==i.substring(0,r.origin.length+1)&&console.warn("Warning: message from "+r.origin+" will be disable in future")}var n=r.data;if(!n)return!1;if("string"!=typeof n&&!(n instanceof String))return!1;var o=n.substr(0,5);if(t[o]){var s=t[o][1];!s||s.filter&&!s.filter(r.origin)||t[o][0](n.substr(6),s)}},setJSON:function(e){i.json=e},getJSON:function(e){if(!e)return i.json;a(function(t){e(t.json)})},setEnv:function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);c()},_q:{},on:function(e,t,r){this._q[e]||(this._q[e]=[]),-1==this._q[e]?t.apply(r):this._q[e].push([t,r])},run:function(e){for(var t=(this._q[e]||[]).length,r=0;r<t;r++)this._q[e][r][0].apply(this._q[e][r][1]);this._q[e]=-1},waitFor:n},e.fastXDM.Server.prototype.start=function(t,r){if(t.contentWindow)this.caller=t.contentWindow,this.frame=t,e.fastXDM.on("helper",function(){e.fastXDM.onServerStart(this)},this);else{var i=this;(r=r||0)<50&&setTimeout(function(){i.start.apply(i,[t,r+1])},100)}},e.fastXDM.Server.prototype.destroy=function(){delete t[this.key]},e.fastXDM.Server.prototype.append=function(e,t,r){var i=document.createElement("DIV");i.innerHTML='<iframe name="'+this.frameName+'" id="'+this.frameId+'" '+(r||"")+"></iframe>";var n=i.firstChild;t.vkApp&&n.addEventListener("load",function(){var e=cur.app.cont,t={type:"VKWebAppSettings",frameId:e.id};e.firstElementChild.contentWindow.postMessage(t,"*")});var o=this,s=function(){n.frameBorder="0",t&&function e(t,r){for(var i in r)t[i]&&"object"==typeof t[i]?e(t[i],r[i]):t[i]=r[i]}(n,t),e.insertBefore(n,e.firstChild),o.start(n)};return~e.className.indexOf("app_container--vk-app")&&delete t.scrolling,o.options.layer?s():setTimeout(function(){s()},0),n},e.fastXDM.Client.prototype.callMethod=e.fastXDM.Server.prototype.callMethod=function(){for(var t=this,r=Array.prototype.slice.call(arguments),i=r.shift(),o=0,c=r.length;o<c;o++)"function"==typeof r[o]?function(){t.funcsCount=(t.funcsCount||0)+1;var e=r[o],i="_func"+t.funcsCount;t.methods[i]=function(){e.apply(this,arguments),delete this.methods[i]},r[o]={_func:t.funcsCount}}():this.options.safe&&(r[o]=s(r[o],!1));n(this,"caller",function(){e.fastXDM.on(this.id,function(){a(function(e){e.send(this,e.json.stringify([i,r]))},this)},this)},this)},e.JSON&&"object"==typeof e.JSON&&e.JSON.parse&&e.JSON.stringify&&'{"a":[1,2,3]}'===e.JSON.stringify({a:[1,2,3]}).replace(/ /g,"")?i.json={parse:e.JSON.parse,stringify:e.JSON.stringify}:e.fastXDM._needJSON=!0,e.postMessage?(i.protocol="p",i.send=function(e,t){var r=e.frame?e.frame.contentWindow:e.caller;if(r)try{r.postMessage(e.key+":"+t,"*")}catch(i){window.postMessage.call(r,e.key+":"+t,"*")}},e.addEventListener?e.addEventListener("message",e.fastXDM.onMessage,!1):e.attachEvent("onmessage",e.fastXDM.onMessage),e.fastXDM._needJSON?(e.fastXDM._onlyJSON=!0,o()):c()):o()}function n(e,t,r,i,o){e[t]?r.apply(i):(o=o||0)<1e3&&setTimeout(function(){n(e,t,r,i,o+1)},0)}function o(t){setTimeout(function(){var r=document.createElement("script");r.type="text/javascript",r.src=t||e.fastXDM.helperUrl,n(document,"body",function(){document.getElementsByTagName("HEAD")[0].appendChild(r)})},0)}function s(e,t){var r;switch(typeof e){case"string":r=t?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e.replace(/&#039;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");break;case"object":if("[object Array]"===Object.prototype.toString.apply(e)){r=[];for(var i=0,n=e.length;i<n;i++)r[i]=s(e[i],t)}else for(var o in r={},e)Object.hasOwnProperty.call(e,o)&&(r[o]=s(e[o],t));break;default:r=e}return r}function a(e,t){i.loaded?e.apply(t,[i]):r.push([t,e])}function c(){i.loaded=!0;for(var e=0,t=r.length;e<t;e++)r[e][1].apply(r[e][0],[i])}function l(e,t){a(function(r){var i=r.json.parse(e);if(i[0]){i[1]||(i[1]=[]);for(var n=0,o=i[1].length;n<o;n++)i[1][n]&&i[1][n]._func?function(){var e=i[1][n]._func;i[1][n]=function(){var r=Array.prototype.slice.call(arguments);r.unshift("_func"+e),t.callMethod.apply(t,r)}}():t.options.safe&&(i[1][n]=s(i[1][n],!0));setTimeout(function(){if(!t.methods[i[0]])throw Error("fastXDM: Method "+i[0]+" is undefined");t.methods[i[0]].apply(t,i[1])},0)}})}}(window),window._iconAdd||(window._iconAdd=window.devicePixelRatio>=2?"_2x":""),window.appCallback=function(e){var t=e.shift();return!cur.app||!cur.app.funcs||(cur.app.funcs[t]||setTimeout(function(){throw new Error("unsupported app method: "+t)},0),setTimeout(function(r){return r.app.funcs[t].apply(r.app,e)}.pbind(cur),0),!0)},window.detectUnityWebPlayer=function(e,t){var r,i=function(e,t){var r=0,i=0,n=ce("object",{type:"application/vnd.unity"},{visibility:"hidden"});bodyNode.appendChild(n),function(){if(void 0===n.GetPluginVersion)i++<10?setTimeout(arguments.callee,10):(bodyNode.removeChild(n),e(null));else{var o={};if(t)for(r=0;r<t.length;++r)o[t[r]]=n.GetUnityVersion(t[r]);o.plugin=n.GetPluginVersion(),bodyNode.removeChild(n),e(o)}}()},n=function(e){var t,r,i,n,o,s=0;if(e){var a=e.toLowerCase().match(/^(\d+)(?:\.(\d+)(?:\.(\d+)([dabfr])?(\d+)?)?)?$/);a&&a[1]&&(t=a[1],r=a[2]?a[2]:0,i=a[3]?a[3]:0,n=a[4]?a[4]:"r",o=a[5]?a[5]:0,s|=t/10%10<<28,s|=t%10<<24,s|=r%10<<20,s|=i%10<<16,s|={d:8192,a:16384,b:24576,f:32768,r:32768}[n],s|=o/100%10<<8,s|=o/10%10<<4,s|=o%10)}return s},o=!1;if(navigator.plugins.refresh(),void 0!==navigator.plugins&&navigator.plugins["Unity Player"]&&void 0!==navigator.mimeTypes&&navigator.mimeTypes["application/vnd.unity"]&&navigator.mimeTypes["application/vnd.unity"].enabledPlugin){if(o=!0,_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.safari&&/Mac OS X 10_6/.test(navigator.appVersion))return void i(function(t){t&&t.plugin||(o=!1),e(o,t)},t);if(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mac&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.chrome)return void i(function(t){t&&n(t.plugin)<=n("2.6.1f3")&&(o=!1),e(o,t)},t);if(t)return void i(function(t){e(o,t)},t)}else if(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.msie){var s=!1;try{null!=ActiveXObject.prototype&&(s=!0)}catch(e){}if(s&&(!/win64/i.test(navigator.userAgent)||!/x64/i.test(navigator.userAgent)))try{var a=new ActiveXObject("UnityWebPlayer.UnityWebPlayer.1"),c=a.GetPluginVersion();if(t){r={};for(var l=0;l<t.length;++l)r[t[l]]=a.GetUnityVersion(t[l]);r.plugin=c}if(o=!0,"2.5.0f5"==c){var p=/Windows NT \d+\.\d+/.exec(navigator.userAgent);if(p&&p.length>0)parseFloat(p[0].split(" ")[2])>=6&&(o=!1)}}catch(e){}}e(o,r)},window.vkApp=function(e,t,r,i,n){if(r=r||{},t=t||{},window.parent&&window.parent!=window&&!t.checking&&!t.openapi&&!t.embed)return!1;var o=this;if(this.cont=ge(e),this.cont){if(r.hash=r.hash||"",-1!=r.hash.indexOf("#")){var s=r.hash.split("#").pop();(s||"").substr(0,1)==vk.navPrefix?r.hash="":r.hash=s}this.params=r,this.onReady=[],this.isOpenInLayer()&&this.onReady.push(this.checkExternalAppResponse.bind(this));var a="";if(1==t.type)if(t.vkApp)a=t.vk_app_url,r.hash?a+=`#${r.hash}`:location.hash&&(a+=location.hash);else{a=t.src;var c=[];for(var l in r)"hash"==l?c.push(l+"="+encodeURIComponent(r[l])):c.push(l+"="+r[l]);a+=(-1==a.indexOf("?")?"?":"&")+c.join("&")}t.inlineApp&&(o.inlineApp=!0),o.options=extend({heightMax:4500},t),this.sessionLogger=null,t.log_session&&!t.vkApp&&(this.sessionLogger=new _shared_apps_SessionTimeLogger__WEBPACK_IMPORTED_MODULE_25__.default(window.cur.aid),cur.destroy.unshift(()=>{this.sessionLogger.stop()})),this.funcs={onInit:function(){return t.heightSync&&o.RPC.callMethod("getHeight",function(e){o.setHeight(e)}),o.inited||(o.inited=!0,i&&i(),o.inlineApp||o.onAppReady()),o.sessionLogger&&o.sessionLogger.start(),!0},ApiCall:function(e,t){var r=e.shift();o.api(r,e[0],t)},_getAppInfo:function(e){e([o.params.api_id,window.location.hash])},api:function(e,t,r){o.api(t,r,function(t){o.apiCallback(e,t)})},setHeight:function(e){o.setHeight(e)},scrollWindow:function(e,t){if(!o.inlineApp){var r=Math.max(e,0);t=intval(t),o.options.layer?o.params.is_vkpay_service&&window.wkLayerWrap&&animate(window.wkLayerWrap,{scrollTop:r},t):t&&t>0?(animate(htmlNode,{scrollTop:r},t),animate(bodyNode,{scrollTop:r},t)):window.scroll(0,r)}},scrollTop:function(e){var t=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.appTopOffset||(cur.appTopOffset=getXY(cur.app.cont)[1]);var r=0;window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&(r=1),cur.app.runCallback("onScrollTop",parseInt(scrollGetY()),parseInt(t),parseInt(cur.appTopOffset),r)},scrollSubscribe:function(e){var t,r=o.isOpenInLayer();t=r&&ge("wk_layer_wrap")||(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.msie6?pageNode:window);var i=function(){var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight,i=r?()=>t.scrollTop:scrollGetY;o.runCallback("onScroll",parseInt(i()),parseInt(e))},n=function(){addEvent(t,"scroll",i)};n(),e&&i(),cur._back?(cur._back.show.push(n),cur._back.hide.push(function(){removeEvent(t,"scroll",i)})):cur.destroy.push(function(){removeEvent(t,"scroll",i)})},showRequestBox:function(e,r,i){t.vkApp||showBox("al_apps.php",{act:"show_request_box",aid:cur.aid,message:r,uid:e,request_key:i},{params:{width:430,dark:1},onFail:function(e){return cur.app.runCallback("onRequestFail",e),!0}})},showInstallPushBox:function(){t.vkApp||showBox("al_apps.php",{act:"show_install_push_box",aid:cur.aid},{params:{width:430,dark:1},onFail:function(e){return cur.app.runCallback("onInstallPushFail",e),!0}})},showProfilePhotoBox:function(e){t.vkApp||showBox("al_apps.php",{act:"show_profile_photo_box",hash:e,aid:cur.aid},{params:{dark:1}})},setTitle:function(e){if(!t.vkApp&&!o.inlineApp){e=e.replace(/[<>]+/gi,"");var r=cur.backLang;r=r||Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_vkontakte"),setDocumentTitle(r+(e?" | "+e:""))}},resizeWindow:function(e,t,r){o.options&&o.options.is_widescreen_mode||(o.setWidth(e,r),o.setHeight(t,r),e=o.frame.clientWidth,t=o.frame.clientHeight,o.runCallback("onWindowResized",e,t))},getLocationProtocol:function(e){e(location.protocol)},setLocation:function(e,t){e=e.toString(),cur.appLoc=e,t&&cur.app.runCallback("onLocationChanged",e),nav.setLoc(extend(nav.objLoc,{"#":e}))},setNavigation:function(){},checkFlashSupport:function(e){(e=positive(e))||(e=9),_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.flash>=e?cur.app.runCallback("onCheckFlashSupportSuccess"):(cur.app.showDummy("no_flash"),cur.app.runCallback("onCheckFlashSupportFail"))},checkUnitySupport:function(){window.detectUnityWebPlayer(function(e){e?cur.app.runCallback("onCheckUnitySupportSuccess"):(cur.app.showDummy("no_unity"),cur.app.runCallback("onCheckUnitySupportFail"))})},showInstallBox:function(){if(!t.vkApp)if(cur.appUser)Apps.onAppAdded();else{if(cur.installBoxShown)return;cur.installBoxShown=!0,showBox("apps",{act:"install_box",aid:t.aid},{params:{dark:1}}).setOptions({onHide:function(){setTimeout(function(){cur.installBoxShown=!1},3e3)}})}},showSettingsBox:function(e){if(!t.vkApp&&!cur.settingsBoxShown){cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=function(e,t){cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?cur.app.runCallback("onSettingsChanged",t):cur.app.runCallback("onSettingsCancel"))},cur.settingsBoxShown=!0;var r={act:"settings_box",aid:t.aid,mask:e};t.gid&&(r.gid=t.gid),showBox("apps",r,{params:{dark:1,width:550}}).setOptions({onHide:function(){cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(function(){cur.settingsBoxShown=!1},3e3)}})}},showGroupSettingsBox:function(e){t.vkApp||(cur.settingsBoxShown||(cur.settingsBoxShown=!0,t.gid&&(cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=function(e,t,r){cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?cur.app.runCallback("onGroupSettingsChanged",t,r):cur.app.runCallback("onGroupSettingsCancel"))},showBox("apps",{act:"group_settings_box",aid:t.aid,mask:e,gid:t.gid},{params:{dark:1,width:550}}).setOptions({onHide:function(){cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(function(){cur.settingsBoxShown=!1},3e3)}}))))},showAppWidgetPreviewBox:function(e,r){if(!t.vkApp&&!cur.appWidgetPreviewBox&&t.gid){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=function(e){n(),cur.app.runCallback("onAppWidgetPreviewFail",e)},cur.onAppWidgetPreviewCancel=function(){n(),cur.app.runCallback("onAppWidgetPreviewCancel")},cur.onAppWidgetPreviewSuccess=function(){n(),cur.app.runCallback("onAppWidgetPreviewSuccess")};var i=showBox("apps",{act:"app_widget_preview_box",aid:t.aid,gid:t.gid,type:e,code:r},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:function(){i.setOptions({onHide:function(){Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:function(e){return~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0}})}function n(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout(function(){delete cur.appWidgetPreviewBox},3e3)}},showAllowMessagesFromCommunityBox:function(e){if(!t.vkApp&&!cur.allowMessagesFromCommunityBox){cur.allowMessagesFromCommunityBox=!0,cur.allowMessagesFromCommunityStatus="",cur.onAllowMessagesFromCommunity=function(e){"ok"===e?cur.app.runCallback("onAllowMessagesFromCommunity"):cur.app.runCallback("onAllowMessagesFromCommunityCancel")};var r={act:"allow_messages_from_community_box",aid:t.aid};r.gid=e||t.gid,showBox("apps",r,{params:{dark:1,width:550}}).setOptions({onHide:function(){cur.onAllowMessagesFromCommunity(cur.allowMessagesFromCommunityStatus),setTimeout(function(){cur.allowMessagesFromCommunityBox=!1},3e3)}})}},showInviteBox:function(){t.vkApp||Apps.showInviteBox(t.aid,t.hash)},showPaymentBox:function(e){showBox("al_apps.php",{act:"show_payment_box",votes:e,aid:t.aid},{params:{dark:1}})},showLeadsPaymentBox:function(e){showBox("al_apps.php",{act:"show_payment_box",aid:t.aid,offers:isArray(e)?e.join(","):intval(e)||1},{params:{dark:1}})},showOrderBox:function(e){if(!t.vkApp){if("object"!=typeof e){var r=Array.prototype.slice.call(arguments);e={},each(r,function(){var t=this.split("=");2==t.length&&(e[t[0]]=t[1])})}var i={};for(var n in e)Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.inArray)(n,["type","votes","offer_id","item","currency"])&&(i[n]=e[n]+"");"offers"==i.type&&isArray(i.offer_id)&&(i.offer_id=i.offer_id.join(",")),i.act="show_order_box",i.aid=t.aid,i.hash=t.hash,o.params.sales_ref&&(i.sales_ref=o.params.sales_ref),showBox("al_apps.php",i,{params:{dark:1},onFail:function(e){return!(void 0!==e||!t.embed)||(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e),!0)}}),cur.onAppOrderCancel=function(){cur.app.runCallback("onOrderCancel")},cur.onAppOrderSuccess=function(e){cur.app.runCallback("onOrderSuccess",e)},cur.onAppOrderFail=function(e){cur.app.runCallback("onOrderFail",e)}}},showSubscriptionBox:function(e,r){if(!t.vkApp){if("object"!=typeof r){var i=Array.prototype.slice.call(arguments);r={},each(i,function(){var e=this.split("=");2==e.length&&(r[e[0]]=e[1])})}var n={act:"show_subscription_box",aid:t.aid,action:e,hash:t.hash};"create"==n.action?n.item=r.item:"resume"!=n.action&&"cancel"!=n.action||(n.subscription_id=r.subscription_id),showBox("al_apps.php",n,{onFail:function(e){return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e),!0}}),cur.onSubscriptionCancel=function(){cur.app.runCallback("onSubscriptionCancel")},cur.onSubscriptionSuccess=function(e){cur.app.runCallback("onSubscriptionSuccess",e)},cur.onSubscriptionFail=function(e){cur.app.runCallback("onSubscriptionFail",e)}}},showMerchantPaymentBox:function(e){return!1},showPortlet:function(e){return!1},addToMenu:function(){ajax.post("al_apps.php",{act:"add_left_menu",aid:cur.aid,hash:cur.app.options.hash},{onDone:function(e){Apps.updateLeftNav(e.left_nav),Apps.addToMenuErrorResolve(e),Apps.updateAddToMenuAction()}})},adsPublish:function(){AdsLight.handleEvent.apply(AdsLight,arguments)},callUser:function(e,r,i){t.vkApp||showBox("al_apps.php",{act:"call_user",uid:e,key:r,aid:cur.aid,msg:i},{dark:1,onFail:function(e){return cur.app.runCallback("onCallFail",e),!0}})},debug:function(){debugLog(1==arguments.length?arguments[0]:arguments)},openExternalApp:function(e,r,i){if(e){var n=["pay-to-user","pay-to-service","pay-to-group","transfer-to-user","transfer-to-group","open-service","add-card","recurrent"],s=["pay-to-user","transfer-to-user"],a=["pay-to-group","transfer-to-group"],c=cur.app.options.vkApp;if(r&&~n.indexOf(r.action))if(!~s.indexOf(r.action)||r.user_id)if(!~a.indexOf(r.action)||r.group_id)if("open-service"!==r.action||o.params.is_vkpay){var l="open-service"!==r.action;if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.isObject)(r.data))try{r.data=JSON.stringify(r.data)}catch(e){r.data=""}var p="",d=[];if(r&&(r.aid=t.aid,p=e+"?"+(d=o.getQueryParts(r)).join("&")),p){var h,u=!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mozilla&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.msi&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.msie_edge,_=!1;if("open-service"===r.action){var f=/^app(\d+)(?:_-(\d+))?$/.exec(e),m=o.options.vkpay_not_layer_services||[],b=positive(f[1]);f&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.inArray)(b,m)&&(_=!0,u&&(h=window.open("","_blank"))),o.params.is_vkpay_service&&o.params.is_mobile&&(_=!0,u&&(h=window.open("","_blank")))}ajax.post("al_apps.php",{act:"open_external_app",url:e,q:d.join("&"),aid:t.aid},{onDone:function(e,t){if(t){if("open-service"===r.action&&_)return e=decodeURIComponent(e),h?void(h.location.href="/"+e):o.params.is_mobile?void(window.location.href="/"+e):void nav.go("/"+e);o.openAppInLayer(e,()=>{cur.onExternalAppDone&&(cur.onExternalAppResults?o.checkExternalAppResponse():o.runCallback("onExternalAppClose"),cur.onExternalAppDone=null)},l),cur.onExternalAppDone=function(e,t){t=!!t,this.isOpenInLayer()||t?cur.onExternalAppResults={api_id:this.params.api_id,result:e}:(cur.onExternalAppResults=null,this.runCallback("onExternalAppDone",e)),t||(cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0))}.bind(o)}},onFail:function(e){try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}return h&&h.close(),c?i(e.error):o.runCallback("onExternalAppFail",e.error),!0}})}}else c?i({error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM}):o.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM});else this.options.vkApp?i({error_msg:"Missing required param group_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM}):o.runCallback("onExternalAppFail",{error_msg:"Missing required param group_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM});else c?i({error_msg:"Missing required param user_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM}):o.runCallback("onExternalAppFail",{error_msg:"Missing required param user_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM});else c?i({error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM}):o.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_30__.ERROR_CODES.OLD_MISSING_PARAM})}},externalAppDone:function(e,t){if(cur.onExternalAppDone?cur.onExternalAppDone(e,t):t||window.WkView&&WkView.hide(!1,!0),o.params.is_mobile||window.opener&&window.opener.vk&&window.opener.vk.platform===_shared_constants_platforms__WEBPACK_IMPORTED_MODULE_33__.PLATFORM_MVK){if(window.opener){var r={method:"externalAppDone",params:e};window.opener.postMessage(r,"*")}o.close(!1)}},externalAppFail:function(e){if(!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.isObject)(e))try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}var t=o.getOpenerApp();t&&t.isOpenInLayer()?cur.onExternalAppResults={api_id:t.params.api_id,error:e.error}:t&&t.runCallback("onExternalAppFail",e.error),cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0)},closeExternalApp:function(){Apps.closeExternalApp()},closeApp:()=>{o.params.is_vkpay_service&&o.close(!0)},sendStats:function(e){(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.isObject)(e)||isArray(e))&&(e=JSON.stringify(e)),ajax.post("al_apps.php",{act:"save_stats",data:e,hash:cur.app.params.stats_hash,app_id:cur.aid},{onDone:function(){o.runCallback("onSendStatsDone")},onFail:function(){return o.runCallback("onSendStatsFail"),!0}})},showWallPostBox:function(e,t,r){if(e.message||e.attachments&&e.attachments.length)o.api("wall.post",e,function(e){e.error?r?r(e.error):this.runCallback("onShowWallPostBoxCancel",e.error):t?t({post_id:e.response.post_id}):this.runCallback("onShowWallPostBoxDone")}.bind(o));else{var i={error_code:100,error_msg:"One of the parameters specified was missing or invalid"};r?r(i):o.runCallback("onShowWallPostBoxCancel",i)}},enableBodyScroll:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){o.params.is_vkpay_service&&cur.bodyScrollDisabled&&(enableBodyScroll(),cur.bodyScrollDisabled=!1,o.runCallback("onBodyScrollDisabled"))}),disableBodyScroll:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){o.params.is_vkpay_service&&!cur.bodyScrollDisabled&&(cur.destroy.push(function(){cur.bodyScrollDisabled&&enableBodyScroll()}),disableBodyScroll(),cur.bodyScrollDisabled=!0,o.runCallback("onBodyScrollEnabled"))}),startHandleWheelEvent:function(){o.params.is_vkpay_service&&o.startHandleWheelEvent()},stopHandleWheelEvent:function(){o.params.is_vkpay_service&&o.stopHandleWheelEvent()},startHandleDeviceOrientation:function(){o.runCallback("onDeviceOrientationNotSupported")},unIdle:()=>{o.sessionLogger&&o.sessionLogger.unIdle()},idle:()=>{o.sessionLogger&&o.sessionLogger.idle()}},r.widget?(o.options.type=1,o.options.widget=!0):(1===this.options.type&&this.params.is_vkpay_service||renderFlash(ge("flash_api_external_cont"),{url:"/swf/api_external.swf",id:"flash_api_external",width:1,height:1,preventhide:1,version:9},{allowFullScreen:!0,allowscriptaccess:"always",allownetworking:"all",wmode:"opaque"},{debug:r.debug?1:0,lc_name:r.lc_name}),o.externalFrame=ge("flash_api_external"));var p=o.options.wmode||"opaque";if(o.options.no_init)return!1;var d,h=1;switch(o.options.type){case 1:o.options.layer?this.RPC=new fastXDM.Server(this.funcs,void 0,{layer:1}):this.RPC=new fastXDM.Server(this.funcs);var u={src:a,width:"100%",overflow:"hidden"};o.options.vkApp?u.vkApp=!0:u.scrolling="no",o.options.widget||(u.height=o.options.height);this.frame=this.RPC.append(o.cont,u,'webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen="true" allow="geolocation; microphone; camera; autoplay;"');break;case 2:debugLog("is wrapper"),d={url:t.src,id:"flash_app",width:o.options.width,height:o.options.height,version:10},"opaque"==p&&(d.preventhide=1),h=renderFlash(o.cont,d,{allowFullScreen:!0,allowscriptaccess:"never",allowFullScreenInteractive:"true",allownetworking:"all",bgcolor:"#F7F7F7",wmode:p},r),o.frame=ge("flash_app");break;case 3:d={url:t.src,id:"flash_app",width:o.options.width,height:o.options.height,version:9},"opaque"==p&&(d.preventhide=1),h=renderFlash(o.cont,d,{allowFullScreen:!0,allownetworking:"all",allowscriptaccess:"never",allowFullScreenInteractive:"true",wmode:p},r),o.frame=ge("flash_app")}h||o.showDummy("no_flash"),r.widget&&setTimeout(function(){o.inited||show("app_connect_error")},8e3),cur.destroy.push(function(){this.RPC&&this.RPC.destroy()}.bind(this))}},vkApp.prototype.boxApp=function(){},vkApp.prototype.onAppReady=function(){for(var e in this.onReady)this.onReady.hasOwnProperty(e)&&this.onReady[e]()},vkApp.prototype.checkExternalAppResponse=function(){cur.onExternalAppResults&&this.params.api_id===cur.onExternalAppResults.api_id&&(cur.onExternalAppResults.result&&this.runCallback("onExternalAppDone",cur.onExternalAppResults.result),cur.onExternalAppResults.error&&this.runCallback("onExternalAppFail",cur.onExternalAppResults.error)),cur.onExternalAppResults=null},vkApp.prototype.runCallback=function(){var e,t=Array.prototype.slice.call(arguments),r=t[0],i="customEvent";switch(-1!=["onLocationChanged","onMerchantPaymentSuccess","onBalanceChanged","onWindowResized","onSettingsChanged","onGroupSettingsChanged","onAppWidgetPreviewFail","onAppWidgetPreviewCancel","onAppWidgetPreviewSuccess","onCheckFlashSupportSuccess","onCheckFlashSupportFail","onCheckUnitySupportSuccess","onCheckUnitySupportFail"].indexOf(r)?(i=r,e=t.slice(1)):e=t.slice(),this.options.type){case 1:if(this.RPC.callMethod("runCallback",t),!this.options.widget&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.iphone&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.ipad)try{this.externalFrame[i](e)}catch(e){}break;case 2:case 3:try{this.externalFrame[i](e)}catch(e){}}"onExternalAppClose"===r&&cur.clearVKMiniAppsLayerPopups&&cur.clearVKMiniAppsLayerPopups()},vkApp.prototype.apiCallback=function(e,t){try{this.externalFrame.apiCallback(e,t)}catch(e){}},vkApp.prototype.setHeight=function(e,t){if(e){this.inlineApp&&e>this.options.heightMax&&!this.params.is_vkpay_service&&(e=this.options.heightMax);var r=e+"px";this.frame.style.height=r,this.options.boxed||(this.cont.style.height=r),this.options.layer&&WkView.onResize(),this.options.onResize&&this.options.onResize()}},vkApp.prototype.isVkpayTransferLayer=function(){return!!this.params.is_vkpay_service&&(this.options.openapi?!!domCA(this.cont,".vkPayOpenApiBox_transfer"):!!domCA(this.cont,".vkpay_transfer"))},vkApp.prototype.setWidth=function(e,t){var r=this.options.vkApp?600:100,i=165;e&&!this.inlineApp&&cur.app&&(e=Math.min(Math.max(e,r),1e3),this.options.layout_width&&(i=this.options.layout_width-e),this.isVkpayTransferLayer()&&t&&(this.cont.style.maxWidth="none",this.cont.style.minWidth="none"),this.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,625)+i}),this.frame.style.width=this.cont.style.width=e+"px")},vkApp.prototype.showProgress=function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(this.cont,"loading"),this.loaderEl=showProgress(this.cont,"","pr_big app_container_progress",!0)},vkApp.prototype.hideProgress=function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(this.cont,"loading"),this.loaderEl&&re(this.loaderEl)},vkApp.prototype.showDummy=function(e){if(this.cont&&~["no_flash","no_unity"].indexOf(e)){var t={act:e};"no_flash"!==e||_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.iphone||_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.ipad?"no_unity"!==e||_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mobile||(t.screen=_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.msie||_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.amigo||_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mac&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.safari?"install":"browser"):t.screen="install",ajax.post("al_apps.php",t,{onDone:function(e){cur.app&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.app.cont,"dummy"),val(cur.app.cont,e))},showProgress:this.showProgress.bind(this),hideProgress:this.hideProgress.bind(this)})}},vkApp.prototype.balanceUpdated=function(e){this.runCallback("onBalanceChanged",e)},vkApp.prototype.checkMethod=function(e,t,r){var i=e.toLowerCase();if("wall.post"==i||"activity.set"==i){var n=t["wall.post"==i?"message":"text"];n||(n=""),t.attachments=this.getValidPostAttachments(t.attachments||t.attachment),showBox("apps",{act:"wall_post_box",aid:this.options.aid,post_id:t.post_id,owner_id:t.owner_id,lat:t.lat,long:t.long,place_id:t.place_id,from_group:t.from_group,publish_date:t.publish_date,signed:t.signed,attachments:t.attachments,text:n,method:i},{params:{width:"430px",dark:1},onFail:function(e){e=e||"Unknown network error occurred",r&&r({error:{error_code:1,error_message:e}})}});var o=this;return cur.apiWallPost=function(i,n){n?r&&r({error:n}):o.api(e,extend(t,{method_access:i}),r)},!1}return!0},vkApp.prototype.checkMethodResult=function(e,t,r,i){switch(e){case"photos.saveProfilePhoto":if(!r.error)return cur.profilePhotoBoxCallback=function(e){i(e?{response:{photo_src:r.response.photo_src}}:{error:{error_code:10007,error_msg:"Operation denied by user"}}),window.profilePhotoBoxCallback=!1},cur.app.funcs.showProfilePhotoBox(r.response.photo_hash),!1}return!0},vkApp.prototype.initClientExternalApp=function(){this.clientRpc=new fastXDM.Client({},{safe:!0}),cur.onExternalAppDone=function(e,t){t=!!t,this.clientRpc.callMethod("externalAppDone",e,t)}.bind(this)},vkApp.prototype.onLocChanged=function(e){e||(e=""),cur.appLoc!=e&&(cur.appLoc=e,this.runCallback("onLocationChanged",e))},vkApp.prototype.api=function(method,inputParams,callback,captcha){var self=this;if(2==arguments.length&&(callback=params,inputParams={}),inputParams||(inputParams={}),captcha||inputParams.method_access||inputParams.method_force||this.checkMethod(method,inputParams,callback)){delete inputParams.callback,delete inputParams.access_token;var params={v:"5.95",api_id:this.params.api_id,method,format:"json",rnd:parseInt(1e4*Math.random())};if(inputParams)for(var i in inputParams)inputParams.hasOwnProperty(i)&&(i=trim(i),/^(rnd|format|api[\s.\[_]id|method|callback|access[\s.\[_]token)(\s*\[|$)/.test(i)||(params[i]=inputParams[i]));var lParams=[];for(var _i2 in params)params.hasOwnProperty(_i2)&&lParams.push([_i2,params[_i2]]);lParams.sort(sName);var sig=this.params.viewer_id;for(var _i3 in lParams)lParams.hasOwnProperty(_i3)&&(sig+=lParams[_i3][0]+"="+lParams[_i3][1]);sig+=this.params.secret,params.sid=this.params.sid,params.sig=blueimp_md5__WEBPACK_IMPORTED_MODULE_31__(sig);var done=function done(text){var response=eval("("+text+")");if(response.error&&14==response.error.error_code)cur.appCaptcha=showCaptchaBox(response.error.captcha_sid,0,!1,{onSubmit:function(e,t){inputParams.captcha_sid=e,inputParams.captcha_key=t,self.api(method,inputParams,callback,!0),cur.appCaptcha.setOptions({onHide:function(){}}).hide()},onHide:function(){callback(response)},imgSrc:response.error.captcha_img});else{if(captcha&&cur.appCaptcha.setOptions({onHide:function(){}}).hide(),!self.checkMethodResult(method,inputParams,response,callback))return;callback&&callback(response)}},fail=function(){callback&&callback({error:{error_code:1,error_message:"Unknown network error occurred"}}),debugLog("Ajax fail")};ajax.plainpost(self.params.api_script||"/api.php",params,done,fail)}function sName(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}},vkApp.prototype.getValidPostAttachments=function(e){var t=/(^https?:\/\/)|(^(poll|album|photo|video|doc|audio|page|note)-?\d+_-?\d+)$/,r=[];return e=e||[],isString(e)&&(e=e.split(",")),each(e,function(){var e=this.trim();t.test(e)&&r.push(e)}),r.join(",")},vkApp.prototype.startHandleWheelEvent=function(){this._wheelEventListener||stManager.add(["ui_common.js"],()=>{this._wheelEventListener=e=>{var t=uiScroll.scrollEventDelta(e);cur.app.runCallback("onWheel",t,document.documentElement.clientHeight)},addEvent(window,browserFeatures.wheelEvent,this._wheelEventListener),cur.destroy.push(()=>{this._wheelEventListener&&removeEvent(window,browserFeatures.wheelEvent,this._wheelEventListener)})})},vkApp.prototype.stopHandleWheelEvent=function(){this._wheelEventListener&&(removeEvent(window,"wheel",this._wheelEventListener),this._wheelEventListener=null)},vkApp.prototype.getQueryParts=function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var i="";void 0!==e[r]&&(i="object"==typeof e[r]?encodeURIComponent(JSON.stringify(e[r])):encodeURIComponent(e[r])),t.push(encodeURIComponent(r)+"="+i)}return t},vkApp.prototype.openAppInLayer=function(e,t,r,i){cur.openerAppsQueue=cur.openerAppsQueue||[],cur.openerAppsQueue.push(this),i=i||{},showWiki({w:e},null,null,extend(i,{queue:1,onHide:()=>{cur.openerAppsQueue.length>0&&(cur.app=cur.openerAppsQueue.pop()),t&&t(this.params.api_id)},noClickHide:r}))},vkApp.prototype.getOpenerApp=function(){return cur.openerAppsQueue&&cur.openerAppsQueue[cur.openerAppsQueue.length-1]},vkApp.prototype.isOpenInLayer=function(){return"layer"===this.params.source},vkApp.prototype.close=function(e){if(this.params.is_vkpay_service&&Apps.closeExternalApp(),!window.WkView||this.params.is_mobile)if(window.opener){if(e){window.opener.postMessage({method:"closeApp"},"*")}window.close()}else e&&this.runCallback("onCloseApp"),window.nav.objLoc.back?window.location.href=nav.objLoc.back:window.nav.go("/feed");else WkView.hide(!1,!0)},vkApp.prototype.setVkPayMobileHeight=function(){if(this.params.is_vkpay_service&&this.params.is_mobile){var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.safari||_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.safari_mobile)&&(e+=window.pageYOffset),e+="px",this.frame.style.minHeight=e,this.frame.style.height=e,this.cont.style.minHeight=e,this.cont.style.height=e}},window.AppsSlider=function(e){if(this.options=extend({inner:null,outer:null,next:null,prev:null,infinite:!0,slideshowDuration:4e3,animationDuration:500,isVkApp:!1},e||{}),this.required=null,this.current=null,this.slideNext=null,this.slidePrev=null,this.slideCurrent=null,this.hasVideoSlides=!1,this.videoPlayer=null,this._handlerInst=null,this._arrowNextHandler=null,this._arrowPrevtHandler=null,this.options.outer&&this.options.inner&&(this.outer=ge(this.options.outer),this.inner=ge(this.options.inner),this.outer&&this.inner)){if(this.slideshow=!1,this.animation={stop:function(){}},this.slideshowTimeout=null,this.interacted=!1,this.slides=domChildren(this.inner),this.options.infinite){if(!this.slides.length)return void re(this.outer);if(this.slides.length<3)for(var t=null,r=0;this.slides.length<4;)t=this.slides[r++].cloneNode(!0),this.slides.push(t),this.inner.appendChild(t)}(this.arrowNext=ge(this.options.next))&&(this._arrowNextHandler=this.next.bind(this),addEvent(this.arrowNext,"mousedown",this._arrowNextHandler)),(this.arrowPrev=ge(this.options.prev))&&(this._arrowPrevtHandler=this.prev.bind(this),addEvent(this.arrowPrev,"mousedown",this._arrowPrevtHandler)),this.inited=!1,this.init()}},AppsSlider.prototype={init:function(){if(void 0!==this.inited)return!!this.inited||(0!==this.outer.offsetWidth&&0!==this.slides[0].offsetWidth?(this.widthOuter=this.outer.offsetWidth,this.widthInner=this.inner.offsetWidth,this.widthSlide=this.widthInner/this.slides.length,this.offsetInner=this.inner.offsetLeft,this.widthSide=(this.widthOuter-this.widthSlide)/2,this.indexNext=this.slides.length-1,this.indexPrev=0,this.indexMargin=(this.slides.length-1)/2|0,this.indexRequired=this.indexCurrent=this.getIndex(),this.highlight(),this.rearrange(),this._initVideoSlides(),this.slideshow&&!this.slideshowTimeout&&this.slideshowStart(),this.inited=!0):void 0)},highlight:function(){this.slideHighlighted&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(this.slideHighlighted,"selected"),this.slideHighlighted=null,this.indexHighlighted=null),this.indexHighlighted!==this.indexCurrent&&(this.indexHighlighted=this.indexCurrent,this.slideHighlighted=this.slides[this.getIndex(this.indexCurrent)],Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(this.slideHighlighted,"selected"))},handler:function(e){var t=e.target&&(e.target===this.outer||this.outer.contains(e.target));this.interacted!=t&&(this.interacted=t,t?(this.slideshowInterrupted=this.slideshow,this.slideshowStop()):(this.slideshow=this.slideshowInterrupted,this.slideshow&&this.slideshowStart()))},slideshowStart:function(){this.slideshow=!0,this.interacted||this._videosIsPlay||(this.slideshowStop(),this.slideshow=!0,this.slideshowTimeout=setTimeout(function(){this.slideshowTimeout=null,vk.rtl?this.indexRequired--:this.indexRequired++,this.serve()}.bind(this),this.options.slideshowDuration))},slideshowStop:function(){this.slideshow=!1,this.slideshowTimeout&&(clearTimeout(this.slideshowTimeout),this.slideshowTimeout=null)},addHandler:function(){this.init()&&(this.removeHandler(),this._handlerInst=this.handler.bind(this),addEvent(document,"mousemove",this._handlerInst))},removeHandler:function(){this._handlerInst&&removeEvent(document,"mousemove",this._handlerInst)},removeAllHandlers:function(){this.removeHandler(),this._arrowNextHandler&&removeEvent(this.arrowNext,"mousemove",this._arrowNextHandler),this._arrowPrevtHandler&&removeEvent(this.arrowPrev,"mousemove",this._arrowPrevtHandler)},requireIndex:function(e){this.indexRequired=this.getIndex(e||0),this.serve()},next:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired>=this.slides.length-1)return;this.indexRequired++,this.serve()}},last:function(){this.indexRequired=this.slides.length-1,this.serve()},prev:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired<1)return;this.indexRequired--,this.serve()}},getIndex:function(e,t){return void 0!==e?(e=e%this.slides.length+(e<0?this.slides.length:0))===this.slides.length?0:e:(e=(this.offsetInner-this.widthSide)/-this.widthSlide,t?e:Math.round(e))},serve:function(){if(this.init()){var e=this.getIndex(this.indexRequired),t=this.required!=e,r=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2);this.required=e,t&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(this.options.onRequired)&&this.options.onRequired(),this.options.infinite||(this.indexRequired=this.required),this.animation.stop(),this.animation=new Fx.Base({style:{}},{duration:this.options.animationDuration,transition:Fx.Transitions.easeOutCubic,onComplete:this.served.bind(this),onStep:function(e){this.offsetInner=e.left,setStyle(this.inner,"left",this.offsetInner);var t=this.indexCurrent;this.indexCurrent=this.getIndex(),t!==this.indexCurrent&&(this.indexCurrent===this.indexRequired&&this.highlight(),this.rearrange(),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(this.options.onChange)&&this.options.onChange())}.bind(this)}),this.animation.start({left:this.offsetInner},{left:r})}},served:function(){var e=this.indexCurrent-this.getIndex(this.indexCurrent);e>30&&(this.indexPrev=0,this.indexNext=this.slides.length-1,this.indexCurrent-=e,this.indexRequired-=e,this.offsetInner=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2),this.inner.style.left=this.offsetInner+"px",each(this.slides,function(e,t){t.style.left=0})),this.hasVideoSlides&&this._serveVideoSlide(),this.rearrange(),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(this.options.onSlide)&&this.options.onSlide(),this.slideshow&&this.slideshowStart()},rearrange:function(){if(this.options.infinite){for(;this.indexCurrent>=this.indexNext-this.indexMargin;){var e=this.getIndex(this.indexNext);this.slides[e].style.left=(this.indexNext-e)*this.widthSlide+"px",this.indexNext++,this.indexPrev++}for(;this.indexCurrent<=this.indexPrev+this.indexMargin;){var t=this.getIndex(this.indexPrev);this.slides[t].style.left=(this.indexPrev-t)*this.widthSlide+"px",this.indexPrev--,this.indexNext--}}this.current=this.getIndex(this.indexCurrent),this.slideNext=this.slides[this.options.infinite?this.getIndex(this.indexCurrent+1):this.indexCurrent+1]||null,this.slidePrev=this.slides[this.options.infinite?this.getIndex(this.indexCurrent-1):this.indexCurrent-1]||null,this.slideCurrent=this.slides[this.current]},update:function(){this.inited=!1,this.slides=domChildren(this.inner),this.init()},destroy:function(){this.slideshowStop(),this.removeAllHandlers(),this.hasVideoSlides=!1},getCurrentSlide:function(){return this.slides[this.current]},_initVideoSlides:function(){var e=this;each(this.slides,function(){if(domData(this,"video"))return e.hasVideoSlides=!0,!1}),e.hasVideoSlides&&(this._preloadVideos(),this._serveVideoSlide())},_isPreloadedVideo:function(e){var t=!1;return each(ajaxCache,function(r,i){if(0==r.indexOf("/al_video.php?act=show_inline")&&r.indexOf("&video="+e)>0)return t=!0,!1}),t},_onVideoPreloaded:function(e,t){if(e){var r=t[3].player.params[0];VideoPlayer.preload(r)}},_preloadVideos:function(){var e=this;each(this.slides,function(){if(domData(this,"video")){var t=e._getVideoParams(this);e._isPreloadedVideo(t.video)||loadInlineVideo(t,e._onVideoPreloaded,!0)}})},_onVideoStop:function(){this._videosIsPlay=!1,this.interacted=!1,this.slideshowStart()},_onVideoStart:function(){this._videosIsPlay=!0,this.interacted=!0,this.slideshowStop()},_onVideoLoaded:function(e,t){this.videoPlayer=t,t.on("media.playing",function(){this.getCurrentSlide()===e?this._onVideoStart():(t.seekTo(0),t.pause())}.bind(this)),t.on("media.ended",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.error",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.pause",this._onVideoStop.bind(this)),t.on("_destroy",this._onVideoStop.bind(this))},_getVideoParams:function(e){return{video:domData(e,"video"),list:domData(e,"hash"),autoplay:1,from_autoplay:1,module:"apps_slider",addParams:{from_autoplay:1},no_progress:1,cache:1}},_serveVideoSlide:function(){var e,t,r,i,n=this.getCurrentSlide();domData(n,"video")?(e=geByTag1("img",n),t=domData(e,"loading"),r=domData(e,"playing"),t||r?this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.play():((i=this._getVideoParams(n)).onLoaded=this._onVideoLoaded.bind(this,n),this._canUseVideo()&&showInlineVideo(i.video,i.list,i,!1,e))):this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.pause()},_canUseVideo:function(){var e=window.wkcur&&window.wkcur.shown&&window.wkLayerWrap&&isVisible(window.wkLayerWrap)||window.Videoview.isLayerShown();if(e)return!1;var t=cur.videoInlinePlayer?cur.videoInlinePlayer.getState():"unknown",r=~["paused","ended"].indexOf(t);return!cur.videoInlinePlayer||cur.videoInlinePlayer===this.videoPlayer||r&&!e}},window.Apps=window.Apps||{optionHiddenClass:"apps_hidden",optionLoadingClass:"loading",address:"apps",init:function init(obj,appTpl){if(extend(cur,{module:"apps",preventFastBack:!1,aTabs:ge("apps_top_tabs"),aSubTabs:geByClass1("_apps_top_subtabs"),aSearch:ge("s_search"),aSearchWrap:ge("apps_search"),aWrap:ge("apps_wrap"),aSummary:ge("apps_summary"),aSummaryCounter:ge("apps_summary_counter"),lShowMoreButton:ge("apps_list_show_more"),lPreload:ge("apps_list_preload"),lContent:ge("apps_list_content"),fWrap:ge("apps_feed_wrap"),fShowMoreButton:ge("apps_feed_show_more"),rNotCounter:ge("apps_recent_notifications_counter"),rNotWrap:ge("apps_notifications_wrap"),rNotNoContent:ge("apps_recent_notifications_no_content"),rNotBlackList:ge("apps_recent_notifications_black_list"),rNotShowMoreButton:ge("apps_recent_notifications_show_more"),rAppsWrap:ge("apps_recent_apps_wrap"),rAppsShowMoreButton:ge("apps_recent_more"),rAppsNoContent:ge("apps_recent_apps_no_content"),catalogSearchShown:+!document.querySelector("#apps_search.SearchToggle__hide"),onSilentLoad:{},apps:{},deletedApps:{},appTpl:appTpl||function(){return""}}),extend(cur,obj),cur.defaultCount=cur.shownApps,"notifications"===nav.objLoc.act&&(delete nav.objLoc.act,nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc)),this.setHistoryBackRules(),this.searchLoadFromAddressBar(),cur.aSearch&&(uiSearch["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),uiSearch.startEvents(cur.aSearch)),setTimeout(function(){this.scrollCheckBinded=this.scrollCheck.bind(this),this.sliderInit(),this.feedInit(),this.notificationsInit(),cur.scrollToHeader&&(setTimeout(this.scrollToHeader.bind(this),100),delete cur.scrollToHeader),cur.scrollToTop&&(scrollToTop(),delete cur.scrollToTop),this.startEvents(),cur.destroy.push(function(e){setTimeout(function(){var t;e.fScrollbar&&cur.fScrollbar!=e.fScrollbar&&(t=!1,globalHistory.forEach(function(r){r.cur!=e&&r.cur.fScrollbar==e.fScrollbar&&(t=!0)}),t||e.fScrollbar.destroy()),e.rNotScrollbar&&cur.rNotScrollbar!=e.rNotScrollbar&&(t=!1,globalHistory.forEach(function(r){r.cur!=e&&r.cur.rNotScrollbar==e.rNotScrollbar&&(t=!0)}),t||e.rNotScrollbar.destroy())},0),cur.featuredSlider&&(cur.featuredSlider.destroy(),cur.featuredSlider=null)}.pbind(cur)),cur.destroy.push(this.stopEvents.bind(this)),cur.aSearch&&uiSearch.scrollResize(cur.aSearch)}.bind(this),0),cur.silent_mode){cur.silent=!0,cur.preload&&(cur.leavePreloadedHeader||delete cur.preload.header,cur.leavePreloadedBefore||delete cur.preload.before);var query={act:"load_apps_silent",gid:cur.gid,oid:cur.oid,header:cur.leavePreloadedHeader?0:1,before:cur.leavePreloadedBefore?0:1,section:cur.section,preload:1,preloaded:[]},prop=null;for(prop in cur.preload=cur.preload||{},cur.preload)cur.preload.hasOwnProperty(prop)&&query.preloaded.push(prop);ajax.post(this.address,query,{cache:1,local:1,onDone:this.withFastBackCheck((json,preload,preloadBefore,preloadHeader)=>{cur.preload=extend(cur.preload||{},preload),cur.preload.before=preloadBefore,cur.preload.header=preloadHeader,json=eval("("+json+")"),cur.curList="all",cur.appsList=json&&json[cur.curList]?json:{all:[]},cur.sectionCount=cur.appsList[cur.curList].length,void 0===cur.searchOffset&&(cur.searchOffset=0),json?this.indexAll(()=>this.onSilentLoad()):this.onSilentLoad()})}),_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_27__.default.isEnabled()&&(window.cur=window.cur||{},window.cur.GameGifts=new _web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_27__.default,window.cur.GiftsFriendsWishListLoader=new _web_apps_games_gifts_GiftsFriendsWishListLoader__WEBPACK_IMPORTED_MODULE_29__.default),cur.FortuneWheel=new _web_apps_promo_wheel_FortuneWheel__WEBPACK_IMPORTED_MODULE_32__.default,cur.FortuneWheel.init(),obj.has_notify&&this.notifyAction()}},notifyAction:()=>{var e=document.querySelector("#l_ap");e&&e.classList.remove("AppLeftMenuWithNotify")},buyDownloadedGame:(e,t,r)=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(t)||(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(t),showBox("al_payments.php",{act:"card_payment_box",type:"game_purchase",game_id:e},{onDone:i=>{i.onSuccessCompleteOrder=()=>{Apps.updateDownloadedGameButton(e,t,r)},Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)},onFail:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)}}))},updateDownloadedGameButton:(e,t,r)=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(t)||(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(t),ajax.post("/al_apps.php",{act:"downloaded_game_button",ref_id:r,app_id:e},{onDone:r=>{r.res?(t.outerHTML=r.html||"",window.showApp&&r.need_show_box_game&&window.showApp(event,e,1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)},onFail:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)}}))},onSilentLoad:function(){if(cur.silent=!1,cur.onSilentLoad)for(var e in cur.onSilentLoad)cur.onSilentLoad.hasOwnProperty(e)&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(cur.onSilentLoad[e])&&cur.onSilentLoad[e]()},withFastBackCheck:function(e){cur.preventFastBack=!0;var t=cur;return function(){cur===t&&(cur.preventFastBack=!1,e.apply(null,Array.prototype.slice.call(arguments)))}},startEvents:function(){addEvent(window,"scroll",this.scrollCheckBinded),addEvent(window,"resize",this.scrollCheckBinded),this.initUpdates(),this.scrollCheck(),this.sliderStart()},stopEvents:function(){removeEvent(window,"scroll",this.scrollCheckBinded),removeEvent(window,"resize",this.scrollCheckBinded),this.stopUpdates(),this.sliderStop()},isSection:function(){for(var e=arguments.length;e--;)if(arguments[e]===cur.section)return!0;return!1},isDelayedOnSilentLoad:function e(t,r){if(cur.silent)return e.count=e.count||0,e.count++,cur.onSilentLoad[t||"key_"+e.count]=r,!0},handlePageCount:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return handlePageCount("ap",e)}),incomingCall:function(e){stManager.add(["notifier.js","notifier.css","apps.css","call.css"],()=>{var t=se('<div><div class="call_apps_wrap clear_fix">'+e+"</div></div>"),r={movable:geByClass1("call_invitation_wrap",t,"div"),startLeft:parseInt((window.innerWidth-224)/2)+"px",startTop:parseInt((window.innerHeight-404)/2)+"px",startWidth:224,startHeight:404,resize:!1,onBeforeHide:function(){},onDragEnd:function(e,t){},onResize:function(e,t){}};this.appCall&&this.appCall.close(),this.appCall=new RBox(t,r)}),window.Notifier&&Notifier.setRecvClbk("apps_call_hide",()=>{this.appCall&&(this.appCall.close(),this.appCall=!1)})},callApprove:function(e){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.appCall&&(this.appCall.close(),this.appCall=!1),nav.go(e)},callReject:function(){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.callOnReject()},callOnReject:function(){this.appCall&&(this.appCall.close(),this.appCall=!1),ajax.post("/al_apps.php",{act:"do_call_reject"},{onDone:function(){}})},editBlacklist:function(){return showBox(this.address,{act:"blacklist_box",height:lastWindowHeight},{stat:["privacy.css",jsc("web/indexer.js")]}),!1},blacklistInit:function(e,t,r){r=r||{};var i=geByClass1("apps_blacklist_wrap",e.bodyNode),n=geByClass1("apps_blacklist",e.bodyNode),o=geByClass1("olist_more",e.bodyNode,"a"),s={},a=new vkIndexer(t,function(e){return e[1]});e.setOptions({width:560,bodyStyle:"padding: 0px"}),e.removeButtons().addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_close"),function(){e.hide(200)},"yes"),n.parentNode.style.height=r.boxHeight+"px";var c=ge("apps_blacklist_filter");r.nofocus||setTimeout(elfocus.pbind(c),100);var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(c,"opts");function p(){if(i.scrollTop>0?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e.bodyNode.parentNode,"olist_topsh"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e.bodyNode.parentNode,"olist_topsh"),i.scrollTop+(i.offsetHeight||i.clientHeight)<n.scrollHeight?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e.bodyNode.parentNode,"olist_botsh"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e.bodyNode.parentNode,"olist_botsh"),o&&o.offsetTop&&o.onclick){var t=o.offsetTop;n.scrollTop+(n.offsetHeight||n.clientHeight)+100>=t&&o.onclick()}}function d(i,c){var l,p,h=(c=~~c||0)?60:120;i&&(i=clean(i).replace(/\u2013|\u2014/g,"-")),l=i?a.search(i):t,p=r.tpl;var u=l.length;l=l.slice(c,c+h);var _,f=[];if(i){var m=escapeRE(i),b=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.parseLatin)(i);null!=b&&(m=m+"|"+escapeRE(b)),_=new RegExp("(?![^&;]+;)(?!<[^<>]*)((\\(*)("+m+"))(?![^<>]*>)(?![^&;]+;)","gi")}each(l,function(){f.push(rs(p,function(e,t,r,i){var n=e[1];if(t){n=-1==t.indexOf(" ")?n.split(" "):[n];var o="";for(var s in n)n.hasOwnProperty(s)&&(o+=(s>0?" ":"")+n[s].replace(i,"$2<em>$3</em>"));n=o}return{id:e[0],name:n,photo:e[2],wrap_class:e[0]&&r[e[0]]?" olist_item_wrap_on":"",link:e[3]||(e[0]>0?"id"+e[0]:"app"+(1e9-e[0]))}}(this,i,s,_)))}),c||f.length||f.push('<div class="no_rows">'+(i?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_search_not_found").replace("{search}",clean(i)):r.lang.apps_blacklist_empty)+"</div>"),re(o),f=f.join(" "),c?n.appendChild(cf(f)):val(n,f),u>c+h&&(n.appendChild(o),o.onclick=function(e){return d(i,c+h),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e)}),e&&e.scroll&&e.scroll.update(!1,!0)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(c,"opts",extend(l,{onChange:function(e){d(e,0)}})),o&&(isVisible(o)?o.onclick=function(e){return d("",60),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e)}:(re(o),show(o))),addEvent(n,"click",function(r){var i=r.originalTarget||r.target;hasClass(i,"olist_item_wrap")||(i=gpeByClass("olist_item_wrap",i));if(!i||i==bodyNode)return;if(hasClass(i,"olist_item_loading"))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(r);if(checkEvent(r))return!0;e.changed=!0;var o=i.id.match(/-?\d+/)[0],a=s[o],l=!1;each(t,function(){if(this[0]==o)return l=this[4],!1}),ajax.post("/al_apps.php",{act:"a_blacklist_delete",cancel:a?1:0,owner_id:o,hash:l},{onDone:function(){toggleClass(i,"olist_item_wrap_on",!a),s[o]=!a},showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(i,"olist_item_loading")},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(i,"olist_item_loading")}}),n.scrollTop<50&&setTimeout(function(){elfocus(c),val(c).length&&c.select()},100);return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(r)}),addEvent(i,"scroll",p),setTimeout(p,10)},initDescription:function(e){var t=geByClass1("apps_i_description_content");val(t,e);var r=parseInt(getStyle(t,"line-height"));Math.ceil(getSize(t)[1]/r)>7&&(setStyle(t,"height",5*r),val(t,e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(geByClass1("apps_i_description_show_more"),this.optionHiddenClass))},showFullDescription:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(geByClass1("apps_i_description_show_more"),this.optionHiddenClass),setStyle(geByClass1("apps_i_description_content"),"height","")},appSsSliderNext:function(e){e?cur.appSsSlider&&cur.appSsSlider.next():cur.wkviewAppsSlider&&cur.wkviewAppsSlider.next()},initAppSsSlider:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t||"";var i,n=ge("apps_i_slider_next"+t),o=ge("apps_i_slider_prev"+t),s=ge("apps_i_slider_outer"+t),a=ge("apps_i_slider_thumbs"+t),c=a?domPN(a):null,l=a?a.children:[],p=null,d=null;function h(){if(a){var e=c.offsetWidth,t=a.scrollWidth;if(t<=e||!t||!e)return;null===p&&(p=0);var r=l[p],n=r.offsetLeft,o=(e-r.offsetWidth)/2-n;o=Math.max(-t+e,Math.min(0,o)),d&&d.stop(),d=animate(a,{left:o},{duration:i.options.animationDuration,transition:Fx.Transitions.easeOutCubic})}}function u(e){return e>=i.slides.length-2}function _(){Array.from(l).forEach(e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"in-view")})}function f(e){if(_(),0===e)for(var t=e;t<=2;t++)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[t],"in-view");else if(u(e))for(var r=i.slides.length-4,n=i.slides.length-1;n>r;)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[n],"in-view"),n--;else for(var o=e-1;o<=e+1;o++)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[o],"in-view")}function m(t){a&&t!==p&&(null!==p&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(l[p],"selected"),p=t,e&&f(p),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[p],"selected"),h())}function b(){m(null!==i.required?i.required:i.current)}function g(){i.slideNext?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(n,"apps_i_slider_available"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(n,"apps_i_slider_available"),i.slidePrev?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(o,"apps_i_slider_available"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(o,"apps_i_slider_available"),hasClass(i.slideCurrent,"apps_promo_video_slide")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(s,"apps_i_slider_video"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(s,"apps_i_slider_video"),i.slideNext?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(s,"apps_i_slider_run"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(s,"apps_i_slider_run"),hasClass(i.slidePrev,"apps_promo_video_slide")&&cur&&cur.videoInlinePlayer&&cur.videoInlinePlayer.pause(),hasClass(i.slideCurrent,"apps_promo_video_slide")&&cur&&cur.videoInlinePlayer&&cur.videoInlinePlayer.play()}if(i=new AppsSlider({inner:ge("apps_i_slider_inner"+t),outer:s,next:n,prev:o,onChange:g,onRequired:b,infinite:!1,isVkApp:e}),r?cur.appSsSlider=i:cur.wkviewAppsSlider=i,g(),b(),each(l,function(e,t){var r=new Image;r.onload=h,r.src=geByTag1("img",t).src,addEvent(t,"click",function(){i&&i.requireIndex(e)})}),cur.promoVideo){var v=ge("apps_promo_video_thumb"+t);v&&showInlineVideo(cur.promoVideo,"",{autoplay:1,module:"app_promo",addParams:{from_autoplay:1}},null,v)}},initSimilarAppsSlider:function(){var e=document.querySelector(".apps_similarApps");if(e){var t=e.querySelector(".apps_similarApps__listContent");t&&stManager.add(["ui_common.js"],()=>{var e=e=>{window.tooltips&&tooltips.hideAll();var r=Math.abs(e.deltaX||e.wheelDeltaX||0);Math.abs(e.deltaY||e.wheelDeltaY||0)>r&&(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e),t.scrollLeft+=uiScroll.scrollEventDelta(e))};addEvent(t,browserFeatures.wheelEvent,e),cur.destroy.push(()=>{removeEvent(t,browserFeatures.wheelEvent,e)})})}},showWinInstructions:function(e,t,r){setTimeout(function(){new MessageBox({width:800,title:cur.winInstrTitle,hideButtons:!0,containerClass:"apps_win_instr_wrap"}).content(rs(trim(cur.winInstrTpl),{download_link:t,help_link:r})).show()},500)},sendInstallRequest:function(e,t,r,i,n,o,s){var a=!!geByClass1("apps_install_header");if(e&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(e)&&!hasClass(e,"button_disabled")){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(e);var c=getSize(e),l=window.isAppLanding?"apps":this.address;if(t){var p={act:"send_install_request",aid:r,ref:i,cid:n,hash:o},d=/^\/app(\d+)_?(-\d+)?(#(.*))?$/.exec(location.pathname);d&&d.length>2&&parseInt(d[2],10)<0&&(p.group_id=Math.abs(parseInt(d[2]))),ajax.post(l,p,{onDone:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger").checked=!0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"button__disabled"))},onFail:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger-fail").checked=!0)},hideProgress:function(){var t=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_install_push_sent_msg");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"button_disabled"),s||setStyle(e,"width",c[0]),!window.isAppLanding&&val(e,t);var r=ge("apps_i_run_box");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(r,"sent"),val(r,t)}})}else cur.ref=i,ajax.post(this.address,{act:"send_install_request_box",aid:r},{onDone:function(t,n,o){if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(e),n){cur.lang||(cur.lang={}),extend(cur.lang,t);var s=new MessageBox({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_get_push_w_install_link")});s.removeButtons(),s.content(n),s.addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_install_sms_send"),function(t){if(e=ge("apps_i_request_btn")||e,t&&e&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(t)){var n=getSize(e);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(t),ajax.post(this.address,{act:"send_install_request",ref:i,aid:r,cid:-3,hash:o},{onFail:function(e){if(e){var r=ge("app_sms_tt_error");val(r,e),show(r),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)}},onDone:function(){this.ttDestroyAll(),s.hide();var r=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_install_push_sent_msg");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"button_disabled"),a||setStyle(e,"width",n[0]),val(e,r);var i=ge("apps_i_run_box");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(i,"sent"),val(i,r)}.bind(this)})}}.bind(this),"yes"),s.addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"),s.hide,"no"),s.show()}else showBox("activation.php",{act:"change_phone_box",hash:o})}.bind(this)})}},deletingApp:!1,showInviteBox:function(e,t){e||(e=cur.app.options.aid,t=cur.app.options.hash),showTabbedBox("al_friends.php",{act:"select_friends_box",checked:"",invite:1,aid:e,from:"apps"},{stat:[jsc("web/privacy.js"),"ui_controls.js","ui_controls.css"],cache:1,params:{dark:1}}),cur.onFlistSave=function(r,i){ajax.post("apps",{act:"invite_friends",aid:e,friends:r.join(","),hash:t},{onDone:function(e,t){setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:e},t).hide,2e3)},onFail:function(e){return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e).hide,2e3),!0}})}},showAppFriends:function(e,t,r){var i=showBox(this.address,{act:"show_app_friends_box",aid:e},{cache:1,dark:1,params:{width:"400px",bodyStyle:"padding: 0px"},onDone:function(){new uiScroll("apps_friendslist")}},t);return i.setControlsText('<a href="" onclick="Apps.showInviteBox('+e+", '"+r+"'); return false;\">"+Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_invite_friends")+"</a>"),i},recountAddVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("add_votes",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("votes_flex",t)),t>0&&ge("app_pay_withdraw")&&(ge("app_pay_withdraw").value=0,this.recountWithdrawVotes(ge("app_pay_withdraw")))},recountWithdrawVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("withdraw_votes",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("votes_flex",t)),t>0&&(ge("app_pay_add").value=0,this.recountAddVotes(ge("app_pay_add")))},initAppView:function(e,t){var r,i;t.layer||cur.nav.push(function(e,r,i,n){if(void 0===e[0]&&!e.join&&!n.pass){if(e["#"])return cur.app.onLocChanged(e["#"]),n.back?3!=vk.al&&nav.setLoc(i):nav.setLoc(i),!1;if(!t.not_block_nav)return nav.setLoc(i),!1}}),cur.app.params.is_vkpay_service&&(r=()=>{t.layer||cur.app.runCallback("onWindowBlur")},i=()=>{var e=window.innerWidth||document.documentElement.clientWidth||bodyNode.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.app.runCallback("onTopWindowResized",e,t),cur.app.setVkPayMobileHeight()},cur.app.setVkPayMobileHeight());var n=function(e){cur.app._lastFocusState!==e.type&&("block"==e.type?cur.app.runCallback("onWindowBlur"):cur.app.runCallback("onWindowFocus")),cur.app._lastFocusState=e.type};cur.app.onReady.push(function(){cur.app&&(cur.app.onLocChanged(e.hash),addEvent(document,"block unblock",n,!0),r&&addEvent(window,"mousedown",r),i&&addEvent(window,"resize",i),cur.destroy.push(function(){removeEvent(document,"block unblock",n),r&&removeEvent(window,"mousedown",r),i&&removeEvent(window,"resize",i)}))}),t.icon&&(setFavIcon(t.icon),cur.destroy.push(function(){setFavIcon("/images/favicon"+(vk.intnat?"_vk":"new")+window._iconAdd+".ico")})),t.is_widescreen_mode&&("loading"===document.readyState?_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_28__.default.deferredInit():_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_28__.default.init()),this.initSimilarAppsSlider(),this.changeCheckBackUrl()},initVkConnect:function(e,t,r,i,n){Object(_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_24__.default)(e,t,r,i,n),window.hasOwnProperty("wkcur")&&wkcur._hide.push(cur.clearVKMiniAppsLayerPopups)},loadSettings:function(e){ajax.post(this.address,{act:"show_settings",aid:cur.aid},extend({cache:1},e))},showSettings:function(){this.ttHideAll(),cur.settShown?(scrollToTop(200),cur.settShown=!1,delete ajaxCache["/apps#act=show_settings&aid="+cur.aid]):showBox(this.address,{act:"show_settings",aid:cur.aid},{params:{dark:1}})},saveSettings:function(e,t,r,i){if(!cur.savingSettings){r||(i&&i.btn&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(i.btn),show("apps_settings_progress"));var n=curBox(),o=ge("app_pay_add"),s=ge("app_pay_withdraw"),a={act:"save_settings",aid:e,hash:t,from:"appview",app_settings_1:isChecked("app_settings_1"),app_settings_256:isChecked("app_settings_256"),add:o?o.value:0,withdraw:s?s.value:0,only_checkboxes:r?1:0,cur_aid:cur.aid};isVisible("app_settings_2097152")&&(a.app_settings_2097152=isChecked("app_settings_2097152")),ajax.post("apps",a,extend({onDone:e=>{i&&i.btn&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(i.btn),e.left_nav&&this.updateLeftNav(e.left_nav),!r&&cur.app&&cur.app.runCallback("onSettingsChanged",e.settings),cur.settingsOnLoad=!1,void 0!==e.coins&&cur.app&&cur.app.balanceUpdated(e.coins),void 0!==e.balance&&updateMoney(e.balance),n&&!r&&n.hide(),this.addToMenuErrorResolve(e,function(e){r&&checkbox("app_settings_256",256&e.settings)}),this.updateAddToMenuAction()},onFail:function(e){e&&val("apps_settings_error",e),show("apps_settings_error"),hide("apps_settings_progress"),scrollToTop(200)},showProgress:function(){cur.savingSettings=!0,n&&n.showProgress()},hideProgress:function(){cur.savingSettings=!1,n&&n.hideProgress()}},i||{}))}},updateAddToMenuAction:function(){var e=ge("app_add_to_menu_action");if(e&&cur.aid&&cur.app&&cur.app.options){var t=ge("l_app"+cur.aid),r={add:cur.app.options.vkApp?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_add_to_favourite"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_add_to_left_menu"),remove:cur.app.options.vkApp?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_remove_from_favourite"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_remove_from_left_menu")};Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(e)&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem)(e),e.setAttribute("onclick","return Apps.addToMenu("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!t)+", this);"),val(e,t?r.remove:r.add)}},addToMenu:function(e,t,r,i){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(i)||ajax.post("al_apps.php",{act:"a_left_menu",aid:e,hash:t,show:r},{onDone:e=>{this.updateLeftNav(e.left_nav),this.updateAddToMenuAction(),this.addToMenuErrorResolve(e)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem.pbind(i),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem.pbind(i)})},vkAppNotifications:function(e,t,r,i){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(i)||ajax.post("al_apps.php",{act:"vk_app_notifications",aid:e,hash:t,allow:r},{onDone:e=>{this.updateNotificationsAction(e)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem.pbind(i),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem.pbind(i)})},updateNotificationsAction:function(e){var t=ge("app_notifications_action");if(t&&cur.aid&&cur.app&&cur.app.options){var r=e,i={add:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_notifications_action_enable"),remove:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_notifications_action_disable")};Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(t)&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem)(t),t.setAttribute("onclick","return Apps.vkAppNotifications("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!r)+", this);"),val(t,r?i.remove:i.add)}},addToMenuErrorResolve:function(e,t){e.left_nav_error?window.menuSettings&&cur.app?(cur.settingsBoxSetLeftMenuAppCallback=function(r){delete cur.settingsBoxSetLeftMenuAppCallback,!r||256&e.settings||(e.settings+=256),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(t)&&t(e)},showTabbedBox("al_settings.php",{act:"menu_box",type:2,aid:cur.aid})):(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e.left_nav_error),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(t)&&t(e)):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(t)&&t(e)},showAppSettings:function(e,t){this.ttHideAll(),t?showBox(this.address,{act:"settings_box_info",aid:e},{params:{dark:1}}):showBox(this.address,{act:"settings_box",aid:e,mask:0,main:1},{params:{dark:1}})},updateOnline:function(){ajax.post(this.address,{act:"update_online",aid:cur.aid,hash:cur.app.options.hash},{ads:1})},updateOffline:function(e){ajax.post(this.address,{act:"update_offline",aid:(e||cur).aid,hash:(e||cur).app.options.hash})},deleteApp:function(e,t,r,i){if(!this.deletingApp){this.deletingApp=!0;cur.app&&cur.app.options&&cur.app.options.vkApp&&this.deleteVkApp();var n=function(r,i,n,o){ajax.post(this.address,{act:"quit",id:e,hash:t||cur.app.options.hash,from:"app"},{onDone:this.withFastBackCheck(function(e){this.deletingApp=!1,window.appsListChanged=!0,this.notificationsSetCounters(e.count_all),e.left_nav&&this.updateLeftNav(e.left_nav),cur._back=!1,r.apply(null,[].slice.call(arguments))}.bind(this)),onFail:this.withFastBackCheck(function(){this.deletingApp=!1,i.apply(null,[].slice.call(arguments))}.bind(this)),showProgress:n,hideProgress:o})}.bind(this);switch(i){case"appactions":n(function(){nav.go("/apps?act=popular",!1)},function(e){e&&Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem)(r)},_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem.pbind(r));break;default:var o=curBox();n(function(){nav.go("/apps?act=popular",!1)},function(e){if(e){var t=ge("apps_settings_error");val(t,e),show(t),scrollToTop()}o&&o.hideProgress()},function(){o&&o.showProgress()})}}},reportApp:function(e,t){showBox("al_reports.php",{act:"report_app_box",app_id:e},{params:{dark:1},stat:["ui_controls.js","ui_controls.css"]})},cancelInstall:function(){nav.go("/apps",!1)},deleteVkApp:function(){var e=cur.app.options.aid,t=cur.app.options.layer&&ge(`app_${e}_container_layer`)?`app_${e}_container_layer`:`app_${e}_container`;cur.vkAppQueue[t]&&cur.vkAppQueue[t].destroyView(),delete cur.vkAppQueue[t]},approveInstall:function(e,t,r){r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(r)||(r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem)(r),window.appsListChanged=1,cur.app&&cur.app.options&&cur.app.options.vkApp&&this.deleteVkApp(),nav.go(extend(nav.objLoc,{join:1,hash:e,sett:t,notify:isChecked("apps_notifications_checkbox")&&isVisible("apps_notifications_checkbox")?1:void 0}),!1,{pass:!0}))},installApp:function(e,t,r){ajax.post(this.address,{act:"do_install",aid:e,hash:t},{onDone:e=>{e==cur&&(this.onAppAdded(),r&&r())}})},onAppAdded:function(){window.appsListChanged=!0,cur.preload&&delete cur.preload.before,cur.app&&(cur.app.runCallback("onApplicationAdded"),cur.appUser=!0,hide("apps_install_btn"),show("apps_show_settings"))},rateOver:function(e){var t=!!geByClass1("apps_install_header"),r=!!geByClass1("WideScreenAppPage"),i=!0,n=!1;cur.rated||hasClass(e,"not_installed")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"over");var o="",s=[],a=0,c=[cur.installPage?-70:-66,0,-36],l="left",p=15,d=0,h=cur.appUser?cur.userRate?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_you_voted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_you_not_voted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_rating_title"),u=rs(cur.rateStatsLabelTpl,{label:h});for(var _ in cur.rateStats=cur.rateStats||{},cur.rateStats)cur.rateStats.hasOwnProperty(_)&&(a+=intval(cur.rateStats[_]));val("app_rate_label",h);for(var f=1;f<=5;f++){o+='<span class="app_rate stats fl_r"></span>';var m=intval(cur.rateStats[f]),b=a?intval(100*m/a):0,g=langNumeric(m,"%s",!0),v=cur.userRate!=10*f&&cur.userRate?"":"my";s.push(rs(cur.rateStatsRowTpl,{id:"apps_rate_row"+f,stars:o,count:g,percent:b,classname:v}));var w=ge("apps_rate_row"+f);w&&(setStyle(geByClass1("app_rate_bg",w),{width:b+"%"}),val(geByClass1("app_rate_percent",w),b+"%"),val(geByClass1("app_rate_cnt",w),g),geByClass1("app_rate_stars",w).className="app_rate_stars fl_l "+v)}u+=s.reverse().join(""),t&&(l="top",c=[210,0,10],p=0,d=15),r&&(l="top",c=[3,10,100],p=0,d=15,i=!1,n=!0),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{text:u,slideX:p,slide:d,className:"app_rate_tt",shift:c,appendEl:window.bodyNode,forcetodown:i,forcetoup:n,dir:l,hasover:1})},rateOut:function(e){this.showRate(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"over")},rateApp:function(e){if(cur.rated)return!1;var t=ge("apps_ratings");cur.appRate=cur.userRate=e,this.rateOut(t),cur.rated=!0,ajax.post("/al_apps.php",{act:"rate_app",aid:cur.aid,rate:e,hash:cur.rate_hash},{onDone:e=>{cur.rateStats=e,this.rateOver(t)}})},showRate:function(e){if(cur.rated)return!1;var t=intval(cur.appRate||0),r=geByClass("app_rate",ge("apps_ratings")),i=Math.floor((t+2)/10),n=Math.floor((t+2)/5)-i;for(var o in r)if(r.hasOwnProperty(o)){var s="app_rate fl_l "+(o<i?"full":o<n?"half":"empty");r[o].className=s}if(e){var a=Math.floor(e/10);for(var c in r)if(r.hasOwnProperty(c)){if(c>=a)break;r[c].className+=" over"}}},recentTabsUpdate:function recentTabsUpdate(needApps,needNotifications){if(cur.rAppsWrap&&cur.rNotWrap){if(needApps=window.appsListChanged||needApps,needNotifications=window.notificationsListChanged||needNotifications,delete window.appsListChanged,delete window.notificationsListChanged,!needApps&&!needNotifications)return;ajax.post(this.address,{act:"update_recent",notifications:needNotifications,apps:needApps,hash:cur.recentUpdateHash},{onDone:this.withFastBackCheck(function(apps,notifications){if(apps&&(each(geByClass("apps_recent_row",cur.rAppsWrap),function(e,t){re(t)}),apps[0]?(show(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rAppsNoContent,"hidden_no_content"),domInsertBefore(cf(apps[0]),cur.rAppsShowMoreButton)):(hide(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rAppsNoContent,"hidden_no_content")),cur.recentOffset=apps[1],apps[2]))for(var i in apps[2]=eval("("+apps[2]+")"),apps[2])apps[2].hasOwnProperty(i)&&(cur.apps[apps[2][i][0]]=apps[2][i]);if(notifications){each(geByClass("apps_notification_row",cur.rNotWrap),function(e,t){re(t)});var tab=ge("apps-recent-notifications-tab");notifications[0]?((notifications[2]?hide:show)(cur.rNotShowMoreButton),show(tab),hide(cur.rNotNoContent),domInsertBefore(cf(notifications[0]),cur.rNotShowMoreButton)):(hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),"notifications"!=nav.objLoc.tab&&hide(tab)),cur.notificationsOffset=notifications[1],cur.notificationsNewest=notifications[4],this.notificationsSetCounters(notifications[3]),this.notificationsInit()}this.ttDestroyAll()}.bind(this)),showProgress:()=>{needApps&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(domPN(cur.rNotWrap),this.optionLoadingClass)},hideProgress:this.withFastBackCheck(function(){needApps&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(domPN(cur.rNotWrap),this.optionLoadingClass)}.bind(this))})}},optionNotificationsReadTimeout:1e3,notificationsReadTimeout:null,notificationsRemovedCount:0,notificationTabSelect:function(){nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rNotBlackList,this.optionHiddenClass),cur.rNotScrollbar&&cur.rNotScrollbar.update(),this.notificationsReadContent()},notificationsInit:function(){cur.rNotWrap&&cur.notificationsOffset&&!cur.rNotScrollbar?(this.notificationsRemovedCount=0,cur.rNotScrollbar=new uiScroll(cur.rNotWrap,{autoresize:!1,global:!0,onmore:this.notificationsLoadContent.bind(this),onscroll:this.notificationsReadContent.bind(this)}),this.notificationsReadContent()):cur.rNotWrap&&cur.rNotScrollbar&&(cur.rNotScrollbar.update(),this.notificationsReadContent())},notificationsMarkReaded:function(e){e.removeAttribute("data-read"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"apps_notification_row_new")},notificationsReadContent:function(){"notifications"===nav.objLoc.tab&&(this.notificationsReadTimeout&&clearTimeout(this.notificationsReadTimeout),this.notificationsReadTimeout=setTimeout(function(){var e=[],t=[];each(cur.rNotWrap.querySelectorAll('div[data-read="1"]'),function(r,i){i.offsetTop+i.offsetHeight/2<=cur.rNotScrollbar.data.scrollTop+cur.rNotScrollbar.data.viewportHeight&&(e.push(i.getAttribute("data-id")),t.push(i))}),e.length&&ajax.post(this.address,{act:"a_mark",newest:cur.notificationsNewest,notif_ids:e.join(","),hash:cur.notificationsHash},{onDone:this.withFastBackCheck(function(e){this.notificationsSetCounters(e),each(t,function(e,t){this.notificationsMarkReaded(t)}.bind(this))}.bind(this))})}.bind(this),this.optionNotificationsReadTimeout))},notificationsLoadContent:function(){isVisible(cur.rNotShowMoreButton)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(cur.rNotShowMoreButton)&&(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(cur.rNotShowMoreButton),ajax.post(this.address,{act:"more_notifications",offset:cur.notificationsOffset,hash:cur.notificationsHash},{onDone:this.withFastBackCheck(function(e,t,r){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(cur.rNotShowMoreButton),cur.notificationsOffset=t,e&&cur.rNotShowMoreButton&&cur.rNotShowMoreButton.parentNode.insertBefore(cf(e),cur.rNotShowMoreButton),r&&hide(cur.rNotShowMoreButton),cur.rNotScrollbar.update()}),onFail:this.withFastBackCheck(function(){hide(cur.rNotShowMoreButton)})}))},notificationsRemoveAll:function(e,t,r,i,n){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(e)&&!checkEvent(n)){var o=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:t},r,Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_delete"),function(t){ajax.post(this.address,{act:"remove_all_notifications_and_requests",newest:cur.notificationsNewest,hash:i},{onDone:this.withFastBackCheck(function(){each(geByClass("apps_notification_row",cur.rNotWrap),function(e,t){re(t)}),hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),this.notificationsSetCounters(0),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this)),showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(t),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink)(e)},hideProgress:this.withFastBackCheck(function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink)(e),o.hide()})})}.bind(this),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"));return!1}},notificationsSetCounters:function(e){if(void 0!==e&&(cur.notificationsNew=e,this.handlePageCount(e),cur.rNotCounter)){var t=e<1e3?e+"":".."+(e+"").substr(-3);e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rNotCounter,this.optionHiddenClass),e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rNotCounter,"ui_tab_count_hidden"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rNotCounter,"ui_tab_count_hidden"),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_21__.animateCount)(cur.rNotCounter,t,{str:t,onDone:e?void 0:_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass.pbind(cur.rNotCounter,this.optionHiddenClass)})}},rejectRequest:function(e,t,r,i){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(e)){var n=ge("apps_notification_"+t);this.notificationsMarkReaded(n),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(n,"html",n.innerHTML),setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"reject_"+i,newest:cur.notificationsNewest,rid:t,hash:r},{onDone:this.withFastBackCheck(function(e,t,r){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),this.notificationsSetCounters(r),cur.rNotScrollbar.update()}.bind(this,n)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(e))}),cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},requestsRestore:function(e,t,r){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(e)){var i=ge("apps_notification_"+t);ajax.post(this.address,{act:"request_restore",newest:cur.notificationsNewest,rid:t,hash:r},{onDone:this.withFastBackCheck(function(e,t){this.notificationsRemovedCount--,val(e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"html")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"apps_notification_service"),setStyle(e,{minHeight:""}),this.notificationsSetCounters(t),cur.rNotScrollbar.update()}.bind(this,i)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink.pbind(e))}),cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},deleteNotification:function(e,t,r,i){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(e)){var n=ge("apps_notification_"+t);setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"delete_notification",newest:cur.notificationsNewest,nid:t,aid:r,hash:i},{onDone:this.withFastBackCheck(function(e,t,r){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),this.notificationsSetCounters(r)}.bind(this,n)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(e))})}},denyNotifications:function(e,t,r,i){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(e)){var n=ge("apps_notification_"+t);setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"deny_notifications",aid:r,hash:i},{onDone:this.withFastBackCheck(function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),t&&val(e,t)}.pbind(n)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink.pbind(e))})}},requestsBanUser:function(e,t,r,i){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(e)){var n=ge("apps_notification_"+t);setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"request_ban_user",mid:r,hash:i},{onDone:this.withFastBackCheck(function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),t&&val(e,t)}.pbind(n)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink.pbind(e),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink.pbind(e))})}},removingApp:!1,restoringApp:!1,feedTabSelect:function(){delete nav.objLoc.tab,nav.setLoc(nav.objLoc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rNotBlackList,this.optionHiddenClass),cur.fScrollbar&&cur.fScrollbar.update()},updateLeftNav:function(e){e&&val(geByTag1("ol",ge("side_bar")),e)},restoreApp:function(e,t,r){if(this.restoringApp)return!1;var i=ge("app"+e);return cur.deletedApps[e]&&"al_apps"==cur.deletedApps[e].from&&val(geByClass1("app_deleted_layer",i,"div"),cur.progressTpl),ajax.post(this.address,{act:"join",gid:cur.gid,gidhash:r,id:e,hash:t,restore:1,from:"al_apps",section:cur.section},{onDone:this.withFastBackCheck(function(t){cur.deletedApps[e]&&(val(i,cur.deletedApps[e].html),t.left_nav&&this.updateLeftNav(t.left_nav),delete cur.deletedApps[e]),cur.apps[e]&&(delete cur.apps[e].deleted,cur.appsIndex&&cur.appsIndex.add(cur.apps[e])),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(i,"deleted")}.bind(this)),showProgress:function(){this.restoringApp=!0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(i,this.optionLoadingClass)}.bind(this),hideProgress:this.withFastBackCheck(function(){this.restoringApp=!1,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(i,this.optionLoadingClass)}.bind(this))}),!1},removeApp:function(e,t,r,i,n){if(i&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(i),this.removingApp)return!1;if(this.isDelayedOnSilentLoad("removeApp"+e,this.removeApp.bind(this,e,t,r)))return!1;this.ttDestroyAll();var o=r?ge("recent"+e):ge("app"+e),s=o&&cur.lContent&&cur.lContent.contains(o)&&this.isSection("settings")?"settings":r?"recent":"al_apps",a=function(){var r;"al_apps"==s&&(r=o&&geByClass1("app_deleted_layer",o,"div"),val(r,cur.progressTpl)),ajax.post(this.address,{act:"quit",gid:cur.gid,id:e,hash:t,offset:cur.recentOffset,from:s},{onDone:this.withFastBackCheck(function(t){"apps"==cur.module&&(delete cur.preload,cur.rNotWrap&&this.isSection("catalog","list")?this.recentTabsUpdate(!1,!0):(window.notificationsListChanged=!0,t.count_all&&this.notificationsSetCounters(t.count_all)),window.appsListChanged=!0,cur.apps[e]&&(cur.appsIndex&&cur.appsIndex.remove(cur.apps[e]),cur.apps[e].deleted=!0),t.left_nav&&this.updateLeftNav(t.left_nav),"settings"==s?(cur.deletedApps[e]={from:s,html:o.innerHTML},o&&o.appendChild(cf(t.html))):"recent"==s?(hide(o),geByClass1("apps_recent_row",cur.rAppsWrap)?cur.recentOffset+=t.offset:(hide(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rAppsNoContent,"hidden_no_content"),cur.recentOffset=0)):(cur.deletedApps[e]={from:s,html:o.innerHTML},t.html&&val(r,t.html)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(o,"deleted"))}.bind(this)),showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(o,this.optionLoadingClass),this.removingApp=!0}.bind(this),hideProgress:this.withFastBackCheck(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(o,this.optionLoadingClass),this.removingApp=!1}.bind(this))})}.bind(this);if("recent"==s)var c=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_quit_app_box_title")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)(n?"apps_game_quit_confirm":"apps_quit_confirm"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_remove"),function(){a(),c.hide()},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"));else if(cur.adminApps&&cur.adminApps[e])var l=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_deletingapp")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_quit"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_delete"),function(){a(),l.hide()},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"));else a()},initSearchTags:function(e,t,r,i){cur.searchTags={},t&&t.forEach(e=>{Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.isObject)(e)&&e.id&&(uiSearch.toggleFilter(r,e.id,e.name,!0),cur.searchTags[e.id]=!0)}),stManager.add(jsc("web/indexer.js"),()=>{e=isArray(e)?e:[],cur.searchTagsIndexer=new vkIndexer(e,e=>e[1]),i.suggester&&i.suggester.instance.setOptions({onlyShowSuggestions:!0,onAcceptSuggestion:Apps.onSearchTagAccepted.bind(Apps),fetchSuggestionsFn:Apps.fetchSearchTagsSuggestions.bind(Apps),onSelectSuggestion:Apps.onSelectSearchSuggestion.bind(Apps)},!0)})},fetchSearchTagsSuggestions:function(e){return cur.searchTagsIndexer?cur.searchTagsIndexer.search(e).filter(e=>!cur.searchTags[positive(e[0])]):[]},onSearchTagRemoved:function(e){var t=ge("s_search"),r=t&&t.value||"";e=positive(e),delete cur.searchTags[e],this.searchUpdate(r)},onSelectSearchSuggestion:function(e){e=positive(e);var t=Object.keys(cur.searchTags);t.push(e),cur.previewTagsStr=t.join(","),cur.searchStr="",this.searchUpdate(""),cur.previewTagsStr=""},onSearchTagAccepted:function(e,t){var r=ge("s_search");e=positive(e),cur.searchTags[e]=!0,uiSearch.toggleFilter(r,e,t,!0),val(r,""),this.searchUpdate("")},runApp:function(e,t,r,i,n,o,s,a){if(!vk.id)return showDoneBox(cur.pleaseSignInLang),!1;Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(e);var c=clone(nav.objLoc);delete c.w,nav.setLoc(c),window.appsListChanged=1;var l="/"+t+"?join=1&hash="+r+"&sett="+i;if(s&&(l="/"+t+"?act=embed&join=1&join_hash="+r+"&sett="+i+"&hash="+a),cur.fromInstallBox&&(l+="&from_install="+(1==cur.fromInstallBox?1:2)),n)if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.isObject)(n))for(var p in n)"w"!=p&&(l+="&"+p+"="+n[p]);else""!=n&&(l+="&ref="+n);o&&(l+="&mid="+o),nav.objLoc["#"]&&(l+="#"+nav.objLoc["#"]),s&&(location.href=l),nav.go(l)},updatesInterval:null,stopUpdates:function(){this.updatesInterval&&clearInterval(this.updatesInterval)},initUpdates:function(e){e&&e.key&&(cur.updatesKey=e.key);var t=function(){window.Notifier&&cur.updatesKey&&Notifier.addKey(cur.updatesKey,function(e,t){if(cur.updatesKey){if(t.events)for(var r in t.events)t.events.hasOwnProperty(r)&&this.parseEvent(t.events[r]);t.ts&&(cur.updatesKey.ts=t.ts)}}.bind(this))}.bind(this);t(),this.updatesInterval=setInterval(t,1e4),cur.destroy.push(this.stopUpdates.bind(this))},parseEvent:function(e){var t=(e=e.split("<!>"))[0];if(cur.updatesVersion&&t==cur.updatesVersion){var r=_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.opera&&intval(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.version)<=12,i=e[3],n=new Date,o=n.getHours(),s=n.getMinutes();o<10&&(o="0"+o),s<10&&(s="0"+s),i=i.replace("{date}",o+":"+s);var a=domFC(cf(i));if(cur.fWrap){var c=cur.fWrap.__uiScroll__?cur.fWrap.__uiScroll__.content:cur.fWrap;function l(){cur.fScrollbar&&cur.fScrollbar.update(),r?a.removeEventListener("oTransitionEnd",l):removeEvent(a,"webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",l)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(a,"apps_feed_row_just_added"),c.insertBefore(a,domFC(c)),r?a.addEventListener("oTransitionEnd",l):addEvent(a,"webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",l),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClassDelayed)(a,"apps_feed_row_just_added"),this.ttHideAll()}}},feedInit:function(){cur.fWrap&&cur.feedOffset&&!cur.fScrollbar?cur.fScrollbar=new uiScroll(cur.fWrap,{autoresize:!1,global:!0,onmore:this.feedLoadContent.bind(this)}):cur.fWrap&&cur.fScrollbar&&cur.fScrollbar.update()},feedLoadContent:function(){!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(cur.fShowMoreButton)&&isVisible(cur.fShowMoreButton)&&ajax.post(this.address,{act:"more_feed",offset:cur.feedOffset,hash:cur.feedHash},{onDone:this.withFastBackCheck(function(e,t,r){cur.feedOffset=t,e&&cur.fShowMoreButton&&cur.fShowMoreButton.parentNode.insertBefore(cf(e),cur.fShowMoreButton),r&&hide(cur.fShowMoreButton),cur.fScrollbar&&cur.fScrollbar.update()}),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(cur.fShowMoreButton),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(cur.fShowMoreButton))})},myAppOver:function(e,t,r){if(hasClass(t,"deleted")||!vk.id)return!1;Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(t,{url:this.address,params:{act:"show_app_friends_tt",aid:e,no_size:r?1:0},typeClass:"tt_black",slide:15,center:1,shift:[0,8,8],ajaxdt:200,showdt:300,hidedt:200,dir:"auto"})},ttScore:function(e,t,r){var i=void 0;return cur.ttScoreShown&&window.tooltips&&(tooltips.hideAll(),i=0),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{center:1,black:1,shift:[0,8,8],showsp:i,text:'<div class="apps_score_tt_cont"><b>'.concat(t,"</b>",r?'<div class="apps_score_tt">'+r+"</div>":"","</div>")})},ttCommon:function(e,t,r){return 0===(r=extend({parent:void 0,center:void 0,event:0,appendEl:void 0,shift:void 0},r)).event&&(r.event=window.event),r.event&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(r.event),r.appendEl&&(r.appendEl=ge(r.appendEl)),r.center?Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{center:r.center,shift:r.shift||[0,8,8],black:1,appendEl:r.appendEl,text:t}):showTitle(e,t,r.shift,r)},ttHideAll:function(){window.tooltips&&tooltips.hideAll()},ttDestroyAll:function(){window.tooltips&&tooltips.destroyAll()},scrollToHeader:function(){var e=ge("apps_header_block"),t=scrollNode.scrollTop,r=getSize("page_header_cont")[1];if(e){var i=Math.max(0,getXY(e)[1]-parseInt(getStyle(e,"marginTop"),10));t+(vk.staticheader?Math.max(0,r-t):r)>i&&scrollToY(i,200)}},scrollToSearch:function(){var e=scrollNode.scrollTop,t=getSize("page_header_cont")[1];if(cur.aSearchWrap){var r=getXY(domPN(cur.aSearchWrap))[1];e+(vk.staticheader?Math.max(0,t-e):t)>r&&scrollToY(r,200)}},scrollCheck:function(){this.isDelayedOnSilentLoad("scrollCheck",this.scrollCheck.bind(this))||!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mobile&&!cur.isAppsLoading&&!cur.disableAutoMore&&isVisible(cur.lShowMoreButton)&&(window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight)+scrollGetY()+400>=cur.lShowMoreButton.offsetTop&&this.searchLoadContent()},searchFocusedClass:"apps_search_focused",backupListContent:function(e){if(cur.backupList||e){if(cur.backupList&&!cur.backupList.contentCopied&&e){for(cur.backupList.content=document.createDocumentFragment();cur.lContent.firstChild;)cur.backupList.content.appendChild(cur.lContent.firstChild);for(cur.backupList.preload=document.createDocumentFragment();cur.lPreload.firstChild;)cur.backupList.content.appendChild(cur.lPreload.firstChild);cur.backupList.contentCopied=!0}}else cur.backupList={cur:{loadMore:cur.loadMore,shownApps:cur.shownApps,sectionCount:cur.sectionCount,searchOffset:cur.searchOffset},content:null,preload:null,contentCopied:!1}},restoreListContent:function(){return cur.backupList?(this.searchProgress(!1),val(cur.lContent,""),val(cur.lPreload,""),extend(cur,cur.backupList.cur),cur.lContent.appendChild(cur.backupList.content),cur.lPreload.appendChild(cur.backupList.preload),delete cur.backupList,!0):(delete cur.backupList,!1)},indexAll:function(e){cur.appsIndex=new vkIndexer(cur.appsList.all,function(e){try{return cur.apps[parseInt(e[0])]=e,e[3]}catch(e){return""}},e)},searchUpdate:function(e){if(!this.isDelayedOnSilentLoad("searchUpdate",this.searchUpdate.bind(this,e))){((e=e||"").length<2||cur.previewTagsStr)&&(e="");var t=cur.previewTagsStr||Object.keys(cur.searchTags||{}).join(",");if(cur.ignoreEqual||cur.searchStr!==e||t!==cur.searchTagsStr){this.isSection("list")&&e&&this.backupListContent(),cur.searchStr=e||"",cur.searchTagsStr=t;var r=this.isSection("apps","settings","manage","admin_requests","reports","ads")?"all":"search";if(e&&this.isSection("apps","settings","manage","admin_requests","reports","ads")){var i=cur.appsIndex.search(clean(e));cur.curList=r+"_search_"+e+"_"+cur.searchTagsStr,cur.appsList[cur.curList]=i,e+=" "+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.parseLatin)(e)||""),e=trim(escapeRE(e).split("&").join("&amp;")),cur.selection={re:new RegExp("("+e.replace(cur.appsIndex.delimiter,"|")+")","gi"),val:"<span>$1</span>"}}else cur.curList=r,cur.selection=!1;this.ttHideAll(),this.searchProgress(!0),this.scrollToSearch(),hide(cur.lShowMoreButton),this.isSection("catalog","list")&&this.searchWriteToAddressBar(),cur.loadMore=1,cur.shownApps=cur.searchOffset=0,this.showRows()}delete cur.ignoreEqual}},showRows:function(){if(!this.isDelayedOnSilentLoad("showRows",this.showRows.bind(this))){if(cur.searchStr||cur.searchTagsStr)this.isSection("list","catalog")&&this.searchLoadContent();else{if(this.isSection("list"))return this.restoreListContent()||(extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),this.searchCatalog(cur.searchStr,cur.searchOffset)),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1;if(this.isSection("catalog"))return extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),val(cur.lContent,""),val(cur.lPreload,""),this.switchLayout("catalog"),this.searchProgress(!1),this.sliderStart(),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1}if(this.isSection("settings","manage","admin_requests","apps","reports","ads")){if(cur.defaultCount&&cur.shownApps<cur.sectionCount){var e=clean(cur.searchStr),t=this.isSection("manage","admin_requests"),r="",i=cur.appsList[cur.curList]||[],n=i.length;if((i=this.filter(i.slice(cur.shownApps)).slice(0,cur.defaultCount)).length&&cur.appTpl){var o=[];each(i,function(e,r){r=clone(r),cur.selection&&(r[3]=r[3].replace(cur.selection.re,cur.selection.val)),o.push(cur.appTpl(r,e==i.length-1,t))}),r=o.join("")}cur.shownApps?r&&cur.lContent.appendChild(cf(r)):r?(val(cur.lContent,r),val(cur.aSummaryCounter,n)):(val(cur.lContent,cur.aSummary.innerHTML.replace("{query}","<b>"+e+"</b>")),val(cur.aSummaryCounter,"")),cur.shownApps+=cur.defaultCount,cur.shownApps>=cur.sectionCount?hide(cur.lShowMoreButton):(show(cur.lShowMoreButton),this.scrollCheck()),cur.searchStr&&!cur.searchOffset&&this.isSection("apps","manage")&&Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.saveSearchAttemptStats)(this.isSection("apps")?"apps_list":"manage",0,i.length,e),this.searchProgress(!1)}return!1}return!0}},searchLoadContent:function(){if(this.isSection("catalog","list")){if(cur.searchStr||(cur.searchStr=""),cur.lPreload.innerHTML){for(var e=document.createDocumentFragment();cur.lPreload.firstChild;)e.appendChild(cur.lPreload.firstChild);cur.lContent.appendChild(e)}return cur.loadMore?this.searchCatalog(cur.searchStr,cur.searchOffset):(cur.loadMore=!0,hide(cur.lShowMoreButton)),!1}return!this.isSection("apps","manage","admin_requests","settings","reports","ads")||this.showRows()},searchCatalog:function(e,t){e=e||"";var r=cur.searchTagsStr,i=+new Date;ajax.post(this.address,{act:e||r||!this.isSection("list")?"search":cur.list,q:e,offset:t,oid:cur.oid,from:cur.section,catalog_search:1,id:cur.listId||void 0,tags:r},{cache:e||cur.searchTagsStr?0:1,onDone:this.withFastBackCheck(function(n,o,s){e==cur.searchStr&&r==cur.searchTagsStr&&(this.isSection("catalog","list")&&((cur.searchStr||r)&&this.sliderStop(),this.switchLayout(cur.searchStr||r?"list":cur.section),this.searchWriteToAddressBar()),this.backupListContent(!0),n&&val(cur.lContent,n),val(cur.lPreload,o||""),cur.loadMore=!!o,extend(cur,s),cur.loadMore&&show(cur.lShowMoreButton),this.scrollCheck(),e&&!t&&Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.saveSearchAttemptStats)(this.isSection("catalog","list")?"apps":"manage"===cur.section?"apps_manage":"apps_list",i,s.count,e))}.bind(this)),showProgress:function(){cur.isAppsLoading=!0,Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(cur.lShowMoreButton)},hideProgress:this.withFastBackCheck(function(){cur.isAppsLoading=!1,this.searchProgress(!1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(cur.lShowMoreButton)}.bind(this))})},filter:function(e){for(var t=e.length,r=[],i=0;i<t;i++){var n=e[i];cur.apps&&cur.apps[n[0]]&&!cur.apps[n[0]].deleted&&r.push(n)}return r},searchLoadFromAddressBar:function(){setTimeout(()=>{cur.searchStr=nav.objLoc.q||"",cur.searchStr&&Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.saveSearchAttemptStats)("apps",0,cur.shownApps,cur.searchStr)},0)},searchWriteToAddressBar:function(e){nav.setLoc(extend(nav.objLoc,{q:cur.searchStr||null,tags:cur.searchTagsStr||null}))},searchProgress:function(e){cur.aSearch&&uiSearch[e?"showProgress":"hideProgress"](cur.aSearch)},searchFocused:function(){cur.aWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.aWrap,this.searchFocusedClass)},searchBlured:function(){cur.aWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,this.searchFocusedClass)},searchReset:function(){cur.aSearch&&uiSearch.reset(cur.aSearch),cur.searchStr=""},switchLayout:function(e){cur.aWrap&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_catalog_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_list_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_manage_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_admin_requests_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_settings_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_apps_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_page_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.aWrap,"apps_"+e+"_layout"))},geTabBySection:function(e,t){var r=ge("apps_tab_"+e+(t?"_"+t:""));return!(!r||!(r=geByTag1("a",r)))&&r},setHistoryBackRules:function(){this.isSection("manage","admin_requests")||(cur._back={show:[function(){if(cur._back.swap&&each(cur._back.swap,function(e,t){t.dummy.parentNode.replaceChild(t.content,t.dummy)}),cur.fScrollbar&&cur.fScrollbar.scrollTop(cur.fScrollbar.data.scrollTop),cur.rNotScrollbar&&cur.rNotScrollbar.scrollTop(cur.rNotScrollbar.data.scrollTop),delete cur._back.swap,setTimeout(function(){var e=nav.objLoc&&ge("notifications"==nav.objLoc.tab?"apps-recent-notifications-tab":"apps-recent-apps-tab");e&&this.switchTabPrepared(e.getElementsByTagName("a")[0]),cur.aSearch&&(uiSearch["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),uiSearch.startEvents(cur.aSearch),cur.aSearch.value=cur.searchStr||"",uiSearch.scrollResize(cur.aSearch)),this.searchWriteToAddressBar(cur.searchStr)}.bind(this),0),this.ttHideAll(),this.recentTabsUpdate(),this.startEvents(),cur.aTabs){var e=this.geTabBySection(this.isSection("list")?cur.list+(cur.listId||""):cur.section);e&&uiTabs.switchTab(e),uiTabs.hideProgress(cur.aTabs)}if(cur.aSubTabs){var t=this.geTabBySection(cur.section,cur.subsection);t&&uiTabs.switchTab(t),uiTabs.hideProgress(cur.aSubTabs)}}.bind(this)],hide:[this.stopEvents.bind(this),this.ttHideAll.bind(this)],text:cur.backLang})},switchTabPrepared:function switchTabPrepared(tabAnchor,event){if(event&&checkEvent(event))return!0;var tabWrap=document.querySelectorAll('div[data-tab="'+domPN(tabAnchor).id+'"]')[0];if(!tabWrap)return!0;var tabGroup=tabWrap.getAttribute("data-tab-group"),tabCallback=tabWrap.getAttribute("data-tab-callback"),tabWraps=document.querySelectorAll('div[data-tab-group="'+tabGroup+'"]');return each(tabWraps,function(e,t){t!==tabWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(t,this.optionHiddenClass)}.bind(this)),uiTabs.switchTab(tabAnchor),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(tabWrap,this.optionHiddenClass),tabCallback&&eval("(function(){"+tabCallback+";})()"),!1},switchTab:function switchTab(section,event,noSearchReset,target){if(event&&checkEvent(event))return!0;if(cur.FortuneWheel&&cur.FortuneWheel.destroy(),Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.removeSearchPositionTracker)("apps"),Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.removeSearchPositionTracker)("apps_list"),Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.removeSearchPositionTracker)("apps_manage"),(this.isSection("list")?cur.list+cur.listId:section)==cur.section)return cur.searchStr&&this.searchReset(),!1;uiSearch.removeAllFilters();var noscroll=!1,scrollToHeader=!1,scrollToTop=!1,newSection=~"/apps/catalog/settings/reports/manage/admin_requests/".indexOf(section)?section:"list",newLayout="reports"==newSection?"apps":newSection;"catalog"==cur.section&&"list"==newSection||"list"==cur.section&&"catalog"==newSection||"list"==cur.section&&"list"==newSection?scrollToHeader=noscroll=!0:cur.section!==newSection&&(scrollToTop=noscroll=!0);var preload=cur.preload&&cur.preload[section],oldBefore="",oldHeader="";if(!cur.preventFastBack&&preload&&(null!==preload.header||cur.leavePreloadedHeader||cur.preload.header)&&(null!==preload.before||cur.leavePreloadedBefore||cur.preload.before)){this.ttDestroyAll();var oldWrapper=ge("wrap3"),titleEl=ge("title"),hideHeader;if(hideHeader=titleEl&&!(!titleEl.parentNode||isVisible(titleEl.parentNode))||void 0,cur._back){window.revertLastInlineVideo&&revertLastInlineVideo(),each(cur._back.hide,function(e,t){t&&t()}),globalHistoryDestroy(cur._back.loc||nav.strLoc),globalHistory.length>2&&globalHistoryDestroy(globalHistory[0].loc),oldBefore=ge("apps_before"),oldHeader=ge("apps_header"),oldWrapper.parentNode.replaceChild(oldWrapper.cloneNode(!0),oldWrapper);var hist={content:oldWrapper,title:titleEl&&titleEl.innerHTML,loc:cur._back.loc||nav.strLoc,cur,radioBtns,ajaxCache,pid:PageID,scrollTop:scrollGetY(),htitle:document.title.toString(),width:vk.width,width_dec:vk.width_dec,width_dec_footer:vk.width_dec_footer,noleftmenu:vk.noleftmenu,notopmenu:vk.notopmenu,nobottommenu:vk.nobottommenu,hideHeader};hist.back=!(!_tbLink||!_tbLink.loc)&&[_tbLink.loc,val(_tbLink),_tbLink.fast],showBackLink(hist.loc,cur._back.text,1),globalHistory.push(hist)}else _tbLink&&(_tbLink.fast=0),processDestroy(cur);PageID=NextPageID,radioBtns={},ajaxCache={},boxQueue.hideAll(),layerQueue.clear(),layers.fullhide&&layers.fullhide(!0);var oldCur=cur;cur={aWrap:ge("apps_wrap"),scrollToHeader,scrollToTop,destroy:[],nav:[],preload:oldCur.preload,_back:oldCur._back};var newJs=[],tmp=null;null!==preload.before?val("apps_before",preload.before):oldCur.leavePreloadedBefore?(oldCur._back&&(tmp={dummy:ce("div"),content:oldBefore},oldCur._back.swap||(oldCur._back.swap=[]),oldCur._back.swap.push(tmp),oldBefore?(oldBefore.parentNode.replaceChild(tmp.dummy,oldBefore),tmp=ge("apps_before"),tmp.parentNode.replaceChild(oldBefore,tmp)):this.restoreBeforeBlock(oldCur,newJs),oldCur.fScrollbar&&oldCur.fScrollbar.scrollTop(oldCur.fScrollbar.data.scrollTop),oldCur.rNotScrollbar&&oldCur.rNotScrollbar.scrollTop(oldCur.rNotScrollbar.data.scrollTop)),extend(cur,{updatesKey:oldCur.updatesKey,updatesVersion:oldCur.updatesVersion,fScrollbar:oldCur.fScrollbar,feedOffset:oldCur.feedOffset,feedHash:oldCur.feedHash,rNotScrollbar:oldCur.rNotScrollbar,notificationsOffset:oldCur.notificationsOffset,notificationsNewest:oldCur.notificationsNewest,notificationsHash:oldCur.notificationsHash,recentOffset:oldCur.recentOffset,recentUpdateHash:oldCur.recentUpdateHash,searchTagsIndexer:oldCur.searchTagsIndexer,searchTags:oldCur.searchTags})):(this.restoreBeforeBlock(oldCur,newJs),newJs.push(oldCur.preload.before[1])),null!==preload.header?val("apps_header",preload.header):oldCur.leavePreloadedHeader?oldCur._back&&(tmp={dummy:ce("div"),content:oldHeader},oldCur._back.swap||(oldCur._back.swap=[]),oldCur._back.swap.push(tmp),oldHeader.parentNode.replaceChild(tmp.dummy,oldHeader),tmp=ge("apps_header"),tmp.parentNode.replaceChild(oldHeader,tmp)):(val("apps_header",oldCur.preload.header[0]),newJs.push(oldCur.preload.header[1])),val("apps_after",preload.after||""),val("apps_content",preload.content||""),val("apps_list_content",preload.list_content||""),val("apps_list_preload",preload.list_preload||"");var promoBanner=document.querySelector("#promo-banner");if(promoBanner)"catalog"===section?show(promoBanner):hide(promoBanner);else if(preload.promo_banner&&"catalog"===section){var banner=se(preload.promo_banner);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(banner,ge("apps_header_block"))}this.switchLayout(newLayout),each(newJs,function(i,js){js&&eval("(function(){"+js+";})()")}),preload.js&&eval("(function(){"+preload.js+";})()"),window.__adsUpdate("force"),nav.objLoc={0:this.address,act:"catalog"===section?void 0:section,search_shown:cur.catalogSearchShown,tab:"catalog"===newSection||"list"===newSection?nav.objLoc.tab:void 0,mid:nav.objLoc.mid,gid:nav.objLoc.gid,add:nav.objLoc.add},nav.setLoc(nav.objLoc),this.searchReset();var tab=this.geTabBySection(section);return tab&&setTimeout(uiTabs.switchTab.pbind(tab),0),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1}target&&(hasClass(target,"app_cat_link")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink)(target):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(target,"apps_header_progress"));var _tab2=this.geTabBySection(section);return _tab2&&(uiTabs.switchTab(_tab2),uiTabs.showProgress(_tab2)),nav.go({0:this.address,act:"catalog"===section?void 0:section,tab:"catalog"===newSection||"list"===newSection?nav.objLoc.tab:void 0,search_shown:cur.catalogSearchShown,mid:nav.objLoc.mid,gid:nav.objLoc.gid,add:nav.objLoc.add},!1,{onDone:function(e){target&&(hasClass(target,"app_cat_link")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink)(target):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(target,"apps_header_progress")),extend(cur,{scrollToHeader,scrollToTop})}.pbind(cur),noscroll})},restoreBeforeBlock(e,t){if(e.preload.before){if(ge("apps_before"))val("apps_before",e.preload.before[0]);else{var r=ce("div",{id:"apps_before"});r.classList.add("apps_before"),r.classList.add("clear_fix"),r.innerHTML=e.preload.before[0],domInsertBefore(r,ge("apps_after"))}t.push(e.preload.before[1])}},sliderInit:function(){"catalog"!=cur.section||cur.featuredSlider||(cur.featuredSlider=new AppsSlider({inner:"apps_featured_slides",outer:"apps_featured_slider",next:"apps_featured_next",prev:"apps_featured_prev",onSlide:function(){window.AdsLight&&AdsLight.applyAds()}}))},sliderStart:function(){cur.featuredSlider&&(cur.featuredSlider.slideshowStart(),cur.featuredSlider.addHandler())},sliderStop:function(){cur.featuredSlider&&(cur.featuredSlider.removeHandler(),cur.featuredSlider.slideshowStop())},collectionsLoadContent:function(e){if(isVisible(e)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(e))return cur.collectionsOffset&&cur.collectionsHasMore?void ajax.post("al_apps.php",{act:"a_collections_more",offset:cur.collectionsOffset,seed:cur.collectionsSeed},{onDone:function(t,r,i){geByClass1("_apps_collections").appendChild(cf(t)),cur.collectionsHasMore=i,i||hide(e),cur.collectionsOffset=r},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(e)}):hide(e)},addToMineGroups:function(e,t,r,i){var n={act:"add_to_mine_group_box",aid:e,hash:t,height:lastWindowHeight,from_gid:i};r&&(n.source=r),showBox("apps",n,{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"}})},makeAppSlider:function(e){return new AppsSlider(e)},closeExternalApp:function(){cur.app.clientRpc&&cur.app.clientRpc.callMethod("closeExternalApp")},adminRequestRow:function(e){var t="",r=_slicedToArray(e,6),i=r[0],n=r[1],o=r[2],s=r[3],a=r[4],c=r[5];if(a=intval(a),n=`<img src="${n}"/>`,o)if("away.php"==o.substr(0,8)){var l=o.replace(/&/g,"&amp;");s=`<a href="${o}" target="_blank" rel="nofollow noopener" onclick="return goAway('${l}')">${s}</a>`,n=`<a href="${o}" target="_blank" rel="nofollow noopener" onclick="return goAway('${l}')">${n}</a>`}else s=`<a href="${o}">${s}</a>`,n=`<a href="${o}">${n}</a>`;return cur.adminRequest&&void 0!==cur.adminRequest[i]?null!==cur.adminRequest&&(t=cur.adminRequest[i]?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_accepted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_declined")):t=`<a onclick='Apps.adminRequestAccept(this, ${i}, "${c}")'>${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_accept")}</a> | `+`<a onclick='Apps.adminRequestDecline(this, ${i}, "${c}")'>${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_decline")}</a>`,rs(cur.rowTpl,{id:i,name:s,img:n,info:`<div class="apps_settings_size">${a?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_X_participants",a,!0):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_noparticipants")}</div>`,actions:t})},adminRequestAccept:function(e,t,r){var i=gpeByClass("_app_settings_actions",e);i&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_accept_admin_request",aid:t,hash:r},{onDone:function(e,r,n){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=n,val(i,e),r&&showDoneBox(r)},hideProgress:function(){cur.adminRequestProcess=!1}}))},adminRequestDecline:function(e,t,r){var i=gpeByClass("_app_settings_actions",e);i&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_decline_admin_request",aid:t,hash:r},{onDone:function(e,r,n){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=n,val(i,e),r&&showDoneBox(r)},hideProgress:function(){cur.adminRequestProcess=!1}}))},share:function(e,t){showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t})},qrCodeModal:function(){cur.qrModal||(cur.qrModal=new _shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_23__.default),cur.qrModal.init(),cur.qrModal.toggle()},unverifiedGoBack:function(){return window.history.back(),!1},initUnverifiedRunScreen:function(){if(window.globalHistory&&window.globalHistory.length){var e=geByClass1("apps_unverifiedAppWarning__btn_back");e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_unverifiedAppWarning__btn_active")}},runUnverified:function(e,t){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(e),nav.setLoc(extend(nav.objLoc,{run_hash:t})),nav.reload()},addAppQrCode:function(e){var t=geByClass1("apps_install_header__qr"),r=`${location.origin}/app${e}${location.hash}`,i=_vkontakte_vk_qr__WEBPACK_IMPORTED_MODULE_26__.createQR(r,120,"",{isShowLogo:!0});t&&(t.innerHTML=i)},showHint:function(e,t,r){return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(t),r=r||{},r=extend({dir:"bottom",shift:[12,8],appendEl:document.body,width:200},r),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showHint)(e,r)},hideVkPayPromoBanner:function(e){window.tooltips&&window.tooltips.hideAll(),re(document.querySelector(".apps_vkPayPromo")),ajax.post("/apps",{act:"hide_vkpay_banner",hash:e})},openVkPayGamesMarket:e=>(Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.statlogsValueEvent)("apps_catalog_vkpay_games_store_button",1),!0),changeCheckBackUrl:()=>{if(window.nav.objLoc&&cur.aid===ID_APP_CHECKBACK){var e=window.nav.objLoc[0];"check"!==e&&e!==`app${ID_APP_CHECKBACK}`||(nav.objLoc[0]="checkback",window.nav.setLoc(nav.objLoc))}},searchToggle:()=>{var e=document.querySelector("#apps_search"),t=document.querySelector("#s_search");e&&window.cur&&(cur.catalogSearchShown=+!e.classList.toggle("SearchToggle__hide")),t&&t.focus()}},_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_27__.default.isEnabled()&&(window.cur=window.cur||{},window.cur.GameGifts=new _web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_27__.default,window.cur.GiftsFriendsWishListLoader=new _web_apps_games_gifts_GiftsFriendsWishListLoader__WEBPACK_IMPORTED_MODULE_29__.default);try{stManager.done("apps.js")}catch(e){}},Iwry:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n="application/font-woff",o={woff:n,woff2:n,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function s(e){var t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function a(e){var t=s(e).toLowerCase();return o[t]||""}function c(e){return new Promise(function(t,r){var i=new Image;i.onload=function(){t(i)},i.onerror=r,i.crossOrigin="anonymous",i.src=e})}function l(e){return e.split(/,/)[1]}function p(e,t){var r=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(r.replace("px",""))}function d(){return window.devicePixelRatio||1}t.uuid=(i=0,function(){return i+=1,"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+i}),t.parseExtension=s,t.getMimeType=a,t.delay=function(e){return function(t){return new Promise(function(r){setTimeout(function(){r(t)},e)})}},t.createImage=c,t.isDataUrl=function(e){return-1!==e.search(/^(data:)/)},t.toDataURL=function(e,t){return"data:"+t+";base64,"+e},t.getDataURLContent=l,t.canvasToBlob=function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):function(e){return new Promise(function(t){for(var r=window.atob(e.toDataURL().split(",")[1]),i=r.length,n=new Uint8Array(i),o=0;o<i;o+=1)n[o]=r.charCodeAt(o);t(new Blob([n],{type:"image/png"}))})}(e)},t.toArray=function(e){for(var t=[],r=0,i=e.length;r<i;r+=1)t.push(e[r]);return t},t.getNodeWidth=function(e){var t=p(e,"border-left-width"),r=p(e,"border-right-width");return e.scrollWidth+t+r},t.getNodeHeight=function(e){var t=p(e,"border-top-width"),r=p(e,"border-bottom-width");return e.scrollHeight+t+r},t.getPixelRatio=d,t.svgToDataURL=function(e){return Promise.resolve().then(function(){return(new XMLSerializer).serializeToString(e)}).then(encodeURIComponent).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})},t.getBlobFromImageURL=function(e){return c(e).then(function(t){var r=t.width,i=t.height,n=document.createElement("canvas"),o=n.getContext("2d"),s=d();return n.width=r*s,n.height=i*s,n.style.width=""+r,n.style.height=""+i,o.scale(s,s),o.drawImage(t,0,0),l(n.toDataURL(a(e)))})}},JHWP:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("Iwry"),n=3e4;t.default=function(e,t){return t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),(window.fetch?window.fetch(e).then(function(e){return e.blob()}).then(function(e){return new Promise(function(t,r){var i=new FileReader;i.onloadend=function(){return t(i.result)},i.onerror=r,i.readAsDataURL(e)})}).then(i.getDataURLContent).catch(function(){return new Promise(function(e,t){t()})}):new Promise(function(t,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var n=new FileReader;n.onloadend=function(){t(i.getDataURLContent(n.result))},n.readAsDataURL(o.response)}else r(new Error("Failed to fetch resource: "+e+", status: "+o.status))},o.ontimeout=function(){r(new Error("Timeout of "+n+"ms occured while fetching resource: "+e))},o.responseType="blob",o.timeout=n,o.open("GET",e,!0),o.send()})).catch(function(r){var i="";if(t.imagePlaceholder){var n=t.imagePlaceholder.split(/,/);n&&n[1]&&(i=n[1])}var o="Failed to fetch resource: "+e;return r&&(o="string"==typeof r?r:r.message),o&&console.error(o),i})}},JuPy:function(e,t,r){"use strict";function i(){return!!window.isMVK}r.r(t),r.d(t,"isMvk",function(){return i})},PjZB:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return o});r("rGqo"),r("a1Th"),r("Btvt");var i=r("q1tI"),n=(r("17x9"),r("pemR"));class o extends i.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var r=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(r=>r+":"+t[e][r]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${r}} @keyframes ${e} {${r}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,r=e.color,o=e.size,s=e.duration,a=e.strokeWidth,c=e.className,l=this.id,p=this.offset,d=this.animation,h=Object(n.classNames)("Spinner",c);return i.createElement("div",{className:h,style:t},i.createElement("svg",{className:"Spinner__svg",width:o,height:o,viewBox:`0 0 ${o} ${o}`,xmlns:"http://www.w3.org/2000/svg"},i.createElement("g",{style:{width:o,height:o,transformOrigin:.5*o+"px "+.5*o+"px"}},i.createElement("style",{dangerouslySetInnerHTML:{__html:d}}),i.createElement("circle",{className:"Spinner__path",fill:"none",stroke:r,strokeDasharray:p,strokeDashoffset:p,strokeWidth:a,style:{animationName:"dash"+l,animationTimingFunction:"ease-in-out",animationDuration:s+"s",animationIterationCount:"infinite"},cx:.5*o,cy:.5*o,r:.5*o-.5*a}))))}}o.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,i,n,o,s,a){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,i,n,o,s,a],p=0;(c=new Error(t.replace(/%s/g,function(){return l[p++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},RJZa:function(e,t,r){"use strict";r.r(t),r.d(t,"confirm",function(){return a}),r.d(t,"cls",function(){return c}),r.d(t,"lockBoxButton",function(){return l}),r.d(t,"hideBox",function(){return p}),r.d(t,"showErrorBox",function(){return d}),r.d(t,"ajax",function(){return h}),r.d(t,"getValues",function(){return u}),r.d(t,"deepClone",function(){return _}),r.d(t,"photoObjToSrc",function(){return f});r("VRzm"),r("Btvt");var i=r("EasH"),n=r("pemR"),o=r("6krn"),s=r("t7n3");function a(e,t){return new Promise((r,n)=>{var s={title:e,onHide:n};return new i.MessageBox(s).content(t).setButtons(Object(o.getLang)("global_yes"),r,Object(o.getLang)("global_cancel"),n).show()})}function c(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return t=t||"",i=i.map(t=>isString(t)&&"_"===t.slice(0,1)?e+t:t),Object(n.classNames)(e+t,...i)}function l(){var e=curBox();if(e){var t=e.btns.ok[0];t&&window.lockButton(t)}}function p(){var e=curBox();e&&e.hide()}function d(e){p(),Object(i.showFastBox)(Object(o.getLang)("global_error"),e)}function h(e,t){return new Promise((r,i)=>{window.ajax.post(e,t,{onDone:function(){r(...arguments)},onFail:function(){return i(...arguments),!0}})})}function u(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function _(e){return Object(s.clone)(e,!0)}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"a",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"b";r=window.isRetina()?i:r;if(!e.sizes2&&!e.sizes)return"";var n=e.sizes2?e.sizes2:e.sizes,o=e.urls2?e.urls2:e.urls;if(!n||!n.length)return"";for(var s=0;s<n.length;s++){if(n[s][0]===r)return t+o[s]}return""}},SLVX:function(e,t,r){"use strict";function i(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",function(){return i})},TBLV:function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var i=r("q1tI"),n=(r("17x9"),r("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var a=e=>{var t=e.className,r=e.children,a=s(e,["className","children"]),c=Object(n.classNames)("Radio",t,{"Radio--disabled":e.disabled});return i.createElement("label",{className:c},i.createElement("input",o({className:"Radio__input Radio__visuallyHidden",type:"radio"},a)),i.createElement("span",{className:"Radio__control"}),Boolean(r)&&i.createElement("span",{className:"Radio__text"},r))};a.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=a},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},UlUB:function(e,t,r){"use strict";function i(e,t){var r,i,n=!1;return function o(){if(n)return r=arguments,void(i=this);e.apply(this,arguments),n=!0,setTimeout(function(){n=!1,r&&(o.apply(i,r),r=i=null)},t)}}r.r(t),r.d(t,"throttle",function(){return i})},WPHA:function(e,t,r){"use strict";r.r(t);r("HEwt"),r("rE2o"),r("ioFf"),r("rGqo");var i=r("D1OX"),n=r("EasH"),o=r("4+be"),s=r("zxIV"),a=r("kcIO"),c=r("FWc3"),l=r("v+DW"),p=r("t7n3"),d=(r("tUrg"),r("qJhe")),h="/apps",u="gifts_get_story_share_data";class _{static share(e,t,r,i){ajax.post(h,{act:u,gift_id:t,sender_id:+i,hash:r,share_type:e},{onDone:e=>{d.StoryPublisher.init({entrypoint:"mini_app",photoUrl:e.image_url,attachment:{type:"url",text:"learn_more",url:e.link},stickers:[{sticker_type:"native",sticker:{action_type:"text",action:{text:e.message,style:"marker",selection_color:"#fff"},transform:{gravity:"center",rotation:0,relation_width:.9,translation_x:0,translation_y:.01}}},{sticker_type:"native",sticker:{action_type:"text",action:{text:e.additional_message,style:"marker",selection_color:"#fff"},transform:{gravity:"center",rotation:0,relation_width:.5,translation_x:0,translation_y:.3}}}]})},onFail:()=>(Object(n.showFastBox)(getLang("global_error"),getLang("global_error")),!0)})}}var f=r("59zB"),m=r("k487"),b=r("Egk5");r.d(t,"default",function(){return v});var g="/apps";class v{static isEnabled(){return!0}constructor(){this.receiverId=0,this.boxWrap=null,this.giftBox=null,this.tooltipHash=""}initGallery(){var e=document.querySelectorAll(".ui_gallery"),t=!0,r=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var a=o.value;new i.UIGallery(a,{scrollY:!1,markOutside:!0})}}catch(e){r=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(r)throw n}}}init(e,t){this.initGallery(),e&&(this.tooltipHash=t,this.showFeatureToolTip())}showTooltip(e){var t=e.dataset.title;Object(c.showTitle)(e,t,[0,8],{center:1,appendEl:document.body})}showSendGiftBox(e,t,r,i){return"button"===e.tagName.toLowerCase()&&this.disableBtn(e),Object(n.showBox)(g,{act:"game_gifts_show_send_box",recipient_id:t,gift_id:r,hash:i},{params:{width:450,onHide:()=>{"button"===e.tagName.toLowerCase()&&this.enableBtn(e)}}}),!1}disableBtn(e){e.classList.add("GameGifts__giftItem--BtnDisabled"),e.disabled=!0}enableBtn(e){e.disabled=!1,e.classList.remove("GameGifts__giftItem--BtnDisabled")}showFriendsDropBox(e,t){var r=document.querySelector(".GameGifts__giftBox--dropBox");new Dropdown(r,e,{big:1,multiselect:!1,width:400,autocomplete:!0,selectedItems:t||void 0,noResult:Object(o.getLang)("apps_game_gifts_box_friends_not_found"),introText:Object(o.getLang)("apps_game_gifts_box_friends_placeholder"),placeholder:Object(o.getLang)("apps_game_gifts_box_friends_placeholder"),withIcons:!0,onChange:e=>{this.giftBox&&(e?this.enableBtn(this.giftBox.btns.ok[0]):this.disableBtn(this.giftBox.btns.ok[0])),this.receiverId=e}})}sendGift(e,t,r,i,s){var a=Object(l.isChecked)("GameGifts__giftBox--nonameInput");Object(n.showBox)(g,{act:"show_order_box",aid:t,hash:r,receiver_id:this.receiverId,item:i,type:"item",gift_hash:s,is_gift:1,is_anonymous_gift:Object(p.intval)(a),gift_id:e},{params:{dark:1,onDestroy:()=>{this.hideSendGiftBox()}},onFail:e=>(Object(n.showFastBox)({title:Object(o.getLang)("global_error")},e),!0)})}removeItemFromWishList(e){var t=Array.from(document.querySelectorAll(".GameGifts__giftItem")).length,r=Object(s.domCA)(e,".GameGifts__giftItem"),i=Object(s.domCA)(e,".GameGifts__gameItem");if(r&&(t--,Object(s.re)(r),i.querySelector(".GameGifts__giftItem")||Object(s.re)(i),!t)){var n=document.querySelector(".wk_wiki_content");Object(s.re)(document.querySelector(".GameGifts__gameItem")),n.insertAdjacentHTML("beforeend",`\n              <div class="GameGiftsLayer__empty">\n                <div class="GameGiftsLayer__emptyMessage">${Object(o.getLang)("apps_game_gifts_empty_wish_list")}</div>\n              </div>\n            `)}}toggleWishList(e,t,r,i,n){Object(b.cancelEvent)(t),this.featureToooltip&&this.hideFeatureTooltip(),window.tooltips&&window.tooltips.hideAll(),e.classList.toggle("GameGifts__giftItemFavorite--isFavorite"),e.classList.contains("GameGifts__giftItemFavorite--isFavorite")?(Object(a.showDoneBox)(Object(o.getLang)("apps_game_gifts_added_to_wish_list"),{timeout:2e3}),e.dataset.title=Object(o.getLang)("apps_game_gifts_favorite_delete")):(e.dataset.title=Object(o.getLang)("apps_game_gifts_favorite_add"),Object(a.showDoneBox)(Object(o.getLang)("apps_game_gifts_removed_from_wish_list"),{timeout:2e3}),n&&this.removeItemFromWishList(e)),ajax.post(g,{act:"gifts_toggle_wish_list",hash:i,gift_id:r})}initSendGiftBox(e,t,r,i,n,s,a){this.boxWrap=document.querySelector(".GameGifts__giftBox--wrap"),this.showFriendsDropBox(s,a),this.giftBox=curBox(),this.giftBox.removeButtons(),this.giftBox.removeButtons(),this.receiverId=a,this.giftBox.addButton(Object(o.getLang)("apps_game_gifts_box_send"),()=>{this.receiverId?this.sendGift(e,t,r,i,n):Object(l.notaBene)(this.boxWrap.querySelector(".selector_input"))}),this.giftBox.addButton(Object(o.getLang)("global_cancel"),null,"no"),this.receiverId||this.disableBtn(this.giftBox.btns.ok[0])}share(e,t,r,i){return _.share(e,t,r,i),!1}hideSendGiftBox(){setTimeout(()=>{this.giftBox&&this.giftBox.hide()},0)}loadMoreUsersWithGift(e,t,r){if(t.data.scrollBottom-200<=0&&!t.loading&&t.hasMore){var i=document.querySelector("#users-with-gift-list");if(!i)return;var n=i.querySelector(".ui_scroll_content");if(!n)return;t.loading=!0,ajax.post("/apps",{act:"gifts_users_with_gift_more",gift_id:e,offset:t.dataOffset,only_friends:Object(p.intval)(r)},{onDone:(e,r,i)=>{t.loading=!1,e&&n.insertAdjacentHTML("beforeend",e),t.dataOffset=i,t.hasMore=r},onFail:()=>{t.loading=!1}})}}hideFeatureTooltip(e){Object(b.cancelEvent)(e),this.featureToooltip&&(this.featureToooltip.hide(),ajax.post("/al_index.php",{act:"hide_feature_tt",type:"games_gifts_favorites",hash:this.tooltipHash}))}showFeatureToolTip(){var e=document.querySelector(".GameGifts__giftItemFavorite ");this.featureToooltip&&this.featureToooltip.destroy(),this.featureToooltip=new m.default(e,{autoShow:!1,content:'<div class="feature_intro_tt_hide" onclick="cur.GameGifts.hideFeatureTooltip(event);"></div>'+Object(o.getLang)("apps_game_gifts_feature_tt"),appendToParent:!0,cls:"feature_intro_tt GamesGiftsFeatureTooltip",offset:[1,-4],onHide:()=>{e.classList.remove("GameGifts__giftItemFavorite--focused"),this.featureToooltip&&this.featureToooltip.destroy()},onShow:()=>{e.classList.add("GameGifts__giftItemFavorite--focused"),ajax.post("/al_index.php",{act:"show_feature_tt",type:"games_gifts_favorites",hash:this.tooltipHash})}}),setTimeout(()=>{this.featureToooltip.show()},500)}showUsersWithGiftBox(e,t){return!Object(n.showBox)("/apps",{act:"gifts_users_with_gift_box",gift_id:e,only_friends:Object(p.intval)(t)},{params:{width:500},containerClass:"GamesFriendsWithGiftBox",cache:1,onDone:(r,i)=>{var n={};i.has_more&&(n.onupdate=r=>{this.loadMoreUsersWithGift(e,r,t)});var o=new f.default("users-with-gift-list",n);o.dataOffset=i.new_offset,o.hasMore=i.has_more}})}}},WfVW:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry"),o=i(r("JHWP")),s=i(r("D2Nl"));function a(e,t){return e instanceof Element?Promise.resolve(e).then(function(e){return function(e,t){var r=e.style.getPropertyValue("background");return r?Promise.resolve(r).then(function(e){return s.default(e,null,t)}).then(function(t){return e.style.setProperty("background",t,e.style.getPropertyPriority("background")),e}):Promise.resolve(e)}(e,t)}).then(function(e){return function(e,t){return e instanceof HTMLImageElement&&!n.isDataUrl(e.src)?Promise.resolve(e.src).then(function(e){return o.default(e,t)}).then(function(t){return n.toDataURL(t,n.getMimeType(e.src))}).then(function(t){return new Promise(function(r,i){e.onload=r,e.onerror=i,e.src=t})}).then(function(){return e},function(){return e}):Promise.resolve(e)}(e,t)}).then(function(e){return function(e,t){var r=n.toArray(e.childNodes).map(function(e){return a(e,t)});return Promise.all(r).then(function(){return e})}(e,t)}):Promise.resolve(e)}t.default=a},XpgC:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return p});r("91GP");var i=r("q1tI"),n=r("i8i4"),o=(r("17x9"),r("pemR")),s=r("clTp");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var c=()=>"undefined"!=typeof window,l=e=>{var t=e.position,r=e.align,i=e.text,n=e.rect,o=e.marginTop,s=e.marginLeft,a=e.maxWidth,c=e.appearance,l=n.left,p=n.top;switch(t){case"t":l+=.5*n.width;break;case"r":l+=n.width,p+=.5*n.height;break;case"b":l+=.5*n.width,p+=n.height;break;case"l":p+=.5*n.height}return{tooltip:{position:t,align:r,text:i,x:l=Math.round(l+s),y:p=Math.round(p+o),maxWidth:a,appearance:c}}};class p extends i.Component{constructor(e){super(e),this.onMouseEnter=e=>{if(this.state.el){var t=this.props,r=t.text,i=t.position,n=t.align,o=t.marginTop,a=t.marginLeft,c=t.maxWidth,l=t.appearance,p=Object(s.default)(this.state.el);this.update({text:r,position:i,align:n,rect:p,marginTop:o,marginLeft:a,maxWidth:c,appearance:l})}},this.onMouseLeave=e=>this.update(),this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.tooltip&&this.setState({tooltip:void 0})},this.renderTooltip=()=>{if(!this.state.tooltip)return null;var e=this.state.tooltip,t=e.x,r=e.y,n=e.position,s=e.align,a=e.text,c=e.removed,l=e.maxWidth,p=e.appearance,d=Object(o.classNames)("Tooltip",`Tooltip--${n}`,`Tooltip--${p}`,{"Tooltip--removed":!!c,[`Tooltip--align-${s}`]:"t"===n||"b"===n});return i.createElement("div",{className:d,style:{top:r,left:t},onTransitionEnd:this.onTransitionEnd},i.createElement("div",{className:"Tooltip__in",style:{maxWidth:l},dangerouslySetInnerHTML:{__html:a}}))},this.state={}}componentDidMount(){var e=n.findDOMNode(this);this.setState({el:e}),e.addEventListener("mouseenter",this.onMouseEnter),e.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.state.el.removeEventListener("mouseenter",this.onMouseEnter),this.state.el.removeEventListener("mouseleave",this.onMouseLeave)}static getDerivedStateFromProps(e,t){return t.tooltip&&["text","position","align","maxWidth","appearance"].some(r=>e[r]!==t.tooltip[r])?l(a({},e,{rect:Object(s.default)(t.el)})):null}update(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(l(e))}render(){var e=this.renderTooltip();return e?(!this.defaultNode&&c()&&(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),i.createElement(i.Fragment,null,this.props.children,n.createPortal(e,this.defaultNode))):this.props.children}}p.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"}},Ya8i:function(e,t,r){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry"),o=i(r("D2Nl"));function s(e){if(void 0===e)return[];var t=e,r=[],i=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi");t=t.replace(i,"");for(var n,o=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(n=o.exec(t));)r.push(n[0]);t=t.replace(o,"");for(var s=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");null!==(n=s.exec(t));)r.push(n[0]);return r}function a(e,t){return fetch(e).then(function(t){return{url:e,cssText:t.text()}},function(e){console.log("ERROR FETCHING CSS: ",e.toString())})}function c(e){return e.cssText.then(function(t){var r=t,i=(r.match(/url\([^)]+\)/g)||[]).map(function(t){var i=t.replace(/url\(([^]+)\)/g,"$1");if(!i.startsWith("https://")){var n=e.url;i=new URL(i,n).href}return new Promise(function(e,n){fetch(i).then(function(e){return e.blob()}).then(function(i){var n=new FileReader;n.addEventListener("load",function(i){r=r.replace(t,"url("+n.result+")"),e([t,n.result])}),n.readAsDataURL(i)}).catch(n)})});return Promise.all(i).then(function(){return r})})}function l(e){var t=[],r=[];return e.forEach(function(t){if("cssRules"in t)try{n.toArray(t.cssRules).forEach(function(e){e.type===CSSRule.IMPORT_RULE&&r.push(a(e.href).then(c).then(function(e){s(e).forEach(function(e){t.insertRule(e,t.cssRules.length)})}).catch(function(e){console.log("Error loading remote css",e.toString())}))})}catch(n){var i=e.find(function(e){return null===e.href})||document.styleSheets[0];null!=t.href&&r.push(a(t.href).then(c).then(function(e){s(e).forEach(function(e){i.insertRule(e,t.cssRules.length)})}).catch(function(e){console.log("Error loading remote stylesheet",e.toString())})),console.log("Error inlining remote css file",n.toString())}}),Promise.all(r).then(function(){return e.forEach(function(e){if("cssRules"in e)try{n.toArray(e.cssRules).forEach(function(e){t.push(e)})}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),t})}function p(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return o.shouldEmbed(e.style.getPropertyValue("src"))})}function d(e){return new Promise(function(t,r){e.ownerDocument||r(new Error("Provided element is not within a Document")),t(n.toArray(e.ownerDocument.styleSheets))}).then(l).then(p)}t.parseWebFontRules=d,t.default=function(e,t){return d(e).then(function(e){return Promise.all(e.map(function(e){var r=e.parentStyleSheet?e.parentStyleSheet.href:null;return o.default(e.cssText,r,t)}))}).then(function(e){return e.join("\n")}).then(function(t){var r=document.createElement("style"),i=document.createTextNode(t);return r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})}},bCCX:function(e,t,r){"use strict";r.r(t),function(e,i){var n,o=r("SLVX");n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:i;var s=Object(o.default)(n);t.default=s}.call(this,r("yLpj"),r("3UD+")(e))},clTp:function(e,t,r){"use strict";function i(e){var t=e.getBoundingClientRect(),r=document.body,i=document.documentElement,n=window.pageYOffset||i.scrollTop||r.scrollTop,o=window.pageXOffset||i.scrollLeft||r.scrollLeft,s=i.clientTop||r.clientTop||0,a=i.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+n-s),left:Math.round(t.left+o-a),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",function(){return i})},eiY0:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return o});var i=r("UlUB"),n=e=>{var t,r=window.document.querySelector("#apps"),i=window.document.querySelector(".head_nav_item"),n=i?i.getBoundingClientRect().left:0;r&&(r.style.height=window.innerHeight-98+"px"),t=n<0?i.offsetLeft:n,t+=45,e&&(e.style.left=t+"px")};class o{static init(){var e=window.document.querySelector(".WideScreenAppBack"),t=window.document.querySelector("#page_body"),r=1030;if(window.document.body&&t&&t.style&&t.style.width){var o=parseInt(t.style.width)+195;o>r&&(r=o),document.body.style.minWidth=r+"px"}var s=Object(i.throttle)(()=>{n(e)},100);window.addEventListener("resize",s),n(e),e.classList.remove("hidden"),window.cur&&window.cur.destroy&&window.cur.destroy.push(()=>{window.removeEventListener("resize",s)})}static deferredInit(){document.addEventListener("DOMContentLoaded",o.init),window.cur&&window.cur.destroy&&window.cur.destroy.push(()=>{document.removeEventListener("DOMContentLoaded",o.init)})}}},gF8j:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return s}),r.d(t,"getVisibilityState",function(){return l}),r.d(t,"getVisiblityEvent",function(){return p});var i=r("uQjJ"),n=r("JuPy"),o=browser.iphone||browser.ipad||browser.ipod;function s(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function a(e,t,r){Object(n.isMvk)()?window.addEvent(e,t,r,{passive:!0}):window.addEvent(e,t,r)}function c(e,t,r){Object(n.isMvk)()?window.removeEvent(e,t,r,{passive:!0}):window.removeEvent(e,t,r)}function l(){return document.visibilityState||document.webkitVisibilityState}function p(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(s.prototype,i.default.prototype),extend(s.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(n.isMvk)()&&this._isTopLevel()&&p()&&c(document,p(),this.onVisiblityChange),Object(n.isMvk)()&&o||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(n.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(n.isMvk)()&&this._isTopLevel()&&p()&&a(document,p(),this.onVisiblityChange),Object(n.isMvk)()&&o||(a(this.opts.focusElement,"focus",this.cbActiveB),a(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(a(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),a(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===l()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=l();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},jYEY:function(e,t,r){var i;!function(n){"use strict";function o(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e,t,r,i,n,s){return o((a=o(o(t,e),o(i,s)))<<(c=n)|a>>>32-c,r);var a,c}function a(e,t,r,i,n,o,a){return s(t&r|~t&i,e,t,n,o,a)}function c(e,t,r,i,n,o,a){return s(t&i|r&~i,e,t,n,o,a)}function l(e,t,r,i,n,o,a){return s(t^r^i,e,t,n,o,a)}function p(e,t,r,i,n,o,a){return s(r^(t|~i),e,t,n,o,a)}function d(e,t){var r,i,n,s,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,u=-271733879,_=-1732584194,f=271733878;for(r=0;r<e.length;r+=16)i=h,n=u,s=_,d=f,h=a(h,u,_,f,e[r],7,-680876936),f=a(f,h,u,_,e[r+1],12,-389564586),_=a(_,f,h,u,e[r+2],17,606105819),u=a(u,_,f,h,e[r+3],22,-1044525330),h=a(h,u,_,f,e[r+4],7,-176418897),f=a(f,h,u,_,e[r+5],12,1200080426),_=a(_,f,h,u,e[r+6],17,-1473231341),u=a(u,_,f,h,e[r+7],22,-45705983),h=a(h,u,_,f,e[r+8],7,1770035416),f=a(f,h,u,_,e[r+9],12,-1958414417),_=a(_,f,h,u,e[r+10],17,-42063),u=a(u,_,f,h,e[r+11],22,-1990404162),h=a(h,u,_,f,e[r+12],7,1804603682),f=a(f,h,u,_,e[r+13],12,-40341101),_=a(_,f,h,u,e[r+14],17,-1502002290),h=c(h,u=a(u,_,f,h,e[r+15],22,1236535329),_,f,e[r+1],5,-165796510),f=c(f,h,u,_,e[r+6],9,-1069501632),_=c(_,f,h,u,e[r+11],14,643717713),u=c(u,_,f,h,e[r],20,-373897302),h=c(h,u,_,f,e[r+5],5,-701558691),f=c(f,h,u,_,e[r+10],9,38016083),_=c(_,f,h,u,e[r+15],14,-660478335),u=c(u,_,f,h,e[r+4],20,-405537848),h=c(h,u,_,f,e[r+9],5,568446438),f=c(f,h,u,_,e[r+14],9,-1019803690),_=c(_,f,h,u,e[r+3],14,-187363961),u=c(u,_,f,h,e[r+8],20,1163531501),h=c(h,u,_,f,e[r+13],5,-1444681467),f=c(f,h,u,_,e[r+2],9,-51403784),_=c(_,f,h,u,e[r+7],14,1735328473),h=l(h,u=c(u,_,f,h,e[r+12],20,-1926607734),_,f,e[r+5],4,-378558),f=l(f,h,u,_,e[r+8],11,-2022574463),_=l(_,f,h,u,e[r+11],16,1839030562),u=l(u,_,f,h,e[r+14],23,-35309556),h=l(h,u,_,f,e[r+1],4,-1530992060),f=l(f,h,u,_,e[r+4],11,1272893353),_=l(_,f,h,u,e[r+7],16,-155497632),u=l(u,_,f,h,e[r+10],23,-1094730640),h=l(h,u,_,f,e[r+13],4,681279174),f=l(f,h,u,_,e[r],11,-358537222),_=l(_,f,h,u,e[r+3],16,-722521979),u=l(u,_,f,h,e[r+6],23,76029189),h=l(h,u,_,f,e[r+9],4,-640364487),f=l(f,h,u,_,e[r+12],11,-421815835),_=l(_,f,h,u,e[r+15],16,530742520),h=p(h,u=l(u,_,f,h,e[r+2],23,-995338651),_,f,e[r],6,-198630844),f=p(f,h,u,_,e[r+7],10,1126891415),_=p(_,f,h,u,e[r+14],15,-1416354905),u=p(u,_,f,h,e[r+5],21,-57434055),h=p(h,u,_,f,e[r+12],6,1700485571),f=p(f,h,u,_,e[r+3],10,-1894986606),_=p(_,f,h,u,e[r+10],15,-1051523),u=p(u,_,f,h,e[r+1],21,-2054922799),h=p(h,u,_,f,e[r+8],6,1873313359),f=p(f,h,u,_,e[r+15],10,-30611744),_=p(_,f,h,u,e[r+6],15,-1560198380),u=p(u,_,f,h,e[r+13],21,1309151649),h=p(h,u,_,f,e[r+4],6,-145523070),f=p(f,h,u,_,e[r+11],10,-1120210379),_=p(_,f,h,u,e[r+2],15,718787259),u=p(u,_,f,h,e[r+9],21,-343485551),h=o(h,i),u=o(u,n),_=o(_,s),f=o(f,d);return[h,u,_,f]}function h(e){var t,r="",i=32*e.length;for(t=0;t<i;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function u(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function _(e){var t,r,i="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),i+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return i}function f(e){return unescape(encodeURIComponent(e))}function m(e){return function(e){return h(d(u(e),8*e.length))}(f(e))}function b(e,t){return function(e,t){var r,i,n=u(e),o=[],s=[];for(o[15]=s[15]=void 0,n.length>16&&(n=d(n,8*e.length)),r=0;r<16;r+=1)o[r]=909522486^n[r],s[r]=1549556828^n[r];return i=d(o.concat(u(t)),512+8*t.length),h(d(s.concat(i),640))}(f(e),f(t))}function g(e,t,r){return t?r?b(t,e):_(b(t,e)):r?m(e):_(m(e))}void 0===(i=function(){return g}.call(t,r,t,e))||(e.exports=i)}()},lMzL:function(e,t,r){"use strict";r.r(t);r("91GP"),r("rGqo"),r("Btvt"),r("pIFo"),r("OG14"),r("SRfc");var i=r("4zn2"),n=e=>{var t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},o=e=>{if(cur.vkAppQueue){var t=Object.keys(cur.vkAppQueue).filter(t=>~t.indexOf(e));if(t.length>0){var r=t[0];cur.vkAppQueue[r].destroyView(),delete cur.vkAppQueue[r]}}},s=e=>i.VKPAY_APPS.includes(e);r("KKXr");var a=new class{constructor(){this.checkStack=()=>{cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}push(e){e.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&e.show(),cur.vkMiniAppsStack.push(e)}clearLayerPopups(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter(e=>!~e.appNode.id.indexOf("container_layer")))}pop(e){var t=cur.vkMiniAppsStack.indexOf(e);~t&&(cur.vkMiniAppsStack.splice(t,1),this.checkForNext())}checkForNext(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()}};var c=class{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.ERROR_TYPES.CLIENT;this.data=t||{},this.method=e,this.type=r}_errorStrucuture(e,t){var r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===i.ERROR_TYPES.API?r.data.error_data.error_msg=t:r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),r}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this._errorStrucuture(i.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error");switch(this.data.code){case i.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(i.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case i.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(i.ERROR_CODES.CONNECTION_LOST,this.data.reason||"Connection lost");case i.ERROR_CODES.USER_DENIED:return this._errorStrucuture(i.ERROR_CODES.USER_DENIED,this.data.reason||"User denied");case i.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(i.ERROR_CODES.INVALID_PARAMS,this.data.reason||"Invalid params");case i.ERROR_CODES.CUSTOM:return this._errorStrucuture(i.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);default:return this._errorStrucuture(this.data.code?this.data.code:i.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error")}}},l=r("JuPy");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var d=class{constructor(e,t){this.props=p({},e),t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.renderModal(),this._destroyed=!1}init(){this.appNode&&this.appNode.appendChild(this.modal)}show(){Object(l.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout(()=>this.modal.classList.add("show"),300),this.initMvkCloseActions()}initMvkCloseActions(){if(Object(l.isMvk)()){if(!window.DirectGames||!cur.app.isDirectGame)return;window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=e=>{e.target===this.modal&&this.onAction(this.props.cancelAction)})}}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){this._destroyed||(Object(l.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)}onAction(e){e(),this.destroy()}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),e.disabled&&(t.disabled=e.disabled),t.innerText=e.title,t.addEventListener("click",()=>this.onAction(e.action)),t}_renderBtns(e){var t=e.getElementsByClassName("vk_app_modal_btns")[0];t&&(this.props.buttons.map(e=>{t.appendChild(this._renderBtn(e))}),1===this.props.buttons.length&&t.classList.add("vk_app_modal_btns--single-btn"))}_renderCloseBtn(e){var t=document.createElement("button");t.setAttribute("type","button"),t.classList.add("vk_app_modal_close_btn"),t.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',t.addEventListener("click",()=>this.onAction(this.props.cancelAction)),e.children[0].appendChild(t)}_renderOuter(){var e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction})}_renderScopes(e){return e.map((e,t)=>0===t?getLang(`vkapps_scope_${e}`):getLang(`vkapps_scope_${e}`).toLowerCase()).join(", ")}prepareScopes(e){return 0===e.length?["general"]:e}prepareExtraBtn(){var e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e}renderModal(){var e=this.props.picClass?this.props.picClass:"",t=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.props.svgIcon?this.props.svgIcon:`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${e}" alt aria-label="product">`}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this.props.text?`<p class="vk_app_modal_container__text">${this.props.text}</p>`:""}\n      `;this.props.scopes&&(t+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),t+='\n          </div>\n          <div class="vk_app_modal_btns"></div>\n      </div>',this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=t,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this.props.scopes&&this.props.scopes.length&&this.props.extraAction&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal)}},h=r("jE6c");function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var _=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.params=u({handlerName:"handler",method:"method"},e),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}get successDescriptor(){return`${this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.handlerName}Failed`}getEventHash(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}_hash`]}getEventName(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}checkParams(e,t){for(var r=0;r<t.length;r++){var n=t[r],o=n.param,s=n.type,a=n.isRequired,c=n.extraChecks;if(!e.hasOwnProperty(o)&&a)return this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${o}"`}),!1;if(e.hasOwnProperty(o)&&typeof e[o]!==s)return this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "${o}" should be ${s}`},this.callback),!1;if(e.hasOwnProperty(o)&&c&&c.length>0)for(var l=0;l<c.length;l++)if(!c[l].check(e[o]))return this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:c[l].error(o)},this.callback),!1}return!0}actionHandler(e){return this.callApi?ajax.post("apps.php",u({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(){this.errorHandler({error_type:"client_error",code:i.ERROR_CODES.USER_DENIED},null),a.pop(this.modal)}allowUIAction(e){this.actionHandler(e),a.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new d(u({},this.params.modal,e)),a.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons&&this.params.modal.buttons.forEach((e,t)=>{"deny"===e.type?this.params.modal.buttons[t].action=this.params.modal.cancelAction:this.params.modal.buttons[t].action=this.params.modal.allowAction})}setData(e,t){e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t}handleResponse(e,t,r,i){try{var n=JSON.parse(e);n.hasOwnProperty("error")?this.errorHandler(n.error):r(n,t)}catch(e){i?i(e):this.errorHandler(e)}}handler(e,t,r){this.setData(e,t),this.callback=r,this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}successHandler(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t&&t(),Object(h.isObject)(e)||(e={result:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:e},this.params.handlerName),Object(l.isMvk)()&&cur.app.frame.focus()}errorHandler(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&(e.request_id=this.params.request_id);var i=new c(this.errorDescriptor,e,r);t&&t(),this.callback(i.selectErrorType()),Object(l.isMvk)()&&cur.app.frame.focus()}};var f=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppInit"}handler(e,t,r){this.setData(e,t),this.callback=r,this.successHandler({result:!0})}};r("HEwt");function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var b=class{constructor(e,t){this.props=m({},e),t&&(this.callback=t),this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}show(){setTimeout(()=>this.modal.classList.add("show"),300)}destroy(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()}onAction(e){this.props.allowUIAction({scope:e,app_id:this.props.app_id}),this.destroy()}onCancelAction(e){e&&e(),this.destroy()}onAllow(){var e=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map(t=>{var r=parseInt(t.id.replace("scope_",""),10);if(!this.props.scopes[r])throw new Error("There is no such scope");e.push(this.props.scopes[r])}),this.onAction(e.join(","))}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),t.innerText=e.title,"success"===e.type?t.addEventListener("click",()=>this.onAllow()):t.addEventListener("click",()=>this.onCancelAction(e.action)),t}_renderBtns(e){this.props.buttons.map(t=>{e.getElementsByClassName("vk_app_modal_btns")[0].appendChild(this._renderBtn(t))})}_renderCloseBtn(e){var t=document.createElement("div");t.setAttribute("aria-label","Close"),t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.classList.add("box_x_button"),t.addEventListener("click",()=>this.onCancelAction(this.props.cancelAction)),e.querySelector(".box_title_wrap").appendChild(t)}_renderOuter(){return document.querySelector(".vk_app_modal_outer")}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction})}_renderScopes(e){return e.map((e,t)=>`\n    <div class="scope_row">\n      <input class="blind_label" type="checkbox" id="scope_${t}" checked="">\n      <label for="scope_${t}">${getLang(`vkapps_scope_${e}`)}</label>\n    </div>\n    `).join("\n")}renderModal(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=`\n  <div class="box_layout vk_app_modal_container">\n    <div class="box_title_wrap">\n       <div class="box_title">${this.props.title}</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      ${this.props.text?`<p>${this.props.text}</p>`:""}\n      ${this.props.scopes&&`<div class="vk_app_modal_scopes">${this._renderScopes(this.props.scopes)}</div>`}\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n`,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal)}};function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var v=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter(e=>this.app.params.group_whitelist_scopes.includes(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.group_whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new d(g({},this.params.modal,e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new b(g({},this.params.modal,e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),a.push(this.modal)}takeAction(e){ajax.post("apps.php",g({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,e),{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:e=>(this.errorHandler(e),!0)})}checkToken(e){e.access_token?this.successHandler({access_token:e.access_token}):this.errorHandler({reason:"Invalid params"})}loadIntroData(e){this.request=g({},e),ajax.post("apps.php",g({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),a.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=`${this.params.modal.title} ${e.group.name}`),this.launchUI(g({},t,{scopes:this.scopeStringToArray(t.scope)}))}}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"!=typeof e.app_id||e.app_id<0)this.errorHandler({code:2,reason:'Param "app_id" should be a positive number'},r);else if(e.app_id===parseInt(this.app.appId,10))if(e.group_id)if("number"!=typeof e.group_id||e.group_id<0)this.errorHandler({code:2,reason:'Param "group_id" should be a positive number'},r);else{var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:"Unknown error"},r)}else this.errorHandler({code:2,reason:'Missing required param "group_id"'},r);else this.errorHandler({code:2,reason:'Wrong param "app_id"'},r);else this.errorHandler({code:2,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:2,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:2,reason:'Missing required param "scope"'},r)}actionHandler(e){this.loadIntroData(e)}};function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var E=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter(e=>this.app.params.group_whitelist_scopes.includes(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.group_whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new d(w({},this.params.modal,e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new b(w({},this.params.modal,e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),a.push(this.modal)}takeAction(e){ajax.post("apps.php",w({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,e),{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:e=>{this.errorHandler(e)}})}checkToken(e){e.access_token?this.successHandler({access_token:e.access_token}):this.errorHandler({reason:"Invalid params"})}loadIntroData(e){this.request=w({},e),ajax.post("apps.php",w({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),a.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=`${this.params.modal.title} ${e.group.name}`),this.launchUI(w({},t,{scopes:this.scopeStringToArray(t.scope)}))}}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"scope",type:"string",isRequired:!0},{param:"app_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]},{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:"Unknown error"},r)}}actionHandler(e){this.loadIntroData(e)}};function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var O=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppAddToCommunity",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community"),text:getLang("apps_connect_modal_messages_request_add_to_community_text")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.addToCommunitySuccessHandler=this.addToCommunitySuccessHandler.bind(this),this.addToCommunityErrorHandler=this.addToCommunityErrorHandler.bind(this),this.unsetCurHandlers=this.unsetCurHandlers.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.checkAppAdd=this.checkAppAdd.bind(this)}takeAction(){ajax.post("apps.php",y({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:e=>{this.handleResponse(e,{},this.checkAppAdd)},onFail:e=>(this.errorHandler(e),!0)})}checkAppAdd(e){parseInt(e,10)&&this.successHandler({result:!0})}loadIntroData(e){this.request=y({},e);var t=Object(l.isMvk)()?y({act:"vkapps_add_to_community_box",hash:cur.app.options.hash,app_id:this.app.appId},this.request):y({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request);Object(l.isMvk)()?window.ajax.post("apps.php",t,{onDone:(e,t)=>{cur.app.showAppsBox(e,t)},onFail:e=>(this.errorHandler(e),!0)}):ajax.post("apps.php",t,{onDone:e=>{this.handleResponse(e,{},this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.loadIntroData(e),a.pop(this.modal)}checkIntroData(e){e.items.length>0?showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId},{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"},onFail:function(e){return window.showFastBox(getLang("global_error"),e),!0}}):0===e.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new MessageBox({title:getLang("global_error"),dark:1}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),()=>{this.noCommunitiesBox.hide()}).show())}unsetCurHandlers(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null,Object(l.isMvk)()&&VKApps.cancelSettings()}addToCommunitySuccessHandler(e){this.successHandler(e),this.unsetCurHandlers()}addToCommunityErrorHandler(e){this.errorHandler(e||{code:4}),this.unsetCurHandlers()}handler(e,t,r){this.setData(e,t),this.callback=r,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,this.launchUI(e)}actionHandler(e){this.loadIntroData(e)}};var C=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetUserInfo",this.callApi=!0,this.useUI=!1}},S={ADD_TO_COMMUNITY:"VKWebAppAddToCommunity",ADD_TO_COMMUNITY_PRELOAD:"VKWebAppAddToCommunityPreload",ADD_TO_FAVORITES:"VKWebAppAddToFavorites",ALLOW_MESSAGES_FROM_GROUP:"VKWebAppAllowMessagesFromGroup",ALLOW_MESSAGES_FROM_GROUP_PRELOAD:"VKWebAppAllowMessagesFromGroupPreload",ALLOW_NOTIFICATIONS:"VKWebAppAllowNotifications",ALLOW_NOTIFICATIONS_PRELOAD:"VKWebAppAllowNotificationsPreload",CALL_API_METHOD:"VKWebAppCallAPIMethod",CLOSE:"VKWebAppClose",DENY_NOTIFICATIONS:"VKWebAppDenyNotifications",FLASH_GET_INFO:"VKWebAppFlashGetInfo",FLASH_SET_LEVEL:"VKWebAppFlashSetLevel",GET_AUTH_TOKEN:"VKWebAppGetAuthToken",GET_AUTH_TOKEN_PRELOAD:"VKWebAppGetAuthTokenPreload",GET_CLIENT_VERSION:"VKWebAppGetClientVersion",GET_COMMUNITY_AUTH_TOKEN:"VKWebAppGetCommunityAuthToken",GET_COMMUNITY_TOKEN:"VKWebAppGetCommunityToken",GET_COMMUNITY_AUTH_TOKEN_PRELOAD:"VKWebAppGetCommunityAuthTokenPreload",GET_EMAIL_PRELOAD:"VKWebAppGetEmailPreload",GET_EMAIL:"VKWebAppGetEmail",GET_FRIENDS:"VKWebAppGetFriends",GET_GEODATA:"VKWebAppGetGeodata",GET_PERSONAL_CARD:"VKWebAppGetPersonalCard",GET_PHONE_NUMBER_PRELOAD:"VKWebAppGetPhoneNumberPreload",GET_PHONE_NUMBER:"VKWebAppGetPhoneNumber",GET_USER_INFO:"VKWebAppGetUserInfo",INIT:"VKWebAppInit",JOIN_GROUP:"VKWebAppJoinGroup",JOIN_GROUP_PRELOAD:"VKWebAppJoinGroupPreload",LOCATION_CHANGED:"VKWebAppLocationChanged",OPEN_APP:"VKWebAppOpenApp",OPEN_CONTACTS:"VKWebAppOpenContacts",OPEN_IN_NATIVE_APP:"VKWebAppOpenInNativeApp",OPEN_PAY_FORM:"VKWebAppOpenPayForm",OPEN:"VKWebAppOpenQR",REDIRECT:"VKWebAppRedirect",RESIZE_WINDOW:"VKWebAppResizeWindow",SCROLL:"VKWebAppScroll",SEND_PAYLOAD:"VKWebAppSendPayload",SETTINGS:"VKWebAppSettings",SET_LOCATION:"VKWebAppSetLocation",SET_TITLE:"VKWebAppSetTitle",SET_VIEW_SETTINGS:"VKWebAppSetViewSettings",SHARE:"VKWebAppShare",SHOW_IMAGES:"VKWebAppShowImages",SHOW_INVITE_BOX:"VKWebAppShowInviteBox",SHOW_LEADER_BOARD_BOX:"VKWebAppShowLeaderBoardBox",SHOW_ORDER_BOX:"VKWebAppShowOrderBox",SHOW_REQUEST_BOX:"VKWebAppShowRequestBox",SHOW_WALL_POST_BOX:"VKWebAppShowWallPostBox",TAPTIC_IMPACT_OCCURRED:"VKWebAppTapticImpactOccurred",TAPTIC_NOTIFICATION_OCCURRED:"VKWebAppTapticNotificationOccurred",TAPTIC_SELECTION_CHANGED:"VKWebAppTapticSelectionChanged",UPDATE_CONFIG:"VKWebAppUpdateConfig",VIEW_UPDATE_NAVIGATION_STATE:"VKWebAppViewUpdateNavigationState",OPEN_ARTICLE_EDIT:"VKWebAppOpenArticleEditor",OPEN_ARTICLE:"VKWebAppOpenArticle"};var A=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppSetLocation"}actionHandler(e){e.hasOwnProperty("location")?"string"==typeof e.location?(Object(l.isMvk)()?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+e.location,path:location.pathname,hash:"#"+e.location}}):cur.app.funcs.setLocation(e.location),je({handler:S.LOCATION_CHANGED,params:{location:e.location}},this.app),this.successHandler({})):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "location" should be a string'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "location"'})}};var P=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetClientVersion"}actionHandler(e){var t=i.PLATFORM.WEB;Object(l.isMvk)()&&(t=i.PLATFORM.MOBILE_WEB),this.successHandler({platform:t,version:"0.0"},this.callback)}};function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var T=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetPhoneNumber",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=k({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("phone_number")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()}};function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var D=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetEmail",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=M({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("email")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()}};var R=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppGetGeodata",this.callApi=!0,this.useUI=!1,this.timeoutFails=0,this.geodataSuccess=this.geodataSuccess.bind(this),this.geodataFail=this.geodataFail.bind(this)}get successDescriptor(){return"VKWebAppGeodataResult"}get errorDescriptor(){return"VKWebAppGeodataFailed"}geodataSuccess(e){var t=e.coords.longitude,r=e.coords.latitude;this.successHandler({available:!0,lat:r,long:t},this.callback)}geodataFail(e){switch(e.code){case 3:this.timeoutFails++,this.timeoutFails<2?navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail):this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Geolocation timeout error"},this.callback);break;case 2:this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Device can't get geodata"},this.callback);break;case 1:this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User didn't allowed"},this.callback)}}actionHandler(e){if(!this.callApi)return{};navigator.geolocation.getCurrentPosition(e=>this.geodataSuccess(e),e=>this.geodataFail(e),{maximumAge:15e5,timeout:2e3})}};var I=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppOpenQR"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}};var L=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppSetViewSettings"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}};var x=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppSetTitle"}handler(e,t){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},t)}};function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var N=class extends _{constructor(e){super(e);var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token"):getLang("apps_connect_modal_messages_request_token_var");this.params.handlerName="VKWebAppGetAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.callApi=!0,this.useUI=!0,this.onEditClick=this.onEditClick.bind(this)}get successDescriptor(){return"VKWebAppAccessTokenReceived"}get errorDescriptor(){return"VKWebAppAccessTokenFailed"}scopeList(e){var t=this.app.params.whitelist_scopes?e.filter(e=>~this.app.params.whitelist_scopes.indexOf(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new d(B({},this.params.modal,e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick}));var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token_available_title"):getLang("apps_connect_modal_messages_scopes_available");this.editScopesModal=new b(B({},this.params.modal,e,{text:t,scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),a.push(this.modal)}actionHandler(e){return this.callApi?ajax.post("apps.php",B({act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);r.status?this.successHandler(B({},r,{scope:e.scope})):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):{}}loadIntroData(e){this.request=B({},e),this.app.appId==e.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId,scope:e.scope},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){console.log(e),this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Wrong app id"})}checkIntroData(e,t){if(e.status){var r={};e.access_token&&(r.access_token=e.access_token),r.scope=this.params.scope.join(","),this.successHandler(r)}else this.launchUI(t)}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"==typeof e.app_id){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:"Unknown error"},r)}else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "app_id" should be a number'},r);else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "scope"'},r)}};function j(){return(j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var W=function(e,t,r,n){if(t||(t={}),delete t.callback,e)if(t.hasOwnProperty("access_token")){Object.keys(t).forEach(e=>{"object"==typeof t[e]&&(t[e]=JSON.stringify(t[e]))});var o=(e=>Object.keys(e).reduce((t,r,i)=>[t,0===i?"?":"&",encodeURIComponent(r),"=",encodeURIComponent(e[r])].join(""),""))(j({api_id:cur.app.params.api_id,method:e,format:"json",v:i.API_VERSION},t)),s=new XMLHttpRequest;s.open("POST",`https://${cur.app.options.vk_app_api_url}/method/${e}${o}`),s.onload=()=>{if(200==s.status)try{var e=JSON.parse(s.response);t.request_id&&(e.request_id=t.request_id),e.hasOwnProperty("error")?n({reason:e.error}):r(e)}catch(e){n({code:1,reason:e.message})}else n({reason:s.statusText})},s.send()}else n({code:i.ERROR_CODES.MISSING_PARAM,reason:"Missing required param access_token"});else n({code:i.ERROR_CODES.MISSING_PARAM,reason:"Missing required param method"})};function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var U=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppCallAPIMethod",this.params.v="5.85",this.params.method=null,this.resolveResponse=this.resolveResponse.bind(this)}actionHandler(e){var t=H({},e.params);e.request_id&&(t.request_id=e.request_id),W(e.method,t,this.successHandler,this.errorHandler)}resolveResponse(e){e&&(e.hasOwnProperty("error")?this.errorHandler(e.error):this.successHandler(e))}handler(e,t,r){this.callback=r,this.setData(e,t),e.params?e.params.v||e.params.version?isNaN(parseInt(e.params.v,10))&&isNaN(parseInt(e.params.version,10))?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "v" should be a number'},r):(e.params.hasOwnProperty("v")?this.params.v=e.params.v:e.params.hasOwnProperty("version")&&(this.params.v=e.params.version),this.actionHandler(e)):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "v"'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:"Missing required params"},r)}};function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var F=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppJoinGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_subscribe"),type:"success"}],text:getLang("apps_connect_modal_messages_join_group_text"),showCloseBtn:!0},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this)}takeAction(){ajax.post("apps.php",K({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:e=>{e.hasOwnProperty("error")?this.errorHandler(e.error):parseInt(e,10)?this.successHandler({result:!0}):this.errorHandler()},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=K({},e),ajax.post("apps.php",K({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(K({isGroupMember:r.is_group_member,canJoin:!r.group.is_closed},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),a.pop(this.modal)}checkIntroData(e,t){e.canJoin?e.isGroupMember?this.successHandler({result:!0}):(this.params.modal.pic=e.photo_100,this.params.modal.app_name=e.name,this.params.modal.subscribers=e.members_count>1e3?Math.ceil(e.members_count/1e3):e.members_count,this.params.modal.title=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new d(K({},this.params.modal)),a.push(this.modal)):this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"User can not join this group"})}handler(e,t,r){this.setData(e,t),this.callback=r,e.group_id?"number"==typeof e.group_id?this.loadIntroData(e):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" is missing'},this.callback)}actionHandler(e){this.loadIntroData(e)}};function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var G=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppAllowMessagesFromGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],text:getLang("apps_connect_modal_messages_allow_messages_text"),title:getLang("apps_connect_modal_messages_allow_messages_title")},this.callApi=!0,this.useUI=!0}takeAction(){var e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",V({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:e=>{e.hasOwnProperty("error")?this.errorHandler(e.error):parseInt(e,10)?this.successHandler({result:!0}):this.errorHandler()},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=V({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,group_id:this.request.group_id},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(V({can_send_messages:r.can_send_messages},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),a.pop(this.modal)}checkIntroData(e,t){e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic=e.photo_100,this.params.modal.app_name=e.name,this.params.modal.subscribers=e.members_count>1e3?Math.ceil(e.members_count/1e3):e.members_count,this.params.modal.text=this.params.modal.text.replace("{group_name}",e.name),this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new d(V({},this.params.modal)),a.push(this.modal))}handler(e,t,r){this.setData(e,t),this.callback=r,e.group_id?"number"==typeof e.group_id?this.loadIntroData(e):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" is missing'},this.callback)}actionHandler(e){this.loadIntroData(e)}};var q=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppDenyNotifications",this.callApi=!0,this.useUI=!1}};function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Y=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppOpenPayForm",this.checkTransaction=this.checkTransaction.bind(this),this.destroyVkPayContainer=this.destroyVkPayContainer.bind(this)}actionHandler(e){this.app.isMiniAppWidget?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenPayForm from widget"}):e.action?"string"==typeof e.action?e.params?e.hasOwnProperty("app_id")&&"number"!=typeof e.app_id?this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'"app_id" param should be an integer number'}):window.cur&&window.cur.app&&window.cur.app.isDirectGame?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"This event supported only for services"}):this.launchVkPayContainer(e):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "params"'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "action" should be a string'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})}openPayApp(e){var t=z({},e.params);t.action=e.action,cur.app.funcs.openExternalApp("vkpay",t,this.errorHandler)}checkTransaction(e){var t=!Object(l.isMvk)()||e.origin===location.origin;e.data&&"vk-connect"===e.data.type?e.data.handler===i.VKPAY_TRANSACTION_EVENT&&t&&(e.data.params.status?this.successHandler(z({},e.data.params),this.callback):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:z({},e.data.params,{error_msg:"VK Pay payment failed"})}),Object(l.isMvk)()||this.destroyVkPayContainer()):e.data&&e.data.externalAppClosed&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"})}destroyVkPayContainer(){window.removeEventListener("message",this.checkTransaction)}launchVkPayContainer(e){this.openPayApp(e),window.addEventListener("message",this.checkTransaction)}};function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var X=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppAllowNotifications",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_allow_notifications_title"),text:getLang("apps_connect_modal_messages_allow_notifications_text")},this.callApi=!0,this.useUI=!0}takeAction(){var e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",$({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:e=>{this.handleResponse(e,{},e=>this.successHandler(e))},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=$({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData($({can_send_messages:r.can_send_messages},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),a.pop(this.modal)}checkIntroData(e,t){e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic="/images/vk-app-notification.png",this.params.modal.picClass="MiniAppModalContainer__pic--small",this.params.modal.app_name=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new d($({},this.params.modal)),a.push(this.modal))}handler(e,t,r){this.setData(e,t),this.callback=r,cur.app.isDirectGame?this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:"This method allowed for mini apps only"}):this.loadIntroData(e)}};function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Z=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppOpenApp"}actionHandler(e){if(this.app.appId!==e.app_id||s(parseInt(this.app.appId,10))){var t={open_app_id:e.app_id};this.openAppId=e.app_id,e.location&&(t.location=e.location),this.openApp=J({},t),ajax.post("apps.php",J({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},t),{onDone:t=>{try{var r=JSON.parse(t);r.hasOwnProperty("original_url")?(this.successHandler({result:!0}),Object(l.isMvk)()?cur.app.openAppInLayer(r.original_url,!0):(cur.app.openAppInLayer(r.original_url,()=>o(e.app_id)),cur.miniAppOpener||(cur.miniAppOpener=this.app))):r.hasOwnProperty("error")&&this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Same app id as origin"})}handler(e,t,r){this.setData(e,t),this.callback=r,this.app.isMiniAppWidget?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenApp from widget"},r):e.app_id?"number"==typeof e.app_id?e.hasOwnProperty("location")&&"string"!=typeof e.location?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'"location" param should be a string'},r):this.actionHandler(e):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "app_id" should be a number'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r)}createUrl(e){return`app${e.app_id}${e.hasOwnProperty("location")?`#${e.location}`:""}`}};r("tUrg");var Q=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShare",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id}actionHandler(e){e.link&&"string"!=typeof e.link?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "link" should be a string'},this.callback):Object(l.isMvk)()?(this.shareEmitters(),e.link?cur.app.funcs.shareBox(e.link,"","","",this.successHandler,this.errorHandler):cur.app.funcs.shareBox(`https://vk.com/app${cur.aid}`,cur.appShareParams.sharePhoto,cur.appShareParams.shareTitle,cur.appShareParams.shareDesc,this.successHandler,this.errorHandler)):e.link?cur.app.funcs.showWallPostBox({message:e.link},this.successHandler,this.errorHandler):(this.shareEmitters(),this.share(this.appId,this.userId))}share(e,t){showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t},{onFail:()=>{this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Unknown error",error_type:"client_error"},this.callback)},params:{onHide:()=>{setTimeout(()=>{cur.app.vkMiniAppShareSuccess&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied",error_type:"client_error"},this.callback)},1e3)}}})}cleanEmitters(){cur.app.vkMiniAppShareSuccess=null,cur.app.vkMiniAppShareFail=null}shareEmitters(){cur.app.vkMiniAppShareSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},cur.app.vkMiniAppShareFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:i.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}};var ee=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowWallPostBox",this.externalSuccessHandler=this.externalSuccessHandler.bind(this),this.externalErrorHandler=this.externalErrorHandler.bind(this),this.setExternalHandlers()}setExternalHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler}unsetCurHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null,Object(l.isMvk)()&&VKApps.cancelSettings()}externalSuccessHandler(e){e&&e[1]?this.successHandler({post_id:e[1]}):this.errorHandler(),this.unsetCurHandlers()}externalErrorHandler(){this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"}),this.unsetCurHandlers()}actionHandler(e){e.hasOwnProperty("message")?e.message&&"string"!=typeof e.message?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "message" should be a string'},this.callback):(e.message=e.message.replace(/(\r)/g,""),cur.app.funcs.showWallPostBox(e,this.successHandler,this.errorHandler)):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "message"'})}},te=class{constructor(e,t,r){this.desiredOffset=e,this.speed=t,this.onComplete=r}go(){scrollTo(pageXOffset,this.desiredOffset),this.onComplete()}};var re=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppScroll",this.useUI=!1,this.DEFAULT_SPEED=100,this.onScrollEnd=this.onScrollEnd.bind(this)}onScrollEnd(){this.successHandler({result:{top:this.params.data.top,height:document.documentElement.offsetHeight}})}actionHandler(e){if(e.hasOwnProperty("top"))if("number"==typeof e.top)if(e.hasOwnProperty("speed")&&"number"!=typeof e.speed)this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'"speed" param should be a number'});else{var t=e.hasOwnProperty("speed")?e.speed:this.DEFAULT_SPEED;if(this.params.data={top:e.top},~this.app.containerId.indexOf("layer")){var r=ge("wk_layer_wrap");r?r.scrollTop=e.top:this.errorHandler({code:i.ERROR_CODES.UNKNOWN})}else this.scroll=new te(e.top,t,this.onScrollEnd),this.scroll.go()}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "top" should be a number'});else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "top"'})}};function ie(){return(ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var ne=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppResizeWindow",this.useUI=!1}setWidth(e){var t=166;e&&this.app.vkApp&&(e=Math.min(Math.max(e,607),1e3),this.app.vkApp.options.layout_width&&(t=this.app.vkApp.options.layout_width-e),this.app.vkApp.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,607)+t}),cur.app.frame.style.width=cur.app.cont.style.width=e+"px",this.result.width=e)}setHeight(e){if(e){e=Math.min(Math.max(e,500),8050),this.app.vkApp.inlineApp&&e>this.app.vkApp.options.heightMax&&!this.app.vkApp.params.is_vkpay_service&&(e=this.app.vkApp.options.heightMax);var t=e+"px";cur.app.frame.style.height=t,this.app.vkApp.options.boxed||(cur.app.cont.style.height=t),this.app.vkApp.options.layer&&WkView.onResize(),this.app.vkApp.options.onResize&&this.app.vkApp.options.onResize(),this.result.height=e}}actionHandler(e){Object(l.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):e.hasOwnProperty("width")&&"number"!=typeof e.width?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "width" should be a number'}):e.hasOwnProperty("height")&&"number"!=typeof e.height?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "height" should be a number'}):e.hasOwnProperty("height")||e.hasOwnProperty("width")?(this.result={},e.hasOwnProperty("width")&&this.setWidth(e.width),e.hasOwnProperty("height")&&this.setHeight(e.height),this.successHandler({result:ie({},this.result)})):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:"At least one parameter is required"})}};function oe(){return(oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var se=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppSendPayload",this.callApi=!0,this.useUI=!1}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.group_id)if("number"==typeof e.group_id)if(e.hasOwnProperty("payload")&&"object"!=typeof e.payload)this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'"payload" param should be an object'},r);else{try{e.payload=JSON.stringify(e.payload)}catch(e){this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "payload" is not valid JSON object'},r)}this.actionHandler(e)}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "group_id" should be a number'},r);else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "group_id"'},r)}actionHandler(e){return ajax.post("apps.php",oe({act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{try{var r=JSON.parse(t);r.hasOwnProperty("error")?this.errorHandler(r.error,this.callback,i.ERROR_TYPES.API):r.status?this.successHandler(oe({},r,{scope:e.scope})):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}},ae=/^\/?@?([a-z0-9_-]+)$/i;var ce=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticle",this.callApi=!1,this.useUI=!0}launchUI(e){var t=e.url;if(ae.test(t))if(Object(l.isMvk)()){var r=window.location.pathname.substr(1),n=t.split("?");window.nav.go(`${n[0]}?from=${r}`)}else window.show(boxLoader),window.show(boxLayerWrap),window.boxRefreshCoords(boxLoader),window.articlePrepare(t,{onCloseCallBack:()=>this.successHandler({type:"close",data:{url:t}}),onFailCallBack:()=>{window.hide(boxLoader),window.hide(boxLayerWrap),this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:"ServerError: Can't open article."})}},function(){window.hide(boxLoader),window.hide(boxLayerWrap),window.nav.go(t)});else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:`Error: incorrect url: ${t}`})}};var le=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppUpdateConfig"}get successDescriptor(){return`${this.params.handlerName}`}get errorDescriptor(){return`${this.params.handlerName}Failed`}actionHandler(e){if(Object(l.isMvk)()){if(!e.viewport_width)return void this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_width"'});e.viewport_height||this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_height"'}),this.successHandler({viewport_width:e.viewport_width,viewport_height:e.viewport_height,scheme:e.scheme?e.scheme:i.CLIENT_SCHEME.LIGHT},this.callback)}}};r("VRzm");function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var de="pending",he="loaded",ue="charged",_e=30,fe={error_type:"client_error",code:i.ERROR_CODES.CONNECTION_LOST};var me=class extends _{constructor(e){super(e),this.showConfirm=e=>{this.params.modal.pic=e.photo_url,this.params.modal.title=e.title,this.params.modal.text=e.message,this.modal=new d(pe({},this.params.modal)),a.push(this.modal);var t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})},this.loadItemData=()=>new Promise((e,t)=>{var r=0;this.interval=setInterval(()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId},{onDone:n=>{switch((n=JSON.parse(n)).hasOwnProperty("error")&&t(n.error),n.status){case de:this.orderId=n.order_id,r++>=_e&&t({error_type:"client_error",code:i.ERROR_CODES.CUSTOM,reason:"Can't load product"});break;case he:this.orderId=n.order_id,this.confirmHash=n.confirm_hash,this.orderHash=n.order_hash,e(n.item_data)}},onFail:()=>{t(fe)}})},1e3)}),this.confirmOrder=()=>{this.hideLoader(),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_order",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash},{onDone:e=>{(e=JSON.parse(e)).status===ue?(this.successHandler(e),a.pop(this.modal)):(a.pop(this.modal),this.errorHandler(e.error))},onFail:()=>{this.onError(fe)}})},this.params.handlerName="VKWebAppShowOrderBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.confirmOrder}],containerClass:"vk_app_modal_container--order",allowAction:this.confirmOrder,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0}}setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.item}showLoader(){var e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.cancel.bind(this),disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new d(pe({},e)),a.push(this.loader)}hideLoader(){this.loader&&(a.pop(this.loader),this.loader.destroy()),this.loader=null}handler(e,t,r){this.setData(e,t),this.callback=r,this.showLoader(),this.makeOrder()}makeOrder(){this.loadItemData().then(e=>{clearInterval(this.interval),this.hideLoader(),this.showConfirm(e)}).catch(e=>{this.onError(e)})}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}onError(e){clearInterval(this.interval),this.errorHandler(e),a.pop(this.modal),this.hideLoader()}};function be(){return(be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var ve=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowLeaderBoardBox",this.callApi=!0}actionHandler(e){Object(l.isMvk)()?super.actionHandler(e):this.errorHandler({error_type:"client_error",error_code:i.ERROR_CODES.INVALID_PARAMS,reason:"Not supported for this platform"})}handleResponse(e,t){if((e=JSON.parse(e)).hasOwnProperty("error"))this.errorHandler(e.error);else{var r=be({},t,e);window.DirectGames.showLeaderBoard({onClose:()=>{this.successHandler({result:!0})},board:r})}}};var we=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowInviteBox",this.callApi=!0}actionHandler(e){Object(l.isMvk)()?window.DirectGames.showInviteBox({onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler}):cur.app.funcs.showInviteBox()}};var Ee=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticleEditor",this.callApi=!1,this.useUI=!0,this.launchUI=this.launchUI.bind(this)}launchUI(e){if(cur.app.params.open_article_edit&&!window.isMvk){var t=e.owner_id,r=e.article_id,n=e.course_id,o="number"==typeof t,s="number"==typeof r,a="number"==typeof n;t&&o?r&&!s?this.errorHandler({code:s?i.ERROR_CODES.MISSING_PARAM:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "article_id" is wrong. Expected integer greater than 0, got type ${typeof r} with value ${r}.`}):n&&(!a||n<=0)?this.errorHandler({code:a?i.ERROR_CODES.MISSING_PARAM:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "course_id" is wrong. Expected integer greater than 0, got type ${typeof n} with value ${n}.`}):window.openArticleEditor&&window.openArticleEditor(t,r,null,{course_id:n,is_education:n>0?1:0,app_id:this.app.appId,app_hash:this.getEventHash()},{from:"app",eventHandler:this.successHandler.bind(this),errorHandler:this.errorWrapper.bind(this)}):this.errorHandler({code:o?i.ERROR_CODES.MISSING_PARAM:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "owner_id" is missing or wrong. Expected integer, got type ${typeof t} with value ${t}.`})}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:window.isMvk?"ClientError: This handler is forbidden on this platform":"ClientError: This app isn't allowed to use this handler"})}errorWrapper(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:e})}};function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Oe=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowRequestBox",this.callApi=!0}actionHandler(e){Object(l.isMvk)()?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,friend_id:e.uid},{onDone:t=>{try{(t=JSON.parse(t)).hasOwnProperty("error")?this.errorHandler(t.error):(Object.assign(e,t),window.DirectGames.showRequestBox(ye({},e,{onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler})))}catch(e){this.errorHandler(e)}},onFail:e=>{this.errorHandler(e)}}):cur.app.funcs.showRequestBox(e.uid,e.message,e.requestKey)}};function Ce(){return(Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Se=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGetKeys",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.hasOwnProperty("count")&&"number"!=typeof e.count?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "count" should be a number'},r):e.hasOwnProperty("offset")&&"number"!=typeof e.offset?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "offset" should be a number'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e))}actionHandler(e){return ajax.post("apps.php",Ce({act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}};function Ae(){return(Ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Pe=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppStorageSet",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.key?"string"==typeof e.key?e.hasOwnProperty("value")&&"string"!=typeof e.value?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "value" should be a string'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "key" should be a string'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "key"'},r)}actionHandler(e){return ajax.post("apps.php",Ae({act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}};function ke(){return(ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Te=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGet",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.keys?"object"==typeof e.keys?e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "keys" should be a string'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "keys"'},r)}actionHandler(e){return ajax.post("apps.php",ke({act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}},Me=r("W9Tc");function De(){return(De=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Re=class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppAddToFavorites",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_favorites"),text:getLang("apps_connect_modal_messages_request_add_to_favorites_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=De({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:i.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.added_to_favorites?this.successHandler({result:!0}):this.launchUI(t)}checkResponse(e){super.checkResponse(e),Object(l.isMvk)()&&!0===e.result&&window.cur&&window.cur.VKApp&&(window.cur.VKApp.isFavorite=!window.cur.VKApp.isFavorite,window.DirectGames&&window.DirectGames.initMenu())}handler(e,t,r){(Object(Me.partConfigEnabled)("mini_apps_web_add_to_favorites")||cur.app.isDirectGame)&&(this.setData(e,t),this.callback=r,this.loadIntroData())}};r("Vd3H");function Ie(){return(Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}class Le extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowStoryBox",this.callApi=!1,this.useUI=!1}get loadFinishDescriptor(){return`${this.params.handlerName}LoadFinish`}loadFinishHandler(e){this.callback({type:this.loadFinishDescriptor,data:e},this.params.handlerName)}actionHandler(e){if(Object(l.isMvk)()||!Object(Me.partConfigEnabled)("web2_story_box_enabled"))return this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM});if(this.validateParams(e)){var t=e.url?e.url:e.blob;window.stManager.add([window.jsc("web/story_publisher.js")]).then(()=>{window.StoryPublisher&&window.StoryPublisher.init({entrypoint:"mini_app",miniAppId:Number(this.app.appId),photoUrl:t,stickers:e.stickers,attachment:e.attachment},()=>this.successHandler({result:!0}),(e,t)=>{if(!e)return this.errorHandler({code:i.ERROR_CODES.USER_DENIED});if(t&&t.response&&t.response.story){var r=t.response.story,n=r.owner_id,o=r.id;return this.loadFinishHandler({story_owner_id:n,story_id:o})}})}).catch(()=>this.errorHandler({code:i.ERROR_CODES.UNKNOWN}))}}static isValidUrl(e){try{return!!new URL(e)}catch(e){return!1}}validateParams(e){return!!this.checkFields(e)&&(!(e.attachment&&!this.checkAttachment(e.attachment))&&!(e.stickers&&!this.checkAStickers(e.stickers)))}checkFields(e){return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>Le.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"attachment",type:"object"},{param:"stickers",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}checkAttachment(e){var t=["url","photo","video","audio"],r=["to_store","vote","more","book","order","enroll","fill","signup","buy","ticket","write","open","learn_more","view","go_to","contact","watch","play","install","read"];return!!this.checkParams(e,[{param:"text",type:"string",isRequired:!0,extraChecks:[{check:e=>r.includes(e),error:e=>`Param "${e}" should be a ${r.join(", ")}`}]},{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be a ${t.join(", ")}`}]}])&&("url"===e.type?this.checkParams(e,[{param:"url",type:"string",isRequired:!0,extraChecks:[{check:e=>Le.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]}]):this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"id",type:"number",isRequired:!0},{param:"access_key",type:"string"}]))}checkAStickers(e){return!e.length||e.every(e=>!!this.checkStickerContainer(e)&&!!this.checkSticker(e.sticker_type,e.sticker))}checkStickerContainer(e){return this.checkParams(e,[{param:"sticker_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["native","renderable"].includes(e),error:e=>`Param "${e}" should be a native or renderable`}]},{param:"sticker",type:"object",isRequired:!0}])}checkSticker(e,t){return"renderable"===e?this.checkRenderableSticker(t):"native"===e?this.checkNativeSticker(t):(this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "sticker_type" should be a native or renderable'}),!1)}checkNativeSticker(e){return!!this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["text","sticker"].includes(e),error:e=>`Param "${e}" should be a text or sticker`}]},{param:"action",type:"object",isRequired:!0},{param:"transform",type:"object",isRequired:!1}])&&(!!this.checkAction(e.action_type,e.action)&&!(e.transform&&!this.checkTransform(e.transform)))}checkAction(e,t){return"text"===e?this.checkParams(t,[{param:"text",type:"string",isRequired:!0},{param:"style",type:"string"},{param:"background_style",type:"string"},{param:"alignment",type:"string"},{param:"selection_color",type:"string"}]):"sticker"===e?this.checkParams(t,[{param:"sticker_id",type:"number",isRequired:!0},{param:"pack_id",type:"number"}]):"link"===e?this.checkParams(t,[{param:"link",type:"string",isRequired:!0},{param:"tooltip_text_key",type:"string"}]):"app"===e?this.checkParams(t,[{param:"app_id",type:"number",isRequired:!0},{param:"app_context",type:"string"}]):(this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "action_type" should be a sticker or text'}),!1)}checkTransform(e){var t=["left_top","left_center","left_bottom","center_top","center","center_bottom","right_top","right_center","right_bottom"];return this.checkParams(e,[{param:"rotation",type:"number",isRequired:!1},{param:"relation_width",type:"number",isRequired:!1},{param:"translation_x",type:"number",isRequired:!1},{param:"translation_y",type:"number",isRequired:!1},{param:"gravity",type:"string",isRequired:!1,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be ${t.join(", ")}`}]}])}checkRenderableSticker(e){return!!this.checkParams(e,[{param:"content_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>Le.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"transform",type:"object",isRequired:!1},{param:"clickable_zones",type:"object",isRequired:!1,extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])&&(!(e.transform&&!this.checkTransform(e.transform))&&!(e.clickable_zones&&!this.checkClickableZones(e.clickable_zones)))}checkClickableZones(e){return e.every(t=>!!this.checkClickableZone(t)&&(!!this.checkAction(t.action_type,t.action)&&(!e.clickable_area||(4!==e.clickable_area.length?(this.errorHandler({code:i.ERROR_CODES.UNKNOWN}),!1):e.clickable_area.every(e=>this.checkParams(e,[{param:"x",type:"number",isRequired:!0},{param:"y",type:"number",isRequired:!0}]))))))}checkClickableZone(e){return this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["link","app"].includes(e),error:e=>`Param "${e}" should be a link or app`}]},{param:"action",type:"object",isRequired:!0},{param:"clickable_area",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}}var xe={VKWebAppInit:f,VKWebAppGetCommunityAuthToken:v,VKWebAppGetCommunityToken:E,VKWebAppGetFriends:class extends _{constructor(e){super(e),this.onFlistHide=()=>{this.hasSuccess||this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"})},this.params.handlerName="VKWebAppGetFriends",this.callApi=!0}loadIntroData(e){var t=this;this.request=Ie({},e),cur.onFlistSave=function(){return t.onFlistSave(...arguments)},cur.onFlistHide=this.onFlistHide,showTabbedBox("apps.php",Ie({act:"handle_vk_connect_event",hash:cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}`]}_hash`],event:i.VK_CONNECT_EVENTS[`${this.params.handlerName}`],app_id:this.app.appId},this.request),{stat:["ui_controls.js","ui_controls.css"]})}onFlistSave(e,t){this.hasSuccess=!0;var r={};r.users=t.friends.map(e=>{var t=e[1].split(" ");return{id:e[0],sex:parseInt(e[5],10),last_name:t[1]?t[1]:"",first_name:t[0],photo_200:e[2]}}),this.request.lists&&(r.lists=t.lists.map(e=>e[0]).sort()),this.successHandler(r)}handler(e,t,r){this.setData(e,t),this.callback=r,Object(l.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):this.checkParams(e,[{param:"multi",type:"boolean"},{param:"lists",type:"boolean"}])&&(e.hasOwnProperty("lists")&&(e.lists=e.lists?1:0),e.hasOwnProperty("multi")&&(e.multi=e.multi?1:0),this.actionHandler(e))}actionHandler(e){this.loadIntroData(e)}},VKWebAppAddToCommunity:O,VKWebAppAddToFavorites:Re,VKWebAppGetUserInfo:C,VKWebAppSetLocation:A,VKWebAppGetClientVersion:P,VKWebAppGetPhoneNumber:T,VKWebAppGetEmail:D,VKWebAppOpenArticle:ce,VKWebAppGetGeodata:R,VKWebAppOpenQR:I,VKWebAppSetViewSettings:L,VKWebAppSetTitle:x,VKWebAppGetAuthToken:N,VKWebAppCallAPIMethod:U,VKWebAppJoinGroup:F,VKWebAppAllowMessagesFromGroup:G,VKWebAppDenyNotifications:q,VKWebAppAllowNotifications:X,VKWebAppOpenPayForm:Y,VKWebAppOpenApp:Z,VKWebAppShare:Q,VKWebAppShowWallPostBox:ee,VKWebAppOpenArticleEditor:Ee,VKWebAppScroll:re,VKWebAppStorageGet:Te,VKWebAppStorageGetKeys:Se,VKWebAppStorageSet:Pe,VKWebAppResizeWindow:ne,VKWebAppSendPayload:se,VKWebAppUpdateConfig:le,VKWebAppTapticImpactOccurred:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppTapticImpactOccurred"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppTapticNotificationOccurred:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppTapticNotificationOccurred"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppTapticSelectionChanged:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppTapticSelectionChanged"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppShowImages:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowImages"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}},VKWebAppShowOrderBox:me,VKWebAppShowLeaderBoardBox:ve,VKWebAppShowInviteBox:we,VKWebAppShowRequestBox:Oe,VKWebAppShowCommunityWidgetPreviewBox:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppShowCommunityWidgetPreviewBox"}resetBox(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout(function(){delete cur.appWidgetPreviewBox},3e3)}actionHandler(e){if(!Object(l.isMvk)()){if(!this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0},{param:"type",type:"string",isRequired:!0}]))return;this.showWidgetPreviewBox(e)}}showWidgetPreviewBox(e){if(!cur.appWidgetPreviewBox){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=e=>{this.resetBox(),this.errorHandler(e)},cur.onAppWidgetPreviewCancel=()=>{this.resetBox(),this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"})},cur.onAppWidgetPreviewSuccess=()=>{this.resetBox(),this.successHandler({result:!0})};var t=showBox("apps",{act:"app_widget_preview_box",aid:this.app.appId,gid:e.group_id,type:e.type,code:e.code},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:()=>{t.setOptions({onHide:()=>{Object(h.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:e=>(~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(h.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0)})}}},VKWebAppOpenInNativeApp:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppOpenInNativeApp",this.useUI=!1}actionHandler(e){var t=window.browser,r=t.ipad,n=t.iphone,o=t.android;if(Object(l.isMvk)()&&(r||n||o)){if(!this.checkParams(e,[{param:"link",type:"string",isRequired:!0}]))return;this.openInNativeApp(e.link)}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM})}openInNativeApp(e){if(this._openAppInProgress)return!1;var t="vk://vk.com/"+e,r=browser.mi?1500:300;browser.safari&&(r=browser.ios>=12?2800:300);var n=Date.now(),o=setTimeout(()=>{this._openAppInProgress=!1,Date.now()-n>r+200||!document.hasFocus()?this.successHandler({result:!0}):(nav.hard_go("https://vk.cc/dl"),this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.NATIVE_APP_IS_NOT_INSTALLED}))},r),s=()=>{clearTimeout(o),this._openAppInProgress=!1,window.removeEventListener("blur",s)};if(window.addEventListener("blur",s),browser.ios){var a=()=>{window.removeEventListener("focus",a)};window.addEventListener("focus",a)}return this._openAppInProgress=!0,nav.hard_go(t),!1}},VKWebAppLocationChanged:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppLocationChanged"}get successDescriptor(){return`${this.params.handlerName}`}actionHandler(e){this.successHandler({location:e.location})}},VKWebAppClose:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppClose"}closeMiniAppPage(){var e=-1,t=window.history.length;2===cur.VKApp.vkMiniAppsHistoryLength&&!document.referrer||1===cur.VKApp.vkMiniAppsHistoryLength?nav.go(Object(l.isMvk)()?"/services":"/feed"):(cur.VKApp.vkMiniAppsHistoryLength!==t&&(e=cur.VKApp.vkMiniAppsHistoryLength-t-1),window.history.go(e))}actionHandler(e){Object(l.isMvk)()?window.opener?(window.opener.postMessage({type:this.params.handlerName,name:this.successDescriptor,eventData:{status:e.status,payload:e.payload}},"*"),window.close()):this.closeMiniAppPage():cur.openerAppsQueue&&cur.openerAppsQueue.length>0&&Object.keys(cur.vkAppQueue).length>1?(cur.miniAppOpener&&cur.miniAppOpener.sendIframeMessage(this.successDescriptor,{status:e.status,payload:e.payload}),WkView.hide()):this.closeMiniAppPage()}handler(e,t,r){this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"status",type:"string",isRequired:!0,extraChecks:[{check:e=>i.CLOSE_STATUS.includes(e),error:e=>`Param "${e}" should be "success" or "failed"`}]},{param:"payload",type:"object",isRequired:!1}])&&this.actionHandler(e)}},VKWebAppShowStoryBox:Le,VKWebAppSubscribeStoryApp:class extends _{constructor(e){super(e),this.params.handlerName="VKWebAppSubscribeStoryApp",this.callApi=!1,this.useUI=!1}actionHandler(e){if(this.validateParams(e)){var t={act:"subscribe_user_to_app",story_owner_id:e.story_owner_id,story_id:e.story_id,access_key:e.access_key,sticker_id:e.sticker_id,hash:this.getEventHash(),app_id:this.app.appId},r=t=>{this.handleResponse(t,e,e=>this.successHandler(e))},i=e=>{this.errorHandler(e)};Object(l.isMvk)()?window.ajax.post("stories.php",t,{onDone:(e,t)=>t?i(t):r(e)}):window.ajax.post("al_stories.php",t,{onDone:r,onFail:i})}}validateParams(e){return this.checkParams(e,[{param:"story_owner_id",type:"number",isRequired:!0},{param:"story_id",type:"number",isRequired:!0},{param:"sticker_id",type:"number",isRequired:!0},{access_key:"string",type:"string",isRequired:!1}])}}};function Be(){return(Be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Ne=(e,t)=>{var r;if(e.frameId){var i=ge(e.frameId);i&&(r=i.querySelector("iframe"))}else t&&(r=t.querySelector("iframe"));r&&"VKWebAppSettings"!==e.type&&r.contentWindow.postMessage(Be({},e),"*")},je=(e,t)=>{if(xe[e.handler]){(new xe[e.handler]).handler(Be({},e.params,{containerId:t.containerId,pic:e.pic}),t,e=>{ge(t.containerId)&&e&&Ne(e,ge(t.containerId))})}},We=r("xo6n");function He(){return(He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Ue=class{constructor(e,t,r,i,n){this.sendIframeMessage=(e,t)=>{var r=document.getElementById(this.containerId);r&&Ne({type:e,data:He({},t)},r)},this.appId=t.aid,this.src=t.src,this.pic=i,this.params=He({},r),this.containerId=e,this.vkApp=n,this.isDirectGame=t.is_direct_game,this.isVKPayApp=t.is_vkpay_app,this.isMiniAppWidget=t.is_mini_app_widget,this.handler=this.handler.bind(this),this.onResize=this.onResize.bind(this),this.i=0}init(){this.sessionLogger=new We.default(this.appId),cur.destroy.unshift(()=>{this.destroyView()}),window.addEventListener("visibilitychange",()=>{document.hidden?this.sessionLogger&&this.sessionLogger.idle():this.sessionLogger&&this.sessionLogger.unIdle()}),window.addEventListener("message",this.handler),window.addEventListener("beforeunload",()=>{this.destroyView()});var e=Object(l.isMvk)()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.DARK,t=Object(l.isMvk)()?i.CLIENT_SCHEME.BRIGHT_LIGHT:i.CLIENT_SCHEME.LIGHT;window.matchMedia("(prefers-color-scheme: dark)").addListener(t=>t.matches&&this.sendUpdateEvent(e)),window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&this.sendUpdateEvent(t)),Object(l.isMvk)()&&(cur.VKApp.vkMiniAppsHistoryLength=window.history.length,this.onResize(),window.addEventListener("resize",this.onResize),this.checkDevice())}initOpenExternalApp(){var e=new URLSearchParams(location.search);if(cur.zNavInfo&&cur.zNavInfo.info.w&&e.has("w")){var t=/app[0-9]+/.exec(cur.zNavInfo.info.w);if(t){var r=parseInt(t[0].replace("app",""),10);je({eventData:{app_id:r},params:{app_id:r,request_id:"vkopenexternalapp"},handler:S.OPEN_APP},this)}}}destroyView(){window.removeEventListener("message",this.handler),this.sessionLogger&&this.sessionLogger.stop()}sendUpdateEvent(e){je({handler:S.UPDATE_CONFIG,params:{viewport_width:this.currentWidth,viewport_height:this.currentHeight,scheme:e||this.getColorScheme()}},this)}onResize(){if(!this.isDirectGame&&this.currentHeight!==window.innerHeight){this.getWindowSize();var e=document.querySelector(".app_container"),t=e&&e.childNodes[0];t&&(t.style.height=this.currentHeight+"px",t.style.minHeight=this.currentHeight+"px",this.sendUpdateEvent())}}getWindowSize(){this.currentHeight=window.innerHeight,this.currentWidth=window.innerWidth}getColorScheme(){var e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=window.matchMedia("(prefers-color-scheme: light)").matches,r=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!e&&!t&&!r;return e?Object(l.isMvk)()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.DARK:t?Object(l.isMvk)()?i.CLIENT_SCHEME.BRIGHT_LIGHT:i.CLIENT_SCHEME.LIGHT:r||n?Object(l.isMvk)()?i.CLIENT_SCHEME.BRIGHT_LIGHT:i.CLIENT_SCHEME.LIGHT:void 0}handler(e){var t=n(e.origin)===n(this.src)||this.isVKPayApp;if(e.data&&"vk-connect"===e.data.type&&t){var r=this;if(e.data.handler===S.INIT&&(this.sessionLogger&&this.sessionLogger.start(),r&&r.sendUpdateEvent(),!Object(l.isMvk)())){var i=document.getElementById(this.containerId);i&&Ne({type:S.SETTINGS,frameId:this.containerId},i)}if(cur.vkAppQueue&&Object.keys(cur.vkAppQueue).length>1){var o="";(o=e.data.frameId?e.data.frameId:this.containerId?this.containerId:Object.keys(cur.vkAppQueue)[1])===this.containerId&&(r=cur.vkAppQueue[o],je(He({},e.data,{pic:this.pic}),r))}else Object(l.isMvk)()?cur.app.hideVkAppPreload():this.initOpenExternalApp(),je(He({},e.data,{pic:this.pic}),r)}else if(e.data&&"VKWebAppClose"===e.data.type&&Object(l.isMvk)()){var s=ge(this.containerId);s&&Ne({type:e.data.name,data:e.data.eventData},s)}}checkDevice(){this.isIOS()&&this.checkIOSXDevice()&&document.body.classList.add("vk_ios_x_device")}isIOS(){return document.body.classList.contains("vk_ios_yes")}checkIOSXDevice(){var e=window.screen.height;return e>=812&&e<900}};t.default=(e,t,r,i,n)=>{if(cur.vkAppQueue||(cur.vkAppQueue={}),!cur.vkAppQueue[e]){var o=new Ue(e,t,r,i,n);o.init(),cur.vkAppQueue[e]=o}}},mYgU:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r("yOtm")),o=i(r("Ya8i")),s=i(r("WfVW")),a=i(r("xkiS")),c=i(r("t0N9")),l=r("Iwry");function p(e,t){return void 0===t&&(t={}),{width:t.width||l.getNodeWidth(e),height:t.height||l.getNodeHeight(e)}}function d(e,t){void 0===t&&(t={});var r=p(e,t),i=r.width,l=r.height;return n.default(e,t.filter,!0).then(function(e){return o.default(e,t)}).then(function(e){return s.default(e,t)}).then(function(e){return c.default(e,t)}).then(function(e){return a.default(e,i,l)})}function h(e,t){return void 0===t&&(t={}),d(e,t).then(l.createImage).then(l.delay(100)).then(function(r){var i=document.createElement("canvas"),n=i.getContext("2d"),o=l.getPixelRatio(),s=p(e,t),a=s.width,c=s.height;return i.width=a*o,i.height=c*o,i.style.width=""+a,i.style.height=""+c,n.scale(o,o),t.backgroundColor&&(n.fillStyle=t.backgroundColor,n.fillRect(0,0,i.width,i.height)),n.drawImage(r,0,0),i})}function u(e,t){void 0===t&&(t={});var r=p(e,t),i=r.width,n=r.height;return h(e,t).then(function(e){return e.getContext("2d").getImageData(0,0,i,n).data})}function _(e,t){return void 0===t&&(t={}),h(e,t).then(function(e){return e.toDataURL()})}function f(e,t){return void 0===t&&(t={}),h(e,t).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})}function m(e,t){return void 0===t&&(t={}),h(e,t).then(l.canvasToBlob)}t.toSvgDataURL=d,t.toCanvas=h,t.toPixelData=u,t.toPng=_,t.toJpeg=f,t.toBlob=m,t.default={toSvgDataURL:d,toCanvas:h,toPixelData:u,toPng:_,toJpeg:f,toBlob:m}},nNgf:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return p});var i=r("BJj/"),n=r("jE6c"),o=r("zxIV"),s=r("v+DW"),a=Object(o.clientHeight)(),c="/apps",l=20;class p{constructor(){this.scrollEl=null,this.offset=0,this.contentEl=null,this.allLoaded=!1,this.loading=!1,this.scrollHandler=null}init(){this.offset=l,this.allLoaded=!1,this.scrollEl=window.wkLayerWrap,this.contentEl=document.querySelector(".wk_wiki_content"),this.scrollHandler=()=>{this._onScroll()},addEvent(this.scrollEl,"scroll",this.scrollHandler),this.initDestroy()}initDestroy(){window.cur=window.cur||{},window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.destroy()});var e=window.wkcur.onHide;window.wkcur.onHide=()=>{Object(n.isFunction)(e)&&e(),this.destroy()}}destroy(){removeEvent(this.scrollEl,"scroll",this.scrollHandler)}_loadMore(){if(!this.allLoaded&&!this.loading){this.loading=!0;var e=Object(o.ce)("div",{className:"GamesGiftsLoader",id:"gifts_loader"});Object(s.showProgress)(e),this.contentEl.appendChild(e),ajax.post(c,{act:"gifts_friends_wish_list_more",offset:this.offset},{onDone:(t,r)=>{this.loading=!1,Object(o.re)(e),t?(this.offset=r,this.contentEl.insertAdjacentHTML("beforeend",t),window.cur.GameGifts&&window.cur.GameGifts.initGallery()):(this.allLoaded=!0,removeEvent(this.scrollEl,"scroll",this.scrollHandler))}})}}_onScroll(){return Object(i.debounce)(()=>{a>=this.scrollEl.scrollHeight-this.scrollEl.scrollTop-Object(o.clientHeight)()&&this._loadMore()},20)()}}},qJhe:function(e,t,r){"use strict";r.r(t);var i,n=r("q1tI"),o=r("i8i4"),s=r("0fW4"),a=r("jE6c"),c=r("EasH"),l=r("6krn"),p=r("3oLO"),d=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),h=r("r7nW").default,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.save=function(e,r,i){void 0===i&&(i={}),t.props.onClickSave(),p.ajax.post("al_stories.php",{act:"get_upload_url",attachment:JSON.stringify(t.props.attachment),clickable_stickers:i.clickable_stickers,mini_app_id:t.props.miniAppId,analytics:i.analytics,hash:i.hash,entry_point:t.props.entrypoint,ref:window.cur.module},{onDone:function(i){t.sendToServer(e,i,r)},onFail:function(e){var t=e||Object(l.getLang)("global_error");return window.showFastBox({title:Object(l.getLang)("global_error")},t,Object(l.getLang)("global_close"),function(){r(),window.curBox().hide()}),!0}})},t.sendToServer=function(e,r,i){var n=new FormData,o=encodeURIComponent("edited_"+Object(a.irand)(0,99999)+".jpg");n.append("file0",e,o),fetch(r,{method:"POST",body:n}).then(function(e){return e.json()}).then(function(e){t.onClose(!0,!1,e),i()}).catch(function(e){console.error(e)})},t.onClose=function(e,r,i){r?t.props.onClose(!1):e?(window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,i)):t.box?(t.box.hide(),delete t.box):t.box=Object(c.showFastBox)({title:Object(l.getLang)("photos_pe_are_you_sure_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(l.getLang)("photos_pe_are_you_sure_close_text"),Object(l.getLang)("box_yes"),function(){t.props.onClose(!1),t.box.hide()},Object(l.getLang)("box_no"))},t}return d(t,e),t.prototype.render=function(){var e=this,t=window.innerHeight-100,r=t/1.78;return n.createElement(h,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},n.createElement(s.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:r,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers}))},t}(n.Component),_=r("ufMw");r.d(t,"StoryPublisher",function(){return f});var f={init:function(e,t,r){var i=this;this.onClickSave=t||function(){},this.cb=r,this.loadStatic().then(function(){i.render(e)}).catch(function(e){console.error(e)})},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?Object(_.sendStat)(_.EVENTS.ADD_STORY_FROM_SHARING):Object(_.sendStat)(_.EVENTS.ADD_STORY);var i=document.querySelector(".StoryPublisher");i||((i=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(i)),o.render(n.createElement(u,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers}),i)},destroy:function(e,t){var r=document.querySelector(".StoryPublisher");r&&o.unmountComponentAtNode(r),this.cb&&this.cb(e,t)}}},qT12:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,a=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,l=i?Symbol.for("react.provider"):60109,p=i?Symbol.for("react.context"):60110,d=i?Symbol.for("react.async_mode"):60111,h=i?Symbol.for("react.concurrent_mode"):60111,u=i?Symbol.for("react.forward_ref"):60112,_=i?Symbol.for("react.suspense"):60113,f=i?Symbol.for("react.memo"):60115,m=i?Symbol.for("react.lazy"):60116;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case d:case h:case s:case c:case a:case _:return e;default:switch(e=e&&e.$$typeof){case p:case u:case l:return e;default:return t}}case m:case f:case o:return t}}}function g(e){return b(e)===h}t.typeOf=b,t.AsyncMode=d,t.ConcurrentMode=h,t.ContextConsumer=p,t.ContextProvider=l,t.Element=n,t.ForwardRef=u,t.Fragment=s,t.Lazy=m,t.Memo=f,t.Portal=o,t.Profiler=c,t.StrictMode=a,t.Suspense=_,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===h||e===c||e===a||e===_||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===f||e.$$typeof===l||e.$$typeof===p||e.$$typeof===u)},t.isAsyncMode=function(e){return g(e)||b(e)===d},t.isConcurrentMode=g,t.isContextConsumer=function(e){return b(e)===p},t.isContextProvider=function(e){return b(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return b(e)===u},t.isFragment=function(e){return b(e)===s},t.isLazy=function(e){return b(e)===m},t.isMemo=function(e){return b(e)===f},t.isPortal=function(e){return b(e)===o},t.isProfiler=function(e){return b(e)===c},t.isStrictMode=function(e){return b(e)===a},t.isSuspense=function(e){return b(e)===_}},r7nW:function(e,t,r){"use strict";r.r(t);var i=r("q1tI"),n=r("i8i4"),o=(r("17x9"),r("pemR"));class s extends i.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=`${parseFloat(this.calculatedPadding)+r}px`),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(o.classNames)("BaseModal",e);return i.createElement("div",{className:t,"aria-modal":"true"},i.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),i.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return n.createPortal(this.renderModal(),document.body)}}s.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=s},sINF:function(e,t,r){"use strict";function i(e){return function(t){var r=t.dispatch,i=t.getState;return function(t){return function(n){return"function"==typeof n?n(r,i,e):t(n)}}}}r.r(t);var n=i();n.withExtraArgument=i,t.default=n},t0N9:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e.style;return t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=t.width+"px"),t.height&&(r.height=t.height+"px"),t.style&&Object.assign(r,t.style),e}},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",function(){return a}),r.d(t,"sendStat",function(){return c}),r.d(t,"prepareStat",function(){return l});var i=r("1y80"),n=r("98sY"),o=r("xYVc"),s=r("W9Tc"),a={ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",CANCEL_GRAFFITI:"cancel_graffiti",SELECT_BACKGROUND:"select_background"};function c(e){if(window.cur.storyPublishContext){var t={event_type:e,story_type:"photo"};Object(s.partConfigEnabled)("story_publish_analytics_log")&&Object(n.debugLog)(t),Object(i.statlogsValueEvent)("story_create_product_analytics",t)}}function l(e,t,r,i){var n=0,s="photo";r===o.default.BACKGROUND_MODES.BACKGROUND&&(s=(n=i)>100?"emojies":"gradients");var a={has_text:0,has_sticker:0,has_graffiti:0,background_type:s,background_id:n},c=[],l=[],p=[];return e.forEach(function(e){if(e.type===o.default.LAYER_TYPES.STICKER){var t=(s=e).id.split("_"),r=t[0],i=t[1],n=parseInt(r);c.push({id:parseInt(i),pack_id:n||0,type:n?"from_pack":"individual"})}else if(e.type===o.default.LAYER_TYPES.TEXT){var s=e;l.push({text:s.text,font:s.fontStyle,size:Math.round(s.fontSize*o.default.FONT_SIZE_COEFFICIENT),color:s.color.slice(1),background:"none",align:"center"})}}),l.length&&(a.has_text=1,a.texts=l),c.length&&(a.has_sticker=1,a.stickers=c),t.forEach(function(e){p.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})}),p.length&&(a.has_graffiti=1,a.graffities=p),a}},vRp6:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return c});r("a1Th"),r("Btvt"),r("rE2o"),r("ioFf"),r("rGqo");var i=r("q1tI"),n=(r("17x9"),r("UlUB")),o=r("PjZB"),s=r("pemR");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],i=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class c extends i.Component{constructor(e){super(e),this.checkLoad=Object(n.throttle)(e=>{var t=a(e,3),r=t[0],i=t[1],n=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(i-r-n<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var r=this.state,i=this.getChildrenData(e,t||this.getScrollData()),n=i.start,o=i.end,s=i.before,a=i.after;n===r.start&&o===r.end&&s===r.before&&a===r.after||this.setState(i)}getChildrenData(e,t){var r=a(t,3),i=r[0],n=r[1],o=r[2],s=this.useWindowScroll?window:this.container,c=s&&s.offsetHeight;if(!s||0===n||0===o)return{start:0,end:0,before:0,after:e.length};o=Math.max(o,c);var l=e.length,p=Math.max(Math.floor(i/this.props.itemHeight)-1,0),d=Math.min(Math.floor((i+2*o)/this.props.itemHeight+1),l);return{start:p,end:d,before:p,after:l-d}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return i.createElement("div",{className:Object(s.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&i.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&i.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||i.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},i.createElement(o.default,null))))}}c.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vTYg:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("Iwry");function n(e,t,r){var n="."+e+":"+t,o=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return i.toArray(e).map(function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")+";"}).join(" ")}(r);return document.createTextNode(n+"{"+o+"}")}t.default=function(e,t){[":before",":after"].forEach(function(r){return function(e,t,r){var o=window.getComputedStyle(e,r),s=o.getPropertyValue("content");if(""!==s&&"none"!==s){var a=i.uuid(),c=document.createElement("style");c.appendChild(n(a,r,o)),t.className=t.className+" "+a,t.appendChild(c)}}(e,t,r)})}},wZQE:function(e,t,r){e.exports=function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},t=function(e,t,r,i,n){if(e<7&&t<7)return!1;if(e>=r-7&&t<7)return!1;if(e<7&&t>=r-7)return!1;if(n){var o=9;r<=25&&o--;var s=(r-14-o)/2-1;return r<=25&&s++,!(e>7+s&&e<r-7-s-1&&t>7+s&&t<r-7-s-1)&&0<=e&&e<r&&0<=t&&t<r&&i[t][e]}return i[t]&&i[t][e]},r=function(e,r,i,n,o){return void 0===o&&(o=!0),{l:t(e-1,r,i,n,o),r:t(e+1,r,i,n,o),t:t(e,r-1,i,n,o),b:t(e,r+1,i,n,o),current:t(e,r,i,n,o)}},i=function(e,i){if("number"!=typeof i.qrSize)throw new Error("Size should be a number");if("string"!=typeof i.className)throw new Error("Classname should be a string");for(var n=84.7776815,o=[],s=0,a=0,c=0,l=0,p=0;p<e.size;p++){s=0;for(var d=0;d<e.size;d++){c=d+s,s+=96,l=p+a;var h,u=r(d,p,e.size,e.modules,i.isShowLogo),_="";u.current?(_=!(_=_||u.l||u.r||u.t||u.b?"":"empty")&&u.l&&u.r||u.t&&u.b?"rect":"")||(_+=u.l?"l":u.r?"r":"",(_+=u.t?"t":u.b?"b":"")||(_="empty")):_=!(_=!(_=!(_=!_&&u.l&&u.t&&t(d-1,p-1,e.size,e.modules,i.isShowLogo)?"n_lt":"")&&u.l&&u.b&&t(d-1,p+1,e.size,e.modules,i.isShowLogo)?"n_lb":"")&&u.r&&u.t&&t(d+1,p-1,e.size,e.modules,i.isShowLogo)?"n_rt":"")&&u.r&&u.b&&t(d+1,p+1,e.size,e.modules,i.isShowLogo)?"n_rb":"",_&&(h='<use xlink:href="#'+_+"-"+i.suffix+'"/>',o.push('<g transform="translate('+c+","+l+')">'+h+"</g>"))}a+=96}var f="",m=(e.size-21)/2*96+672-10;e.size<=25&&(f="scale(0.85)",m+=50);var b=96*(e.size-7);o.push('<use fill-rule="evenodd" transform="translate(0,0)" xlink:href="#point-'+i.suffix+'"/>'),o.push('<use fill-rule="evenodd" transform="translate('+b+',0)" xlink:href="#point-'+i.suffix+'"/>'),o.push('<use fill-rule="evenodd" transform="translate(0,'+b+')" xlink:href="#point-'+i.suffix+'"/>'),i.isShowLogo&&(i.logoData?o.push('\n        <image \n          preserveAspectRatio="xMidYMid slice" clip-path="url(#logo-mask-'+i.suffix+')"\n          style="width: 750px; height: 750px;" width="750" height="750" \n          transform="translate('+m+","+m+") "+f+'" \n          xlink:href="'+i.logoData+'" \n        />\n      '):o.push('\n        <use style="width: 750px; height: 750px;" width="750" height="750" \n          fill="none" \n          fill-rule="evenodd" \n          transform="translate('+m+","+m+") "+f+'" xlink:href="#vk_logo-'+i.suffix+'"\n        />\n      '));var g=99*e.size,v="",w="translate(0,0)";if(i.isShowBackground){var E=(i.qrSize-40)/i.qrSize,y=g/i.qrSize*21;v='\n      <rect \n        x="0" \n        width="'+g+'" \n        height="'+g+'" \n        rx="'+Math.ceil(g/(i.qrSize/36))+'" \n        fill="'+i.backgroundColor+'"\n      />',w="translate("+y+", "+y+") scale("+E+")"}var O="M0,0 L66,0 C"+n+",-3.44940413e-15 100,15.2223185 100,34 L100,66 C100,"+n+" "+n+",100 66,100 L0,100 L0,0 Z",C="M0,0 L100,0 L100,66 C100,"+n+" "+n+",100 66,100 L0,100 L0,0 Z";return'\n  <svg \n    version="1.1" \n    viewBox="0 0 '+g+" "+g+'" \n    width="'+i.qrSize+'px" \n    height="'+i.qrSize+'px"\n    '+(i.className?'class="'+i.className+'"':"")+' \n    xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n  >\n    <defs>\n      <rect id="rect-'+i.suffix+'" width="100" height="100" fill="'+i.foregroundColor+'"/>\n      <path \n        id="empty-'+i.suffix+'" \n        d="M0,28.6v42.9C0,87.3,12.8,100,28.6,100h42.9c15.9,0,28.6-12.8,28.6-28.6V28.6C100,12.7,87.2,0,71.4,0H28.6 C12.8,0,0,12.8,0,28.6z"\n        fill="'+i.foregroundColor+'"\n      />\n      <path id="b-'+i.suffix+'" d="'+O+'" transform="rotate(-90 50 50)" fill="'+i.foregroundColor+'"/>\n      <path id="r-'+i.suffix+'" d="'+O+'" transform="rotate(-180 50 50)" fill="'+i.foregroundColor+'"/>\n      <path id="l-'+i.suffix+'" d="'+O+'" fill="'+i.foregroundColor+'"/>\n      <path id="t-'+i.suffix+'" d="'+O+'" transform="rotate(90 50 50)" fill="'+i.foregroundColor+'"/>\n      <path id="l-'+i.suffix+'" d="'+C+'" transform="rotate(-90 50 50)" fill="'+i.foregroundColor+'"/>\n      <path id="lt-'+i.suffix+'" d="'+C+'" fill="'+i.foregroundColor+'"/>\n      <path id="lb-'+i.suffix+'" d="'+C+'" transform="rotate(-90 50 50)" fill="'+i.foregroundColor+'"/>\n      <path id="rb-'+i.suffix+'" d="'+C+'" transform="rotate(-180 50 50)" fill="'+i.foregroundColor+'"/>\n      <path id="rt-'+i.suffix+'" d="'+C+'" transform="rotate(90 50 50)" fill="'+i.foregroundColor+'"/>\n      <path \n        id="n_lt-'+i.suffix+'" \n        d="M30.5,2V0H0v30.5h2C2,14.7,14.8,2,30.5,2z" \n        fill="'+i.foregroundColor+'"\n      />\n      <path \n        id="n_lb-'+i.suffix+'"\n        d="M2,69.5H0V100h30.5v-2C14.7,98,2,85.2,2,69.5z" \n        fill="'+i.foregroundColor+'"\n      />\n      <path \n        id="n_rt-'+i.suffix+'" \n        d="M98,30.5h2V0H69.5v2C85.3,2,98,14.8,98,30.5z" \n        fill="'+i.foregroundColor+'"\n      />\n      <path id="n_rb-'+i.suffix+'" \n        d="M69.5,98v2H100V69.5h-2C98,85.3,85.2,98,69.5,98z" \n        fill="'+i.foregroundColor+'"\n      />\n      <path \n        id="point-'+i.suffix+'" \n        fill="'+i.foregroundColor+'"\n        d="M600.001786,457.329333 L600.001786,242.658167 C600.001786,147.372368 587.039517,124.122784 581.464617,118.535383 C575.877216,112.960483 552.627632,99.9982143 457.329333,99.9982143 L242.670667,99.9982143 C147.372368,99.9982143 124.122784,112.960483 118.547883,118.535383 C112.972983,124.122784 99.9982143,147.372368 99.9982143,242.658167 L99.9982143,457.329333 C99.9982143,552.627632 112.972983,575.877216 118.547883,581.464617 C124.122784,587.027017 147.372368,600.001786 242.670667,600.001786 L457.329333,600.001786 C552.627632,600.001786 575.877216,587.027017 581.464617,581.464617 C587.039517,575.877216 600.001786,552.627632 600.001786,457.329333 Z M457.329333,0 C653.338333,0 700,46.6616668 700,242.658167 C700,438.667167 700,261.332833 700,457.329333 C700,653.338333 653.338333,700 457.329333,700 C261.332833,700 438.667167,700 242.670667,700 C46.6616668,700 0,653.338333 0,457.329333 C0,261.332833 0,352.118712 0,242.658167 C0,46.6616668 46.6616668,0 242.670667,0 C438.667167,0 261.332833,0 457.329333,0 Z M395.996667,200 C480.004166,200 500,220.008332 500,303.990835 C500,387.998334 500,312.001666 500,395.996667 C500,479.991668 480.004166,500 395.996667,500 C312.001666,500 387.998334,500 304.003333,500 C220.008332,500 200,479.991668 200,395.996667 C200,312.001666 200,350.906061 200,303.990835 C200,220.008332 220.008332,200 304.003333,200 C387.998334,200 312.001666,200 395.996667,200 Z" \n      />\n      <g id="vk_logo-'+i.suffix+'">\n        <path \n          fill="'+i.logoColor+'" \n          d="M253.066667,0 C457.466667,0 272.533333,0 476.933333,0 C681.333333,0 730,48.6666667 730,253.066667 C730,457.466667 730,272.533333 730,476.933333 C730,681.333333 681.333333,730 476.933333,730 C272.533333,730 457.466667,730 253.066667,730 C48.6666667,730 0,681.333333 0,476.933333 C0,272.533333 0,367.206459 0,253.066667 C0,48.6666667 48.6666667,0 253.066667,0 Z"/><path fill="#FFF" d="M597.816744,251.493445 C601.198942,240.214758 597.816746,231.927083 581.719678,231.927083 L528.490512,231.927083 C514.956087,231.927083 508.716524,239.08642 505.332448,246.981031 C505.332448,246.981031 478.263599,312.960647 439.917002,355.818719 C427.510915,368.224806 421.871102,372.172112 415.10389,372.172112 C411.720753,372.172112 406.822917,368.224806 406.822917,356.947057 L406.822917,251.493445 C406.822917,237.95902 402.895137,231.927083 391.615512,231.927083 L307.969678,231.927083 C299.511836,231.927083 294.425223,238.208719 294.425223,244.162063 C294.425223,256.99245 313.597583,259.951287 315.573845,296.043086 L315.573845,374.428788 C315.573845,391.614583 312.470184,394.730425 305.702972,394.730425 C287.658011,394.730425 243.763595,328.456052 217.730151,252.620844 C212.628223,237.881107 207.511068,231.927083 193.907178,231.927083 L140.678012,231.927083 C125.469678,231.927083 122.427826,239.08642 122.427826,246.981031 C122.427826,261.079625 140.473725,331.006546 206.452402,423.489903 C250.437874,486.648674 312.410515,520.885417 368.803012,520.885417 C402.638134,520.885417 406.823845,513.28125 406.823845,500.183098 L406.823845,452.447917 C406.823845,437.239583 410.029185,434.204421 420.743703,434.204421 C428.638315,434.204421 442.172739,438.151727 473.753063,468.603713 C509.843923,504.694573 515.79398,520.885417 536.094678,520.885417 L589.323845,520.885417 C604.532178,520.885417 612.136345,513.28125 607.749619,498.274853 C602.949226,483.318593 585.717788,461.619053 562.853283,435.89599 C550.446258,421.234166 531.837128,405.444943 526.197316,397.548454 C518.302704,387.399043 520.558441,382.88663 526.197316,373.864619 C526.197316,373.864619 591.049532,282.508661 597.816744,251.493445 Z"\n        />\n      </g>\n      <clipPath id="logo-mask-'+i.suffix+'">\n        <rect x="0" y="0" width="750" height="750" />\n      </clipPath>\n    </defs>\n\n    '+v+'\n\n    <g transform="'+w+'">\n      '+o.join("\n")+"\n    </g>\n  </svg>"},n=function(){function e(t,r,i,n){if(this.version=t,this.errorCorrectionLevel=r,this.mask=n,this.modules=[],this.isFunction=[],t<e.MIN_VERSION||t>e.MAX_VERSION)throw"Version value out of range";if(n<-1||n>7)throw"Mask value out of range";this.size=4*t+17;for(var o=[],s=0;s<this.size;s++)o.push(!1);for(s=0;s<this.size;s++)this.modules.push(o.slice()),this.isFunction.push(o.slice());this.drawFunctionPatterns();var a=this.addEccAndInterleave(i);if(this.drawCodewords(a),-1==n){var c=1e9;for(s=0;s<8;s++){this.applyMask(s),this.drawFormatBits(s);var l=this.getPenaltyScore();l<c&&(n=s,c=l),this.applyMask(s)}}if(n<0||n>7)throw"Assertion error";this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}return e.encodeText=function(t,r){var i=s.makeSegments(t);return e.encodeSegments(i,r)},e.encodeBinary=function(t,r){var i=s.makeBytes(t);return e.encodeSegments([i],r)},e.encodeSegments=function(t,r,i,n,o,a){if(void 0===i&&(i=1),void 0===n&&(n=40),void 0===o&&(o=-1),void 0===a&&(a=!0),!(e.MIN_VERSION<=i&&i<=n&&n<=e.MAX_VERSION)||o<-1||o>7)throw"Invalid value";var l,p;for(l=i;;l++){var d=8*e.getNumDataCodewords(l,r),h=s.getTotalBits(t,l);if(h<=d){p=h;break}if(l>=n)throw"Data too long"}for(var u=0,_=[e.Ecc.MEDIUM,e.Ecc.QUARTILE,e.Ecc.HIGH];u<_.length;u++){var f=_[u];a&&p<=8*e.getNumDataCodewords(l,f)&&(r=f)}for(var m=new c,b=0,g=t;b<g.length;b++){var v=g[b];m.appendBits(v.mode.modeBits,4),m.appendBits(v.numChars,v.mode.numCharCountBits(l));for(var w=0,E=v.getData();w<E.length;w++){var y=E[w];m.array.push(y)}}if(m.array.length!=p)throw"Assertion error";var O=8*e.getNumDataCodewords(l,r);if(m.array.length>O)throw"Assertion error";if(m.appendBits(0,Math.min(4,O-m.array.length)),m.appendBits(0,(8-m.array.length%8)%8),m.array.length%8!=0)throw"Assertion error";for(var C=236;m.array.length<O;C^=253)m.appendBits(C,8);for(var S=[];8*S.length<m.array.length;)S.push(0);return m.array.forEach(function(e,t){return S[t>>>3]|=e<<7-(7&t)}),new e(l,r,S,o)},e.prototype.getModule=function(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]},e.prototype.drawCanvas=function(e,t,r){if(e<=0||t<0)throw"Value out of range";var i=(this.size+2*t)*e;r.width=i,r.height=i;for(var n=r.getContext("2d"),o=-t;o<this.size+t;o++)for(var s=-t;s<this.size+t;s++)n.fillStyle=this.getModule(s,o)?"#000000":"#FFFFFF",n.fillRect((s+t)*e,(o+t)*e,e,e)},e.prototype.toSvgString=function(e){if(e<0)throw"Border must be non-negative";for(var t=[],r=0;r<this.size;r++)for(var i=0;i<this.size;i++)this.getModule(i,r)&&t.push("M"+(i+e)+","+(r+e)+"h1v1h-1z");return'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+(this.size+2*e)+" "+(this.size+2*e)+'" stroke="none">\n\t<rect width="100%" height="100%" fill="#FFFFFF"/>\n\t<path d="'+t.join(" ")+'" fill="#000000"/>\n</svg>\n'},e.prototype.drawFunctionPatterns=function(){for(var e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);var t=this.getAlignmentPatternPositions(),r=t.length;for(e=0;e<r;e++)for(var i=0;i<r;i++)0==e&&0==i||0==e&&i==r-1||e==r-1&&0==i||this.drawAlignmentPattern(t[e],t[i]);this.drawFormatBits(0),this.drawVersion()},e.prototype.drawFormatBits=function(e){for(var t=this.errorCorrectionLevel.formatBits<<3|e,r=t,i=0;i<10;i++)r=r<<1^1335*(r>>>9);var n=21522^(t<<10|r);if(n>>>15!=0)throw"Assertion error";for(i=0;i<=5;i++)this.setFunctionModule(8,i,o(n,i));for(this.setFunctionModule(8,7,o(n,6)),this.setFunctionModule(8,8,o(n,7)),this.setFunctionModule(7,8,o(n,8)),i=9;i<15;i++)this.setFunctionModule(14-i,8,o(n,i));for(i=0;i<8;i++)this.setFunctionModule(this.size-1-i,8,o(n,i));for(i=8;i<15;i++)this.setFunctionModule(8,this.size-15+i,o(n,i));this.setFunctionModule(8,this.size-8,!0)},e.prototype.drawVersion=function(){if(!(this.version<7)){for(var e=this.version,t=0;t<12;t++)e=e<<1^7973*(e>>>11);var r=this.version<<12|e;if(r>>>18!=0)throw"Assertion error";for(t=0;t<18;t++){var i=o(r,t),n=this.size-11+t%3,s=Math.floor(t/3);this.setFunctionModule(n,s,i),this.setFunctionModule(s,n,i)}}},e.prototype.drawFinderPattern=function(e,t){for(var r=-4;r<=4;r++)for(var i=-4;i<=4;i++){var n=Math.max(Math.abs(i),Math.abs(r)),o=e+i,s=t+r;0<=o&&o<this.size&&0<=s&&s<this.size&&this.setFunctionModule(o,s,2!=n&&4!=n)}},e.prototype.drawAlignmentPattern=function(e,t){for(var r=-2;r<=2;r++)for(var i=-2;i<=2;i++)this.setFunctionModule(e+i,t+r,1!=Math.max(Math.abs(i),Math.abs(r)))},e.prototype.setFunctionModule=function(e,t,r){this.modules[t][e]=r,this.isFunction[t][e]=!0},e.prototype.addEccAndInterleave=function(t){var r=this.version,i=this.errorCorrectionLevel;if(t.length!=e.getNumDataCodewords(r,i))throw"Invalid argument";for(var n=e.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][r],o=e.ECC_CODEWORDS_PER_BLOCK[i.ordinal][r],s=Math.floor(e.getNumRawDataModules(r)/8),c=n-s%n,l=Math.floor(s/n),p=[],d=new a(o),h=0,u=0;h<n;h++){var _=t.slice(u,u+l-o+(h<c?0:1));u+=_.length;var f=d.getRemainder(_);h<c&&_.push(0),p.push(_.concat(f))}var m=[];for(h=0;h<p[0].length;h++)for(var b=0;b<p.length;b++)(h!=l-o||b>=c)&&m.push(p[b][h]);if(m.length!=s)throw"Assertion error";return m},e.prototype.drawCodewords=function(t){if(t.length!=Math.floor(e.getNumRawDataModules(this.version)/8))throw"Invalid argument";for(var r=0,i=this.size-1;i>=1;i-=2){6==i&&(i=5);for(var n=0;n<this.size;n++)for(var s=0;s<2;s++){var a=i-s,c=0==(i+1&2)?this.size-1-n:n;!this.isFunction[c][a]&&r<8*t.length&&(this.modules[c][a]=o(t[r>>>3],7-(7&r)),r++)}}if(r!=8*t.length)throw"Assertion error"},e.prototype.applyMask=function(e){if(e<0||e>7)throw"Mask value out of range";for(var t=0;t<this.size;t++)for(var r=0;r<this.size;r++){var i=void 0;switch(e){case 0:i=(r+t)%2==0;break;case 1:i=t%2==0;break;case 2:i=r%3==0;break;case 3:i=(r+t)%3==0;break;case 4:i=(Math.floor(r/3)+Math.floor(t/2))%2==0;break;case 5:i=r*t%2+r*t%3==0;break;case 6:i=(r*t%2+r*t%3)%2==0;break;case 7:i=((r+t)%2+r*t%3)%2==0;break;default:throw"Assertion error"}!this.isFunction[t][r]&&i&&(this.modules[t][r]=!this.modules[t][r])}},e.prototype.getPenaltyScore=function(){for(var t=0,r=0;r<this.size;r++){for(var i=[0,0,0,0,0,0,0],n=!1,o=0,s=0;s<this.size;s++)this.modules[r][s]==n?5==++o?t+=e.PENALTY_N1:o>5&&t++:(e.addRunToHistory(o,i),!n&&e.hasFinderLikePattern(i)&&(t+=e.PENALTY_N3),n=this.modules[r][s],o=1);e.addRunToHistory(o,i),n&&e.addRunToHistory(0,i),e.hasFinderLikePattern(i)&&(t+=e.PENALTY_N3)}for(s=0;s<this.size;s++){i=[0,0,0,0,0,0,0],n=!1;var a=0;for(r=0;r<this.size;r++)this.modules[r][s]==n?5==++a?t+=e.PENALTY_N1:a>5&&t++:(e.addRunToHistory(a,i),!n&&e.hasFinderLikePattern(i)&&(t+=e.PENALTY_N3),n=this.modules[r][s],a=1);e.addRunToHistory(a,i),n&&e.addRunToHistory(0,i),e.hasFinderLikePattern(i)&&(t+=e.PENALTY_N3)}for(r=0;r<this.size-1;r++)for(s=0;s<this.size-1;s++)(n=this.modules[r][s])==this.modules[r][s+1]&&n==this.modules[r+1][s]&&n==this.modules[r+1][s+1]&&(t+=e.PENALTY_N2);for(var c=0,l=0,p=this.modules;l<p.length;l++)for(var d=0,h=p[l];d<h.length;d++)(n=h[d])&&c++;var u=this.size*this.size;return t+=(Math.ceil(Math.abs(20*c-10*u)/u)-1)*e.PENALTY_N4},e.prototype.getAlignmentPatternPositions=function(){if(1==this.version)return[];for(var e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((this.size-13)/(2*e-2)),r=[6],i=this.size-7;r.length<e;i-=t)r.splice(1,0,i);return r},e.getNumRawDataModules=function(t){if(t<e.MIN_VERSION||t>e.MAX_VERSION)throw"Version number out of range";var r=(16*t+128)*t+64;if(t>=2){var i=Math.floor(t/7)+2;r-=(25*i-10)*i-55,t>=7&&(r-=36)}return r},e.getNumDataCodewords=function(t,r){return Math.floor(e.getNumRawDataModules(t)/8)-e.ECC_CODEWORDS_PER_BLOCK[r.ordinal][t]*e.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][t]},e.addRunToHistory=function(e,t){t.pop(),t.unshift(e)},e.hasFinderLikePattern=function(e){var t=e[1];return t>0&&e[2]==t&&e[4]==t&&e[5]==t&&e[3]==3*t&&Math.max(e[0],e[6])>=4*t},e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e}();function o(e,t){return 0!=(e>>>t&1)}var s=function(){function e(e,t,r){if(this.mode=e,this.numChars=t,this.bitData=r,t<0)throw"Invalid argument";this.bitData=r.slice()}return e.makeBytes=function(t){for(var r=new c,i=0,n=t;i<n.length;i++){var o=n[i];r.appendBits(o,8)}return new e(e.Mode.BYTE,t.length,r.array)},e.makeNumeric=function(t){if(!this.NUMERIC_REGEX.test(t))throw"String contains non-numeric characters";for(var r=new c,i=0;i<t.length;){var n=Math.min(t.length-i,3);r.appendBits(parseInt(t.substr(i,n),10),3*n+1),i+=n}return new e(e.Mode.NUMERIC,t.length,r.array)},e.makeAlphanumeric=function(t){if(!this.ALPHANUMERIC_REGEX.test(t))throw"String contains unencodable characters in alphanumeric mode";var r,i=new c;for(r=0;r+2<=t.length;r+=2){var n=45*e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r));n+=e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r+1)),i.appendBits(n,11)}return r<t.length&&i.appendBits(e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r)),6),new e(e.Mode.ALPHANUMERIC,t.length,i.array)},e.makeSegments=function(t){return""==t?[]:this.NUMERIC_REGEX.test(t)?[e.makeNumeric(t)]:this.ALPHANUMERIC_REGEX.test(t)?[e.makeAlphanumeric(t)]:[e.makeBytes(e.toUtf8ByteArray(t))]},e.makeEci=function(t){var r=new c;if(t<0)throw"ECI assignment value out of range";if(t<128)r.appendBits(t,8);else if(t<16384)r.appendBits(2,2),r.appendBits(t,14);else{if(!(t<1e6))throw"ECI assignment value out of range";r.appendBits(6,3),r.appendBits(t,21)}return new e(e.Mode.ECI,0,r.array)},e.prototype.getData=function(){return this.bitData.slice()},e.getTotalBits=function(e,t){for(var r=0,i=0,n=e;i<n.length;i++){var o=n[i],s=o.mode.numCharCountBits(t);if(o.numChars>=1<<s)return 1/0;r+=4+s+o.bitData.length}return r},e.toUtf8ByteArray=function(e){e=encodeURI(e);for(var t=[],r=0;r<e.length;r++)"%"!=e.charAt(r)?t.push(e.charCodeAt(r)):(t.push(parseInt(e.substr(r+1,2),16)),r+=2);return t},e.NUMERIC_REGEX=/^[0-9]*$/,e.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,e.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e}(),a=function(){function e(t){if(this.coefficients=[],t<1||t>255)throw"Degree out of range";for(var r=this.coefficients,i=0;i<t-1;i++)r.push(0);r.push(1);var n=1;for(i=0;i<t;i++){for(var o=0;o<r.length;o++)r[o]=e.multiply(r[o],n),o+1<r.length&&(r[o]^=r[o+1]);n=e.multiply(n,2)}}return e.prototype.getRemainder=function(t){for(var r=this.coefficients.map(function(e){return 0}),i=function(t){var i=t^r.shift();r.push(0),n.coefficients.forEach(function(t,n){return r[n]^=e.multiply(t,i)})},n=this,o=0,s=t;o<s.length;o++)i(s[o]);return r},e.multiply=function(e,t){if(e>>>8!=0||t>>>8!=0)throw"Byte out of range";for(var r=0,i=7;i>=0;i--)r=r<<1^285*(r>>>7),r^=(t>>>i&1)*e;if(r>>>8!=0)throw"Assertion error";return r},e}(),c=function(){function e(){this.array=[]}return e.prototype.appendBits=function(e,t){if(t<0||t>31||e>>>t!=0)throw"Value out of range";for(var r=t-1;r>=0;r--)this.array.push(e>>>r&1)},e}();(function(e){var t=function(){function e(e,t){this.ordinal=e,this.formatBits=t}return e.LOW=new e(0,1),e.MEDIUM=new e(1,0),e.QUARTILE=new e(2,3),e.HIGH=new e(3,2),e}();e.Ecc=t})(n||(n={})),function(e){var t=function(){function e(e,t){this.modeBits=e,this.numBitsCharCount=t}return e.prototype.numCharCountBits=function(e){return this.numBitsCharCount[Math.floor((e+7)/17)]},e.NUMERIC=new e(1,[10,12,14]),e.ALPHANUMERIC=new e(2,[9,11,13]),e.BYTE=new e(4,[8,16,16]),e.KANJI=new e(8,[8,10,12]),e.ECI=new e(7,[0,0,0]),e}();e.Mode=t}(s||(s={}));var l=128,p="#ffffff",d="#000000",h="#4680c2";return{createQR:function(t,r,o,a){if("string"!=typeof t)throw new TypeError("Enter text for encoding");var c=e({},"object"==typeof r&&null!==r?r:{},"object"==typeof a&&null!==a?a:{},{qrSize:"object"==typeof r&&null!==r&&"number"==typeof r.qrSize?r.qrSize:r,className:"object"==typeof r&&null!==r&&"string"==typeof r.className?r.className:o}),u=[n.Ecc.LOW,n.Ecc.MEDIUM,n.Ecc.QUARTILE,n.Ecc.HIGH],_={qrSize:"number"==typeof c.qrSize?c.qrSize:l,className:"string"==typeof c.className?c.className:o||"",isShowLogo:!!c.isShowLogo||!1,isShowBackground:!!c.isShowBackground||!1,foregroundColor:"string"==typeof c.foregroundColor?c.foregroundColor:d,backgroundColor:"string"==typeof c.backgroundColor?c.backgroundColor:p,logoColor:"string"==typeof c.logoColor?c.logoColor:h,suffix:c.suffix?c.suffix.toString():"0",logoData:"string"==typeof c.logoData?c.logoData:null,ecc:"number"==typeof c.ecc&&u[c.ecc]?c.ecc:3},f=s.makeSegments(t),m=n.encodeSegments(f,u[_.ecc],1,40,-1,!0);return i(m,_)}}}()},xYVc:function(e,t,r){"use strict";r.r(t);var i=r("t7n3");t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(i.isRetina)()?2:1,STICKER_SMALL:64,STICKER_MEDIUM:Object(i.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#E64646","#FF9300","#FFCB00","#62DA37","#00AEF9","#CC74E1"],FONTS:["classic","cursive","marker","italics","typewriter","poster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"}}},xkiS:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("Iwry");t.default=function(e,t,r){var n="http://www.w3.org/2000/svg",o=document.createElementNS(n,"svg"),s=document.createElementNS(n,"foreignObject");return o.setAttributeNS("","width",""+t),o.setAttributeNS("","height",""+r),s.setAttributeNS("","width","100%"),s.setAttributeNS("","height","100%"),s.setAttributeNS("","x","0"),s.setAttributeNS("","y","0"),s.setAttributeNS("","externalResourcesRequired","true"),o.appendChild(s),s.appendChild(e),i.svgToDataURL(o)}},xo6n:function(e,t,r){"use strict";r.r(t);r("KKXr"),r("Vd3H"),r("rGqo"),r("Btvt"),r("91GP");var i=r("UlUB"),n=r("gF8j"),o={id:"active_time",triggerEvents:"mouseover mousedown keypress",timeout:15e3,maxChainInterval:0,doesScrollTriggerIdle:!1,callback:()=>{}};var s=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._timeChainStart=void 0,this._timeStart=0,this._timeActivityStart=0,this._sumActiveTime=0,this.opts=Object.assign({},o,e),this._idle=new n.default({id:this.opts.id,element:document,focusElement:window,triggerEvents:this.opts.triggerEvents,idleTimeout:this.opts.timeout}),window.addEventListener("beforeunload",this._onTabClose.bind(this)),this.opts.doesScrollTriggerIdle&&window.addEventListener("scroll",Object(i.throttle)(this._onScroll.bind(this),this.opts.timeout)),this._idle.on("idle",this._onTabInactive.bind(this)),this._idle.on("unidle",this._onTabActive.bind(this)),this._idle.start(),this._timeChainStart=Date.now(),document.activeElement===document.body&&this.start()}_checkTimeLimit(){this._timeStart&&this.opts.maxChainInterval&&(Date.now()-this._timeStart>this.opts.maxChainInterval&&this.endInterval())}_sessionEnd(){this.opts.callback(this.getData())}getData(){var e=Date.now(),t=this._sumActiveTime;return this._timeActivityStart&&(t+=e-this._timeActivityStart),{timeChainStart:this._timeChainStart,timeStart:this._timeStart,timeEnd:e,activeTime:t}}_onTabActive(){this.start()}_onTabInactive(){this.stop()}_onTabClose(){this.endInterval()}_onScroll(){this._idle.unidle(),clearTimeout(this._idleTimeoutHandler),this._idleTimeoutHandler=setTimeout(()=>this._idle.idle(),2*this.opts.timeout)}stop(){this._timeActivityStart&&(this._sumActiveTime+=Date.now()-this._timeActivityStart,this._checkTimeLimit(),this._timeActivityStart=0)}start(){if(this._checkTimeLimit(),!this._timeActivityStart){var e=Date.now();this._timeStart||(this._timeStart=e),this._timeActivityStart=e}}resetToNewTimer(){this._timeStart=0,this._sumActiveTime=0,this._timeActivityStart=0}endInterval(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._timeActivityStart?(e&&this._sessionEnd(),this._idle.stop(),this.resetToNewTimer(),this):this}startInterval(){return this._idle.start(),this.start(),this}},a=r("J8bf"),c=r("W0P9");r.d(t,"default",function(){return h});var l="remixapp_session",p=10,d={triggerEvents:"mousemove keydown keypress",timeout:18e4};class h{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.opts=Object.assign({},d,t),this.activeTime=null,this.sessionId=null,this.sessions={},this.appId=e,this.lastIdleTs=0}start(){this._loadSessions(),this.sessionId=this._getSessionId(),Object(c.log)("[AppSessionTimeLogger] started with session id",this.sessionId),this.activeTime=new s({id:`app_${this.appId}`,triggerEvents:this.opts.triggerEvents,timeout:this.opts.timeout,doesScrollTriggerIdle:!0,callback:this._saveSession.bind(this)}),this.activeTime._idle.on("idle",this._onIdle.bind(this)),this.activeTime._idle.on("unidle",this._onUnIdle.bind(this)),this.activeTime.start()}stop(){Object(c.log)("[AppSessionTimeLogger] stopped."),this.activeTime&&(this.activeTime.endInterval(),this.activeTime.stop(),this.sessions={},this.activeTime=null)}idle(){this.activeTime&&this.activeTime._idle.cbInactive()}unIdle(){this.activeTime&&this.activeTime._idle.cbActive()}_clearOldSessions(){var e=Object.keys(this.sessions);e.length>p&&(e.sort((e,t)=>{var r=+e.split("_")[1];return+t.split("_")[1]-r}),e.slice(p).forEach(e=>{delete this.sessions[e],Object(c.log)("[AppSessionTimeLogger] deleted old session",e)}))}_saveSession(){this._logSession(),Object(a.setCookie)(l,JSON.stringify(this.sessions),.01)}_logSession(){if(this.sessionId&&this.activeTime){this._clearOldSessions();var e=this.activeTime.getData().activeTime;(e=Math.round(e/1e3))>0&&(this.sessions[this.sessionId]=e),Object(c.log)("[AppSessionTimeLogger] Log sessions:",this.sessions)}}_onIdle(){this.lastIdleTs=Date.now()}_onUnIdle(){this.activeTime&&(this.lastIdleTs&&Date.now()-this.lastIdleTs>this.opts.timeout&&(this.activeTime.endInterval(),this.activeTime.startInterval(),this.sessionId=this._getSessionId(),Object(c.log)("[AppSessionTimeLogger] last session is ended after timeout",this.opts.timeout),Object(c.log)("[AppSessionTimeLogger] start new session with id",this.sessionId)),this.lastIdleTs=0)}_getSessionId(){return`${this.appId}_${Date.now()}`}_loadSessions(){var e=Object(a.getCookie)(l);if(e)try{this.sessions=JSON.parse(e)}catch(e){this.sessions={}}Object(c.log)("[AppSessionTimeLogger] Load old sessions from cookie",this.sessions)}}},yOtm:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry"),o=i(r("vTYg"));function s(e){return e instanceof HTMLCanvasElement?n.createImage(e.toDataURL()):e.tagName&&"svg"===e.tagName.toLowerCase()?Promise.resolve(e).then(function(e){return n.svgToDataURL(e)}).then(n.createImage):Promise.resolve(e.cloneNode(!1))}function a(e,t){return t instanceof Element?Promise.resolve().then(function(){return function(e,t){var r=window.getComputedStyle(e),i=t.style;r.cssText?i.cssText=r.cssText:n.toArray(r).forEach(function(e){i.setProperty(e,r.getPropertyValue(e),r.getPropertyPriority(e))})}(e,t)}).then(function(){return o.default(e,t)}).then(function(){return function(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}(e,t)}).then(function(){return t}):t}function c(e,t,r){return r||!t||t(e)?Promise.resolve(e).then(s).then(function(r){return function(e,t,r){var i=n.toArray(e.childNodes);return 0===i.length?Promise.resolve(t):i.reduce(function(e,i){return e.then(function(){return c(i,r)}).then(function(e){e&&t.appendChild(e)})},Promise.resolve()).then(function(){return t})}(e,r,t)}).then(function(t){return a(e,t)}):Promise.resolve(null)}t.default=c},z9Td:function(e,t,r){"use strict";r.r(t),r.d(t,"PLATFORM_MVK",function(){return i});var i="mvk"}});