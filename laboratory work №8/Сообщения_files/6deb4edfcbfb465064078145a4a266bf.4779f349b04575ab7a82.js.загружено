(window.webpackJsonp=window.webpackJsonp||[]).push([["bundles/6deb4edfcbfb465064078145a4a266bf"],{"/e88":function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},Ed98:function(e,t,r){"use strict";r.r(t);r("a1Th"),r("rE2o"),r("ioFf"),r("VRzm"),r("HEwt"),r("Oyvg"),r("fA63"),r("OG14"),r("rGqo"),r("Btvt"),r("tUrg"),r("FEjr"),r("SRfc"),r("KKXr"),r("pIFo");var a=r("u2Gu");function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s,o=window.browser&&(browser.mozilla||browser.safari);class n{constructor(e,t,r){this._mediaId=e,this._editor=t,this._highlighted=!1,this._isCaptioned=!!r,s=this.getEditor().getOptions().multiMediasSeparator}isCaptioned(){return this._isCaptioned}getEditor(){return this._editor}getMediaIdsCount(){return this._mediaId.split(s).length}getMediaId(e){return void 0!==e?this._mediaId.split(s)[e]:this._mediaId}getMediaIds(){return this._mediaId.split(s)}setMediaId(e){this._mediaId=e}highlight(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e!=this._highlighted){this._highlighted=e;var r=this.el();if(e){var i=getSize(r),s=se('<div class="article_ed__object_highlight _article_ed__object_highlight"></div>');setStyle(s,{width:i[0]+0,height:i[1]+0}),addClass(r,"article_ed__object_highlighted")}else re(geByClass1("_article_ed__object_highlight",r)),removeClass(r,"article_ed__object_highlighted");if(this._isCaptioned)if(e)this._toggleCaption(!0),this._toggleCaptionPlaceholder(this.isEmptyCaption()),t||Object(a.focusEl)(this._getCaptionEl(),!0);else{var o=this.isEmptyCaption();this._toggleCaptionPlaceholder(o),this._toggleCaption(!o)}}}render(){}appendObjectInnerEl(){var e=this.render();addClass(e,"article_object_el"),e.setAttribute("contenteditable","false");var t=geByClass1("article_object_el",this._objectEl);if(t)domReplaceEl(t,e);else{var r=geByClass1("article_ed__img_inner",this._objectEl);r.insertBefore(e,r.firstChild)}}el(){if(!this._objectEl){var e=this.render();addClass(e,"article_object_el"),e.setAttribute("contenteditable","false");var t=this.getEditor().isLocked()?"false":"true",r=browser.mozilla?`contenteditable="${t}"`:'contenteditable="false"';this._objectEl=se(`<figure ${r}></figure>`);var i=this.renderExtraControlsEl(),s=this.renderEditControlEl();if(i){var n=se('<div class="article_ed__img_wrapper"></div>'),l=se('<div class="article_ed__img_inner"></div>');i.setAttribute("contenteditable","false"),addClass(i,"article_ed__extra_controls"),l.appendChild(i),n.appendChild(l),this._objectEl.appendChild(n),this.appendObjectInnerEl()}else this._objectEl.appendChild(e);s&&this._objectEl.appendChild(s),this._isCaptioned&&(this._captionEl=se(`<figcaption class="article_ed__figcaption" contenteditable="false">\n          <div class="article_ed__figcaption_edit" contenteditable="${t}"></div>\n          <div class="article_ed__caption_placeholder" contenteditable="false">${getLang("pages_article_figure_placeholder")}</div>\n        </figcaption>`),this._objectEl.appendChild(this._captionEl)),o&&e.addEventListener("click",()=>{this.highlight(!0),Object(a.focusEl)(e)})}return this._setLoadingEl(),this._objectEl}renderExtraControlsEl(){return!1}renderEditControlEl(){return!1}renderLoadErr(){return se(`\n      <div class="article_editor_embed_error">\n        <p class="article_editor_embed_error_text">${getLang("pages_article_load_error_msg")}</p>\n      </div>\n    `)}setLoadingState(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!!this._isLoading!=e&&(this._isLoading=e,this._setLoadingEl(t),toggleClass(this._objectEl,"article_ed__object_loading",e),e||this.getEditor().onObjectStateLoaded(this))}isLoading(){return!!this._isLoading}_setLoadingEl(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._objectEl){if(re(geByClass1("article_ed___object_loading_placeholder",this._objectEl)),this._isLoading){var t=se('<div class="article_ed___object_loading_placeholder"></div>');toggleClass(t,"article_ed__object_loading_white",e),domInsertBefore(t,this._objectEl.firstChild)}toggleClass(this._objectEl,"article_ed___object_loading",!!this._isLoading)}}getCaptionEl(){return!!this._isCaptioned&&this._getCaptionEl()}isCaptionFocused(){return!!this._isCaptioned&&this._isFocusInCaption()}setCaptionElHtml(e){if(this._isCaptioned){e=e.trim();var t=this._getCaptionEl();t.innerHTML!=e&&(t.innerHTML=e),this._toggleCaptionPlaceholder(!e),this._toggleCaption(!!e)}}isEmptyCaption(){return!this._getCaptionEl().textContent.trim()}_getCaptionEl(){return geByClass1("article_ed__figcaption_edit",this._captionEl)}_toggleCaption(e){toggleClass(this._captionEl,"article_ed__figcaption_visible",e)}_toggleCaptionPlaceholder(e){void 0!==this._captionPlaceholderShown&&this._captionPlaceholderShown===e||(this._captionPlaceholderShown=toggle(geByClass1("article_ed__caption_placeholder",this._captionEl),e))}_isFocusInCaption(){var e=i(Object(a.getRange)(),2),t=e[0],r=e=>{var t=this._captionEl;return!!window.traverseParent(e,e=>e==t,10)};if(e[1])return r(t.startContainer);var s=r(t.startContainer),o=r(t.endContainer);return s&&o}loadErrorHandler(e){this.setLoadingState(!1),addClass(this._objectEl,"article_paragraph_err"),e.appendChild(this.renderLoadErr())}}var l={};function h(e){return`${(e=e.split("_"))[0]}_${e[1]}`}class d{static add(e,t,r){l[e]=l[e]||{},Object(a.isEmbedType)(e)?l[e][t]=r:l[e][h(t)]=r}static get(e,t,r){return l[e]=l[e]||{},Object(a.isEmbedType)(e)?l[e][t]:(void 0!==r&&(t=(t=t.split(","))[r]),l[e][h(t)])}static addRaw(e,t,r){l[e]=l[e]||{},l[e][t]=r}static getRaw(e,t){return l[e]=l[e]||{},l[e][t]}}var c=r("WF5+");function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class _ extends n{constructor(e,t){super(e,t,!0)}render(){this._el=se('\n      <div class="article_object_audio"></div>\n    ');var e=d.get(c.ParagraphType.ObjectAudioPlaylist,this.getMediaId());if(e.snippet)this._el.innerHTML=e.snippet;else{var t=p(this.getMediaId().split("_"),2),r=t[0],a=t[1];this.setLoadingState(!0),ajax.post("al_articles.php",{act:"get_audioplaylist_snippet",pl_owner_id:r,pl_id:a,pl_access_hash:e.accessHash},{onDone:e=>{this.setLoadingState(!1),this._el.appendChild(se(e))}})}return this._el.appendChild(se(`<div class="article_ed__audioplaylist_play_note" contenteditable="false">${getLang("pages_articles_editor_audio_play_note")}</div>`)),this._el}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(e,t){return e?`<div class="article_ed__caredit_item article_ed__caredit_item_photo" data-media-id="${t}">\n      <div class="article_ed__caredit_photo" style="background-image: url(${e})"></div>\n      <div class="article_ed__caredit_remove"><div class="article_ed__caredit_remove_icon"></div></div>\n    </div>`:`<button class="article_ed__caredit_item article_ed__caredit_item_add" nodrag="1">\n      <div class="article_ed__caredit_add"></div>\n      <div class="article_ed__caredit_item_text">${getLang("pages_article_ed_carousel_add")}</div>\n    </button>`}class v{constructor(e,t,r,a){var i='<div class="article_ed__caredit">\n                  <div class="article_ed__caredit_inner">\n    ';i+=`\n      <div class="article_ed__caredit_header">\n        <div class="article_ed__caredit_container">\n          ${getLang("pages_article_ed_carousel_title")}\n          <div class="article_ed__caredit_header_controls">\n            <div class="article_ed__caredit_header_counter"></div>\n            <button class="flat_button article_ed__caredit_save">${getLang("global_save")}</button>\n            <button class="flat_button article_ed__caredit_cancel">${getLang("global_cancel")}</button>\n          </div>\n         </div>\n      </div>\n    `,i+='\n      <div class="article_ed__caredit_items_wrap article_ed__caredit_container">\n        <div class="article_ed__caredit_items">\n    ',t.getMediaId().split(",").forEach(e=>{var t=d.get(c.ParagraphType.ObjectPhoto,e),r=g(Object(c.getAppropriateImage)(t.sizes,251),1)[0];i+=u(r,e)}),i+=u(),i+="  </div>",i+="</div>",i+='</div>\n             <div class="article_ed__caredit_loading" style="display: none"></div>\n           </div>',this._els={},this._els.editor=se(i),this._els.itemsWrap=geByClass1("article_ed__caredit_items_wrap",this._els.editor),this._els.items=geByClass1("article_ed__caredit_items",this._els.editor),this._els.addButton=geByClass1("article_ed__caredit_item_add",this._els.editor),this._els.saveButton=geByClass1("article_ed__caredit_save",this._els.editor),this._els.cancelButton=geByClass1("article_ed__caredit_cancel",this._els.editor),this._els.loading=geByClass1("article_ed__caredit_loading",this._els.editor),this._els.counter=geByClass1("article_ed__caredit_header_counter",this._els.editor),this._els.addButton.addEventListener("click",()=>{showBox("al_photos.php",{to_id:t.getEditor().getArticleOwnerId(),act:"choose_photo",max_files:this._limit-this._medias.length,article:1},{cache:1,stat:[jsc("web/photos.js"),"photos.css","upload.js"]}),cur.chooseMedia=this._onPhotoAdd.bind(this),cur.showMediaProgress=()=>{show(this._els.loading),t.getEditor().setMediaUploadMode(!0)},cur.choosePhotoUploadedAll=()=>{hide(this._els.loading),t.getEditor().setMediaUploadMode(!1)}}),this._onSave=r,this._els.saveButton.addEventListener("click",this.save.bind(this)),this._els.cancelButton.addEventListener("click",this.cancel.bind(this)),this._els.items.addEventListener("click",e=>{if(hasClass(e.target,"article_ed__caredit_remove")){var t=gpeByClass("article_ed__caredit_item",e.target);re(t),this._collectMediaIds(),this._initSorter(),this._toggleAddButton(),this._updateCounter()}}),e.appendChild(this._els.editor),setStyle(this._els.itemsWrap,{height:getSize(this._els.itemsWrap)[1]}),this._initSorter(),this._scroll=new uiScroll(this._els.itemsWrap,{global:!0,stopScrollPropagation:!0,stopScrollPropagationAlways:!0,theme:"dark"}),this._limit=a,this._originalMedias=this._collectMediaIds(),this._toggleAddButton(),this._updateCounter()}cancel(){re(this._els.editor),this._onSave(this._originalMedias.join(","))}save(){re(this._els.editor),this._onSave(this._medias.join(","))}_updateCounter(){this._els.counter.innerHTML=langNumeric(this._medias.length,cur.lang.pages_aricle_ed_carousel_counter)}_toggleAddButton(){toggle(this._els.addButton,this._medias.length<this._limit),this._scroll.update()}_collectMediaIds(){return this._medias=[],each(this._els.items.children,(e,t)=>{var r=domData(t,"media-id");r&&this._medias.push(r)}),this._medias=this._medias.slice(0,this._limit),this._medias}addPhoto(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._onPhotoAdd("photo",e,t,r)}_onPhotoAdd(e,t,r,i){if(!inArray(t,this._medias)&&this._medias.length<this._limit){d.add(c.ParagraphType.ObjectPhoto,t,{size:Object(a.getPhotoSize)(r.editable.sizes),sizes:r.editable.sizes});var s=g(Object(c.getAppropriateImage)(r.editable.sizes,251),1)[0];domInsertBefore(se(u(s,t)),this._els.addButton)}return void 0===i&&(curBox()&&curBox().hide(),this._initSorter(),this._scroll.update()),this._collectMediaIds(),this._toggleAddButton(),this._updateCounter(),!1}_initSorter(){this._sorter?this._sorter.update():stManager.add([jsc("web/grid_sorter.js")],()=>{this._sorter=new window.GridSorter(this._els.items,"",{onReorder:()=>{this._collectMediaIds()}})})}}var b,f=r("zxIV");function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class y extends n{constructor(e,t,r){super(e,t,!0),this._currentImageIndex=0,this.paragraph=r}cancelCarouselEditor(){this._carouselEditor&&this._carouselEditor.cancel()}renderExtraControlsEl(){var e=se(`\n        <div>\n          <div class="article_ed__carousel_nav_btn">\n            <div class="article_ed__carousel_nav_btn_left"></div>\n            <div class="article_ed__carousel_nav_btn_right"></div>\n          </div>\n          <div class="article_ed__carousel_btns">\n            <button class="article_ed__carousel_btn article_ed__carousel_btn_edit">${getLang("pages_article_ed_create_carousel")}</button>\n            <div class="article_ed__carousel_btn article_ed__carousel_counter"></div>\n          </div>\n        </div>\n    `);this._carouselControlsEl=e;var t=geByClass1("article_ed__carousel_btn_edit",e),r=geByClass1("article_ed__carousel_nav_btn_left",e),a=geByClass1("article_ed__carousel_nav_btn_right",e);return this._editButtonEl=t,this._controls=e,this.updateEditButtonCaption(),t.addEventListener("click",e=>(this.createCarousel(),cancelEvent(e))),r.addEventListener("click",this.prevPhotoInCarousel.bind(this)),a.addEventListener("click",this.nextPhotoInCarousel.bind(this)),this._setImageIndex(0),e}renderCarouselHover(){this._carouselControlsEl&&!this._hoverEl&&(this._hoverEl=ce("div",{className:"article_ed__carouselHover",innerHTML:this.isCarousel()||this.isCarouselEditorOpened()?getLang("pages_article_ed_add_photo_carousel_hint"):getLang("pages_article_ed_create_carousel_hint")}),Object(f.domInsertAfter)(this._hoverEl,this._carouselControlsEl))}removeCarouselHover(){re(this._hoverEl),this._hoverEl=null}updateEditButtonCaption(){var e=this.getMediaIdsCount()>1;this._editButtonEl.innerHTML=e?getLang("pages_article_ed_edit_carousel"):getLang("pages_article_ed_create_carousel")}createCarousel(){var e=this.getEditor();e.closeAllCarouselEditors(),e._resizeTooltip&&e._resizeTooltip.hide(),addClass(this._objectEl,"article_ed__carousel_edit_open"),this._carouselEditor=new v(this._controls,this,e=>{e?(delete this._fixedImageSize,this.setMediaId(e),this.appendObjectInnerEl(),this.getEditor().saveUndoStateAndDraft(),this.updateEditButtonCaption(),this._setImageIndex(0,this._controls),removeClass(this._objectEl,"article_ed__carousel_edit_open"),delete this._carouselEditor):this.getEditor().removeObject(this)},this.getEditor().getLimits().maxCarouselItems)}addPhotoInCarousel(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._carouselEditor&&this._carouselEditor.addPhoto(e,t,r)}saveCarousel(){this._carouselEditor&&this._carouselEditor.save()}nextPhotoInCarousel(){this.isCarousel()&&this._changePhotoInCarousel(!1)}prevPhotoInCarousel(){this.isCarousel()&&this._changePhotoInCarousel(!0)}_changePhotoInCarousel(e){var t=this.getEditor();this._setImageIndex(this.getImageIndex()+(e?-1:1));var r=t.getObjectParagraphIndex(this.paragraph);r>=0?(t.setParagraphDirty(r),t.redraw(!1)):t.redraw(!0),this.isCaptionFocused()&&Object(a.focusEl)(this.getCaptionEl(),!0)}getImageIndex(){return Math.min(this.getMediaIdsCount()-1,this._currentImageIndex)}_setImageIndex(e){this._currentImageIndex=Math.min(Math.max(0,e),this.getMediaIdsCount());var t=geByClass1("article_ed__carousel_nav_btn",this._carouselControlsEl);toggleClass(t,"no_left",0==this._currentImageIndex),toggleClass(t,"no_right",this._currentImageIndex==this.getMediaIdsCount()-1),toggleClass(this._objectEl,"article__carousel",this.isCarousel());var r=geByClass1("article_ed__carousel_counter",this._carouselControlsEl);this.isCarousel()?(setStyle(r,"display","inline-block"),r.innerHTML=getLang("pages_article_ed_carousel_counter").replace("{counter}",this._currentImageIndex+1).replace("{total}",this.getMediaIdsCount())):hide(r),this._drawImage(),this.highlight()}render(){this._el=se('\n      <div class="article_ed__img_content">\n        <img contenteditable="false" class="article_ed__img"/>\n      </div>\n    ');var e=d.get(c.ParagraphType.ObjectPhoto,this.getMediaId(),0);return e&&e.sizes?(this.setLoadingState(!1),this._drawImage()):this.setLoadingState(!0),this._el}_initUpload(){if(void 0===this._upload){var e=this.getEditor().getPhotoUploadOptions();this._upload=Upload.init(this.getEditor().getPhotoUploadEl(),e.url,e.params,{file_name:"photo",file_size_limit:15728640,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:c.ALLOWED_FILE_TYPES_FOR_PASTE,file_input:null,accept:"image/jpeg,image/png,image/gif",wiki_editor:0,noCheck:!0,customShowProgress:()=>{},onUploadStart:function(e,t){},onUploadComplete:(e,t)=>{t=JSON.parse(t),isEmpty(t)?this._onUploadCallback&&this._onUploadCallback():ajax.post("al_photos.php",extend({act:"choose_uploaded"},t),{onDone:(e,t)=>{this._mediaId=e,d.add(c.ParagraphType.ObjectPhoto,e,{size:Object(a.getPhotoSize)(t.editable.sizes),sizes:t.editable.sizes}),this._drawImage(),this._onUploadCallback&&this._onUploadCallback(),this.getEditor().saveUndoStateAndDraft()}})},onUploadProgress:function(){},onCheckServerFailed:function(){},onUploadCompleteAll:function(){},noFlash:1,max_files:20,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:e.opts.server,error:e.opts.default_error,error_hash:e.opts.error_hash})}}_getImageEl(){return geByTag1("img",this._el)}setBLOB(e,t){this._onUploadCallback=t;var r=new FileReader;r.onload=()=>{this._initUpload(),Upload.onFileApiSend(this._upload,[e])},r.readAsDataURL(e)}_updateSize(){}_drawImage(){if(this._el){var e=d.get(c.ParagraphType.ObjectPhoto,this.getMediaId(),this.getImageIndex()),t=720;switch(parseInt(this.paragraph.mode)){case 1:t=350;break;case 2:t=920;break;case 3:t=window.innerWidth}if(e){var r=m(Object(c.getAppropriateImage)(e.sizes,t),1)[0],a=this._getImageEl(),i=!1;a.onload=()=>{clearTimeout(b),i=!0,setStyle(a,"visibility","visible"),show(a),this.setLoadingState(!1),this.isCarousel()&&this._fixSize()},a.src=r,clearTimeout(b),i||(b=setTimeout(()=>{i||(setStyle(a,"visibility","hidden"),this.setLoadingState(!0,this.isCarousel()))},10)),this._updateSize()}}}isCarousel(){return this.getMediaIdsCount()>1}isCarouselEditorOpened(){return!!this._carouselEditor}_fixSize(){this._fixedImageSize=getSize(this._el),this._fixedImageSize[0]=Math.ceil(this._fixedImageSize[0]),this._fixedImageSize[1]=Math.ceil(this._fixedImageSize[1]),setStyle(this._el,{height:this._fixedImageSize[1]+"px"}),setStyle(this._getImageEl(),{"max-width":this._fixedImageSize[0],"max-height":this._fixedImageSize[1]})}_isSmallPhotoSize(){var e=d.get(c.ParagraphType.ObjectPhoto,this.getMediaId(),0);return!(!e&&!e.size)&&e.size[0]>=720}}class P extends n{constructor(e,t){super(e,t,!0)}render(){this._el=se('\n      <div class="article_object_video"></div>\n    ');var e=d.get(c.ParagraphType.ObjectVideo,this.getMediaId());if(!e)return this._el;if(e.preview)this._el.appendChild(se(`<div class="article_ed__video_play_note" contenteditable="false">${getLang("pages_articles_editor_video_play_note")}</div>`)),this._el.appendChild(se(e.preview));else if(e.editable||e.thumb){var t;if(e.thumb)t=e.thumb;else t=Object(c.getAppropriateImage)(e.editable.sizes,this.getEditor().getWidth(!0))[0];this._el.appendChild(se('<div class="article_object_video_play"></div>')),this._el.appendChild(se(rs(this.getEditor().getOptions().videoLabelTemplate,{duration:e.duration||0,platform:e.platform||""}))),this._el.appendChild(se(`<div class="article_ed__video_play_note" contenteditable="false">${getLang("pages_articles_editor_video_play_note")}</div>`)),this._el.appendChild(se(`<img class="article_ed__video_img" src=${t} contenteditable="false" />`))}return this._el}onViewport(e){}onRender(){}}var E=r("EasH");class O extends n{constructor(e,t){super(e,t,!0)}render(){this._el=se('\n      <div class="article_ed__gif_content"></div>\n    ');var e=d.get(c.ParagraphType.ObjectGIF,this.getMediaId());if(e)if(e.video){if(this._videoEl=ce("video",{autoplay:!0,loop:"loop",muted:!0,src:e.video+"&mp4=1"}),e.size){var t=e.size[0]<e.size[1],r=!this._isSmallGifSize();(t||r)&&setStyle(this._videoEl,{width:e.size[0]})}this._el.appendChild(this._videoEl),this._el.appendChild(se('<span class="article_ed__select_dummy">&nbsp;</span>'))}else if(e.href){var a=e.href+"&wnd=1&module="+cur.module;this._imgEl=ce("img"),this._imgEl.addEventListener("error",()=>{Object(E.showFastBox)(getLang("pages_article_error_box_title"),getLang("pages_article_error_box_text")),this._editor.removeObject(this)}),this._imgEl.src=a,this._el.appendChild(this._imgEl)}return this._el}onViewport(e){if(this._imgEl)setStyle(this._imgEl,"visibility",e?"visible":"hidden");else if(e){var t=this._videoEl.play();t&&t.catch(()=>{})}else this._videoEl.pause()}onRender(){setTimeout(()=>{var e=this._videoEl&&this._videoEl.play();if(e&&e.catch(()=>{}),browser.msie&&this._videoEl){var t=this._videoEl.src;this._videoEl.src="",this._videoEl.src=t}})}_isSmallGifSize(){var e=d.get(c.ParagraphType.ObjectGIF,this.getMediaId());return!(!e||!e.size)&&e.size[0]>this.getEditor().getOptions().minGifWidthExpand}}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class C extends n{constructor(e,t){super(e,t,!0)}render(){this._el=se('\n      <div class="article_object_audio"></div>\n    ');var e=d.get(c.ParagraphType.ObjectPodcast,this.getMediaId());if(e.snippet)this._el.innerHTML=e.snippet;else{var t=j(this.getMediaId().split("_"),2),r=t[0],a=t[1];this.setLoadingState(!0),ajax.post("al_articles.php",{act:"get_podcast_snippet",owner_id:r,podcast_id:a},{onDone:e=>{this.setLoadingState(!1),this._el.appendChild(se(e))}})}return this._el.appendChild(se(`<div class="article_ed__audioplaylist_play_note" contenteditable="false">${getLang("pages_articles_editor_audio_play_note")}</div>`)),this._el}}class T extends n{constructor(e,t){super(e,t,!0)}render(){var e=d.get(c.ParagraphType.ObjectAudio,this.getMediaId()).audio,t=AudioUtils.drawAudio(e);return this._el=se(`\n      <div class="article_object_audio">${t}</div>\n    `),this._el}}class w extends n{constructor(e,t){super(e,t,!0)}render(){var e=d.get(c.ParagraphType.ObjectMarketItem,this.getMediaId());return this._el=Object(a.buildProductSnippetElement)(e,"article_add__object_market_product"),this._el}onRender(){}}class x extends n{constructor(e,t){super(e,t,!0)}render(){var e=d.getRaw(c.ParagraphType.ObjectAliExpressProduct,this.getMediaId());return this._el=Object(a.buildProductSnippetElement)(e,"article_add__object_market_aliexpress_product"),this._el}getMediaId(){return this._mediaId}onRender(){}}var I,S=[{pattern:/\s-\s$/,substitution:" — "},{pattern:/^-\s$/,substitution:"— "},{pattern:/--\s$/,substitution:"— "},{pattern:/\s"$/,substitution:" “",noUndo:!0,cyrillic:!1},{pattern:/(\S)"$/,substitution:"$1”",noUndo:!0,cyrillic:!1},{pattern:/^"$/,substitution:"“",noUndo:!0,cyrillic:!1},{pattern:/\s"$/,substitution:" «",noUndo:!0,cyrillic:!0},{pattern:/(\S)"$/,substitution:"$1»",noUndo:!0,cyrillic:!0},{pattern:/^"$/,substitution:"«",noUndo:!0,cyrillic:!0},{pattern:"+/-",substitution:"±"},{pattern:"+-",substitution:"±"},{pattern:"^2",substitution:"²"},{pattern:"^3",substitution:"³"},{pattern:"<<",substitution:"«"},{pattern:">>",substitution:"»"},{pattern:"(c)",substitution:"©"},{pattern:"(C)",substitution:"©"},{pattern:"(r)",substitution:"®"},{pattern:"(R)",substitution:"®"},{pattern:"1/2",substitution:"½"},{pattern:"1/4",substitution:"¼"},{pattern:"3/4",substitution:"¾"},{pattern:"...",substitution:"…"},{pattern:"->",substitution:"→"},{pattern:"<-",substitution:"←"},{pattern:"!=",substitution:"≠"},{pattern:"<=",substitution:"≤"},{pattern:">=",substitution:"≥"}];class k extends n{constructor(e,t){super(e,t,!0)}render(){return this._el=se('<div class="article_object_embed"></div>'),this.setLoadingState(!0),loadScript("https://platform.twitter.com/widgets.js",{onLoad:()=>{this.setLoadingState(!1),window.twttr.widgets.createTweet(this.getMediaId(),this._el,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0}).then(()=>{})},onError:()=>{this.loadErrorHandler(this._el)}}),this._el}}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class A extends n{constructor(e,t){super(e,t,!0)}render(){var e=L(this.getMediaId().split(";"),2),t=e[0],r=e[1];this._el=se(`<div class="article_object_embed fb-post" data-href="https://www.facebook.com/${t}/posts/${r}/" data-width="552px"></div>`),this.setLoadingState(!0);var a=window.vk&&0==window.vk.lang?"ru_RU":"en_US";return loadScript(`https://connect.facebook.net/${a}/all.js#xfbml=1&amp;version=v2.8`,{onLoad:()=>{setTimeout(()=>{window.FB.XFBML.parse(this._objectEl,this.setLoadingState(!1))})},onError:()=>{this.loadErrorHandler(this._el)}}),this._el}}class M extends n{constructor(e,t){super(e,t,!0)}render(){return this._el=se(`\n      <div class="article_object_embed article_object_embed_instagram">\n        <blockquote\n            class="article_embed_spacer instagram-media"\n            data-instgrm-permalink="https://instagram.com/p/${this.getMediaId()}"\n            data-instgrm-version="12"\n        ></blockquote>\n      <div>\n    `),this.setLoadingState(!0),loadScript("https://www.instagram.com/embed.js",{onLoad:()=>{setTimeout(()=>{window.instgrm.Embeds.process(),addEvent(window,"message",c.changeHeightInstagramEmbed),this.setLoadingState(!1)},0)},onError:()=>{this.loadErrorHandler(this._el)}}),this._el}}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class R extends n{constructor(e,t){super(e,t,!0)}render(){return this._el=se('<div class="article_object_embed"></div>'),setTimeout(()=>{var e=D(this.getMediaId().split(";"),2),t=e[0],r=e[1],a=domData(this._objectEl,"uuid"),i=`vk_post_${this.getMediaId()}_${a}`;this._el.setAttribute("id",i),this.setLoadingState(!0),loadScript("/js/api/openapi.js",{onLoad:()=>{ajax.post("dev.php",{act:"a_get_post_hash",post:`${t}_${r}`},{onDone:e=>{e&&(this.setLoadingState(!1),window.VK&&window.VK.Widgets&&window.VK.Widgets.Post(`${i}`,t,r,e))},onError:()=>{this.loadErrorHandler(this._el)}})}})},0),this._el}}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class N extends n{constructor(e,t){super(e,t,!0)}render(){var e=B(this.getMediaId().split(";"),2),t=e[0],r=e[1];return this._el=se(`<div class="article_object_embed"><blockquote class="telegram-post" data-telegram-post="${t}/${r}" data-width="100%" data-userpic="true"></div>`),this.setLoadingState(!0),loadScript("https://telegram.org/js/telegram-widget.js?5",{onLoad:()=>{this.setLoadingState(!1)},onError:()=>{this.loadErrorHandler(this._el)}}),this._el}}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class H extends n{constructor(e,t){super(e,t,!0)}render(){this._el=se('\n      <div class="article_object_poll"></div>\n    ');var e=d.get(c.ParagraphType.ObjectPoll,this.getMediaId());if(e&&e.snippet)return this._el.appendChild(se(e.snippet)),this._el;var t=z(this.getMediaId().split("_"),2)[1];return this.setLoadingState(!0),ajax.post("al_articles.php",{act:"get_poll_snippet",voting_id:t},{onDone:e=>{this.setLoadingState(!1),this._el.appendChild(se(e))}}),this._el}renderEditControlEl(){var e=d.get(c.ParagraphType.ObjectPoll,this.getMediaId());if(!e||!e.editable)return null;var t=se(`\n      <div class="article_ed__obj_edit_control">\n        <div class="article_ed__poll_object_btn">\n          <button class="article_ed__poll_object_edit">${getLang("global_edit")}</button>\n        </div>\n      </div>\n    `);return geByClass1("article_ed__poll_object_edit",t).addEventListener("click",this._editor.editObjectPoll.bind(this._editor,this)),t}}function U(e){return JSON.parse(JSON.stringify(e))}function F(e,t,r){var i=[];return e.forEach((e,s)=>{r&&!Object(a.isObjectParagraph)(e)&&Object(a.isParagraphEmpty)(e)&&0!=s&&e.type!=c.ParagraphType.Code||i.push(function(e,t){var r={};for(var i in e)if(e.hasOwnProperty(i)){if(i.startsWith("_")&&("_uuid"!==i||!t))continue;var s=e[i];r[i]=isObject(s)||isArray(s)?U(s):s}return Object(a.isObjectParagraph)(e)&&e._object&&(r.mediaId=e._object.getMediaId()),e.sep&&(r.sep=1),r.type==c.ParagraphType.Text&&delete r.type,r.lines.forEach(e=>{if(e){if(void 0!==e.decorations){var t=!0;each(e.decorations,(r,a)=>{0==a.length?delete e.decorations[r]:t=!1}),t&&delete e.decorations}e.brs&&0==e.brs.length&&delete e.brs}}),r}(e,t))}),U(i)}function $(e){return e.forEach(e=>{e.type=e.type||c.ParagraphType.Text,e.lines.forEach(e=>{e.brs=e.brs||[],e.decorations=e.decorations||{}})}),e}function K(e){var t=[];e.length>I.maxParagraphs&&t.push(getLang("pages_article_ed_limit_paragraphs").replace("{count}",e.length).replace("{limit}",I.maxParagraphs));var r=0,i=0;return e.forEach(e=>{var s=0;e.lines.forEach(e=>{e&&(r+=e.text.length,s+=e.text.length)}),Object(a.isObjectParagraph)(e)&&i++,s>I.maxSymbolsPerParagraph&&t.push(getLang("pages_article_ed_limit_symbols_per_par").replace("{count}",s).replace("{limit}",I.maxSymbolsPerParagraph))}),r>I.maxSymbols&&t.push(getLang("pages_article_ed_limit_symbols").replace("{count}",r).replace("{limit}",I.maxSymbols)),i>I.maxObjects&&t.push(getLang("pages_article_ed_limit_objects").replace("{count}",i).replace("{limit}",I.maxObjects)),t.length&&t.push(getLang("pages_article_ed_limit")),t.join("<br>")}var W=r("4+be");class Y{static _saveChunk(e,t,r,a,i){ajax.post("al_articles.php",{act:"save_text_chunk",article_owner_id:e,hash:a,chunk_index:r,Article_text:JSON.stringify(t)},{onDone:e=>{i(e)},onError:()=>{i(!0)}})}static _saveFinally(e,t,r,a,i,s,o,n,l,h){l=l?JSON.stringify(l):"",ajax.post("al_articles.php",extend({act:"save",article_owner_id:e,article_id:t,cover_photo_id:i,name:a,is_published:intval(r),chunks_count:n,Article_text:l,hash:o},s||{}),{onDone:h,onFail:e=>e.startsWith("locked ")?(h(e),!0):e?(Object(E.showFastBox)(Object(W.getLang)("global_error"),e),h(!0),!0):void 0})}static save(e,t,r,a,i,s,o,n,l,h){var d=[],c=[],p=0;if(r.forEach(e=>{var t=0;e.lines.forEach(e=>{t+=e.text.length,e.decorations&&e.decorations.link&&e.decorations.link.forEach(e=>{t+=(e[2]||"").length})}),e.mediaId&&(t+=e.mediaId.length),(p+=t)>=n&&(d.push(c),p=t,c=[]),c.push(e)}),c.length&&d.push(c),d.length>1){var _=new CallHub(()=>{Y._saveFinally(e,t,a,i,s,l,o,d.length,!1,h)},d.length);d.forEach((t,r)=>{Y._saveChunk(e,t,r,o,e=>{e?Object(E.showFastBox)(Object(W.getLang)("global_error"),Object(W.getLang)("pages_articles_save_fail")):_.done()})})}else Y._saveFinally(e,t,a,i,s,l,o,0,r,h)}}var G=r("W9Tc"),V=r("/PiP"),X=r("t7n3");function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,i=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}r.d(t,"default",function(){return ne});var q={KeyA:65,KeyB:66,KeyC:67,KeyI:73,KeyS:83,KeyY:89,KeyZ:90,Apostrophe:192,Backspace:8,Enter:13,Space:32,Up:38,Down:40,Delete:46,Tab:9},J=[{type:"strong",tag:"strong"},{type:"em",tag:"em"},{type:"strike",tag:"strike"},{type:"link",tag:"a"},{type:"code",tag:"code"}],Z=J.slice().reverse(),ee={};each(J,(e,t)=>{ee[t.tag]=t});var te={};each(J,(e,t)=>{te[t.type]=t});var ae=100,ie=1;function oe(){return ie+++"-"+Date.now()%1e6+"-"+irand(0,99999)}class ne{constructor(e,t,r){var i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._id=oe(),cur.lang=cur.lang||{},extend(cur.lang,s.lang),this._options=s,this._els={editor:ge(e),canvas:se('<div class="article_editor_canvas article_edit article" contenteditable="true"></div>')},this._els.editor.appendChild(this._els.canvas),this._els.editor.appendChild(this._photoUploadEl=se('<div class="article_photo_upload"></div>')),addClass(this._els.editor,"article_editor"),this._dirty=[],this._undos=[],this._redos=[],this._objects={},this._floatedObjects=[],i=s.limits,I=i;var o=r||[];if(s.postData){var n=s.postData.text||"";n=(n=n.replace(/❤/g,"❤️")).split("\n");var l=[];l.push(Object(a.buildParagraph)({type:c.ParagraphType.Header1,lines:[{text:""}]})),n.forEach(e=>{trim(e)&&l.push(Object(a.buildParagraph)({lines:[{text:clean(e)}]}))}),o=l.concat(o)}o&&0!=o.length||(o=[Object(a.buildParagraph)({type:this._options.noTitle?c.ParagraphType.Text:c.ParagraphType.Header1})]),(o=o.filter(e=>!1!==e)).forEach(e=>{e.lines.forEach(e=>{e.text=Object(a.replaceParagraphEntities)(e.text),e.brs&&isObject(e.brs)&&(e.brs=Object(a.convertBRsToArray)(e.brs))})}),s.needIndexCorrection&&Object(a.correctRealIndexes)(o,1),this.initParagraphs(o),this._updateTextPlaceholders(),this._initObjectDrag(),s.postData?Object(a.focusEl)(this._getParagraphElByIndex(0)):this._restoreLastCursor(),this.saveDraft(!1,!0),s.coverPhoto&&this.setCoverPhoto(s.coverPhoto,!1),(this._options.isPublished||this._options.wasPublished)&&this.setPublishName(t.name),this.updateWarnInfos(),this._publishNameCandidate=s.name||this._getName(),this._saveUndoState(),this.wasPublishedInCurrentSession=!1,this._openTime=Date.now(),stManager.add("audio.js")}updateWarnInfos(){this.showWarningInfo(),this.showEditLockInfo(),this.showRevEditInfo()}_setEventListener(e,t,r){this._events=this._events||[],this._events.push({el:e,event:t,handler:r}),e.addEventListener(t,r)}setCoverPhoto(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._coverPhoto=e,this._options.isPublished||this.saveDraft(t)}getCoverPhoto(){return!1!==this._coverPhoto&&(this._coverPhoto?this._coverPhoto:void 0)}getFirstCoverPhotoFromParagraphs(){var e=!1;return this._ps.forEach(t=>{if(!e&&t.type==c.ParagraphType.ObjectPhoto){var r=t._object.getMediaId(0);e={id:r,data:d.get(c.ParagraphType.ObjectPhoto,r)}}}),e}getPublishName(){return this._publishName||this._publishNameCandidate||this._getName()}getTimeSpent(){return Math.round((Date.now()-this._openTime)/1e3)}setPublishName(e){this._publishName=e,this._options.isPublished||this.saveDraft(!0)}_updateTextPlaceholders(){if(!this._options.noTitle){this._els.placeholders||(this._els.placeholders=se('<div class="article_ed__text_placeholders"></div>'),this._els.placeholderTitle=se(`<h1>${this.getOptions().placeholderTitle}</h1>`),this._els.placeholderFirstParagraph=se(`<p>${this.getOptions().placeholderParagraph}</p>`),this._els.placeholders.appendChild(this._els.placeholderTitle),this._els.placeholders.appendChild(this._els.placeholderFirstParagraph),this._els.editor.appendChild(this._els.placeholders)),Object(a.isParagraphEmpty)(this._ps[0])?removeClass(this._els.placeholderTitle,"article_ed__text_placeholder_hidden"):addClass(this._els.placeholderTitle,"article_ed__text_placeholder_hidden");var e=this._ps[1],t=!!e&&e.sep,r=Q(this._getCurrentParagraphIndex(),1)[0];Object(a.isParagraphEmpty)(e)&&(!e||e.type!=c.ParagraphType.Code)&&r<2&&this._ps.length<=2&&!t?removeClass(this._els.placeholderFirstParagraph,"article_ed__text_placeholder_hidden"):addClass(this._els.placeholderFirstParagraph,"article_ed__text_placeholder_hidden")}}destroy(){this._els.editor.innerHTML="",removeClass(this._els.editor,"article_editor"),this._formatTooltip&&this._formatTooltip.destroy(),this._resizeTooltip&&this._resizeTooltip.destroy(),this._objectPickerTooltip&&this._objectPickerTooltip.destroy(),this._events=this._events||[],this._events.forEach(e=>{e.el.removeEventListener(e.event,e.handler)}),delete cur.docsCurFilter}getLimits(){return this._options.limits}getOptions(){return this._options}getWidth(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return getSize(this._els.canvas)[0]+(e?2*this._options.figureSideMargin:0)}getPhotoUploadOptions(){return this._options.photoUploadOptions}getPhotoUploadEl(){return this._photoUploadEl}removeObject(e){each(this._ps,(t,r)=>{if(r._object==e){var i=this._getParagraphElByIndex(t+1);return Object(a.focusEl)(i),re(this._getParagraphElByIndex(t)),this._setAllParagraphsDirty(),this._triggerInputEvent(),!1}})}_processPastedUrl(e,t){var r=this._getParagraph(e);r&&r.type==c.ParagraphType.Text&&setTimeout(()=>{this._processMatchingEmbeds(e,t)||(re(this._els.shareParseForm),re(this._els.shareIFrame),this._els.shareIFrame=this._els.editor.appendChild(se('<iframe class="editor__share_parse_iframe" name="editor__share_parse_iframe"></iframe>')),this._els.shareParseForm=this._els.editor.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"editor__share_parse_iframe"})),this._els.shareParseForm.appendChild(ce("input",{type:"hidden",name:"hash",value:this._options.shareHash})),this._els.shareParseForm.appendChild(ce("input",{type:"hidden",name:"url",value:t})),this._els.shareParseForm.appendChild(ce("input",{type:"hidden",name:"index",value:1})),this._els.shareParseForm.appendChild(ce("input",{type:"hidden",name:"force_media",value:1})),window.onUploadFail=()=>{},window.onUploadDone=t=>{if(t){var r=t[2];if(r){var i,s,o={};switch(t[0]){case"audio_playlist":i=c.ParagraphType.ObjectAudioPlaylist,o={accessHash:r.accessHash},t[1]=r.ownerId+"_"+r.id+(r.accessHash?"_"+r.accessHash:"");break;case"podcast":i=c.ParagraphType.ObjectPodcast,o={};break;case"poll":Object(G.partConfigEnabled)("article_poll")&&(i=c.ParagraphType.ObjectPoll,o={editable:!1,snippet:r.snippet});break;case"doc":"gif"!=r.ext&&3!=r.type||(i=c.ParagraphType.ObjectGIF,(o={size:r.video_preview_size,video:r.video_preview,href:r.href||r.editable.href}).video||o.href||(i=!1));break;case"photo":i=c.ParagraphType.ObjectPhoto,o={size:Object(a.getPhotoSize)(r.editable.sizes),sizes:r.editable.sizes};break;case"video":i=c.ParagraphType.ObjectVideo,o={editable:r.editable,duration:r.editable.duration,platform:r.editable.platform}}if(i){var n=Object(a.hasSeparator)(this._ps[e]),l={mediaId:t[1],type:i,sep:n,fromExtPage:intval(r.from_ext_page)};d.add(i,l.mediaId,o),this._linkTooltip&&this._linkTooltip.hide(),l=Object(a.buildParagraph)(l),(s=this._getParagraph(e+1))&&s._object&&s._object._mediaId===l.mediaId||(this._getOrCreateParagraphObject(l),this._insertParagraphAt(e+1,l),this._els.canvas.normalize(),this._redraw(!0,!0),this._saveUndoState(),setTimeout(()=>{this.onObjectStateLoaded()},10))}}}},this._els.shareParseForm.submit())},0)}_processMatchingEmbeds(e,t){var r,i,s;if(r=t.match(/^https?:\/\/(?:www.)?twitter\.com\/(?:#!\/)?(?:\w+)\/status(?:es)?\/(\d+)$/))i=c.ParagraphType.ObjectTwitter,s=r[1];else if(r=t.match(/^https?:\/\/(?:www.)?instagram\.com\/p\/([a-zA-Z0-9_-]+)(?:\/embed)?(?:\/)?/))i=c.ParagraphType.ObjectInstagram,s=r[1];else if(r=t.match(/^https?:\/\/(?:www.)?facebook\.com\/(\w.+)\/posts\/(\d+)\/?$/))i=c.ParagraphType.ObjectFacebook,s=`${r[1]};${r[2]}`;else if(r=t.match(/^(?:https?:\/\/)?(?:[a-z0-9\_\.-]*\.)?(?:www.)?vk\.com\/(?:[a-z0-9\_\.-?]*w=)?wall(-?\d+)_(\d+)/))i=c.ParagraphType.ObjectVK,s=`${r[1]};${r[2]}`;else if(r=t.match(/^https?:\/\/(?:www.)?t\.me\/(\w.+)\/(\d+)/)){if(ge(`telegram-post-${r[1]}-${r[2]}`))return!1;i=c.ParagraphType.ObjectTelegram,s=`${r[1]};${r[2]}`}if(!i||!s)return!1;var o=Object(a.buildParagraph)({_uuid:oe(),type:i,mediaId:s}),n=this._getParagraph(e+1);return!(!n||!n._object||n._object._mediaId!==o.mediaId)||(this._getOrCreateParagraphObject(o),this._insertParagraphAt(e+1,o),this._els.canvas.normalize(),this._redraw(!0,!0),this._saveUndoState(),!0)}_handleObjectPaste(e){var t=(e.clipboardData||e.originalEvent.clipboardData).getData("text/plain");if(t){var r=Q(t.split(":"),2),a=r[0],i=r[1];if("uuid"==a&&i){var s=domQuery1(`[data-uuid="${i}"]`);if(s){var o=s.cloneNode(!0);o.setAttribute("data-force-update","1");var n=Q(this._getCurrentParagraphIndex(),1)[0];Object(f.domInsertAfter)(o,this._getParagraphElByIndex(n)),e.preventDefault(),this._setAllParagraphsDirty(),this._triggerInputEvent()}}}}_handleLinkPaste(e){var t=this,r=(e.clipboardData||e.originalEvent.clipboardData).items;for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];"string"===s.kind&&function(){var e=Q(t._getCurrentParagraphIndex(),1)[0];s.getAsString(r=>{var i=r.replace(/(<([^>]+)>)/gi,""),s=extractUrls(i,!0);if(1===s.length){var o=s[0].url,n=t._getParagraphElByIndex(e);t._processPastedUrl(e,o),Object(a.traverseTree)(n,r=>{if(r.nodeType==Node.TEXT_NODE&&r.textContent.indexOf(o)>=0&&!Object(f.traverseParent)(r,e=>e.tagName&&"a"==e.tagName.toLowerCase(),3)){t._saveCursorMarker();var a=document.createRange();a.setStart(r,r.textContent.indexOf(o)),a.setEnd(r,r.textContent.indexOf(o)+o.length);var i=window.getSelection();i.removeAllRanges(),i.addRange(a),t._setParagraphDirty(e),document.execCommand("createLink",!1,o),t._restoreCursorFromMarker()}},!1)}})}()}}_handlePhotoPaste(e){var t=this;this._photoPasteUploadingProcess=!1;var r=(e.clipboardData||e.originalEvent.clipboardData).items;for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];"file"===s.kind&&function(){t._photoPasteUploadingProcess=!0;var e=s.getAsFile(),r=new FileReader;r.onload=()=>{t._photoPasteUploadingProcess=!1;var i=Q(t._getCurrentParagraphIndex(),1)[0];i=i||0;var s,o=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPhoto});t._getOrCreateParagraphObject(o).setBLOB(e),Object(a.isParagraphEmpty)(t._ps[i])?(s=i,Object(a.hasSeparator)(t._ps[s])&&(o.sep=1),t._ps[s]=o):(s=i+1,t._insertParagraphAt(s,o)),t._redraw(!0,!0);var n=new Image;n.onload=()=>{t._focusParagraph(s+1),t._showObjectPicker()},n.src=r.result},r.readAsDataURL(e)}()}}_getCurrentSelectionState(){var e=Q(this._getCurrentParagraphIndex(),2),t=e[0],r=e[1];if(!1===t||!1===r)return!1;for(var i,s,o={decorations:{},header1:!1,header2:!0,header3:!0,header:!1,object:!1,quote:!0,list:!1,justHeaders:!0},n={},l=0,h=t;h<=r&&h<this._ps.length;h++){var d=Object(a.isObjectParagraph)(this._ps[h])?this._ps[h]._object.getCaptionEl():this._getParagraphElByIndex(h);if(void 0===i){var p=Q(Object(X.getCaretCharacterOffsetWithin)(d),2);i=p[0],s=p[1]}this._ps[h].lines.forEach(e=>{var t=e.decorations;J.forEach(r=>{var a=t[r.type];a&&!isEmpty(a)&&a.forEach(t=>{var a=[t[0]+l,t[1]+l];if("link"==r.type)i<a[1]&&s>a[0]&&(n[r.type]=1,o.decorations[r.type]=!0);else if(1==n[r.type]){s>a[1]||(s>=a[0]&&s<=a[1]?t[0]>0?n[r.type]=-1:(n[r.type]=2,o.decorations[r.type]=!0):n[r.type]=-1)}else if(!n[r.type]){var h=i>=a[0]&&i<=a[1];h&&(s>=a[0]&&s<=a[1])?(n[r.type]=2,o.decorations[r.type]=!0):h&&(e.text.length>a[1]?n[r.type]=-1:n[r.type]=1)}})}),l+=e.text.length})}for(var _=t;_<=r&&_<this._ps.length;_++)Object(a.isObjectParagraph)(this._ps[_])&&(o.captionFocused=o.captionFocused||this._ps[_]._object.isCaptionFocused(),o.object=!0),this._ps[_].type==c.ParagraphType.Header1&&(o.header1=!0),this._ps[_].type!=c.ParagraphType.Header2&&(o.header2=!1),this._ps[_].type!=c.ParagraphType.Header3&&(o.header3=!1),inArray(this._ps[_].type,[c.ParagraphType.Header1,c.ParagraphType.Header2,c.ParagraphType.Header3])?o.header=!0:o.justHeaders=!1,inArray(this._ps[_].type,[c.ParagraphType.Quote,c.ParagraphType.Quote2])||(o.quote=!1),inArray(this._ps[_].type,[c.ParagraphType.BulletList,c.ParagraphType.NumericList])&&(o.list=!0);var g=Q(Object(a.getRange)(),1)[0];return!(g&&g.startContainer&&hasClass(g.startContainer,"article_ed__noconteditable"))&&(o.multiline=t!=r,o)}_hideFormatTooltip(){this._formatTooltip&&this._formatTooltip.isShown()&&this._formatTooltip.hide()}_showFormatTooltip(){if(!this.isLocked()){clearTimeout(this._doShowFormatTooltipTO);try{var e=window.getSelection();if(e.focusNode&&(hasClass(e.focusNode,"article_set_link")||"input"==e.focusNode.nodeName.toLowerCase()))return;var t=!e.isCollapsed;this._doShowFormatTooltipTO=setTimeout(this._doShowFormatTooltip.bind(this,t),1)}catch(e){}}}_doShowFormatTooltip(e){if(!this._formatTooltip){var t,r=se(`\n        <div>\n          <div class="article_format_btns clear_fix"></div>\n          <div class="article_set_link"><input type="text" placeholder="${getLang("pages_articles_enter_link")}"/><div class="article_set_link_delete"></div></div>\n        </div>`);this._formatTooltip=new ElementTooltip(this._els.editor,{cls:"article_format_tt",content:r,customShow:!0,offset:[0,-3],onShow:()=>{var e=this._getCurrentSelectionState(),t=[];if(!e||e.header1||e.object&&!e.captionFocused||(e.justHeaders||t.push(["strong","cur.articleEditor.setStrong()",!!e.decorations.strong]),e.quote||e.justHeaders||t.push(["em","cur.articleEditor.setEm()",!!e.decorations.em]),t.push(["strike","cur.articleEditor.setStrike()",!!e.decorations.strike]),e.decorations.link?t.push(["link","cur.articleEditor.clearLink()",e.decorations.link]):t.push(["link","cur.articleEditor.setLinkMode(true)",e.decorations.link]),e.object||e.header1||e.list||(t.push(["header1","cur.articleEditor.setHeader1("+intval(e.header2)+")",e.header2]),t.push(["header2","cur.articleEditor.setHeader2("+intval(e.header3)+")",e.header3]),t.push(["quote","cur.articleEditor.setQuote()",e.quote]))),0!=t.length){var a=geByClass1("article_format_btns",r);a.innerHTML="",t.forEach((e,t)=>{t>0&&inArray(e[0],["header1"])&&a.appendChild(se('<div class="article_format_divider"></div>'));var r=e[2]?"article_format_btn_active":"";a.appendChild(se(`<button class="article_format_btn ${r}" id="article_format_btn_${e[0]}" onclick="${e[1]}"></button>`))}),this.setLinkMode(!1)}else this._formatTooltip.hide()},getTargetBoundingBox:()=>{if(this._formatTooltip.linkMode)return t;var e=Q(Object(a.getRange)(),3),r=e[0],i=e[2];if(!i||!i.rangeCount)return t;var s=r.getBoundingClientRect();if(!s.left){var o=r.startContainer.nodeType==Node.ELEMENT_NODE?r.startContainer:domPN(r.startContainer),n=getXY(o),l=getSize(o);return t={top:n[1]+scrollGetY(),left:n[0]+l[0]/2,width:s.width,height:s.height}}return t={top:s.top+scrollGetY(),left:s.left,width:s.width,height:s.height}}}),this._formatTooltip.linkMode=!1;var i=geByTag1("input",r);i.addEventListener("keypress",e=>{if(e.keyCode==q.Enter)return this._setLinkToSelectedText(i.value.trim()),this._formatTooltip.hide(),cancelEvent(e)}),geByClass1("article_set_link_delete",r).addEventListener("click",e=>(this._setLinkToSelectedText(),cancelEvent(e)))}e?(this._linkTooltip&&this._linkTooltip.isShown()&&this._linkTooltip.hide(),this._formatTooltip.show(),this._formatTooltip.getOptions().onShow(),this._formatTooltip.updatePosition()):(this._formatTooltip.hide(),this._formatTooltip.linkMode&&this.setLinkMode(!1,!0))}_setLinkToSelectedText(e){if(e){if(!(e=(e=e.substr(0,1500)).replace(/%E2%80%AE/i,"").replace("&#8238;","").replace(/&#x202E;/i,"")).match("^https?://"))e=(Object(a.isVKUrl)(e)?"https":"http")+"://"+e;e=encodeURIComponent(e)}this.setLinkMode(!1,!1),this._restoreCursor(this._linkSelectedCursor),this._setAllParagraphsDirty(),e&&document.execCommand("createLink",!1,e),!browser.msie&&e||this._triggerInputEvent(),e?this._restoreCursor(this._linkSelectedCursor):this._restoreCursor(this._linkCursor)}clearLink(){this.setLinkMode(!1);var e=Q(Object(a.getRange)(),3),t=e[0],r=e[2],i=Object(f.domClosestByTag)("a",t.startContainer),s=Object(f.domClosestByTag)("a",t.endContainer)||i;i&&(this._saveCursorMarker(),r.setBaseAndExtent(i,0,s,Math.max(1,s.children.length))),this._setCurrentParagraphDirty(),document.execCommand("unlink",!1)}setLinkMode(e,t){var r;e&&(r=this._getCursor(),browser.msie||document.execCommand("superscript",!1,!0));var a=this._formatTooltip.getContent();if(this._formatTooltip.linkMode!=!!e)if(e){var i=geByTag1("input",a);i.value="",addClass(a,"article_editor_format_tt_set_link"),this._linkCursor=r,this._linkSelectedCursor=this._getCursor(),i.focus(),this._formatTooltip.linkMode=!0,this._formatTooltip.updatePosition()}else setStyle(a,{width:null}),removeClass(a,"article_editor_format_tt_set_link"),this._formatTooltip.linkMode=!1,t&&(this._saveCursorMarker(),this._setAllParagraphsDirty(),this._triggerInputEvent())}setHeader1(e){this._setHeader(c.ParagraphType.Header2,!e)}setHeader2(e){this._setHeader(c.ParagraphType.Header3,!e)}setQuote(){var e=this._getCursor(),t=Q(this._getCurrentParagraphIndex(),2),r=t[0],i=t[1];if(!1!==r){i||(i=r);for(var s=c.ParagraphType.Text,o=r;o<=i;o++)if(h(this._ps[o])){s=this._ps[o].type==c.ParagraphType.Quote?c.ParagraphType.Quote2:this._ps[o].type==c.ParagraphType.Quote2?c.ParagraphType.Text:c.ParagraphType.Quote;break}for(var n=r;n<=i;n++){var l=this._ps[n];h(l)&&(this._ps[n]=Object(a.buildParagraph)({type:s,lines:[l.lines[0]],sep:Object(a.hasSeparator)(this._ps[n])}),this._setParagraphDirty(n))}this._redraw(!0),this._updateTextPlaceholders(),this._restoreCursor(e),this._saveUndoState(),this.saveDraft()}function h(e){return!Object(a.isObjectParagraph)(e)&&!Object(a.isListParagraph)(e)}}_setHeader(e,t){var r=this._getCursor(),i=Q(this._getCurrentParagraphIndex(),2),s=i[0],o=i[1];if(!1!==s){o||(o=s);for(var n=s;n<=o;n++){l(this._ps[n])&&(this._ps[n].type=t?e:c.ParagraphType.Text,this._setParagraphDirty(n))}this._redraw(!0),this._updateTextPlaceholders(),this._restoreCursor(r),this._saveUndoState(),this.saveDraft()}function l(e){return!Object(a.isObjectParagraph)(e)&&!Object(a.isListParagraph)(e)}}setStrong(){this._setAllParagraphsDirty(),document.execCommand("bold"),browser.msie&&this._triggerInputEvent()}setEm(){this._setAllParagraphsDirty(),document.execCommand("italic"),browser.msie&&this._triggerInputEvent()}setStrike(){this._setCurrentParagraphDirty(),document.execCommand("strikeThrough"),browser.msie&&this._triggerInputEvent()}saveUndoStateAndDraft(){this._saveUndoState(),this.saveDraft()}_saveUndoStateDelayed(){clearTimeout(this._saveUndoDelayedTO),this._saveUndoDelayedTO=setTimeout(()=>{this._saveUndoState()},1e3)}_saveUndoState(){clearTimeout(this._saveUndoDelayedTO),this._saveUndoDelayedTO=!1;var e=F(this._ps,!0);if(this._undoCurrentState){if(JSON.stringify(e)==JSON.stringify(this._undoCurrentState))return;this._undos.push({ps:this._undoCurrentState,cursor:this._lastCursor}),this._undos.length>ae&&this._undos.shift()}this._undoCurrentState=e,this._undoCurrentStateCursor=this._getCursor(),this._redos=[],this._options.onUndoRedo&&this._options.onUndoRedo()}undo(){if(this._saveUndoDelayedTO&&this._saveUndoState(),this._undos.length){this._redos.push({ps:this._undoCurrentState,cursor:this._undoCurrentStateCursor});var e=this._undos.pop();this._ps=$(e.ps),this._undoCurrentState=F(this._ps,!0),this._undoCurrentStateCursor=e.cursor,this._redraw(!0),e.cursor&&this._restoreCursor(e.cursor),this._updateTextPlaceholders(),0==this._undos.length&&(this._undoable=!1)}this._options.onUndoRedo&&this._options.onUndoRedo()}redo(){if(0!=this._redos.length){this._undos.push({ps:this._undoCurrentState,cursor:this._undoCurrentStateCursor});var e=this._redos.pop();this._ps=$(e.ps),this._undoCurrentState=F(this._ps,!0),this._undoCurrentStateCursor=e.cursor,this._redraw(!0),e.cursor&&this._restoreCursor(e.cursor),this._updateTextPlaceholders(),this._options.onUndoRedo&&this._options.onUndoRedo()}}canUndo(){return this._undoable||this._undos.length>0}canRedo(){return this._redos.length>0}initParagraphs(e){e.forEach(e=>{e._preparedData&&((Object(a.isEmbedType)(e.type)?[e.mediaId]:e.mediaId.split(",")).forEach((t,r)=>{d.add(e.type,t,e._preparedData[r])}),delete e._preparedData)}),this._ps=$(e),this._cleanParagraphsBRs(),this._ensureDummyParagraphs(),this._init()}_getParagraphFromHTML(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function i(t,r){if(t.nodeType==Node.TEXT_NODE){var s=t.data.replace(/</g,"&lt;").replace(/>/g,"&gt;");r.text+="pre"==e?s:Object(a.cleanTextSpaces)(s)}else Object(a.isBR)(t)&&r.text.length>0&&r.brs.push(r.text.length);each(t.childNodes,(e,t)=>{var s=[r.text.length];i(t,r),s.push(r.text.length);var o,n=(t.tagName||"").toLowerCase();switch(t.style&&("bold"==t.style.fontWeight||parseInt(t.style.fontWeight)>400)&&(n="strong"),n){case"b":case"strong":o=te.strong;break;case"em":case"i":o=te.em;break;case"s":case"strike":case"del":o=te.strike;break;case"a":o=te.link;var l=t.getAttribute("href")||"",h=Object(a.decodeURL)(l);Object(a.isVKUrl)(l)&&(h=l.match(/app-?\d+_-?\d+/)?h.replace("%23","#"):h.replace("#","%23")),s.push(h);break;case"code":o=te.code;break;case"font":var d=t.getAttribute("face");"monospace"===d?o=te.code:"times"===d&&(o=te.code)}o&&(r.decorations[o.type]=r.decorations[o.type]||[],s[0]<s[1]&&r.decorations[o.type].push(s),r.decorations[o.type]=Object(a.mergeRanges)(r.decorations[o.type]))})}var s=document.createElement("div");s.innerHTML=t;var o,n=[],l={};if("ol"==e||"ul"==e){switch(e){case"ol":o=c.ParagraphType.NumericList;break;case"ul":o=c.ParagraphType.BulletList}for(var h=0,d=s.children.length;h<d;h++){var p={text:"",decorations:{},brs:[]};i(s.children[h],p),p.brs=Object(a.cleanBRs)(p.brs),n.push(p)}}else{switch(e){case"h1":o=c.ParagraphType.Header1;break;case"h2":case"header":o=c.ParagraphType.Header2;break;case"h3":case"h4":o=c.ParagraphType.Header3;break;case"blockquote":o=c.ParagraphType.Quote;break;case"cite":o=c.ParagraphType.Quote2;break;case"pre":o=c.ParagraphType.Code;break;default:o=c.ParagraphType.Text}var _=s.firstElementChild;if(Object(a.isObjectParagraphEl)(_)){var g=domData(_,"type"),u=domData(_,"media-id");g&&u&&(s=geByTag1("figure",_),o=g,l.mediaId=u)}var v={text:"",decorations:{},brs:[]};i(s,v),v.brs=Object(a.cleanBRs)(v.brs,v.text.length),n.push(v),o==c.ParagraphType.Code&&delete v.decorations.code,r||o!=c.ParagraphType.Text||"```"!=v.text||0!=v.brs.length||(v.text="",o=c.ParagraphType.Code),Object(a.isHeaderParagraph)(o)||(0===v.text.indexOf("1. ")?(o=c.ParagraphType.NumericList,this._removeParagraphLineTextPart(v,0,"1. ".length)):0===v.text.indexOf("* ")&&(o=c.ParagraphType.BulletList,this._removeParagraphLineTextPart(v,0,"* ".length))),v.brs=v.brs.filter(e=>e>0)}return l.lines=n,l.type=o,Object(a.buildParagraph)(l)}_removeParagraphLineTextPart(e,t,r){e.text=e.text.substring(0,t)+e.text.substring(r);for(var a=r-t,i=0,s=e.brs.length;i<s;i++){var o=e.brs[i];o>t&&o<r?e.brs[i]=void 0:e.brs[i]>t&&e.brs[i]>=r&&(e.brs[i]-=a)}e.brs=e.brs.filter(e=>void 0!==e),each(e.decorations,(i,s)=>{s.forEach(e=>{e[0]<=t&&e[1]<=t||(e[0]<=t&&e[1]<=r?e[1]=t:e[0]>=t&&e[1]<=r?e[0]=e[1]=void 0:e[0]>=t&&e[1]>r?(e[0]=t,e[1]-=a):(e[0]-=a,e[1]-=a))}),e.decorations[i]=e.decorations[i].filter(e=>void 0!==e[0])})}_renderObjectParagraph(e,t){var r=this._getOrCreateParagraphObject(e),i=r.el();r.onRender&&r.onRender();var s=0;return isString(t)&&(t=[t]),e.type==c.ParagraphType.ObjectPhoto?(s=r.getImageIndex(),r.setCaptionElHtml(t[s]||"")):r.setCaptionElHtml(t[0]||""),domData(i,"paragraph-lines",JSON.stringify(e.lines)),domData(i,"uuid",e._uuid),domData(i,"type",e.type),domData(i,"media-id",e._object.getMediaId()),domData(i,"mode",parseInt(e.mode)||0),addClass(i,a.ArticleEditorParagraphClass),i}_renderParagraphLines(e,t){if(!e.lines)return["",""];var r="",i="",s="",o=parseInt(e.type);switch(o){case c.ParagraphType.NumericList:r="ol",i="li";break;case c.ParagraphType.BulletList:r="ul",i="li";break;case c.ParagraphType.Header1:i="h1";break;case c.ParagraphType.Header2:i="h2";break;case c.ParagraphType.Header3:i="h3";break;case c.ParagraphType.Quote:i="blockquote";break;case c.ParagraphType.Quote2:i="cite";break;case c.ParagraphType.Code:i="pre";break;default:r="p"}var n=[];return e.lines.forEach(r=>{if(r){var l=r.text,h=r.decorations,d=[];each(J,(e,t)=>{if(!Object(a.isHeaderParagraph)(o)&&o!=c.ParagraphType.Code||"code"!=t.type){var r=h[t.type];if(r)for(var i=function(e,a){var i=r[a];(d[i[0]]=d[i[0]]||{open:{},close:{}}).open[t.type]=u(i);var s=d[i[1]]=d[i[1]]||{open:{},close:{}},o=function(e,t){for(var r=[];e>0;){var a=d[--e];if(a)for(var i in a.open)if(a.open.hasOwnProperty(i)){if(i==t)return[];r.push(i)}}return r}(i[1],t.type);o.forEach(e=>{s.close[e.type]=!0}),s.close[t.type]=!0,o.forEach(e=>{s.open[e.type]=u(i)})},s=0,n=r.length;s<n;s++)i(0,s)}});var p=0,_=[];d.forEach((t,i)=>{if(t){var s=!1,o=t.close.link&&1==Object.keys(t.close).length;i>0&&(s=Object(a.prepareLineText)(l,p,i,r.brs,e.type==c.ParagraphType.Code),o||_.push(s));var n=0;o&&(s&&s.endsWith("<br/>")&&(n++,s=s.replace(/<br\/>$/,"")),s&&s.endsWith("<br/>")&&(n++,s=s.replace(/<br\/>$/,"")),!1!==s&&_.push(s)),each(Z,(e,r)=>{void 0!==t.close[r.type]&&_.push(`</${r.tag}>`)}),_.push("<br/>".repeat(n)),each(J,(e,r)=>{var a=t.open[r.type];void 0!==t.open[r.type]&&(!0===a?_.push(`<${r.tag}>`):_.push(`<${r.tag} href="${clean(a)}">`))}),p=i}}),_.push(Object(a.prepareLineText)(l,p,void 0,r.brs,e.type==c.ParagraphType.Code));var g="";i&&(g+=`<${i}${s=s?` ${s}`:""}>`),inArray(o,[c.ParagraphType.Quote,c.ParagraphType.Quote2])&&(g+="<p>"),g+=_.join("")||(t?"":"<br/>"),inArray(o,[c.ParagraphType.Quote,c.ParagraphType.Quote2])&&(g+="</p>"),i&&(g+=`</${i}>`),n.push(g)}function u(e){return e[2]||!0}}),[r,n]}_renderParagraph(e){var t,r=Object(a.isObjectParagraph)(e),i=Q(this._renderParagraphLines(e,r),2),s=i[0],o=i[1];if(r)t=this._renderObjectParagraph(e,o);else{var n=o.join("");t=s?se(`<${s}>${n}</${s}>`):se(n)}return Object(a.hasSeparator)(e)?domData(t,"sep",Object(a.genSepatorId)()):domData(t,"sep",null),addClass(t,a.ArticleEditorParagraphClass),addClass(t,"article_paragraph"),t}_getParagraphElByIndex(e){return!1===e?null:this._els.canvas.childNodes[e]||null}getObjectParagraphIndex(e){for(var t=0;t<this._ps.length;t++)if(this._ps[t]._uuid===e._uuid)return t;return-1}_getParagraph(e){return e<this._ps.length?this._ps[e]:null}_decorateParagraphEls(){for(var e=0,t=this._ps.length;e<t;e++){var r=e>0&&this._ps[e-1],a=this._ps[e],i=e+1<t&&this._ps[e+1],s=!1,o=!1,n=!1;r&&a.type==r.type||(s=!0),i&&a.type==i.type||(o=!0),(c.ResizableObjectTypes.includes(+i.type)||i.sep)&&(n=!0);var l=this._getParagraphElByIndex(e);toggleClass(l,"article_decoration_first",s),toggleClass(l,"article_decoration_last",o),toggleClass(l,"article_decoration_before",n)}}redraw(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._redraw(e,!0)}_redraw(e,t){var r=this._getCursor();e?(this._els.canvas.innerHTML="",this._ps.forEach(e=>{this._els.canvas.appendChild(this._renderParagraph(e))})):this._dirty.forEach(e=>{if(!(e>=this._ps.length)){var t=this._getParagraphElByIndex(e);if(t){var r=this._renderParagraph(this._ps[e]);t?r.outerHTML!=t.outerHTML&&domReplaceEl(t,r):this._els.canvas.appendChild(r)}}}),t&&this._restoreCursor(r),this._decorateParagraphEls(),this._dirty=[]}_getContainingParagraphEl(e){for(;e&&e.parentNode!=this._els.canvas;)e=e.parentNode;var t=Object(a.getElementIndex)(e);return[e,t,this._getParagraph(t)]}_getCurrentParagraphIndex(){var e=window.getSelection();if(e.rangeCount){var t=e.getRangeAt(0);if(t.startContainer==this._els.canvas)return[t.startOffset,t.endOffset];var r=Q(this._getContainingParagraphEl(t.startContainer),2)[1],i=t.endContainer;if(0===t.endOffset&&(this._isParagraphEl(i)||this._isParagraphEl(domPN(i))&&0==Object(a.childNodeIndex)(i))){var s=Q(this._getContainingParagraphEl(i),1)[0];i=Object(f.domPS)(s)||s}var o=Q(this._getContainingParagraphEl(i),2)[1];return[r,Math.max(r,o)]}return[0,!1]}_saveCursorMarker(){if(!this._markerCursorSet){var e=Q(Object(a.getRange)(),2),t=e[0],r=e[1];if(!t)return[0,0];var i=t.startContainer,s=t.startOffset,o=t.endContainer,n=t.endOffset;if(i!=this._els.canvas){var l=this._getContainingParagraphEl(i)[1];h(i,s,a.CURSOR_MARKER_START),r||(this._getContainingParagraphEl(o)[1]==l&&o.textContent.includes(a.CURSOR_MARKER_START)&&(n+=1),h(o,n,a.CURSOR_MARKER_END)),this._markerCursorSet=!0}}function h(e,t,r){if(e.nodeType==Node.TEXT_NODE){var a=e.textContent;e.textContent=a.substring(0,t)+r+a.substring(t)}else{var i=document.createTextNode(r);e.insertBefore(i,e.childNodes[t])}}}_restoreCursorFromMarker(){if(this._markerCursorSet){var e,t,r,i=(e,t,r)=>{return function t(i){if(i.nodeType==Node.TEXT_NODE){var s=i.textContent.indexOf(e);if(s>=0){i.textContent=i.textContent.split(e).join("");var o=i.parentElement;return-1!=o.innerHTML.search(/\s$/)&&(o.innerHTML=o.innerHTML.trimRight()+a.NBSP,r&&r[0]==i&&(r[0]=o.lastChild),i=o.lastChild),o.innerHTML||((i=o).innerHTML="<br/>",s=0),[i,s]}}else for(var n=0,l=i.childNodes.length;n<l;n++){var h;if(h=t(i.childNodes[n]))return h}}(t)};for(r=0;r<this._els.canvas.children.length&&!(e=i(a.CURSOR_MARKER_START,this._els.canvas.children[r]));r++);for(;r<this._els.canvas.children.length&&!(t=i(a.CURSOR_MARKER_END,this._els.canvas.children[r],e));r++);if(e){var s=document.createRange();e[0].nodeType==Node.TEXT_NODE&&(e[1]=Math.min(e[1],e[0].textContent.length)),s.setStart(e[0],e[1]),t&&(t[0].nodeType==Node.TEXT_NODE&&(t[1]=Math.min(t[1],t[0].textContent.length)),s.setEnd(t[0],t[1])),window.getSelection().setBaseAndExtent(s.startContainer,s.startOffset,s.endContainer,s.endOffset)}var o=e=>{this._ps.forEach(t=>{t.lines.forEach(t=>{var r=t.text.indexOf(e);if(r>=0){t.text=t.text.replace(e,"");for(var a=0,i=0;i<t.brs.length;i++)t.brs[i]>r&&(a=1),t.brs[i]-=a;each(J,(e,a)=>{var i=t.decorations[a.type];if(i)for(var s=0,o=i.length;s<o;s++){var n=i[s];n[0]>r&&(n[0]-=1),n[1]>r&&(n[1]-=1)}})}})})};o(a.CURSOR_MARKER_START),o(a.CURSOR_MARKER_END),this._markerCursorSet=!1}}_setAllParagraphsDirty(){this._dirty=[];for(var e=this._els.canvas.children.length,t=0;t<e;t++)this._dirty.push(t);this._ps=[]}_setCurrentParagraphDirty(){var e=Q(this._getCurrentParagraphIndex(),2),t=e[0],r=e[1];this._setParagraphDirty(t,r)}setParagraphDirty(e,t){this._setParagraphDirty(e,t)}_setParagraphDirty(e,t){if(void 0===e||e<0)throw new Error("Invalid paragraph index");t=t||e;for(var r=e;r<=t;r++)inArray(r,this._dirty)||this._dirty.push(r)}_expandDoubleBRs(){function e(e,t,r){var i=e.lines[0];void 0===r&&(r=i.text.length);var s=[];return i.brs.forEach(e=>{e<r&&e>t&&s.push(e-t)}),Object(a.buildParagraph)({type:e.type,lines:[{text:i.text.substr(t,r-t),decorations:Object(a.decorationsSlice)(i.decorations,t,r),brs:s}]})}for(var t=!1,r=0,i=this._ps.length;r<i;r++){var s=this._ps[r];if(s.lines.length>1)s.lines.forEach(a.cleanLineBRs);else{var o=s.lines[0];if(!o||!o.brs.length)continue;for(var n=o.brs,l=[],h=0,d=0,c=n.length;d<c;d++)if(h!=n[d]&&d>0&&n[d-1]==n[d]){var p=e(s,h,n[d]);Object(a.isParagraphEmpty)(p)||l.push(p),h=n[d]}l.push(e(s,h)),l.length>1&&(Array.prototype.splice.apply(this._ps,[r,1].concat(l)),r=r+l.length-1,t=!0)}}return t}_processAlienPhotos(){var e=this;if(!this._photoPasteUploadingProcess)for(var t,r=Array.prototype.slice.call(this._els.canvas.children);t=r.shift();)if(!Object(a.isObjectParagraphEl)(t)||!this._isTrackedObjectEl(t))for(var i=Array.prototype.slice.call(geByTag("img",t)),s=void 0,o=function(){if(!s.src||!domPN(t)||!isVisible(s))return"continue";var r=Object(f.traverseParent)(s,t=>t==e._els.canvas||"FIGURE"==t.tagName,10),i=!(!r||r==e._els.canvas)&&geByTag1("figcaption",r),o=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPhoto}),n=e._renderObjectParagraph(o,i?i.innerHTML:"");Object(a.justCursorInString)(t.textContent)?(domReplaceEl(t,n),re(s),Object(f.domInsertAfter)(se(`<p>${a.CURSOR_MARKER_START}</p>`),n)):(Object(f.domInsertAfter)(n,domPN(s)),re(i),re(s)),Object(f.traverseParent)(n,t=>{if(t==e._els.canvas)return!0;removeClass(t,a.ArticleEditorParagraphClass)}),Object(a.queuePhotoProcess)(s.src,(t,r,a)=>{t?(re(n),e._forgetObject(o._uuid),e._setAllParagraphsDirty(),e._triggerInputEvent(),a()):e._getOrCreateParagraphObject(o).setBLOB(r,a)})};s=i.shift();)o()}_flattenAlienParagraphs(){var e=this;if(this._fromPasteEvent){for(var t,r=Array.prototype.slice.call(this._els.canvas.children),i=this._fromPasteEvent,s=this._pasteCurrentIndex,o=Q(this._getCurrentParagraphIndex(),1)[0],n=-1,l=function(){if(n++,i&&!trim(t.textContent)&&n>s&&n<=o)return re(t),"continue";var r=t;Object(a.isQuoteEl)(t)&&!Object(a.isAlienParagraphEl)(t)&&(r=t.firstChild);var l=!1;(function e(i){if(i&&i.nodeType!=Node.TEXT_NODE&&!Object(a.isBR)(i))if(Object(a.hasBlockElements)(i))if(this._isTrackedObjectEl(i))i!=r&&(domInsertBefore(i,t),l=!0);else for(var s,o=Array.prototype.slice.call(i.childNodes);s=o.shift();)e.call(this,s);else i!=r&&(trim(i.innerHTML)&&domInsertBefore(i,t),l=!0)}).call(e,r,!0),l&&re(t)};t=r.shift();)l();this._setAllParagraphsDirty()}}_correctCaptionSelection(){var e=Q(Object(a.getRange)(),3),t=e[0],r=e[1],i=e[2];if(t&&!r){var s=Object(f.traverseParent)(t.startContainer,e=>"FIGCAPTION"==e.tagName,5);if(s&&t.endContainer!=t.startContainer&&t.endContainer.nodeType==Node.ELEMENT_NODE&&Object(a.isParagraphEl)(t.endContainer)&&0==t.endOffset&&0==t.startOffset){var o=geByClass1("article_ed__figcaption_edit",s),n=t.cloneRange();n.selectNodeContents(o),i.removeAllRanges(),i.addRange(n)}}}cancelSaveDraft(){clearTimeout(this._draftSaveTO)}saveDraft(e,t,r){if(!this.isLocked()){clearTimeout(this._draftSaveTO);var a=JSON.stringify({paragraphs:F(this._ps)});t?this._lastSavedDraft=a:this._lastSavedDraft!=a||e?(this._options.onDraftNotSaved&&this._options.onDraftNotSaved(),this._draftSaveTO=setTimeout(()=>{if(this._lastSavedDraft=a,0!=this._ps.length){var e=K(this._ps);e?this._options.onDraftNotSaved&&this._options.onDraftNotSaved(e):this.save(!1,(e,t,r)=>{this._initDraftSave=!0,this._options.onDraftSaved&&this._options.onDraftSaved(e,t,r)})}},r?0:1e3*this._options.draftSaveDelay)):!t&&this._initDraftSave&&this._options.onDraftSaved&&this._options.onDraftSaved(!1,this.getArticleId())}}_getName(){if(this._publishName)return this._publishName;var e=F(this._ps),t=e.length?e[0].lines[0].text:"";return Object(a.generateLatinizedName)(t,this._options.maxNameLength)}getTitle(){var e=this._ps[0];return e?e.lines[0].text:""}isLimitsExceeded(){return!!K(this._ps)}save(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=F(this._ps,!1,!0);e&&Object(a.correctRealIndexes)(i,-1);var s=this._getName(),o=this.getCoverPhoto();void 0===o&&e&&(o=this.getFirstCoverPhotoFromParagraphs()),this.getOptions().postData&&(r.from_post_convert=1),this.getOptions().isEducationArticle&&(r.education_course_id=this.getOptions().educationCourseId),r.session_duration=this.getTimeSpent(),Y.save(this.getArticleOwnerId(),this.getArticleId(),i,e,s,o?o.id:"",this._getSaveDraftHash(),this._options.limits.maxSymbolsPerChunk,r,(r,a,i,o,n,l)=>{if(isString(r)&&r.startsWith("locked "))return this.getOptions().editLockMessage=r.slice("locked ".length),this.showEditLockInfo(),void(t&&t(!0));r||(a&&(this._options.articleId=a),"al_articles.php"!=nav.objLoc[0]||nav.objLoc.article_id||nav.setLoc(extend({},nav.objLoc,{article_id:this.getArticleOwnerId()+"_"+this.getArticleId()})),this._publishNameCandidate=s,e&&(this._options.isPublished=!0,this.wasPublishedInCurrentSession=!0),this._options.monetizationAllowed=l,this._replaceVideos(n)),t&&t(r,a,i,o)})}_replaceVideos(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!1;try{e.forEach(e=>{var r=Q(e,4),a=r[0],i=r[1],s=r[2],o=r[3];this._ps.forEach((e,r)=>{if(e.type==c.ParagraphType.ObjectVideo){var n=Q(e.mediaId.split("_"),3),l=n[0],h=n[1];n[2]||l!=a||h!=i||(e.mediaId=`${s}_${o}`,this._setParagraphDirty(r),t=!0)}})})}catch(e){}t&&this._redrawModel()}focus(){this._restoreLastCursor()}focusLastParagraph(){Object(a.focusEl)(this._getParagraphElByIndex(this._ps.length-1))}getArticleId(){return this._options.articleId}getArticleOwnerId(){return this._options.articleOwnerId}_getSaveDraftHash(){return this._options.saveDraftHash}_expandBlockquoteParagraphs(e){for(var t,r=Array.prototype.slice.call(this._els.canvas.children);t=r.shift();)if(Object(a.isQuoteEl)(t)){var i=t.tagName,s=Array.prototype.slice.call(t.children),o=s[0];if(1==s.length&&o&&o.tagName&&inArray(o.tagName,["H1","H2","H3"])){domReplaceEl(t,o);continue}if(s.shift(),s.length)for(var n=void 0;n=s.shift();){if(this._saveCursorMarker(),e)Object(f.domInsertAfter)(n,t);else{var l=se(`<${i}></${i}>`);l.appendChild(n),Object(f.domInsertAfter)(l,t)}this._restoreCursorFromMarker()}}}_ensureDummyParagraphs(){if(this._els.canvas){var e=this._els.canvas.lastChild;if(e)if(trim(e.innerHTML)&&"<br>"!=e.innerHTML&&"&nbsp;"!=e.innerHTML||"H1"==e.tagName){var t=Object(a.buildParagraph)({});this._els.canvas.appendChild(this._renderParagraph(t)),this._ps.push(t),this._updateTextPlaceholders()}}}_ensureAtLeastOneParagraph(){0==this._ps.length&&(this._ps=[Object(a.buildParagraph)({type:c.ParagraphType.Text})])}_ensureTitleParagraph(){if(!this._options.noTitle){var e=this._ps[0];Object(a.isObjectParagraph)(e)&&(this._ps[0]=Object(a.buildParagraph)({type:c.ParagraphType.Header1})),e.type=c.ParagraphType.Header1,e.lines[0].decorations={},e.lines[0].brs=[],delete e.sep}this._ps.forEach((e,t)=>{(this._options.noTitle||0!=t)&&(1==t&&e.type==c.ParagraphType.Header1&&(e.type=c.ParagraphType.Text),e.type==c.ParagraphType.Header1&&(e.type=c.ParagraphType.Header2))})}_insertParagraphAt(e,t){this._ps.splice(e,0,t)}_deleteParagraphFrom(e){this._ps.splice(e,1)}_focusParagraph(e,t){Object(a.focusEl)(this._getParagraphElByIndex(e),t)}_init(){this._correctEmptyParagraphAfterFloatObjects(),this._redraw(!0),this._initEvents(),this._initLinksHrefTooltip(),this._initResizeTooltip()}_redrawModel(){this._saveCursorMarker(),this._redraw(!0),this._restoreCursor()}addObjectMarketProduct(){var e=Q(this._getCurrentParagraphIndex(),1)[0];Object(V.showAttachProductBox)(null,t=>{Object(a.isParagraphEmpty)(this._ps[e])||this._insertParagraphAt(e,Object(a.buildParagraph)());var r={type:c.ParagraphType.ObjectMarketItem,mediaId:t.id};"link"===t.type&&(r.type=c.ParagraphType.ObjectAliExpressProduct,r.mediaId=t.url);var i=Object(a.buildParagraph)(r);"link"===t.type?d.addRaw(r.type,r.mediaId,{product:t}):d.add(r.type,r.mediaId,{product:t}),this._getOrCreateParagraphObject(i),this._ps[e]=i,curBox().hide(),this._redrawModel();var s=this._getParagraphElByIndex(e);Object(a.focusEl)(s),this.saveUndoStateAndDraft(),e++})}addObjectAudio(){var e=Q(this._getCurrentParagraphIndex(),1)[0];this.getArticleOwnerId()<0&&(cur.audioAttachOriginalOwnerId=this.getArticleOwnerId(),cur.audioAttachSwitchOwnerId=vk.id),AudioPage.showAttachBox(this.getArticleOwnerId(),{canPlaylistAttach:!0,onAudioChoose:(t,r,i,s)=>{Object(a.isParagraphEmpty)(this._ps[e])||this._insertParagraphAt(e,Object(a.buildParagraph)());var o=Object(a.buildParagraph)({type:c.ParagraphType.ObjectAudio,mediaId:i.fullId});d.add(c.ParagraphType.ObjectAudio,i.fullId,{audio:s}),this._getOrCreateParagraphObject(o),this._ps[e]=o,t.shiftKey||curBox().hide(),this._redrawModel();var n=this._getParagraphElByIndex(e);Object(a.focusEl)(n),this.saveUndoStateAndDraft(),e++},onPlaylistChoose:(t,r)=>{var i=r.getOwnerId()+"_"+r.getPlaylistId()+(r.getAccessHash()?"_"+r.getAccessHash():""),s=Object(a.buildParagraph)({type:c.ParagraphType.ObjectAudioPlaylist,mediaId:i});d.add(c.ParagraphType.ObjectAudioPlaylist,i,{accessHash:r.getAccessHash()}),this._getOrCreateParagraphObject(s),this._ps[e]=s,curBox().hide(),this._redrawModel();var o=this._getParagraphElByIndex(e);Object(a.focusEl)(o),this.saveUndoStateAndDraft()}})}closeAllCarouselEditors(){this._ps.forEach(e=>{e.type==c.ParagraphType.ObjectPhoto&&e._object.cancelCarouselEditor&&e._object.cancelCarouselEditor()})}setMediaUploadMode(e){this._isUploading=!!e,toggleClass(this._els.editor,"article_ed__uploading",this._isUploading)}isMediaUploadMode(){return this._isUploading}addObjectVideo(){var e=Q(this._getCurrentParagraphIndex(),1)[0],t=this._getParagraph(e),r=Object(a.hasSeparator)(t);delete t.sep,showBox("al_video.php",{act:"a_choose_video_box",from:"article",to_id:this.getArticleOwnerId(),blockPersonal:1}),cur.chooseMedia=(t,i,s,o,n)=>{var l=Object(a.buildParagraph)({type:c.ParagraphType.ObjectVideo,mediaId:i,sep:r});r=!1,d.add(c.ParagraphType.ObjectVideo,i,s),this._getOrCreateParagraphObject(l),0==o?this._ps[e]=l:this._ps.splice(e+o,0,l),this._redrawModel(),this._saveUndoState();var h=this._getParagraphElByIndex(e);Object(a.focusEl)(h),!n&&curBox()&&curBox().hide(),this.saveDraft()}}addObjectDoc(){var e=Q(this._getCurrentParagraphIndex(),1)[0],t=this._getParagraph(e),r=Object(a.hasSeparator)(t);delete t.sep,cur.docsCurFilter="gif";var i=showBox("docs.php",{act:"a_choose_doc_box",from:"article",ext_filter:"gif",to_id:this.getArticleOwnerId()},{stat:["docs.css"]});cur.chooseMedia=(t,s,o)=>{i.hide();var n=Object(a.buildParagraph)({type:c.ParagraphType.ObjectGIF,mediaId:s,sep:r});r=!1,d.add(c.ParagraphType.ObjectGIF,s,{video:o.video_preview,size:o.video_preview_size,href:o.href}),this._getOrCreateParagraphObject(n),this._insertParagraphAt(e,n),this._redrawModel(),this._saveUndoState(),this.saveDraft(),this._updateTextPlaceholders()},cur.showMediaProgress=()=>{}}addObjectPhoto(){var e,t,r=Q(this._getCurrentParagraphIndex(),1)[0],i=this._getParagraph(r)||Object(a.buildParagraph)(),s=showBox("al_photos.php",{to_id:this.getArticleOwnerId(),act:"choose_photo",max_files:200,article:1},{cache:1,stat:[jsc("web/photos.js"),"photos.css","upload.js"],dark:1});cur.onMediaUploadStarted=()=>{var t=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPhoto}),i=this._renderObjectParagraph(t,""),s=this._getParagraphElByIndex(r);domInsertBefore(i,s),Object(a.focusEl)(s),e=i,this.setMediaUploadMode(!0)},cur.onMediaUploadFail=()=>{delete cur.onMediaUploadStarted,e&&re(e),this.setMediaUploadMode(!1)};var o=-1;cur.chooseMedia=(n,l,h,p)=>{void 0===p?o++:o=intval(p),delete cur.onMediaUploadStarted,this.setMediaUploadMode(!1),e&&re(e);var _=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPhoto,mediaId:l,sep:i.sep});return d.add(c.ParagraphType.ObjectPhoto,l,{size:Object(a.getPhotoSize)(h.editable.sizes),sizes:h.editable.sizes}),this._getOrCreateParagraphObject(_),o?this._ps.splice(r+o,0,_):this._ps[r]=_,void 0===p&&s.hide(),clearTimeout(t),t=setTimeout(()=>{this._redrawModel(),this._focusParagraph(r+o),this._updateTextPlaceholders(),this.saveUndoStateAndDraft()},10),!1},cur.showMediaProgress=()=>{}}addSeparator(){var e=Q(this._getCurrentParagraphIndex(),1)[0],t=Object(a.hasSeparator)(this._getParagraph(e)),r=Object(a.hasSeparator)(this._getParagraph(e+1));!t&&!r&&e<this._ps.length-1&&this._ps.splice(e,1),this._getParagraph(e).sep=1;var i=this._getCursor();this._redraw(!0),this._restoreCursor(i),this._updateTextPlaceholders()}addObjectPoll(){var e=Q(this._getCurrentParagraphIndex(),1)[0],t=this._getParagraph(e),r=Object(a.hasSeparator)(t);showBox("al_voting.php",{act:"box",owner_id:this.getArticleOwnerId(),ref:"article"},{containerClass:"article_poll_creation"}),cur.chooseMedia=(t,i)=>{if(t&&i){var s=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPoll,mediaId:t,sep:r});d.add(c.ParagraphType.ObjectPoll,t,{editable:!0,snippet:i}),r=!1,this._getOrCreateParagraphObject(s),this._insertParagraphAt(e,s),this._redrawModel(),this._saveUndoState(),this.saveDraft(),this._updateTextPlaceholders()}}}editObjectPoll(e){var t=Q(e.getMediaId().split("_"),2),r=t[0],i=t[1],s=Q(this._getContainingParagraphEl(e.el()),3),o=s[1],n=s[2],l=Object(a.hasSeparator)(n);showBox("al_voting.php",{act:"box",voting_id:i,owner_id:r,ref:"article"},{containerClass:"article_poll_creation"}),cur.chooseMedia=(t,r)=>{var i=e.getCaptionEl().innerHTML;this._deleteParagraphFrom(o),this._forgetObject(n._uuid);var s=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPoll,mediaId:t,sep:l});d.add(c.ParagraphType.ObjectPoll,t,{editable:!0,snippet:r}),l=!1;var h=this._getOrCreateParagraphObject(s);this._insertParagraphAt(o,s),this._redrawModel(),this._saveUndoState(),this.saveDraft(),this._updateTextPlaceholders(),h.setCaptionElHtml(i)}}onObjectStateLoaded(){this.saveDraft(),this._showObjectPicker()}_hideObjectPicker(){this._objectPickerTooltip&&this._objectPickerTooltip.hide()}_showObjectPicker(){if(!this.isLocked()&&cur.articleEditor){if(!this._objectPickerEl){this._objectPickerEl=se('<div class="article_editor_object_picker"><div class="article_editor_object_picker_icon"></div></div>'),this._els.editor.appendChild(this._objectPickerEl);var e="";Object(G.partConfigEnabled)("article_poll")&&(e='<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_poll" onclick="cur.articleEditor.addObjectPoll()"></button>');var t="";cur.articleEditor.getOptions().marketAttachProductEnabled&&(t='<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_product" onclick="cur.articleEditor.addObjectMarketProduct()"></button>');var r=se(`<div class="article_editor_object_picker_btns_wrap clear_fix">\n        <button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_photo" onclick="cur.articleEditor.addObjectPhoto()">\n        </button><button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_video" onclick="cur.articleEditor.addObjectVideo()">\n        </button><button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_audio" onclick="cur.articleEditor.addObjectAudio()"></button>\n        ${e}\n        ${t}\n        <button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_doc" onclick="cur.articleEditor.addObjectDoc()">\n        </button><button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_sep" onclick="cur.articleEditor.addSeparator()">\n        </button>\n      </div>`);this._objectPickerTooltip=new ElementTooltip(this._objectPickerEl,{content:r,forceSide:"right",cls:"article_editor_object_picker_tt",autoShow:!1,elClassWhenShown:"article_editor_object_picker_tt_shown",offset:[2,0]}),this._objectPickerEl.addEventListener("mousedown",e=>cancelEvent(e))}var i=Q(this._getCurrentParagraphIndex(),2),s=i[0],o=i[1];if(!this.isMediaUploadMode()&&!1!==s&&s==o&&Object(a.isParagraphEmpty)(this._ps[s],!0)&&this._ps[s]&&inArray(this._ps[s].type,[c.ParagraphType.Text,c.ParagraphType.Header2,c.ParagraphType.Header3])){show(this._objectPickerEl);var n=this._getParagraphElByIndex(s),l=getXY(this._els.editor),h=getXY(n)[1]-l[1],d=!1;this._uploadFloatList(),this._floatedObjects.forEach(e=>{e.startY<=h+15&&e.endY+30>=h&&(d=!0)}),setStyle(this._objectPickerEl,{left:d?355:-40,top:h})}else hide(this._objectPickerEl)}}_initLinksHrefTooltip(){this._els.canvas.addEventListener("mouseover",e=>{if("a"==e.target.tagName.toLowerCase()){if(this._linkTooltip&&this._linkTooltip.destroy(),this._formatTooltip&&this._formatTooltip.isShown())return;var t=e.target,r=t.getAttribute("href").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),i=Object(a.decodeURL)(r);Object(a.isVKUrl)(r)||(r="/away.php?to="+encodeURIComponent(r)+"&utf=1"),this._linkTooltip=new ElementTooltip(t,{cls:"article_editor_link_show_tt",appendTo:this._els.editor,content:se(`<a target="_blank" rel="noopener" href="${r}" class="article_editor_link">${i}</a>`)})}})}_isTrackedObjectEl(e){var t=domData(e,"uuid");return!!t&&!!this._getObject(t)}_cloneObjectParagraphs(){for(var e,t=Array.prototype.slice.call(this._els.canvas.children),r={};e=t.shift();)if(Object(a.isObjectParagraphEl)(e)){var i=e.getAttribute("data-uuid"),s=parseInt(e.getAttribute("data-type"));if(r[i]){var o=this._getObject(i);i=oe(),this._getOrCreateParagraphObject({type:s,_uuid:i,mediaId:o.getMediaId()}),domData(e,"uuid",i)}r[i]=!0}}_correctCursorToBeWithinCanvas(){var e=Q(Object(a.getRange)(),2),t=e[0];e[1]&&t.startContainer==this._els.canvas&&this._focusParagraph(0)}_triggerInputEvent(){this._els.canvas.dispatchEvent(new Event("input"))}getCursor(){return this._getCursor()}_getCursor(){var e=this._els.canvas,t=Q(Object(a.getRange)(),2),r=t[0],i=t[1];if(!r)return!1;var s={start:{path:[],textOffset:void 0,nodeOffset:void 0},end:{path:[],textOffset:void 0,nodeOffset:void 0}};function o(t,r,i){r.nodeType==Node.TEXT_NODE?t.textOffset=i:t.nodeOffset=i,Object(f.traverseParent)(r,r=>{if(r==e)return!0;Object(a.isQuoteEl)(r)&&r.firstChild&&r.firstChild.nodeType==Node.ELEMENT_NODE&&"p"==r.firstChild.tagName.toLowerCase()&&t.path.pop(),t.path.push(Object(a.childNodeIndex)(r))},10),t.path=t.path.slice().reverse()}return o(s.start,r.startContainer,r.startOffset),i?delete s.end:o(s.end,r.endContainer,r.endOffset),s.isEmpty=()=>!s.end&&0==s.start.nodeOffset&&0==s.start.path.length&&0==s.start.path[0],s}restoreCursor(e){this._restoreCursor(e)}_restoreCursor(e){if(!e)return this._restoreCursorFromMarker();var t=this._els.canvas;function r(e){var r=t,i=0;return e.path.forEach((t,i)=>{if(Object(a.isQuoteEl)(r)){var s=r.firstChild;s&&1==i&&s.nodeType==Node.ELEMENT_NODE&&"p"==s.tagName.toLowerCase()&&(r=s)}t=Math.min(r.childNodes.length-1,t);var o=r.childNodes[t];if(!o)return e.nodeOffset=0,!1;r=o}),i=r.nodeType==Node.TEXT_NODE&&void 0!==e.textOffset?Math.min(r.textContent.length,e.textOffset):0,void 0!==e.nodeOffset&&r&&r.children&&(i=Math.min(e.nodeOffset,r.childNodes.length)),[r,i]}var i=document.createRange();try{var s=Q(r(e.start),2),o=s[0],n=s[1];if(Object(a.isBR)(o)&&0==n){var l=domPN(o);Object(a.isParagraphEl)(l)&&1==l.childNodes.length&&(o=l)}if(i.setStart(o,n),e.end){var h=Q(r(e.end),2),d=h[0],c=h[1];i.setEnd(d,c)}window.getSelection().setBaseAndExtent(i.startContainer,i.startOffset,i.endContainer,i.endOffset)}catch(e){debugLog(e)}}_saveLastCursor(){var e=this._getCursor(),t="article_cursor_"+this.getArticleOwnerId()+"_"+(this.getArticleId()||0);e&&!e.isEmpty()?ls.set(t,JSON.stringify(e)):ls.remove(t),this._lastCursor=e}_restoreLastCursor(){var e=ls.get("article_cursor_"+this.getArticleOwnerId()+"_"+(this.getArticleId()||0));e?(e=JSON.parse(e),this._restoreCursor(e)):Object(a.focusEl)(this._els.canvas.firstChild)}_toggleCodeBlocks(){for(var e,t=Q(this._getCurrentParagraphIndex(),2),r=t[0],a=t[1],i=r;i<=a;i++)void 0===e&&(e=this._ps[i].type!=c.ParagraphType.Code),this._ps[i].type=e?c.ParagraphType.Code:c.ParagraphType.Text;var s=this._getCursor();this._redraw(!0),this._restoreCursor(s),this._updateTextPlaceholders()}_removeExtraSeparators(){for(var e,t=this._els.canvas.children,r=0;r<t.length;r++){var a=t[r],i=domData(a,"sep");i&&(void 0!==e&&i==e&&domData(a,"sep",null),e=i)}}_replaceAlienInlineTags(){var e=!1,t={b:"strong",i:"em"};return function r(a){var i=a.tagName.toLowerCase();if(t[i]){e||(this._saveCursorMarker(),e=!0);var s=ce(t[i],{innerHTML:a.innerHTML});domReplaceEl(a,s)}else for(var o,n=Array.prototype.slice.call(a.childNodes);o=n.shift();)o.nodeType==Node.ELEMENT_NODE&&r.call(this,o)}.call(this,this._els.canvas),e&&this._restoreCursorFromMarker(),e}_cleanParagraphsBRs(){this._ps.forEach(e=>{e.lines.forEach(a.cleanLineBRs)})}_initEvents(){if(!this.isLocked()){this._setEventListener(window,"scroll",()=>{var e=scrollGetY(),t=window.innerHeight;this._ps.forEach((r,i)=>{if(Object(a.isObjectParagraph)(r)){var s=this._getParagraphElByIndex(i),o=getSize(s),n=getXY(s),l=n[1]<e+t&&n[1]+o[1]>e;r._object.onViewport&&r._object.onViewport(l)}})});var e,t=0;this._setEventListener(document,"selectionchange",()=>{var r=Q(Object(a.getRange)(),2),i=r[0],o=r[1];if(i&&!Object(f.traverseParent)(i.commonAncestorContainer,e=>e==this._els.canvas))return void this._showObjectPicker();var n=Q(this._getCurrentParagraphIndex(),1)[0];if(!1!==n){if(!o&&hasClass(i.startContainer,"article")){var l=this._ps[t];if(Object(a.isObjectParagraph)(l))return void Object(a.focusEl)(l._object.getCaptionEl())}var h=i.startContainer;if(browser.msie&&o&&gpeByClass("article_ed__extra_controls",h)&&"BUTTON"!=h.tagName){var d=this._ps[n];if(Object(a.isObjectParagraph)(d))return void d._object.getCaptionEl().focus()}t=n,this._highlightObjectsInCurrentSelection(),this._showObjectPicker(),this._correctCaptionSelection(),this._ensureDummyParagraphs(),0==s&&this._showFormatTooltip(),this._saveLastCursor();var p=this._getParagraph(n);Object(a.isObjectParagraph)(p)&&c.ResizableObjectTypes.includes(parseInt(p.type))?this._resizeTooltip&&(clearTimeout(e),e=setTimeout(()=>{this._showResizeTooltip()},100)):this._resizeTooltip&&this._resizeTooltip.isShown()&&this._resizeTooltip.hide()}else this._showObjectPicker()});var r=!1,i=!1,s=!1;this._els.canvas.addEventListener("mousedown",()=>{var e;s=!0,this._setEventListener(window,"mouseup",e=t=>{s=!1,"article_format_btn_link"==t.target.id||(this._showFormatTooltip(),e&&window.removeEventListener("mouseup",e))})}),this._els.canvas.addEventListener("selectstart",()=>{this._hideFormatTooltip()}),this._els.canvas.addEventListener("copy",e=>{var t=Q(Object(a.getRange)(),2),r=t[0];if(t[1]){var i=Q(this._getContainingParagraphEl(r.commonAncestorContainer),1)[0];Object(a.isObjectParagraphEl)(i)&&(e.clipboardData.setData("text/plain","uuid:"+i.getAttribute("data-uuid")),e.preventDefault())}}),this._els.canvas.addEventListener("paste",e=>{var t=Q(this._getCurrentParagraphIndex(),1)[0];t&&(this._handleObjectPaste(e),this._handleLinkPaste(e),this._handlePhotoPaste(e),this._fromPasteEvent=!0,this._pasteCurrentIndex=t)}),this._els.canvas.addEventListener("click",e=>{if(e.target.nodeType==Node.ELEMENT_NODE&&"A"==e.target.tagName)return cancelEvent(e)});var o=!1;this._els.canvas.addEventListener("input",()=>{this._hideObjectPicker(),this._expandBlockquoteParagraphs(h),this._removeExtraSeparators();var e,t=this._replaceAlienInlineTags();browser.safari||this._els.canvas.normalize(),this._fromPasteEvent||t||this._markerCursorSet?this._saveCursorMarker():e=this._getCursor(),this._processAlienPhotos(),this._flattenAlienParagraphs(),this._cloneObjectParagraphs(),this._ps.length>0&&this._els.canvas.children.length!==this._ps.length&&this._setAllParagraphsDirty(),this._dirty.forEach(this._updateLineData.bind(this)),o&&(this._cleanParagraphsBRs(),o=!1),this._ensureAtLeastOneParagraph(),this._ensureTitleParagraph();var a=!1;if(this._fromPasteEvent)try{a=this._expandDoubleBRs()}catch(e){console.error(e)}this._redraw(a),this._restoreCursor(e),this._correctCursorToBeWithinCanvas(),this._dirty=[],i?this._saveUndoStateDelayed():this._saveUndoState(),r=i=!1,this._fromPasteEvent=!1,this._updateTextPlaceholders(),this.saveDraft(),this._undoable=!0,this._options.onUndoRedo&&this._options.onUndoRedo()});var n,l=!1,h=!1,d=1;this._els.canvas.addEventListener("keydown",e=>{var t=e.keyCode,s=e.metaKey||e.ctrlKey,p=e.shiftKey,_=Q(Object(a.getRange)(),2),g=_[0],u=_[1];if(g){var v=Q(this._getCurrentParagraphIndex(),2),b=v[0],m=v[1],y=this._getParagraph(b),P=!1;if(Object(a.isObjectParagraph)(y))if(y._object.isCaptionFocused())P=0==g.startOffset&&u;else P=Q(this._getContainingParagraphEl(g.startContainer),1)[0]==y._object.el();if(P&&u&&browser.mozilla){if(t==q.Up)return this._focusParagraph(b-1,!0),cancelEvent(e);if(t==q.Down)return this._focusParagraph(b+1,!0),cancelEvent(e)}if((t==q.Delete||t==q.Backspace)&&this._resizeTooltip&&this._resizeTooltip.isShown()&&this._resizeTooltip.hide(),t==q.Tab&&u&&0==b)return Object(a.focusEl)(this._getParagraphElByIndex(1)),cancelEvent(e);if(s&&t==q.KeyA&&Object(a.isObjectParagraph)(y)&&y._object.isCaptionFocused()){var E=y._object.getCaptionEl();return Object(a.selectEl)(E),cancelEvent(e)}if(s)switch(t){case q.KeyB:return this._setCurrentParagraphDirty(),document.execCommand("Bold",!1,null),cancelEvent(e);case q.KeyI:return this._setCurrentParagraphDirty(),document.execCommand("Italic",!1,null),cancelEvent(e);case q.KeyS:return this.saveDraft(!1,!1,!0),cancelEvent(e);case q.KeyZ:return p?this.redo():this.undo(),cancelEvent(e);case q.KeyY:return this.redo(),cancelEvent(e)}var O=t==q.KeyC&&e.altKey,j=y?y.type:c.ParagraphType.Text,C=Object(f.gpeByTag)("pre",g.startContainer),T=!!(C||Object(f.gpeByTag)("pre",g.endContainer)||g.startContainer.nodeType==Node.ELEMENT_NODE&&"PRE"==g.startContainer.tagName);if(O){if(j===c.ParagraphType.Header1)return cancelEvent(e);if(u)return this._toggleCodeBlocks(),cancelEvent(e);if(!T&&inArray(j,[c.ParagraphType.Text,c.ParagraphType.NumericList,c.ParagraphType.BulletList])){this._setCurrentParagraphDirty();var w=Object(f.gpeByTag)("code",g.startContainer)||Object(f.gpeByTag)("code",g.endContainer);if(w){this._saveCursorMarker();var x=se("<span></span>");x.innerHTML=w.innerHTML,domReplaceEl(w,x),this._triggerInputEvent()}else document.execCommand("fontName",!1,"monospace"),browser.msie&&this._triggerInputEvent();return cancelEvent(e)}}if(t==q.Tab&&T&&j==c.ParagraphType.Code)return document.execCommand("insertText",!1,"  "),cancelEvent(e);var I=!1;if(t==q.Backspace){if(l)return l[0].textContent=l[1],this._restoreCursor(l[2]),l=!1,cancelEvent(e);if(P){var k=this._getParagraphElByIndex(b),L=Object(a.createParagraphEl)("",Object(a.hasSeparator)(y));return this._correctEmptyParagraphAfterFloatObjects(),domReplaceEl(k,L),Object(a.focusEl)(L),this._setAllParagraphsDirty(),this._triggerInputEvent(),cancelEvent(e)}if(g&&0==g.startOffset&&g.collapsed){var A=Object(f.gpeByTag)("li",g.startContainer),M=Object(a.getElementIndex)(A);if(A){var D=this._ps[b],R=clone(D),B=clone(D);R.lines=R.lines.slice(0,M);var N=Object(a.buildParagraph)({lines:[clone(D.lines[M])]});B.lines=B.lines.slice(M+1),this._ps.splice(b,1,R,N,B),this._redraw(!0);var z=this._getParagraphElByIndex(b+1);return Object(a.focusEl)(z),this._saveUndoState(),cancelEvent(e)}}if(g&&u&&0==g.startOffset&&"LI"!==g.startContainer.nodeName){var H=Q(this._getCurrentParagraphIndex(),1)[0],U=H>0&&this._ps[H-1];if(Object(a.isObjectParagraph)(U)){Object(a.isParagraphEmpty)(this._ps[H])&&(this._ps.splice(H,1),this._redraw(!0));var F=this._getParagraphElByIndex(H-1);return Object(a.focusEl)(F),cancelEvent(e)}}this._setAllParagraphsDirty(),browser.msie&&setTimeout(()=>{this._triggerInputEvent()})}if(t==q.Delete){var $=this._ps[b],K=this._ps[b+1],W=Q(Object(X.getCaretCharacterOffsetWithin)(g.startContainer),1)[0],Y=g.startContainer.textContent.length==W;if(P)if(!($._object.isCaptionFocused()&&!!$.lines[0].text)){var G=this._getParagraphElByIndex(b),V=Object(a.createParagraphEl)();return domReplaceEl(G,V),Object(a.focusEl)(V),this._setAllParagraphsDirty(),this._triggerInputEvent(),cancelEvent(e)}if(u&&Object(a.hasSeparator)(K)&&Y)return this._setParagraphDirty(b+1),delete K.sep,this._redraw(!1,!0),cancelEvent(e);if(u&&Y&&Object(a.isObjectParagraph)(K))return Object(a.isParagraphEmpty)($)&&$.type!=c.ParagraphType.Header1&&(this._ps.splice(b,1),this._redraw(!0,!0)),Object(a.focusEl)(K._object.getCaptionEl()),cancelEvent(e);K&&Object(a.isParagraphEmpty)($)&&inArray(K.type,[c.ParagraphType.Header2,c.ParagraphType.Header3])&&($.type=K.type,this._setParagraphDirty(b),this._redraw()),this._setAllParagraphsDirty(),(browser.msie&&0==g.startOffset&&0==b||p)&&setTimeout(()=>{this._setCurrentParagraphDirty(),this._triggerInputEvent()})}else if(t==q.Enter){if(T&&C&&j==c.ParagraphType.Code&&u){var J=C.textContent.search(/[^\s]/);return-1==J&&(J=C.textContent.length),document.execCommand("insertText",!1,"\n"+" ".repeat(J)),cancelEvent(e)}if(this._isWithinObjectParagraphEl(Object(a.getFocusedElement)())){var Z=Q(this._getContainingParagraphEl(Object(a.getFocusedElement)()),2),ee=Z[0],te=Z[1],re=Object(a.createParagraphEl)(),ae=this._ps[te]._object;return!ae.isCaptioned()||ae.isCaptionFocused()?Object(f.domInsertAfter)(re,ee):domInsertBefore(re,ee),this._setAllParagraphsDirty(),Object(a.focusEl)(re),this._triggerInputEvent(),cancelEvent(e)}var ie=Q(this._getContainingParagraphEl(Object(a.getFocusedElement)()),3),oe=ie[0],ne=ie[2],le=Q(Object(X.getCaretCharacterOffsetWithin)(oe),2)[1];if(e.shiftKey||e.ctrlKey&&browser.safari){var he=Q(Object(X.getCaretCharacterOffsetWithin)(oe),2)[1],de=Object(f.domClosestByTag)("li",g.startContainer),ce=0;de&&(ce=Object(f.domChildIndex)(de));var pe=!1;if(each(ne.lines,(e,t)=>{var r=t.brs,a=t.text.length;return 0==he||he<=a&&inArray(he,r)?(pe=!0,!1):!((he-=a)<=0&&e==ce)&&void 0}),pe){o=!0,this._setParagraphDirty(b,m),document.execCommand("insertParagraph");var _e=domNS(oe);return _e&&(Object(a.focusEl)(_e),_e.focus()),this._triggerInputEvent(),cancelEvent(e)}browser.msie&&0==he&&g.insertNode(se("<br>"))}var ge=u&&g.startContainer.nodeType==Node.TEXT_NODE&&!g.startContainer.nextSibling&&le==oe.textContent.length;h=ge&&!Object(a.isListParagraph)(this._ps[b])&&!e.shiftKey&&inArray(ne.type,[c.ParagraphType.Quote,c.ParagraphType.Quote2]),window.browser&&window.browser.msie&&setTimeout(this._triggerInputEvent.bind(this)),this._setParagraphDirty(b,m)}else e.key&&1==e.key.length?(this._setParagraphDirty(b),this._setParagraphDirty(m),e.metaKey||(I=!0,e.key&&(Object(a.isCyrillicChar)(e.key)?d+=1:Object(a.isLatinChar)(e.key)&&(d-=1),d=Math.min(Math.max(d,-5),5))),r=Object(a.isWhiteSpaceChar)(e.key),I&&!r&&(i=!0),setTimeout(()=>{var e=Q(Object(a.getRange)(),2),t=e[0],r=e[1],i=this._getParagraph(b);if(i&&(i.type!=c.ParagraphType.Code&&!!!(Object(f.gpeByTag)("code",t.startContainer)||t.startContainer.nodeType==Node.ELEMENT_NODE&&"CODE"==t.startContainer.tagName)&&(n=n||d>0,r&&t))){var s=t.startContainer;if(s.nodeType==Node.TEXT_NODE&&t.startOffset>0)for(var o=s.textContent.substring(t.startOffset-5,t.startOffset),h=0,p=S.length;h<p;h++){var _=S[h];if(void 0===_.cyrillic||_.cyrillic===n)if(_.pattern instanceof RegExp){var g=o.match(_.pattern);if(g){var u=_.substitution;g.length>1&&(u=u.replace("$1",g[1])),v.call(this,t.startOffset,s,g[0],u,_.noUndo);break}}else if(o.endsWith(_.pattern)){v.call(this,t.startOffset,s,_.pattern,_.substitution,_.noUndo);break}}}function v(e,t,r,a,i){var s=this._getCursor(),o=t.textContent.substring(0,e-r.length),n=t.textContent.substring(e);i||(l=[t,o+r+n,s]),t.textContent=o+a+n,this._restoreCursor(s),this._setParagraphDirty(b),this._triggerInputEvent()}},0)):!1;l=!1}}),this._setEventListener(window,"resize",()=>{this._resizeTooltip&&this._resizeTooltip.isShown()&&this._updatePositionResizeTooltip()})}}_isParagraphEl(e){return e&&hasClass(e,a.ArticleEditorParagraphClass)}_isWithinObjectParagraphEl(e){var t=Q(this._getContainingParagraphEl(e),1)[0];return t&&Object(a.isObjectParagraphEl)(t)}_highlightObjectsInCurrentSelection(){var e=Q(this._getCurrentParagraphIndex(),2),t=e[0],r=e[1];!1!==t&&!1!==r&&this._ps.forEach((e,a)=>{if(e._object){var i=t!=r;e._object.highlight(a>=t&&a<=r,i)}})}_getOrCreateParagraphObject(e){e._uuid||(e._uuid=oe());var t=this._getObject(e._uuid);if(!t){var r=e.mediaId||"";switch(parseInt(e.type)){case c.ParagraphType.ObjectPhoto:t=new y(r,this,e);break;case c.ParagraphType.ObjectVideo:t=new P(r,this);break;case c.ParagraphType.ObjectGIF:t=new O(r,this);break;case c.ParagraphType.ObjectAudio:t=new T(r,this);break;case c.ParagraphType.ObjectAudioPlaylist:t=new _(r,this);break;case c.ParagraphType.ObjectPodcast:t=new C(r,this);break;case c.ParagraphType.ObjectTwitter:t=new k(r,this);break;case c.ParagraphType.ObjectInstagram:t=new M(r,this);break;case c.ParagraphType.ObjectFacebook:t=new A(r,this);break;case c.ParagraphType.ObjectVK:t=new R(r,this);break;case c.ParagraphType.ObjectTelegram:t=new N(r,this);break;case c.ParagraphType.ObjectPoll:t=new H(r,this);break;case c.ParagraphType.ObjectMarketItem:t=new w(r,this);break;case c.ParagraphType.ObjectAliExpressProduct:t=new x(r,this)}this._setObject(e._uuid,t)}return e._object=t,t}_forgetObject(e){delete this._objects[e]}_getObject(e){return this._objects[e]||null}_setObject(e,t){return this._objects[e]=t}_updateLineData(e){var t=this._getParagraphElByIndex(e);if(t){if(this._isWithinObjectParagraphEl(t)){var r=Q(Object(a.paragraphElProperties)(t),3),i=r[0],s=r[1],o=r[2],n=this._getObject(s);if(!n)return;var l=Object(a.buildParagraph)();if(n.getCaptionEl()){var h=this._getParagraphFromHTML("",n.getCaptionEl().innerHTML,!0);if(i==c.ParagraphType.ObjectPhoto){var d=domData(n.el(),"paragraph-lines");d&&(l.lines=JSON.parse(d));var p=n.getImageIndex();l.lines[p]=h.lines[0];for(var _=0;_<l.lines.length;_++)l.lines[_]=l.lines[_]||{text:"",decorations:{}}}else l.lines[0]=h.lines[0]}l.type=i,l.mode=o,l._uuid=s,l._object=n,this._ps[e]=l}else if(t.nodeType==Node.ELEMENT_NODE){var g=t.tagName.toLowerCase();this._ps[e]=this._getParagraphFromHTML(g,t.innerHTML)}else this._ps[e]=this._getParagraphFromHTML("p",t.textContent);t.nodeType==Node.ELEMENT_NODE&&domData(t,"sep")&&(this._ps[e].sep=!0)}}onDragEnd(){this._dragEnterEventsHandler&&(this._els.canvas.removeEventListener("dragenter",this._dragEnterEventsHandler),delete this._dragEnterEventsHandler),this._dragLeaveEventsHandler&&(this._els.canvas.removeEventListener("dragleave",this._dragLeaveEventsHandler),delete this._dragLeaveEventsHandler),this._dragDropEventsHandler&&(this._els.canvas.removeEventListener("drop",this._dragDropEventsHandler),delete this._dragDropEventsHandler),this._dragEndEventsHandler&&(this._els.canvas.removeEventListener("dragend",this._dragEndEventsHandler),delete this._dragEndEventsHandler)}getCurrentParagraphs(){var e=Q(this._getCurrentParagraphIndex(),2),t=e[0],r=e[1];return[this._getParagraphElByIndex(t),this._getParagraphElByIndex(r)]}_initObjectDrag(){var e,t,r,i,s,o=this,n=0,l=!1,h=null,p=this._els;function _(e){!1!==e&&e===h||u(),s!=e&&(each(geByClass("article_ed__drag_hovered"),(e,t)=>{removeClass(t,"article_ed__drag_hovered")}),e&&addClass(e,"article_ed__drag_hovered"),s=e)}function g(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t),l=!1,removeClass(p.canvas,"no_select"),clearTimeout(n),clearInterval(i),_(!1),re(r),r=!1}function u(){h&&(removeClass(h._objectEl,"article__carousel--noHover"),h.removeCarouselHover(),h=null)}var v=e=>{e&&(addClass(e._object._objectEl,"article__carousel--noHover"),(h=this._getOrCreateParagraphObject(e)).renderCarouselHover())};function b(e){e.preventDefault(),e.stopPropagation()}var m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=!1;t&&(r=o._getOrCreateParagraphObject(t).isCarouselEditorOpened());var a=o._getContainingParagraphEl(e.target),i=Q(a,3),s=i[0],n=i[2],l=n&&+n.type===c.ParagraphType.ObjectPhoto;if(n&&parseInt(n.mode)===c.ObjectResizeType.Float)return!1;if(t===n||r)return!1;if(l){var h=getXY(s),d=getSize(s),p=.7;if(e.pageY<h[1]+d[1]*p)return!0}return!1},y=(e,t)=>{var r=e.isCarouselEditorOpened();t&&(r||e.createCarousel(),t.forEach((t,r)=>{var a={editable:{sizes:d.get(c.ParagraphType.ObjectPhoto,t).sizes}};e.addPhotoInCarousel(t,a,r)}))},P=e=>{n&&(clearTimeout(n),cancelEvent(e)),n=setTimeout(()=>{var t=Q(this._getContainingParagraphEl(e.target),3),r=t[0],a=t[1],s=t[2];s&&+s.type===c.ParagraphType.ObjectPhoto&&m(e)?(_(!1),v(s)):_(r),l=a,addClass(this._els.canvas,"no_select"),clearInterval(i),e.pageY<200+scrollGetY()?i=setInterval(()=>this._options.layer.scrollTop-=10,10):scrollGetY()+window.innerHeight-200<e.pageY&&(i=setInterval(()=>this._options.layer.scrollTop+=10,10))})};["dragenter","dragover","dragleave","drop"].forEach(e=>{this._els.canvas.addEventListener(e,b,!1)}),["dragenter","dragover"].forEach(e=>{this._els.canvas.addEventListener(e,P)}),this._els.canvas.addEventListener("dragleave",e=>{n&&(clearTimeout(n),cancelEvent(e)),n=setTimeout(()=>g(),100)}),this._els.canvas.addEventListener("drop",e=>{var t=e.dataTransfer.files;if(t.length){if(!function(e){return Array.from(e).every(e=>!!e.name&&c.ALLOWED_FILE_TYPES_FOR_PASTE.split(";").some(t=>(t=t.slice(1),e.name.substr(-t.length).toLowerCase()===t)))}(t))return Object(E.showFastBox)(getLang("global_error"),getLang("pages_article_ed_paste_photo_file_error")),void g();if(!1!==l){u(),this._photoPasteUploadingProcess=!0;var r=Q(this._getContainingParagraphEl(e.target),3)[2],i=Array.from(t),s=r&&+r.type===c.ParagraphType.ObjectPhoto&&m(e),o=(e,t)=>new Promise(r=>{var i=new FileReader;i.onload=()=>{this._photoPasteUploadingProcess=!1;var i=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPhoto}),s=this._getOrCreateParagraphObject(t);s.setLoadingState(!0,!0);this._getOrCreateParagraphObject(i).setBLOB(e,()=>{var e=this._getOrCreateParagraphObject(i).getMediaId(0);s.setLoadingState(!1),y(s,[e]),this._forgetObject(i._uuid),r()}),this._resizeTooltip&&this._resizeTooltip.isShown()&&this._resizeTooltip.hide()},i.readAsDataURL(e)});s?Promise.all(i.map(e=>o(e,r))).then(()=>{this._focusParagraph(l),this._showObjectPicker(),this.saveUndoStateAndDraft(),g()}):((e,t)=>new Promise(r=>{var i=new FileReader;i.onload=()=>{this._photoPasteUploadingProcess=!1;var s=t,o=Object(a.buildParagraph)({type:c.ParagraphType.ObjectPhoto});this._getOrCreateParagraphObject(o).setBLOB(e,()=>{r(o)}),Object(a.isParagraphEmpty)(this._ps[t])&&t?(Object(a.hasSeparator)(this._ps[t])&&(o.sep=1),this._ps[t]=o):(s=t+1,this._insertParagraphAt(s,o)),t||this._updateTextPlaceholders(),this._redraw(!0,!0),(new Image).src=i.result,this._resizeTooltip&&this._resizeTooltip.isShown()&&this._resizeTooltip.hide()},i.readAsDataURL(e)}))(t[0],l).then(e=>{for(var t=[],r=1;r<i.length;r++)t.push(o(i[r],e));return Promise.all(t)}).then(()=>{this._showObjectPicker(),this._focusParagraph(l+1),this.saveUndoStateAndDraft(),g()})}}}),this._els.canvas.addEventListener("mousedown",s=>{if(r&&re(r),2==s.button)return g(),cancelEvent(s);var o=getSize(this._els.canvas)[1];removeClass(this._els.canvas,"no_select"),_(!1);var n=Q(this._getContainingParagraphEl(s.target),3),h=n[0],d=n[1],p=n[2];if(Object(a.isObjectParagraph)(p)){var b,P,E,O,j,C=s.pageY;window.addEventListener("mousemove",e=e=>{if(r||!(Math.abs(C-e.pageY)<10)){r||(r=se('<div class="article_ed__drag_shadow"></div>'),this._els.editor.appendChild(r),(b=getXY(this._els.canvas))[1]-=scrollGetY(),P=getSize(h),E=getXY(h),O=e.pageX-E[0],j=e.pageY-E[1]+this._options.layer.scrollTop,setStyle(r,{width:P[0],height:P[1]}),this._focusParagraph(d)),addClass(this._els.canvas,"no_select"),b||g(),setStyle(r,{left:e.pageX-b[0]-O,top:e.pageY-scrollGetY()-j-b[1]+this._options.layer.scrollTop}),clearInterval(i),e.pageY-scrollGetY()<200?i=setInterval(()=>{this._options.layer.scrollTop-=10},10):e.pageY-scrollGetY()>window.innerHeight-200&&(i=setInterval(()=>{this._options.layer.scrollTop+window.innerHeight>o+300?clearInterval(i):this._options.layer.scrollTop+=10},10));var t=Q(this._getContainingParagraphEl(e.target),3),a=t[0],s=t[1],n=t[2];if(+p.type===c.ParagraphType.ObjectPhoto){if(m(e,p))return _(!1),v(n),void(l=s);u()}a&&a!=h&&a!=Object(f.domPS)(h)?(_(a),l=s):(_(!1),l=!1)}}),window.addEventListener("mouseup",t=e=>{if(!1!==l&&d){var t=this._getParagraph(l),r=t&&+t.type===c.ParagraphType.ObjectPhoto&&m(e,p);if(this._ps.splice(d,1),Object(a.hasSeparator)(p)&&(this._ps[d].sep=1,delete p.sep),r){var i=this._getOrCreateParagraphObject(p).getMediaIds(),s=this._getOrCreateParagraphObject(t);y(s,i)}else this._ps.splice(l+1,0,p);if(this._redraw(!0,!0),r){var o=this.getObjectParagraphIndex(t);this._focusParagraph(o)}else this._focusParagraph(l+1);this.saveUndoStateAndDraft(),this._resizeTooltip&&this._resizeTooltip.isShown()&&this._resizeTooltip.hide()}g()})}})}isLocked(){return!!this.getOptions().editLockMessage}showEditLockInfo(){this.isLocked()?(this.showWarningInfo(this.getOptions().editLockMessage),this._els.canvas.removeAttribute("contenteditable"),hide(this._objectPickerEl),this._hideObjectPicker(),this._hideFormatTooltip()):this.showWarningInfo(!1)}showRevEditInfo(){nav.objLoc.from_rev&&this.showWarningInfo(getLang("pages_article_rev_edit"))}showWarningInfo(e){var t=geByClass1("article_ed__warn_info",this._els.editor);t&&!e&&(removeClass(this._els.editor,"article_ed__warn_shown"),re(t)),t||e&&(t=se(`<div class="article_ed__warn_info">${e}</div>`),this._els.editor.appendChild(t),addClass(this._els.editor,"article_ed__warn_shown"))}_initResizeTooltip(){var e=se('<div class="resize-tooltip__btns article_format_btns clear_fix"></div>');this._resizeTooltip=new ElementTooltip(this._els.editor.parentNode,{content:e,autoShow:!1,customShow:!0,forceSide:"top",cls:"resize-tooltip article_format_tt"}),e.addEventListener("click",e=>{if(e.target.classList.contains("article_format_btn")){var t=parseInt(e.target.dataset.mode);this.setModeCurrentObject(t)}})}_showResizeTooltip(){var e=Q(this._getCurrentParagraphIndex(),1)[0],t=this._getParagraphElByIndex(e),r=this._getParagraph(e),a=intval(r.type);if(c.ResizableObjectTypes.includes(a))if(this._resizeTooltip&&!this._resizeTooltip.isShown()&&this._resizeTooltip.show(),hasClass(t,"article_ed__carousel_edit_open"))this._resizeTooltip.hide();else if(r._object.isLoading())this._resizeTooltip.hide();else{var i=[{id:c.ObjectResizeType.Float,type:"inline"},{id:c.ObjectResizeType.Normal,type:"text"},{id:c.ObjectResizeType.Medium,type:"bigger"},{id:c.ObjectResizeType.Large,type:"cover"}],s=geByClass1("resize-tooltip__btns"),o=[1,1,1,1];switch(a){case c.ParagraphType.ObjectPhoto:r._object.isCarousel()?o=[0,1,1,0]:r._object._isSmallPhotoSize()||(o=[1,1,0,0]);break;case c.ParagraphType.ObjectGIF:r._object._isSmallGifSize()||(o=[1,1,0,0]);break;case c.ParagraphType.ObjectTwitter:case c.ParagraphType.ObjectFacebook:case c.ParagraphType.ObjectInstagram:case c.ParagraphType.ObjectVK:case c.ParagraphType.ObjectTelegram:o=[1,1,0,0]}s.innerHTML="",i.forEach((e,t)=>{o[t]&&s.appendChild(se(`\n          <button class="article_format_btn${r.mode==e.id||!r.mode&&!e.id?" article_format_btn_active":""}" id="article_format_btn_${e.type}"  data-mode=${e.id} ></button>\n        `))}),this._updatePositionResizeTooltip()}}_updatePositionResizeTooltip(){var e=this._resizeTooltip,t=Q(getXY(this._els.editor),2)[1],r=Q(this._getCurrentParagraphIndex(),1)[0],a=this._getParagraphElByIndex(r).getBoundingClientRect(),i=a.top,s=a.left,o=a.width,n=getSize(e._ttel)[0]/2;setStyle(e._ttel,{top:i-t-60+window.scrollY+140,left:s+o/2-n})}setModeObject(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.ObjectResizeType.Normal,r=this._getParagraph(e);Object(a.isObjectParagraph)(r)&&(r.mode=t,this._correctEmptyParagraphAfterFloatObjects(),this._redraw(!0,!0),this.saveUndoStateAndDraft())}setModeCurrentObject(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.ObjectResizeType.Normal,t=Q(this._getCurrentParagraphIndex(),1)[0];this.setModeObject(t,e)}_uploadFloatList(){var e=getXY(this._els.editor);this._floatedObjects=[],this._ps.forEach((t,r)=>{if(t.mode&&parseInt(t.mode)===c.ObjectResizeType.Float){var a=this._getParagraphElByIndex(r),i=a.getBoundingClientRect().height,s=getXY(a);this._floatedObjects.push({startY:s[1]-e[1],endY:s[1]-e[1]+i})}})}_correctEmptyParagraphAfterFloatObjects(){for(var e=0;e<this._ps.length;e++){var t=this._ps[e],r=this._ps[e+1];if(Object(a.isObjectResize)(t)>=0)if(1===parseInt(t.mode)&&Object(a.isObjectParagraph)(r)){var i=Object(a.buildParagraph)();i._autoInsert=!0,this._insertParagraphAt(e+1,i)}else 1!==parseInt(t.mode)&&r&&r._autoInsert&&this._deleteParagraphFrom(e+1)}}}},FEjr:function(e,t,r){"use strict";r("OGtf")("strike",function(e){return function(){return e(this,"strike","","")}})},I74W:function(e,t,r){"use strict";r("qncB")("trimLeft",function(e){return function(){return e(this,1)}},"trimStart")},"WF5+":function(e,t,r){"use strict";r.r(t),r.d(t,"ParagraphType",function(){return a}),r.d(t,"ResizableObjectTypes",function(){return i}),r.d(t,"ObjectResizeType",function(){return s}),r.d(t,"ArticleStatsEvents",function(){return o}),r.d(t,"getAppropriateImage",function(){return l}),r.d(t,"preloadImage",function(){return d}),r.d(t,"mailruStatsPixel",function(){return c}),r.d(t,"getUrlParam",function(){return p}),r.d(t,"changeHeightInstagramEmbed",function(){return _}),r.d(t,"ALLOWED_FILE_TYPES_FOR_PASTE",function(){return g});r("OG14"),r("Oyvg"),r("pIFo"),r("Vd3H");var a={Text:1,Header1:2,Header2:3,Header3:4,Code:5,NumericList:6,BulletList:7,Quote:8,Quote2:9,ObjectAudioPlaylist:100,ObjectPhoto:101,ObjectVideo:102,ObjectGIF:103,ObjectPodcast:104,ObjectAudio:105,ObjectTwitter:106,ObjectFacebook:107,ObjectInstagram:108,ObjectVK:109,ObjectTelegram:110,ObjectPoll:111,ObjectMarketItem:112,ObjectAliExpressProduct:113},i=[a.ObjectPhoto,a.ObjectGIF,a.ObjectVideo,a.ObjectTwitter,a.ObjectFacebook,a.ObjectInstagram,a.ObjectVK,a.ObjectTelegram],s={Normal:0,Float:1,Medium:2,Large:3},o={clickOnVideo:"click_on_video",clickOnAudio:"click_on_audio",clickOnPhoto:"click_on_photo",clickOnExternalLink:"external_link_click",clickOnCarouselNext:"click_on_carousel_next",clickOnCarouselPrev:"click_on_carousel_prev",clickOnMentions:"click_on_mentions",nightModeOn:"night_mod_on",nightModeOff:"night_mod_off",close:"close"};function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&!1===t.call(e[r],r,e[r]))break;return e}function l(e,t,r){var a=[];if(n(e,(e,t)=>{r&&-1==["w","z","y","x","m","s"].indexOf(e)||a.push(t)}),!a.length)return[!1];a.sort((e,t)=>e[1]-t[1]),t*=window.devicePixelRatio>=2?2:1;var i=a[a.length-1];return n(a,(e,r)=>{if(r[1]>=t)return i=r,!1}),i}var h={};function d(e,t){if(!0===h[e])return t&&t(),!0;if(isArray(h[e]))return h[e].push(t),!1;h[e]=[t];var r=new Image;return r.onload=()=>{var t=h[e];h[e]=!0,n(t,(e,t)=>{t&&t()})},r.src=e,!1}function c(e,t){if(isObject(t)&&!isEmpty(t)){var r=`https://vk-callback.go.mail.ru/longread_pxl?action=${e}`;n(t,(e,t)=>{r+=`&${e}=${t}`}),(new Image).src=r}}function p(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function _(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,r=document.getElementsByTagName("iframe"),a=r.length-1;a>=0;a--){var i=r[a];if(i.contentWindow===e.source){t=i;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout(()=>{if("MEASURE"===e.type){var r=e.details.height;t.setAttribute("height",r)}},100)}}}var g="*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF"},fA63:function(e,t,r){"use strict";r("qncB")("trimRight",function(e){return function(){return e(this,2)}},"trimEnd")},qncB:function(e,t,r){var a=r("XKFU"),i=r("vhPU"),s=r("eeVq"),o=r("/e88"),n="["+o+"]",l=RegExp("^"+n+n+"*"),h=RegExp(n+n+"*$"),d=function(e,t,r){var i={},n=s(function(){return!!o[e]()||"​"!="​"[e]()}),l=i[e]=n?t(c):o[e];r&&(i[r]=l),a(a.P+a.F*n,"String",i)},c=d.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(h,"")),e};e.exports=d},u2Gu:function(e,t,r){"use strict";r.r(t),r.d(t,"NBSP",function(){return i}),r.d(t,"CURSOR_MARKER_START",function(){return s}),r.d(t,"CURSOR_MARKER_END",function(){return o}),r.d(t,"ArticleEditorParagraphClass",function(){return n}),r.d(t,"replaceParagraphEntities",function(){return l}),r.d(t,"isQuoteEl",function(){return h}),r.d(t,"paragraphElProperties",function(){return d}),r.d(t,"deb",function(){return c}),r.d(t,"isParagraphEl",function(){return p}),r.d(t,"selectEl",function(){return _}),r.d(t,"focusEl",function(){return g}),r.d(t,"isBR",function(){return u}),r.d(t,"prepareLineText",function(){return v}),r.d(t,"getElementIndex",function(){return b}),r.d(t,"isObjectParagraphEl",function(){return f}),r.d(t,"isObjectParagraph",function(){return m}),r.d(t,"isObjectResize",function(){return y}),r.d(t,"hasSeparator",function(){return P}),r.d(t,"genSepatorId",function(){return O}),r.d(t,"isEmbedType",function(){return j}),r.d(t,"isHeaderParagraph",function(){return C}),r.d(t,"isListParagraph",function(){return T}),r.d(t,"buildParagraph",function(){return w}),r.d(t,"convertBRsToArray",function(){return x}),r.d(t,"getRange",function(){return I}),r.d(t,"prepareSpacesWithSpaces",function(){return S}),r.d(t,"cleanTextSpaces",function(){return k}),r.d(t,"mergeRanges",function(){return L}),r.d(t,"isWhiteSpaceChar",function(){return A}),r.d(t,"isCyrillicChar",function(){return D}),r.d(t,"isLatinChar",function(){return R}),r.d(t,"isAlienParagraphEl",function(){return B}),r.d(t,"getFocusedElement",function(){return N}),r.d(t,"getPhotoSize",function(){return z}),r.d(t,"childNodeIndex",function(){return H}),r.d(t,"generateLatinizedName",function(){return F}),r.d(t,"dataURItoBlob",function(){return $}),r.d(t,"imageToBlob",function(){return K}),r.d(t,"queuePhotoProcess",function(){return V}),r.d(t,"justCursorInString",function(){return X}),r.d(t,"isParagraphEmpty",function(){return Q}),r.d(t,"arrayUnique",function(){return q}),r.d(t,"decorationsSlice",function(){return J}),r.d(t,"cleanLineBRs",function(){return Z}),r.d(t,"cleanBRs",function(){return ee}),r.d(t,"createParagraphEl",function(){return te}),r.d(t,"traverseTree",function(){return re}),r.d(t,"throttle",function(){return ae}),r.d(t,"isPublishNameCorrect",function(){return ie}),r.d(t,"correctRealIndexes",function(){return ne}),r.d(t,"isVKUrl",function(){return le}),r.d(t,"decodeURL",function(){return he}),r.d(t,"BlockElements",function(){return de}),r.d(t,"hasBlockElements",function(){return ce}),r.d(t,"buildProductSnippetElement",function(){return pe});r("NO8f"),r("KKXr"),r("fA63"),r("I74W"),r("OG14"),r("Vd3H"),r("pIFo");var a=r("WF5+"),i="&nbsp;",s="​",o="‌",n="_article_paragraph";function l(e){return se("<textarea>"+(e||"")+"</textarea>").value.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(e){return e&&e.nodeType==Node.ELEMENT_NODE&&inArray(e.tagName.toLowerCase(),["cite","blockquote"])}function d(e){return[domData(e,"type"),domData(e,"uuid"),domData(e,"mode")]}function c(e,t){cur[e]=cur[e]||0,void 0===t?console.log(e,cur[e]):cur[e],cur[e]++}function p(e){return e&&hasClass(e,"_article_paragraph")}function _(e){if(e)try{var t=document.createRange();t.selectNodeContents(e);var r=window.getSelection();r.removeAllRanges(),r.addRange(t)}catch(e){}}function g(e,t){if(e)try{var r=document.createRange();t?(r.selectNodeContents(e),r.collapse(!1)):(r.setStart(e,0),r.setEnd(e,0));var a=window.getSelection();a.removeAllRanges(),a.addRange(r)}catch(e){}}function u(e){return e&&e.nodeType==Node.ELEMENT_NODE&&"BR"==e.tagName}function v(e,t,r,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e=e.substring(t,r),a&&a.length){var s=[],o=0;a.forEach(r=>{if(!((r-=t)<=0||r>e.length)){var a=e.substring(o,r)+"<br/>";a=i?a:S(a),s.push(a),o=r}});var n=e.substring(o);s.push(i?n:S(n));s[s.length-1];return s.join("")}return i?e:S(e)}function b(e){if(!e)return!1;for(var t=0;null!=(e=e.previousSibling);)t++;return t}function f(e){return e&&e.nodeType==Node.ELEMENT_NODE&&!!domData(e,"uuid")}function m(e){return e&&e.type&&e.type>=100}function y(e){return e&&e.mode}function P(e){return e&&e.sep}var E=0;function O(){return++E}function j(e){return inArray(e,[a.ParagraphType.ObjectFacebook,a.ParagraphType.ObjectInstagram,a.ParagraphType.ObjectTwitter,a.ParagraphType.ObjectTelegram,a.ParagraphType.ObjectVK,a.ParagraphType.ObjectAliExpressProduct])}function C(e){var t;return t=isObject(e)?e.type:e,inArray(t,[a.ParagraphType.Header1,a.ParagraphType.Header2,a.ParagraphType.Header3])}function T(e){return e&&(e.type==a.ParagraphType.NumericList||e.type==a.ParagraphType.BulletList)}function w(e){var t={};return m(e=e||{})&&(t._uuid=e._uuid),t.lines=e.lines||[{text:"",decorations:{},brs:[]}],t.type=e.type?parseInt(e.type):a.ParagraphType.Text,e.mediaId&&(t.mediaId=e.mediaId),e.sep&&(t.sep=e.sep),e.fromExtPage&&(t.fromExtPage=e.fromExtPage),t}function x(e){if(isArray(e))return e;var t=[];return each(e,(e,r)=>{t.push(intval(r))}),t.sort(),t}function I(){var e=window.getSelection();return e.rangeCount?[e.getRangeAt(0),e.isCollapsed,e]:[!1]}function S(e){return-1!=e.search(/^\s/)&&(e=" "+e.trimLeft()),-1!=e.search(/\s$/)&&(e=e.trimRight()+i),e}function k(e){return e.replace(/\s\s+/g," ").replace(/\s/g," ")}function L(e){var t=e.slice();t.sort((e,t)=>e[0]-t[0]);for(var r=0;r<t.length-1;){var a=t[r],i=t[r+1],s=a[2]===i[2];a[1]>=i[0]&&s?(a[1]=Math.max(a[1],i[1]),t.splice(r+1,1)):r++}return t}function A(e){return/\s/.test(e)}var M=/[\u0400-\u04FF]/;function D(e){return M.test(e)}function R(e){return/[a-zA-Z]/.test(e)}function B(e){return!hasClass(e,n)}function N(){return window.getSelection().focusNode}function z(e){var t=[];each(e,(e,r)=>{t.push(r)});var r=t.sort((e,t)=>t[1]-e[1])[0];return[r[1],r[2]]}function H(e){for(var t=e.parentNode,r=0;r<t.childNodes.length;r++)if(e==t.childNodes[r])return r;return-1}var U={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1105:"e",1078:"zh",1079:"z",1080:"i",1081:"i",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"c",1095:"ch",1096:"sh",1097:"sch",1099:"y",1101:"e",1102:"u",1103:"ya"};function F(e,t){e=e.toLowerCase();for(var r="",a=!1,i="-qwertyuiopasdfghjklzxcvbnm0123456789".split(""),s=0;s<e.length;s++)if(/\s/.test(e[s]))a||(r+="-",a=!0);else if(inArray(e[s],i))r+=e[s],a=!1;else{var o=U[e.charCodeAt(s)];o&&(r+=o,a=!1)}return r=(r=r.substr(0,t)).replace(/-*$/,"").replace(/^-*/,"").replace(/-+/g,"-")}function $(e){var t,r,a;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(t.length);for(var i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([a],{type:r})}function K(e,t,r){var a;if("function"==typeof t&&(r=t,t={}),t=t||{},!e)return r(new Error("Pass in a IMG DOM node or a url as first param"));if("object"==typeof e&&"img"===e.tagName.toLowerCase()&&(a=e.src),"string"==typeof e&&(a=e),!/^data:/.test(a)||t.convert){var i,s={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",svg:"image/svg+xml"};t.type=s[t.type]||((i=a)?s[i.split("?").shift().split(".").pop()]:null),t.src=a,t.callback=r,t.name=a,t.type?function(e,t){var r=document.createElement("canvas"),a=document.createElement("img");a.onload=function(){var e=r.getContext("2d");r.width=a.width,r.height=a.height,e.drawImage(a,0,0),t(null,r.toDataURL("image/png"))},a.addEventListener("error",()=>{t(new Error("FailedToLoadImage"))}),r.getContext?(a.crossOrigin="anonymous",a.src=e):setTimeout(t,0,new Error("CanvasIsNotSupported"))}(a,function(e,t,r){if(t)return void e.callback(t);var a=$(r);a.name=a.filename=e.name,e.callback(null,a)}.bind(null,t)):r(new Error("Image type is not supported"))}else r(null,$(a))}var W=[],Y=0,G=2;function V(e,t){W.push({src:e,cb:t}),function e(){if(0!=W.length&&Y!=G){Y++;var t=W.shift(),r=new Image;r.addEventListener("error",()=>{t.cb(!0,!1,()=>{Y--,e()})}),r.addEventListener("load",()=>{K(r,{},(r,a)=>{t.cb(r,a,()=>{Y--,e()})})}),r.src=t.src}}()}function X(e){return 1==(e=trim(e)).length&&e[0]==s}function Q(e,t){if(!e)return!0;if(m(e))return!1;var r=e.lines;return 0==r.length||!(t?trim(r[0].text):r[0].text)}function q(e){return e.filter((e,t,r)=>r.indexOf(e)===t)}function J(e,t,r){var a={};for(var i in e)e.hasOwnProperty(i)&&function(){var s=[];e[i].forEach(e=>{t<e[1]&&e[0]<=r&&s.push([Math.max(e[0],t)-t,Math.min(r,e[1])-t,e[2]])}),a[i]=s}();return a}function Z(e){e.brs=q(e.brs),e.brs[e.brs.length-1]==e.text.length&&e.brs.pop()}function ee(e,t){var r=e.length;return 1==r&&e[r-1]==t?e.pop():r>1&&e[r-1]==t&&e[r-2]!=t&&e.pop(),e}function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(arguments.length>1?arguments[1]:void 0)?`data-sep="${O()}"`:"";return se(`<p class="${n}" ${t}>${e}</p>`)}function re(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t(e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]);if(void 0!==a)return a;for(var i,s=Array.prototype.slice.call(r?e.children:e.childNodes);i=s.shift();){var o=re(i,t,r,!1);if(void 0!==o)return o}}function ae(e,t,r){var a,i,s,o=null,n=0;r||(r={});var l=function(){n=!1===r.leading?0:Date.now(),o=null,s=e.apply(a,i),o||(a=i=null)};return function(){var h=Date.now();n||!1!==r.leading||(n=h);var d=t-(h-n);return a=this,i=arguments,d<=0||d>t?(o&&(clearTimeout(o),o=null),n=h,s=e.apply(a,i),o||(a=i=null)):o||!1===r.trailing||(o=setTimeout(l,d)),s}}function ie(e){return!!/^[a-z0-9\-]+$/.test(e)&&(-1==e.indexOf("--")&&("-"!=e[0]&&"-"!=e[e.length-1]&&!(e.length>60)))}function oe(e,t,r){e.decorations&&each(e.decorations,(e,a)=>{a.forEach(e=>{e[0]>t&&(e[0]+=r),e[1]>t&&(e[1]+=r)})}),e.brs&&e.brs.forEach((r,a)=>{r>t&&(e.brs[a]-=1)})}function ne(e,t){e.forEach(e=>{e.lines.forEach(e=>{for(var r=0,a=e.text.length;r<a;r++){var i=e.text.charCodeAt(r);i>=55296&&i<=56319&&(oe(e,r,t),r+=1)}})})}function le(e){return/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(e)}function he(e){var t=e;try{t=decodeURIComponent(e)}catch(r){t=e}return t}var de="div p footer form h1 h2 h3 h4 h5 h6 header hgroup hr main nav output pre section table tfoot address article aside blockquote canvas dd dl dt fieldset figcaption figure".toUpperCase().split(" ");function ce(e){for(var t=0,r=e.children.length;t<r;t++)if(de.indexOf(e.children[t].tagName)>=0)return!0;return!1}function pe(e,t){var r;if(e.snippet)r=e.snippet;else{var a=e.product;a.description||(a.description=a.title),r=rs(cur.articleEditor.getOptions().marketItemSnippetTemplate,a)}return se(`<div class="${t}" contenteditable="false">${r}</div>`)}}}]);try{stManager.done("cmodules/bundles/6deb4edfcbfb465064078145a4a266bf.4779f349b04575ab7a82.js")}catch(e){}